var T0=Object.create;var Ns=Object.defineProperty;var F0=Object.getOwnPropertyDescriptor;var L0=Object.getOwnPropertyNames;var M0=Object.getPrototypeOf,N0=Object.prototype.hasOwnProperty;var B0=(n,e)=>()=>(n&&(e=n(n=0)),e);var wt=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),Ce=(n,e)=>{for(var r in e)Ns(n,r,{get:e[r],enumerable:!0})},yp=(n,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of L0(e))!N0.call(n,a)&&a!==r&&Ns(n,a,{get:()=>e[a],enumerable:!(o=F0(e,a))||o.enumerable});return n};var cn=(n,e,r)=>(r=n!=null?T0(M0(n)):{},yp(e||!n||!n.__esModule?Ns(r,"default",{value:n,enumerable:!0}):r,n)),O0=n=>yp(Ns({},"__esModule",{value:!0}),n);var xp={};Ce(xp,{default:()=>P0});function P0(n){n.nav.menu.append({content:'text:"Open on GitHub"',data:{href:"https://github.com/lahmatiy/about.me"}}),n.page.define("default",{view:"context",modifiers:{view:"block",className:"mode-toggle",content:{view:"toggle-group",name:"mode",value:"=#.params.mode",data:[{value:"forhumans",text:"For everyone"},{value:"forgeeks",text:"For geeks"}],afterToggles:'md:"Powered by [Discovery.js](https://github.com/discoveryjs/discovery)"'}},content:[function(e,r,o,a){n.setPageParams(a.mode!=="forhumans"?{mode:a.mode}:{},!0),n.cancelScheduledRender(),a.params=n.pageParams},{view:"switch",content:[{when:'#.mode="forhumans"',content:{view:"block",className:"for-humans",content:["h1:who.name","md:who.bio",{view:"inline-list",data:"who.entries().[value ~= /^http/]",item:"badge:{ text: key, href: value, external: true }"},'h2:"Open Source projects"',{view:"ol",className:"projects",limit:!1,data:"projects",item:[{view:"block",when:"spotlight",className:"spotlight",content:'text:"\u2605"'},"link:{ text: title, href: url, external: true }",{view:"context",when:"role",content:['badge:{ text: role, color: "#dcaf025c" }']},'text:" \u2013 " + description',{view:"ul",data:"satellites",whenData:!0,item:[{view:"block",when:"spotlight",className:"spotlight",content:'text:"\u2605"'},"link:{ text: title, href: url, external: true }",{view:"context",when:"role",content:['badge:{ text: role, color: "#dcaf025c" }']},'text:" \u2013 " + description']}]},'h2:"Talks"',{view:"ol",className:"talks",limit:!1,data:"talks",item:[{view:"switch",content:[{when:"slides",content:"link:{ text: title, href: slides, external: true }"},{content:"text:title"}]},'text:" "',{view:"badge",when:"slides_en",data:'{ text: "Slides in English", href: slides_en, external: true, color: "#dcaf025c" }'},{view:"badge",when:"video",data:'{ text: "Video", href: video, external: true, color: "#dc02025c" }'},{view:"block",className:"talk-details",content:"text:`${date} / ${event} / ${location}`"}]},'h2:"Articles"',{view:"ol",limit:!1,data:"articles",item:["link:{ text: title, href: url, external: true }","text:` (${date})`"]},'h2:"Participation in podcasts"',{view:"ol",className:"shows",limit:!1,data:"shows",item:["text:title",{view:"ul",data:"episodes",item:[{view:"switch",content:[{when:"url",content:"link:{ text: title or num, href: url, external: true }"},{content:"text:title or num"}]},{view:"inline-list",when:"media",data:"media.entries()",item:"badge:{ text: key, href: value, external: true }"}]}]},'h2:"Event production"',{view:"ol",limit:!1,data:"eventProduction",item:['link:{ text: title + (num ? " #" + num : ""), href: url, external: true }',"text:` (${date}) ${location} `",{view:"inline-list",data:"roles",item:"badge"}]}]}},{content:{view:"struct",expanded:2,limit:12}}]}]}),n.view.define("video",(e,r,o)=>{let{video:a}=typeof o=="string"?{video:o}:o;if(typeof a=="string"){let u=document.createElement("iframe");u.setAttribute("width",280),u.setAttribute("height",158),u.setAttribute("src",a.replace(/^https?:\/\/youtu.be\/([^\/]+)\/?$/,"https://www.youtube.com/embed/$1")),u.setAttribute("frameborder",0),u.setAttribute("allow","accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"),u.setAttribute("allowfullscreen",""),e.appendChild(u)}})}var kp=B0(()=>{});var Cn=wt((Tc,Fc)=>{(function(n,e){typeof Tc=="object"&&typeof Fc<"u"?Fc.exports=e():typeof define=="function"&&define.amd?define(e):(n=n||self,n.CodeMirror=e())})(Tc,function(){"use strict";var n=navigator.userAgent,e=navigator.platform,r=/gecko\/\d/i.test(n),o=/MSIE \d/.test(n),a=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(n),u=/Edge\/(\d+)/.exec(n),f=o||a||u,d=f&&(o?document.documentMode||6:+(u||a)[1]),h=!u&&/WebKit\//.test(n),g=h&&/Qt\/\d+\.\d+/.test(n),v=!u&&/Chrome\/(\d+)/.exec(n),w=v&&+v[1],x=/Opera\//.test(n),T=/Apple Computer/.test(navigator.vendor),E=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(n),M=/PhantomJS/.test(n),F=T&&(/Mobile\/\w+/.test(n)||navigator.maxTouchPoints>2),D=/Android/.test(n),C=F||D||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(n),L=F||/Mac/.test(e),N=/\bCrOS\b/.test(n),B=/win/i.test(e),O=x&&n.match(/Version\/(\d*\.\d*)/);O&&(O=Number(O[1])),O&&O>=15&&(x=!1,h=!0);var z=L&&(g||x&&(O==null||O<12.11)),_=r||f&&d>=9;function W(t){return new RegExp("(^|\\s)"+t+"(?:$|\\s)\\s*")}var te=function(t,i){var l=t.className,s=W(i).exec(l);if(s){var c=l.slice(s.index+s[0].length);t.className=l.slice(0,s.index)+(c?s[1]+c:"")}};function H(t){for(var i=t.childNodes.length;i>0;--i)t.removeChild(t.firstChild);return t}function X(t,i){return H(t).appendChild(i)}function A(t,i,l,s){var c=document.createElement(t);if(l&&(c.className=l),s&&(c.style.cssText=s),typeof i=="string")c.appendChild(document.createTextNode(i));else if(i)for(var p=0;p<i.length;++p)c.appendChild(i[p]);return c}function Q(t,i,l,s){var c=A(t,i,l,s);return c.setAttribute("role","presentation"),c}var U;document.createRange?U=function(t,i,l,s){var c=document.createRange();return c.setEnd(s||t,l),c.setStart(t,i),c}:U=function(t,i,l){var s=document.body.createTextRange();try{s.moveToElementText(t.parentNode)}catch{return s}return s.collapse(!0),s.moveEnd("character",l),s.moveStart("character",i),s};function ce(t,i){if(i.nodeType==3&&(i=i.parentNode),t.contains)return t.contains(i);do if(i.nodeType==11&&(i=i.host),i==t)return!0;while(i=i.parentNode)}function xe(t){var i=t.ownerDocument||t,l;try{l=t.activeElement}catch{l=i.body||null}for(;l&&l.shadowRoot&&l.shadowRoot.activeElement;)l=l.shadowRoot.activeElement;return l}function Le(t,i){var l=t.className;W(i).test(l)||(t.className+=(l?" ":"")+i)}function _e(t,i){for(var l=t.split(" "),s=0;s<l.length;s++)l[s]&&!W(l[s]).test(i)&&(i+=" "+l[s]);return i}var et=function(t){t.select()};F?et=function(t){t.selectionStart=0,t.selectionEnd=t.value.length}:f&&(et=function(t){try{t.select()}catch{}});function Ke(t){return t.display.wrapper.ownerDocument}function ht(t){return Pe(t.display.wrapper)}function Pe(t){return t.getRootNode?t.getRootNode():t.ownerDocument}function ke(t){return Ke(t).defaultView}function be(t){var i=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,i)}}function G(t,i,l){i||(i={});for(var s in t)t.hasOwnProperty(s)&&(l!==!1||!i.hasOwnProperty(s))&&(i[s]=t[s]);return i}function ae(t,i,l,s,c){i==null&&(i=t.search(/[^\s\u00a0]/),i==-1&&(i=t.length));for(var p=s||0,m=c||0;;){var y=t.indexOf("	",p);if(y<0||y>=i)return m+(i-p);m+=y-p,m+=l-m%l,p=y+1}}var ne=function(){this.id=null,this.f=null,this.time=0,this.handler=be(this.onTimeout,this)};ne.prototype.onTimeout=function(t){t.id=0,t.time<=+new Date?t.f():setTimeout(t.handler,t.time-+new Date)},ne.prototype.set=function(t,i){this.f=i;var l=+new Date+t;(!this.id||l<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,t),this.time=l)};function re(t,i){for(var l=0;l<t.length;++l)if(t[l]==i)return l;return-1}var Ee=50,Ae={toString:function(){return"CodeMirror.Pass"}},we={scroll:!1},We={origin:"*mouse"},Te={origin:"+move"};function $e(t,i,l){for(var s=0,c=0;;){var p=t.indexOf("	",s);p==-1&&(p=t.length);var m=p-s;if(p==t.length||c+m>=i)return s+Math.min(m,i-c);if(c+=p-s,c+=l-c%l,s=p+1,c>=i)return s}}var st=[""];function it(t){for(;st.length<=t;)st.push(Me(st)+" ");return st[t]}function Me(t){return t[t.length-1]}function ze(t,i){for(var l=[],s=0;s<t.length;s++)l[s]=i(t[s],s);return l}function V(t,i,l){for(var s=0,c=l(i);s<t.length&&l(t[s])<=c;)s++;t.splice(s,0,i)}function se(){}function J(t,i){var l;return Object.create?l=Object.create(t):(se.prototype=t,l=new se),i&&G(i,l),l}var Ne=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function gt(t){return/\w/.test(t)||t>"\x80"&&(t.toUpperCase()!=t.toLowerCase()||Ne.test(t))}function Dn(t,i){return i?i.source.indexOf("\\w")>-1&&gt(t)?!0:i.test(t):gt(t)}function Zo(t){for(var i in t)if(t.hasOwnProperty(i)&&t[i])return!1;return!0}var An=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function tt(t){return t.charCodeAt(0)>=768&&An.test(t)}function In(t,i,l){for(;(l<0?i>0:i<t.length)&&tt(t.charAt(i));)i+=l;return i}function mn(t,i,l){for(var s=i>l?-1:1;;){if(i==l)return i;var c=(i+l)/2,p=s<0?Math.ceil(c):Math.floor(c);if(p==i)return t(p)?i:l;t(p)?l=p:i=p+s}}function jn(t,i,l,s){if(!t)return s(i,l,"ltr",0);for(var c=!1,p=0;p<t.length;++p){var m=t[p];(m.from<l&&m.to>i||i==l&&m.to==i)&&(s(Math.max(m.from,i),Math.min(m.to,l),m.level==1?"rtl":"ltr",p),c=!0)}c||s(i,l,"ltr")}var or=null;function zn(t,i,l){var s;or=null;for(var c=0;c<t.length;++c){var p=t[c];if(p.from<i&&p.to>i)return c;p.to==i&&(p.from!=p.to&&l=="before"?s=c:or=c),p.from==i&&(p.from!=p.to&&l!="before"?s=c:or=c)}return s??or}var Ua=function(){var t="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",i="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";function l(k){return k<=247?t.charAt(k):1424<=k&&k<=1524?"R":1536<=k&&k<=1785?i.charAt(k-1536):1774<=k&&k<=2220?"r":8192<=k&&k<=8203?"w":k==8204?"b":"L"}var s=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,c=/[stwN]/,p=/[LRr]/,m=/[Lb1n]/,y=/[1n]/;function b(k,P,j){this.level=k,this.from=P,this.to=j}return function(k,P){var j=P=="ltr"?"L":"R";if(k.length==0||P=="ltr"&&!s.test(k))return!1;for(var q=k.length,R=[],Y=0;Y<q;++Y)R.push(l(k.charCodeAt(Y)));for(var ee=0,oe=j;ee<q;++ee){var le=R[ee];le=="m"?R[ee]=oe:oe=le}for(var de=0,ue=j;de<q;++de){var pe=R[de];pe=="1"&&ue=="r"?R[de]="n":p.test(pe)&&(ue=pe,pe=="r"&&(R[de]="R"))}for(var ve=1,ge=R[0];ve<q-1;++ve){var Se=R[ve];Se=="+"&&ge=="1"&&R[ve+1]=="1"?R[ve]="1":Se==","&&ge==R[ve+1]&&(ge=="1"||ge=="n")&&(R[ve]=ge),ge=Se}for(var Re=0;Re<q;++Re){var ft=R[Re];if(ft==",")R[Re]="N";else if(ft=="%"){var Ge=void 0;for(Ge=Re+1;Ge<q&&R[Ge]=="%";++Ge);for(var Pt=Re&&R[Re-1]=="!"||Ge<q&&R[Ge]=="1"?"1":"N",Lt=Re;Lt<Ge;++Lt)R[Lt]=Pt;Re=Ge-1}}for(var nt=0,Mt=j;nt<q;++nt){var pt=R[nt];Mt=="L"&&pt=="1"?R[nt]="L":p.test(pt)&&(Mt=pt)}for(var ot=0;ot<q;++ot)if(c.test(R[ot])){var rt=void 0;for(rt=ot+1;rt<q&&c.test(R[rt]);++rt);for(var Ze=(ot?R[ot-1]:j)=="L",Nt=(rt<q?R[rt]:j)=="L",ai=Ze==Nt?Ze?"L":"R":j,Jn=ot;Jn<rt;++Jn)R[Jn]=ai;ot=rt-1}for(var bt=[],xn,dt=0;dt<q;)if(m.test(R[dt])){var Rl=dt;for(++dt;dt<q&&m.test(R[dt]);++dt);bt.push(new b(0,Rl,dt))}else{var Bn=dt,gr=bt.length,mr=P=="rtl"?1:0;for(++dt;dt<q&&R[dt]!="L";++dt);for(var Ct=Bn;Ct<dt;)if(y.test(R[Ct])){Bn<Ct&&(bt.splice(gr,0,new b(1,Bn,Ct)),gr+=mr);var li=Ct;for(++Ct;Ct<dt&&y.test(R[Ct]);++Ct);bt.splice(gr,0,new b(2,li,Ct)),gr+=mr,Bn=Ct}else++Ct;Bn<dt&&bt.splice(gr,0,new b(1,Bn,dt))}return P=="ltr"&&(bt[0].level==1&&(xn=k.match(/^\s+/))&&(bt[0].from=xn[0].length,bt.unshift(new b(0,0,xn[0].length))),Me(bt).level==1&&(xn=k.match(/\s+$/))&&(Me(bt).to-=xn[0].length,bt.push(new b(0,q-xn[0].length,q)))),P=="rtl"?bt.reverse():bt}}();function Fe(t,i){var l=t.order;return l==null&&(l=t.order=Ua(t.text,i)),l}var Xo=[],me=function(t,i,l){if(t.addEventListener)t.addEventListener(i,l,!1);else if(t.attachEvent)t.attachEvent("on"+i,l);else{var s=t._handlers||(t._handlers={});s[i]=(s[i]||Xo).concat(l)}};function Sn(t,i){return t._handlers&&t._handlers[i]||Xo}function mt(t,i,l){if(t.removeEventListener)t.removeEventListener(i,l,!1);else if(t.detachEvent)t.detachEvent("on"+i,l);else{var s=t._handlers,c=s&&s[i];if(c){var p=re(c,l);p>-1&&(s[i]=c.slice(0,p).concat(c.slice(p+1)))}}}function Ye(t,i){var l=Sn(t,i);if(l.length)for(var s=Array.prototype.slice.call(arguments,2),c=0;c<l.length;++c)l[c].apply(null,s)}function Qe(t,i,l){return typeof i=="string"&&(i={type:i,preventDefault:function(){this.defaultPrevented=!0}}),Ye(t,l||i.type,t,i),St(i)||i.codemirrorIgnore}function Yt(t){var i=t._handlers&&t._handlers.cursorActivity;if(i)for(var l=t.curOp.cursorActivityHandlers||(t.curOp.cursorActivityHandlers=[]),s=0;s<i.length;++s)re(l,i[s])==-1&&l.push(i[s])}function Bt(t,i){return Sn(t,i).length>0}function en(t){t.prototype.on=function(i,l){me(this,i,l)},t.prototype.off=function(i,l){mt(this,i,l)}}function vt(t){t.preventDefault?t.preventDefault():t.returnValue=!1}function Ir(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}function St(t){return t.defaultPrevented!=null?t.defaultPrevented:t.returnValue==!1}function Rn(t){vt(t),Ir(t)}function Oi(t){return t.target||t.srcElement}function tn(t){var i=t.which;return i==null&&(t.button&1?i=1:t.button&2?i=3:t.button&4&&(i=2)),L&&t.ctrlKey&&i==1&&(i=3),i}var Va=function(){if(f&&d<9)return!1;var t=A("div");return"draggable"in t||"dragDrop"in t}(),jr;function es(t){if(jr==null){var i=A("span","\u200B");X(t,A("span",[i,document.createTextNode("x")])),t.firstChild.offsetHeight!=0&&(jr=i.offsetWidth<=1&&i.offsetHeight>2&&!(f&&d<8))}var l=jr?A("span","\u200B"):A("span","\xA0",null,"display: inline-block; width: 1px; margin-right: -1px");return l.setAttribute("cm-text",""),l}var Pi;function Hn(t){if(Pi!=null)return Pi;var i=X(t,document.createTextNode("A\u062EA")),l=U(i,0,1).getBoundingClientRect(),s=U(i,1,2).getBoundingClientRect();return H(t),!l||l.left==l.right?!1:Pi=s.right-l.right<3}var Qt=`

b`.split(/\n/).length!=3?function(t){for(var i=0,l=[],s=t.length;i<=s;){var c=t.indexOf(`
`,i);c==-1&&(c=t.length);var p=t.slice(i,t.charAt(c-1)=="\r"?c-1:c),m=p.indexOf("\r");m!=-1?(l.push(p.slice(0,m)),i+=m+1):(l.push(p),i=c+1)}return l}:function(t){return t.split(/\r\n?|\n/)},qn=window.getSelection?function(t){try{return t.selectionStart!=t.selectionEnd}catch{return!1}}:function(t){var i;try{i=t.ownerDocument.selection.createRange()}catch{}return!i||i.parentElement()!=t?!1:i.compareEndPoints("StartToEnd",i)!=0},ts=function(){var t=A("div");return"oncopy"in t?!0:(t.setAttribute("oncopy","return;"),typeof t.oncopy=="function")}(),nn=null;function Ga(t){if(nn!=null)return nn;var i=X(t,A("span","x")),l=i.getBoundingClientRect(),s=U(i,0,1).getBoundingClientRect();return nn=Math.abs(l.left-s.left)>1}var zr={},rn={};function on(t,i){arguments.length>2&&(i.dependencies=Array.prototype.slice.call(arguments,2)),zr[t]=i}function sr(t,i){rn[t]=i}function Rr(t){if(typeof t=="string"&&rn.hasOwnProperty(t))t=rn[t];else if(t&&typeof t.name=="string"&&rn.hasOwnProperty(t.name)){var i=rn[t.name];typeof i=="string"&&(i={name:i}),t=J(i,t),t.name=i.name}else{if(typeof t=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(t))return Rr("application/xml");if(typeof t=="string"&&/^[\w\-]+\/[\w\-]+\+json$/.test(t))return Rr("application/json")}return typeof t=="string"?{name:t}:t||{name:"null"}}function Hr(t,i){i=Rr(i);var l=zr[i.name];if(!l)return Hr(t,"text/plain");var s=l(t,i);if(_n.hasOwnProperty(i.name)){var c=_n[i.name];for(var p in c)c.hasOwnProperty(p)&&(s.hasOwnProperty(p)&&(s["_"+p]=s[p]),s[p]=c[p])}if(s.name=i.name,i.helperType&&(s.helperType=i.helperType),i.modeProps)for(var m in i.modeProps)s[m]=i.modeProps[m];return s}var _n={};function qr(t,i){var l=_n.hasOwnProperty(t)?_n[t]:_n[t]={};G(i,l)}function vn(t,i){if(i===!0)return i;if(t.copyState)return t.copyState(i);var l={};for(var s in i){var c=i[s];c instanceof Array&&(c=c.concat([])),l[s]=c}return l}function Ii(t,i){for(var l;t.innerMode&&(l=t.innerMode(i),!(!l||l.mode==t));)i=l.state,t=l.mode;return l||{mode:t,state:i}}function _r(t,i,l){return t.startState?t.startState(i,l):!0}var Je=function(t,i,l){this.pos=this.start=0,this.string=t,this.tabSize=i||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=l};Je.prototype.eol=function(){return this.pos>=this.string.length},Je.prototype.sol=function(){return this.pos==this.lineStart},Je.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},Je.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},Je.prototype.eat=function(t){var i=this.string.charAt(this.pos),l;if(typeof t=="string"?l=i==t:l=i&&(t.test?t.test(i):t(i)),l)return++this.pos,i},Je.prototype.eatWhile=function(t){for(var i=this.pos;this.eat(t););return this.pos>i},Je.prototype.eatSpace=function(){for(var t=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>t},Je.prototype.skipToEnd=function(){this.pos=this.string.length},Je.prototype.skipTo=function(t){var i=this.string.indexOf(t,this.pos);if(i>-1)return this.pos=i,!0},Je.prototype.backUp=function(t){this.pos-=t},Je.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=ae(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?ae(this.string,this.lineStart,this.tabSize):0)},Je.prototype.indentation=function(){return ae(this.string,null,this.tabSize)-(this.lineStart?ae(this.string,this.lineStart,this.tabSize):0)},Je.prototype.match=function(t,i,l){if(typeof t=="string"){var s=function(m){return l?m.toLowerCase():m},c=this.string.substr(this.pos,t.length);if(s(c)==s(t))return i!==!1&&(this.pos+=t.length),!0}else{var p=this.string.slice(this.pos).match(t);return p&&p.index>0?null:(p&&i!==!1&&(this.pos+=p[0].length),p)}},Je.prototype.current=function(){return this.string.slice(this.start,this.pos)},Je.prototype.hideFirstChars=function(t,i){this.lineStart+=t;try{return i()}finally{this.lineStart-=t}},Je.prototype.lookAhead=function(t){var i=this.lineOracle;return i&&i.lookAhead(t)},Je.prototype.baseToken=function(){var t=this.lineOracle;return t&&t.baseToken(this.pos)};function he(t,i){if(i-=t.first,i<0||i>=t.size)throw new Error("There is no line "+(i+t.first)+" in the document.");for(var l=t;!l.lines;)for(var s=0;;++s){var c=l.children[s],p=c.chunkSize();if(i<p){l=c;break}i-=p}return l.lines[i]}function En(t,i,l){var s=[],c=i.line;return t.iter(i.line,l.line+1,function(p){var m=p.text;c==l.line&&(m=m.slice(0,l.ch)),c==i.line&&(m=m.slice(i.ch)),s.push(m),++c}),s}function ji(t,i,l){var s=[];return t.iter(i,l,function(c){s.push(c.text)}),s}function $t(t,i){var l=i-t.height;if(l)for(var s=t;s;s=s.parent)s.height+=l}function S(t){if(t.parent==null)return null;for(var i=t.parent,l=re(i.lines,t),s=i.parent;s;i=s,s=s.parent)for(var c=0;s.children[c]!=i;++c)l+=s.children[c].chunkSize();return l+i.first}function I(t,i){var l=t.first;e:do{for(var s=0;s<t.children.length;++s){var c=t.children[s],p=c.height;if(i<p){t=c;continue e}i-=p,l+=c.chunkSize()}return l}while(!t.lines);for(var m=0;m<t.lines.length;++m){var y=t.lines[m],b=y.height;if(i<b)break;i-=b}return l+m}function Z(t,i){return i>=t.first&&i<t.first+t.size}function ie(t,i){return String(t.lineNumberFormatter(i+t.firstLineNumber))}function K(t,i,l){if(l===void 0&&(l=null),!(this instanceof K))return new K(t,i,l);this.line=t,this.ch=i,this.sticky=l}function fe(t,i){return t.line-i.line||t.ch-i.ch}function Be(t,i){return t.sticky==i.sticky&&fe(t,i)==0}function at(t){return K(t.line,t.ch)}function Et(t,i){return fe(t,i)<0?i:t}function Wr(t,i){return fe(t,i)<0?t:i}function bf(t,i){return Math.max(t.first,Math.min(i,t.first+t.size-1))}function De(t,i){if(i.line<t.first)return K(t.first,0);var l=t.first+t.size-1;return i.line>l?K(l,he(t,l).text.length):Fb(i,he(t,i.line).text.length)}function Fb(t,i){var l=t.ch;return l==null||l>i?K(t.line,i):l<0?K(t.line,0):t}function wf(t,i){for(var l=[],s=0;s<i.length;s++)l[s]=De(t,i[s]);return l}var ns=function(t,i){this.state=t,this.lookAhead=i},yn=function(t,i,l,s){this.state=i,this.doc=t,this.line=l,this.maxLookAhead=s||0,this.baseTokens=null,this.baseTokenPos=1};yn.prototype.lookAhead=function(t){var i=this.doc.getLine(this.line+t);return i!=null&&t>this.maxLookAhead&&(this.maxLookAhead=t),i},yn.prototype.baseToken=function(t){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=t;)this.baseTokenPos+=2;var i=this.baseTokens[this.baseTokenPos+1];return{type:i&&i.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-t}},yn.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},yn.fromSaved=function(t,i,l){return i instanceof ns?new yn(t,vn(t.mode,i.state),l,i.lookAhead):new yn(t,vn(t.mode,i),l)},yn.prototype.save=function(t){var i=t!==!1?vn(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new ns(i,this.maxLookAhead):i};function xf(t,i,l,s){var c=[t.state.modeGen],p={};Ef(t,i.text,t.doc.mode,l,function(k,P){return c.push(k,P)},p,s);for(var m=l.state,y=function(k){l.baseTokens=c;var P=t.state.overlays[k],j=1,q=0;l.state=!0,Ef(t,i.text,P.mode,l,function(R,Y){for(var ee=j;q<R;){var oe=c[j];oe>R&&c.splice(j,1,R,c[j+1],oe),j+=2,q=Math.min(R,oe)}if(Y)if(P.opaque)c.splice(ee,j-ee,R,"overlay "+Y),j=ee+2;else for(;ee<j;ee+=2){var le=c[ee+1];c[ee+1]=(le?le+" ":"")+"overlay "+Y}},p),l.state=m,l.baseTokens=null,l.baseTokenPos=1},b=0;b<t.state.overlays.length;++b)y(b);return{styles:c,classes:p.bgClass||p.textClass?p:null}}function kf(t,i,l){if(!i.styles||i.styles[0]!=t.state.modeGen){var s=zi(t,S(i)),c=i.text.length>t.options.maxHighlightLength&&vn(t.doc.mode,s.state),p=xf(t,i,s);c&&(s.state=c),i.stateAfter=s.save(!c),i.styles=p.styles,p.classes?i.styleClasses=p.classes:i.styleClasses&&(i.styleClasses=null),l===t.doc.highlightFrontier&&(t.doc.modeFrontier=Math.max(t.doc.modeFrontier,++t.doc.highlightFrontier))}return i.styles}function zi(t,i,l){var s=t.doc,c=t.display;if(!s.mode.startState)return new yn(s,!0,i);var p=Lb(t,i,l),m=p>s.first&&he(s,p-1).stateAfter,y=m?yn.fromSaved(s,m,p):new yn(s,_r(s.mode),p);return s.iter(p,i,function(b){Ka(t,b.text,y);var k=y.line;b.stateAfter=k==i-1||k%5==0||k>=c.viewFrom&&k<c.viewTo?y.save():null,y.nextLine()}),l&&(s.modeFrontier=y.line),y}function Ka(t,i,l,s){var c=t.doc.mode,p=new Je(i,t.options.tabSize,l);for(p.start=p.pos=s||0,i==""&&Cf(c,l.state);!p.eol();)Ya(c,p,l.state),p.start=p.pos}function Cf(t,i){if(t.blankLine)return t.blankLine(i);if(t.innerMode){var l=Ii(t,i);if(l.mode.blankLine)return l.mode.blankLine(l.state)}}function Ya(t,i,l,s){for(var c=0;c<10;c++){s&&(s[0]=Ii(t,l).mode);var p=t.token(i,l);if(i.pos>i.start)return p}throw new Error("Mode "+t.name+" failed to advance stream.")}var Df=function(t,i,l){this.start=t.start,this.end=t.pos,this.string=t.current(),this.type=i||null,this.state=l};function Af(t,i,l,s){var c=t.doc,p=c.mode,m;i=De(c,i);var y=he(c,i.line),b=zi(t,i.line,l),k=new Je(y.text,t.options.tabSize,b),P;for(s&&(P=[]);(s||k.pos<i.ch)&&!k.eol();)k.start=k.pos,m=Ya(p,k,b.state),s&&P.push(new Df(k,m,vn(c.mode,b.state)));return s?P:new Df(k,m,b.state)}function Sf(t,i){if(t)for(;;){var l=t.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!l)break;t=t.slice(0,l.index)+t.slice(l.index+l[0].length);var s=l[1]?"bgClass":"textClass";i[s]==null?i[s]=l[2]:new RegExp("(?:^|\\s)"+l[2]+"(?:$|\\s)").test(i[s])||(i[s]+=" "+l[2])}return t}function Ef(t,i,l,s,c,p,m){var y=l.flattenSpans;y==null&&(y=t.options.flattenSpans);var b=0,k=null,P=new Je(i,t.options.tabSize,s),j,q=t.options.addModeClass&&[null];for(i==""&&Sf(Cf(l,s.state),p);!P.eol();){if(P.pos>t.options.maxHighlightLength?(y=!1,m&&Ka(t,i,s,P.pos),P.pos=i.length,j=null):j=Sf(Ya(l,P,s.state,q),p),q){var R=q[0].name;R&&(j="m-"+(j?R+" "+j:R))}if(!y||k!=j){for(;b<P.start;)b=Math.min(P.start,b+5e3),c(b,k);k=j}P.start=P.pos}for(;b<P.pos;){var Y=Math.min(P.pos,b+5e3);c(Y,k),b=Y}}function Lb(t,i,l){for(var s,c,p=t.doc,m=l?-1:i-(t.doc.mode.innerMode?1e3:100),y=i;y>m;--y){if(y<=p.first)return p.first;var b=he(p,y-1),k=b.stateAfter;if(k&&(!l||y+(k instanceof ns?k.lookAhead:0)<=p.modeFrontier))return y;var P=ae(b.text,null,t.options.tabSize);(c==null||s>P)&&(c=y-1,s=P)}return c}function Mb(t,i){if(t.modeFrontier=Math.min(t.modeFrontier,i),!(t.highlightFrontier<i-10)){for(var l=t.first,s=i-1;s>l;s--){var c=he(t,s).stateAfter;if(c&&(!(c instanceof ns)||s+c.lookAhead<i)){l=s+1;break}}t.highlightFrontier=Math.min(t.highlightFrontier,l)}}var Tf=!1,Tn=!1;function Nb(){Tf=!0}function Bb(){Tn=!0}function rs(t,i,l){this.marker=t,this.from=i,this.to=l}function Ri(t,i){if(t)for(var l=0;l<t.length;++l){var s=t[l];if(s.marker==i)return s}}function Ob(t,i){for(var l,s=0;s<t.length;++s)t[s]!=i&&(l||(l=[])).push(t[s]);return l}function Pb(t,i,l){var s=l&&window.WeakSet&&(l.markedSpans||(l.markedSpans=new WeakSet));s&&t.markedSpans&&s.has(t.markedSpans)?t.markedSpans.push(i):(t.markedSpans=t.markedSpans?t.markedSpans.concat([i]):[i],s&&s.add(t.markedSpans)),i.marker.attachLine(t)}function Ib(t,i,l){var s;if(t)for(var c=0;c<t.length;++c){var p=t[c],m=p.marker,y=p.from==null||(m.inclusiveLeft?p.from<=i:p.from<i);if(y||p.from==i&&m.type=="bookmark"&&(!l||!p.marker.insertLeft)){var b=p.to==null||(m.inclusiveRight?p.to>=i:p.to>i);(s||(s=[])).push(new rs(m,p.from,b?null:p.to))}}return s}function jb(t,i,l){var s;if(t)for(var c=0;c<t.length;++c){var p=t[c],m=p.marker,y=p.to==null||(m.inclusiveRight?p.to>=i:p.to>i);if(y||p.from==i&&m.type=="bookmark"&&(!l||p.marker.insertLeft)){var b=p.from==null||(m.inclusiveLeft?p.from<=i:p.from<i);(s||(s=[])).push(new rs(m,b?null:p.from-i,p.to==null?null:p.to-i))}}return s}function Qa(t,i){if(i.full)return null;var l=Z(t,i.from.line)&&he(t,i.from.line).markedSpans,s=Z(t,i.to.line)&&he(t,i.to.line).markedSpans;if(!l&&!s)return null;var c=i.from.ch,p=i.to.ch,m=fe(i.from,i.to)==0,y=Ib(l,c,m),b=jb(s,p,m),k=i.text.length==1,P=Me(i.text).length+(k?c:0);if(y)for(var j=0;j<y.length;++j){var q=y[j];if(q.to==null){var R=Ri(b,q.marker);R?k&&(q.to=R.to==null?null:R.to+P):q.to=c}}if(b)for(var Y=0;Y<b.length;++Y){var ee=b[Y];if(ee.to!=null&&(ee.to+=P),ee.from==null){var oe=Ri(y,ee.marker);oe||(ee.from=P,k&&(y||(y=[])).push(ee))}else ee.from+=P,k&&(y||(y=[])).push(ee)}y&&(y=Ff(y)),b&&b!=y&&(b=Ff(b));var le=[y];if(!k){var de=i.text.length-2,ue;if(de>0&&y)for(var pe=0;pe<y.length;++pe)y[pe].to==null&&(ue||(ue=[])).push(new rs(y[pe].marker,null,null));for(var ve=0;ve<de;++ve)le.push(ue);le.push(b)}return le}function Ff(t){for(var i=0;i<t.length;++i){var l=t[i];l.from!=null&&l.from==l.to&&l.marker.clearWhenEmpty!==!1&&t.splice(i--,1)}return t.length?t:null}function zb(t,i,l){var s=null;if(t.iter(i.line,l.line+1,function(R){if(R.markedSpans)for(var Y=0;Y<R.markedSpans.length;++Y){var ee=R.markedSpans[Y].marker;ee.readOnly&&(!s||re(s,ee)==-1)&&(s||(s=[])).push(ee)}}),!s)return null;for(var c=[{from:i,to:l}],p=0;p<s.length;++p)for(var m=s[p],y=m.find(0),b=0;b<c.length;++b){var k=c[b];if(!(fe(k.to,y.from)<0||fe(k.from,y.to)>0)){var P=[b,1],j=fe(k.from,y.from),q=fe(k.to,y.to);(j<0||!m.inclusiveLeft&&!j)&&P.push({from:k.from,to:y.from}),(q>0||!m.inclusiveRight&&!q)&&P.push({from:y.to,to:k.to}),c.splice.apply(c,P),b+=P.length-3}}return c}function Lf(t){var i=t.markedSpans;if(i){for(var l=0;l<i.length;++l)i[l].marker.detachLine(t);t.markedSpans=null}}function Mf(t,i){if(i){for(var l=0;l<i.length;++l)i[l].marker.attachLine(t);t.markedSpans=i}}function is(t){return t.inclusiveLeft?-1:0}function os(t){return t.inclusiveRight?1:0}function Ja(t,i){var l=t.lines.length-i.lines.length;if(l!=0)return l;var s=t.find(),c=i.find(),p=fe(s.from,c.from)||is(t)-is(i);if(p)return-p;var m=fe(s.to,c.to)||os(t)-os(i);return m||i.id-t.id}function Nf(t,i){var l=Tn&&t.markedSpans,s;if(l)for(var c=void 0,p=0;p<l.length;++p)c=l[p],c.marker.collapsed&&(i?c.from:c.to)==null&&(!s||Ja(s,c.marker)<0)&&(s=c.marker);return s}function Bf(t){return Nf(t,!0)}function ss(t){return Nf(t,!1)}function Rb(t,i){var l=Tn&&t.markedSpans,s;if(l)for(var c=0;c<l.length;++c){var p=l[c];p.marker.collapsed&&(p.from==null||p.from<i)&&(p.to==null||p.to>i)&&(!s||Ja(s,p.marker)<0)&&(s=p.marker)}return s}function Of(t,i,l,s,c){var p=he(t,i),m=Tn&&p.markedSpans;if(m)for(var y=0;y<m.length;++y){var b=m[y];if(b.marker.collapsed){var k=b.marker.find(0),P=fe(k.from,l)||is(b.marker)-is(c),j=fe(k.to,s)||os(b.marker)-os(c);if(!(P>=0&&j<=0||P<=0&&j>=0)&&(P<=0&&(b.marker.inclusiveRight&&c.inclusiveLeft?fe(k.to,l)>=0:fe(k.to,l)>0)||P>=0&&(b.marker.inclusiveRight&&c.inclusiveLeft?fe(k.from,s)<=0:fe(k.from,s)<0)))return!0}}}function sn(t){for(var i;i=Bf(t);)t=i.find(-1,!0).line;return t}function Hb(t){for(var i;i=ss(t);)t=i.find(1,!0).line;return t}function qb(t){for(var i,l;i=ss(t);)t=i.find(1,!0).line,(l||(l=[])).push(t);return l}function Za(t,i){var l=he(t,i),s=sn(l);return l==s?i:S(s)}function Pf(t,i){if(i>t.lastLine())return i;var l=he(t,i),s;if(!Wn(t,l))return i;for(;s=ss(l);)l=s.find(1,!0).line;return S(l)+1}function Wn(t,i){var l=Tn&&i.markedSpans;if(l){for(var s=void 0,c=0;c<l.length;++c)if(s=l[c],!!s.marker.collapsed){if(s.from==null)return!0;if(!s.marker.widgetNode&&s.from==0&&s.marker.inclusiveLeft&&Xa(t,i,s))return!0}}}function Xa(t,i,l){if(l.to==null){var s=l.marker.find(1,!0);return Xa(t,s.line,Ri(s.line.markedSpans,l.marker))}if(l.marker.inclusiveRight&&l.to==i.text.length)return!0;for(var c=void 0,p=0;p<i.markedSpans.length;++p)if(c=i.markedSpans[p],c.marker.collapsed&&!c.marker.widgetNode&&c.from==l.to&&(c.to==null||c.to!=l.from)&&(c.marker.inclusiveLeft||l.marker.inclusiveRight)&&Xa(t,i,c))return!0}function Fn(t){t=sn(t);for(var i=0,l=t.parent,s=0;s<l.lines.length;++s){var c=l.lines[s];if(c==t)break;i+=c.height}for(var p=l.parent;p;l=p,p=l.parent)for(var m=0;m<p.children.length;++m){var y=p.children[m];if(y==l)break;i+=y.height}return i}function as(t){if(t.height==0)return 0;for(var i=t.text.length,l,s=t;l=Bf(s);){var c=l.find(0,!0);s=c.from.line,i+=c.from.ch-c.to.ch}for(s=t;l=ss(s);){var p=l.find(0,!0);i-=s.text.length-p.from.ch,s=p.to.line,i+=s.text.length-p.to.ch}return i}function el(t){var i=t.display,l=t.doc;i.maxLine=he(l,l.first),i.maxLineLength=as(i.maxLine),i.maxLineChanged=!0,l.iter(function(s){var c=as(s);c>i.maxLineLength&&(i.maxLineLength=c,i.maxLine=s)})}var $r=function(t,i,l){this.text=t,Mf(this,i),this.height=l?l(this):1};$r.prototype.lineNo=function(){return S(this)},en($r);function _b(t,i,l,s){t.text=i,t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null),t.order!=null&&(t.order=null),Lf(t),Mf(t,l);var c=s?s(t):1;c!=t.height&&$t(t,c)}function Wb(t){t.parent=null,Lf(t)}var $b={},Ub={};function If(t,i){if(!t||/^\s*$/.test(t))return null;var l=i.addModeClass?Ub:$b;return l[t]||(l[t]=t.replace(/\S+/g,"cm-$&"))}function jf(t,i){var l=Q("span",null,null,h?"padding-right: .1px":null),s={pre:Q("pre",[l],"CodeMirror-line"),content:l,col:0,pos:0,cm:t,trailingSpace:!1,splitSpaces:t.getOption("lineWrapping")};i.measure={};for(var c=0;c<=(i.rest?i.rest.length:0);c++){var p=c?i.rest[c-1]:i.line,m=void 0;s.pos=0,s.addToken=Gb,Hn(t.display.measure)&&(m=Fe(p,t.doc.direction))&&(s.addToken=Yb(s.addToken,m)),s.map=[];var y=i!=t.display.externalMeasured&&S(p);Qb(p,s,kf(t,p,y)),p.styleClasses&&(p.styleClasses.bgClass&&(s.bgClass=_e(p.styleClasses.bgClass,s.bgClass||"")),p.styleClasses.textClass&&(s.textClass=_e(p.styleClasses.textClass,s.textClass||""))),s.map.length==0&&s.map.push(0,0,s.content.appendChild(es(t.display.measure))),c==0?(i.measure.map=s.map,i.measure.cache={}):((i.measure.maps||(i.measure.maps=[])).push(s.map),(i.measure.caches||(i.measure.caches=[])).push({}))}if(h){var b=s.content.lastChild;(/\bcm-tab\b/.test(b.className)||b.querySelector&&b.querySelector(".cm-tab"))&&(s.content.className="cm-tab-wrap-hack")}return Ye(t,"renderLine",t,i.line,s.pre),s.pre.className&&(s.textClass=_e(s.pre.className,s.textClass||"")),s}function Vb(t){var i=A("span","\u2022","cm-invalidchar");return i.title="\\u"+t.charCodeAt(0).toString(16),i.setAttribute("aria-label",i.title),i}function Gb(t,i,l,s,c,p,m){if(i){var y=t.splitSpaces?Kb(i,t.trailingSpace):i,b=t.cm.state.specialChars,k=!1,P;if(!b.test(i))t.col+=i.length,P=document.createTextNode(y),t.map.push(t.pos,t.pos+i.length,P),f&&d<9&&(k=!0),t.pos+=i.length;else{P=document.createDocumentFragment();for(var j=0;;){b.lastIndex=j;var q=b.exec(i),R=q?q.index-j:i.length-j;if(R){var Y=document.createTextNode(y.slice(j,j+R));f&&d<9?P.appendChild(A("span",[Y])):P.appendChild(Y),t.map.push(t.pos,t.pos+R,Y),t.col+=R,t.pos+=R}if(!q)break;j+=R+1;var ee=void 0;if(q[0]=="	"){var oe=t.cm.options.tabSize,le=oe-t.col%oe;ee=P.appendChild(A("span",it(le),"cm-tab")),ee.setAttribute("role","presentation"),ee.setAttribute("cm-text","	"),t.col+=le}else q[0]=="\r"||q[0]==`
`?(ee=P.appendChild(A("span",q[0]=="\r"?"\u240D":"\u2424","cm-invalidchar")),ee.setAttribute("cm-text",q[0]),t.col+=1):(ee=t.cm.options.specialCharPlaceholder(q[0]),ee.setAttribute("cm-text",q[0]),f&&d<9?P.appendChild(A("span",[ee])):P.appendChild(ee),t.col+=1);t.map.push(t.pos,t.pos+1,ee),t.pos++}}if(t.trailingSpace=y.charCodeAt(i.length-1)==32,l||s||c||k||p||m){var de=l||"";s&&(de+=s),c&&(de+=c);var ue=A("span",[P],de,p);if(m)for(var pe in m)m.hasOwnProperty(pe)&&pe!="style"&&pe!="class"&&ue.setAttribute(pe,m[pe]);return t.content.appendChild(ue)}t.content.appendChild(P)}}function Kb(t,i){if(t.length>1&&!/  /.test(t))return t;for(var l=i,s="",c=0;c<t.length;c++){var p=t.charAt(c);p==" "&&l&&(c==t.length-1||t.charCodeAt(c+1)==32)&&(p="\xA0"),s+=p,l=p==" "}return s}function Yb(t,i){return function(l,s,c,p,m,y,b){c=c?c+" cm-force-border":"cm-force-border";for(var k=l.pos,P=k+s.length;;){for(var j=void 0,q=0;q<i.length&&(j=i[q],!(j.to>k&&j.from<=k));q++);if(j.to>=P)return t(l,s,c,p,m,y,b);t(l,s.slice(0,j.to-k),c,p,null,y,b),p=null,s=s.slice(j.to-k),k=j.to}}}function zf(t,i,l,s){var c=!s&&l.widgetNode;c&&t.map.push(t.pos,t.pos+i,c),!s&&t.cm.display.input.needsContentAttribute&&(c||(c=t.content.appendChild(document.createElement("span"))),c.setAttribute("cm-marker",l.id)),c&&(t.cm.display.input.setUneditable(c),t.content.appendChild(c)),t.pos+=i,t.trailingSpace=!1}function Qb(t,i,l){var s=t.markedSpans,c=t.text,p=0;if(!s){for(var m=1;m<l.length;m+=2)i.addToken(i,c.slice(p,p=l[m]),If(l[m+1],i.cm.options));return}for(var y=c.length,b=0,k=1,P="",j,q,R=0,Y,ee,oe,le,de;;){if(R==b){Y=ee=oe=q="",de=null,le=null,R=1/0;for(var ue=[],pe=void 0,ve=0;ve<s.length;++ve){var ge=s[ve],Se=ge.marker;if(Se.type=="bookmark"&&ge.from==b&&Se.widgetNode)ue.push(Se);else if(ge.from<=b&&(ge.to==null||ge.to>b||Se.collapsed&&ge.to==b&&ge.from==b)){if(ge.to!=null&&ge.to!=b&&R>ge.to&&(R=ge.to,ee=""),Se.className&&(Y+=" "+Se.className),Se.css&&(q=(q?q+";":"")+Se.css),Se.startStyle&&ge.from==b&&(oe+=" "+Se.startStyle),Se.endStyle&&ge.to==R&&(pe||(pe=[])).push(Se.endStyle,ge.to),Se.title&&((de||(de={})).title=Se.title),Se.attributes)for(var Re in Se.attributes)(de||(de={}))[Re]=Se.attributes[Re];Se.collapsed&&(!le||Ja(le.marker,Se)<0)&&(le=ge)}else ge.from>b&&R>ge.from&&(R=ge.from)}if(pe)for(var ft=0;ft<pe.length;ft+=2)pe[ft+1]==R&&(ee+=" "+pe[ft]);if(!le||le.from==b)for(var Ge=0;Ge<ue.length;++Ge)zf(i,0,ue[Ge]);if(le&&(le.from||0)==b){if(zf(i,(le.to==null?y+1:le.to)-b,le.marker,le.from==null),le.to==null)return;le.to==b&&(le=!1)}}if(b>=y)break;for(var Pt=Math.min(y,R);;){if(P){var Lt=b+P.length;if(!le){var nt=Lt>Pt?P.slice(0,Pt-b):P;i.addToken(i,nt,j?j+Y:Y,oe,b+nt.length==R?ee:"",q,de)}if(Lt>=Pt){P=P.slice(Pt-b),b=Pt;break}b=Lt,oe=""}P=c.slice(p,p=l[k++]),j=If(l[k++],i.cm.options)}}}function Rf(t,i,l){this.line=i,this.rest=qb(i),this.size=this.rest?S(Me(this.rest))-l+1:1,this.node=this.text=null,this.hidden=Wn(t,i)}function ls(t,i,l){for(var s=[],c,p=i;p<l;p=c){var m=new Rf(t.doc,he(t.doc,p),p);c=p+m.size,s.push(m)}return s}var Ur=null;function Jb(t){Ur?Ur.ops.push(t):t.ownsGroup=Ur={ops:[t],delayedCallbacks:[]}}function Zb(t){var i=t.delayedCallbacks,l=0;do{for(;l<i.length;l++)i[l].call(null);for(var s=0;s<t.ops.length;s++){var c=t.ops[s];if(c.cursorActivityHandlers)for(;c.cursorActivityCalled<c.cursorActivityHandlers.length;)c.cursorActivityHandlers[c.cursorActivityCalled++].call(null,c.cm)}}while(l<i.length)}function Xb(t,i){var l=t.ownsGroup;if(l)try{Zb(l)}finally{Ur=null,i(l)}}var Hi=null;function lt(t,i){var l=Sn(t,i);if(l.length){var s=Array.prototype.slice.call(arguments,2),c;Ur?c=Ur.delayedCallbacks:Hi?c=Hi:(c=Hi=[],setTimeout(ew,0));for(var p=function(y){c.push(function(){return l[y].apply(null,s)})},m=0;m<l.length;++m)p(m)}}function ew(){var t=Hi;Hi=null;for(var i=0;i<t.length;++i)t[i]()}function Hf(t,i,l,s){for(var c=0;c<i.changes.length;c++){var p=i.changes[c];p=="text"?nw(t,i):p=="gutter"?_f(t,i,l,s):p=="class"?tl(t,i):p=="widget"&&rw(t,i,s)}i.changes=null}function qi(t){return t.node==t.text&&(t.node=A("div",null,null,"position: relative"),t.text.parentNode&&t.text.parentNode.replaceChild(t.node,t.text),t.node.appendChild(t.text),f&&d<8&&(t.node.style.zIndex=2)),t.node}function tw(t,i){var l=i.bgClass?i.bgClass+" "+(i.line.bgClass||""):i.line.bgClass;if(l&&(l+=" CodeMirror-linebackground"),i.background)l?i.background.className=l:(i.background.parentNode.removeChild(i.background),i.background=null);else if(l){var s=qi(i);i.background=s.insertBefore(A("div",null,l),s.firstChild),t.display.input.setUneditable(i.background)}}function qf(t,i){var l=t.display.externalMeasured;return l&&l.line==i.line?(t.display.externalMeasured=null,i.measure=l.measure,l.built):jf(t,i)}function nw(t,i){var l=i.text.className,s=qf(t,i);i.text==i.node&&(i.node=s.pre),i.text.parentNode.replaceChild(s.pre,i.text),i.text=s.pre,s.bgClass!=i.bgClass||s.textClass!=i.textClass?(i.bgClass=s.bgClass,i.textClass=s.textClass,tl(t,i)):l&&(i.text.className=l)}function tl(t,i){tw(t,i),i.line.wrapClass?qi(i).className=i.line.wrapClass:i.node!=i.text&&(i.node.className="");var l=i.textClass?i.textClass+" "+(i.line.textClass||""):i.line.textClass;i.text.className=l||""}function _f(t,i,l,s){if(i.gutter&&(i.node.removeChild(i.gutter),i.gutter=null),i.gutterBackground&&(i.node.removeChild(i.gutterBackground),i.gutterBackground=null),i.line.gutterClass){var c=qi(i);i.gutterBackground=A("div",null,"CodeMirror-gutter-background "+i.line.gutterClass,"left: "+(t.options.fixedGutter?s.fixedPos:-s.gutterTotalWidth)+"px; width: "+s.gutterTotalWidth+"px"),t.display.input.setUneditable(i.gutterBackground),c.insertBefore(i.gutterBackground,i.text)}var p=i.line.gutterMarkers;if(t.options.lineNumbers||p){var m=qi(i),y=i.gutter=A("div",null,"CodeMirror-gutter-wrapper","left: "+(t.options.fixedGutter?s.fixedPos:-s.gutterTotalWidth)+"px");if(y.setAttribute("aria-hidden","true"),t.display.input.setUneditable(y),m.insertBefore(y,i.text),i.line.gutterClass&&(y.className+=" "+i.line.gutterClass),t.options.lineNumbers&&(!p||!p["CodeMirror-linenumbers"])&&(i.lineNumber=y.appendChild(A("div",ie(t.options,l),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+s.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+t.display.lineNumInnerWidth+"px"))),p)for(var b=0;b<t.display.gutterSpecs.length;++b){var k=t.display.gutterSpecs[b].className,P=p.hasOwnProperty(k)&&p[k];P&&y.appendChild(A("div",[P],"CodeMirror-gutter-elt","left: "+s.gutterLeft[k]+"px; width: "+s.gutterWidth[k]+"px"))}}}function rw(t,i,l){i.alignable&&(i.alignable=null);for(var s=W("CodeMirror-linewidget"),c=i.node.firstChild,p=void 0;c;c=p)p=c.nextSibling,s.test(c.className)&&i.node.removeChild(c);Wf(t,i,l)}function iw(t,i,l,s){var c=qf(t,i);return i.text=i.node=c.pre,c.bgClass&&(i.bgClass=c.bgClass),c.textClass&&(i.textClass=c.textClass),tl(t,i),_f(t,i,l,s),Wf(t,i,s),i.node}function Wf(t,i,l){if($f(t,i.line,i,l,!0),i.rest)for(var s=0;s<i.rest.length;s++)$f(t,i.rest[s],i,l,!1)}function $f(t,i,l,s,c){if(i.widgets)for(var p=qi(l),m=0,y=i.widgets;m<y.length;++m){var b=y[m],k=A("div",[b.node],"CodeMirror-linewidget"+(b.className?" "+b.className:""));b.handleMouseEvents||k.setAttribute("cm-ignore-events","true"),ow(b,k,l,s),t.display.input.setUneditable(k),c&&b.above?p.insertBefore(k,l.gutter||l.text):p.appendChild(k),lt(b,"redraw")}}function ow(t,i,l,s){if(t.noHScroll){(l.alignable||(l.alignable=[])).push(i);var c=s.wrapperWidth;i.style.left=s.fixedPos+"px",t.coverGutter||(c-=s.gutterTotalWidth,i.style.paddingLeft=s.gutterTotalWidth+"px"),i.style.width=c+"px"}t.coverGutter&&(i.style.zIndex=5,i.style.position="relative",t.noHScroll||(i.style.marginLeft=-s.gutterTotalWidth+"px"))}function _i(t){if(t.height!=null)return t.height;var i=t.doc.cm;if(!i)return 0;if(!ce(document.body,t.node)){var l="position: relative;";t.coverGutter&&(l+="margin-left: -"+i.display.gutters.offsetWidth+"px;"),t.noHScroll&&(l+="width: "+i.display.wrapper.clientWidth+"px;"),X(i.display.measure,A("div",[t.node],null,l))}return t.height=t.node.parentNode.offsetHeight}function Ln(t,i){for(var l=Oi(i);l!=t.wrapper;l=l.parentNode)if(!l||l.nodeType==1&&l.getAttribute("cm-ignore-events")=="true"||l.parentNode==t.sizer&&l!=t.mover)return!0}function us(t){return t.lineSpace.offsetTop}function nl(t){return t.mover.offsetHeight-t.lineSpace.offsetHeight}function Uf(t){if(t.cachedPaddingH)return t.cachedPaddingH;var i=X(t.measure,A("pre","x","CodeMirror-line-like")),l=window.getComputedStyle?window.getComputedStyle(i):i.currentStyle,s={left:parseInt(l.paddingLeft),right:parseInt(l.paddingRight)};return!isNaN(s.left)&&!isNaN(s.right)&&(t.cachedPaddingH=s),s}function bn(t){return Ee-t.display.nativeBarWidth}function ar(t){return t.display.scroller.clientWidth-bn(t)-t.display.barWidth}function rl(t){return t.display.scroller.clientHeight-bn(t)-t.display.barHeight}function sw(t,i,l){var s=t.options.lineWrapping,c=s&&ar(t);if(!i.measure.heights||s&&i.measure.width!=c){var p=i.measure.heights=[];if(s){i.measure.width=c;for(var m=i.text.firstChild.getClientRects(),y=0;y<m.length-1;y++){var b=m[y],k=m[y+1];Math.abs(b.bottom-k.bottom)>2&&p.push((b.bottom+k.top)/2-l.top)}}p.push(l.bottom-l.top)}}function Vf(t,i,l){if(t.line==i)return{map:t.measure.map,cache:t.measure.cache};if(t.rest){for(var s=0;s<t.rest.length;s++)if(t.rest[s]==i)return{map:t.measure.maps[s],cache:t.measure.caches[s]};for(var c=0;c<t.rest.length;c++)if(S(t.rest[c])>l)return{map:t.measure.maps[c],cache:t.measure.caches[c],before:!0}}}function aw(t,i){i=sn(i);var l=S(i),s=t.display.externalMeasured=new Rf(t.doc,i,l);s.lineN=l;var c=s.built=jf(t,s);return s.text=c.pre,X(t.display.lineMeasure,c.pre),s}function Gf(t,i,l,s){return wn(t,Vr(t,i),l,s)}function il(t,i){if(i>=t.display.viewFrom&&i<t.display.viewTo)return t.display.view[cr(t,i)];var l=t.display.externalMeasured;if(l&&i>=l.lineN&&i<l.lineN+l.size)return l}function Vr(t,i){var l=S(i),s=il(t,l);s&&!s.text?s=null:s&&s.changes&&(Hf(t,s,l,ul(t)),t.curOp.forceUpdate=!0),s||(s=aw(t,i));var c=Vf(s,i,l);return{line:i,view:s,rect:null,map:c.map,cache:c.cache,before:c.before,hasHeights:!1}}function wn(t,i,l,s,c){i.before&&(l=-1);var p=l+(s||""),m;return i.cache.hasOwnProperty(p)?m=i.cache[p]:(i.rect||(i.rect=i.view.text.getBoundingClientRect()),i.hasHeights||(sw(t,i.view,i.rect),i.hasHeights=!0),m=uw(t,i,l,s),m.bogus||(i.cache[p]=m)),{left:m.left,right:m.right,top:c?m.rtop:m.top,bottom:c?m.rbottom:m.bottom}}var Kf={left:0,right:0,top:0,bottom:0};function Yf(t,i,l){for(var s,c,p,m,y,b,k=0;k<t.length;k+=3)if(y=t[k],b=t[k+1],i<y?(c=0,p=1,m="left"):i<b?(c=i-y,p=c+1):(k==t.length-3||i==b&&t[k+3]>i)&&(p=b-y,c=p-1,i>=b&&(m="right")),c!=null){if(s=t[k+2],y==b&&l==(s.insertLeft?"left":"right")&&(m=l),l=="left"&&c==0)for(;k&&t[k-2]==t[k-3]&&t[k-1].insertLeft;)s=t[(k-=3)+2],m="left";if(l=="right"&&c==b-y)for(;k<t.length-3&&t[k+3]==t[k+4]&&!t[k+5].insertLeft;)s=t[(k+=3)+2],m="right";break}return{node:s,start:c,end:p,collapse:m,coverStart:y,coverEnd:b}}function lw(t,i){var l=Kf;if(i=="left")for(var s=0;s<t.length&&(l=t[s]).left==l.right;s++);else for(var c=t.length-1;c>=0&&(l=t[c]).left==l.right;c--);return l}function uw(t,i,l,s){var c=Yf(i.map,l,s),p=c.node,m=c.start,y=c.end,b=c.collapse,k;if(p.nodeType==3){for(var P=0;P<4;P++){for(;m&&tt(i.line.text.charAt(c.coverStart+m));)--m;for(;c.coverStart+y<c.coverEnd&&tt(i.line.text.charAt(c.coverStart+y));)++y;if(f&&d<9&&m==0&&y==c.coverEnd-c.coverStart?k=p.parentNode.getBoundingClientRect():k=lw(U(p,m,y).getClientRects(),s),k.left||k.right||m==0)break;y=m,m=m-1,b="right"}f&&d<11&&(k=cw(t.display.measure,k))}else{m>0&&(b=s="right");var j;t.options.lineWrapping&&(j=p.getClientRects()).length>1?k=j[s=="right"?j.length-1:0]:k=p.getBoundingClientRect()}if(f&&d<9&&!m&&(!k||!k.left&&!k.right)){var q=p.parentNode.getClientRects()[0];q?k={left:q.left,right:q.left+Kr(t.display),top:q.top,bottom:q.bottom}:k=Kf}for(var R=k.top-i.rect.top,Y=k.bottom-i.rect.top,ee=(R+Y)/2,oe=i.view.measure.heights,le=0;le<oe.length-1&&!(ee<oe[le]);le++);var de=le?oe[le-1]:0,ue=oe[le],pe={left:(b=="right"?k.right:k.left)-i.rect.left,right:(b=="left"?k.left:k.right)-i.rect.left,top:de,bottom:ue};return!k.left&&!k.right&&(pe.bogus=!0),t.options.singleCursorHeightPerLine||(pe.rtop=R,pe.rbottom=Y),pe}function cw(t,i){if(!window.screen||screen.logicalXDPI==null||screen.logicalXDPI==screen.deviceXDPI||!Ga(t))return i;var l=screen.logicalXDPI/screen.deviceXDPI,s=screen.logicalYDPI/screen.deviceYDPI;return{left:i.left*l,right:i.right*l,top:i.top*s,bottom:i.bottom*s}}function Qf(t){if(t.measure&&(t.measure.cache={},t.measure.heights=null,t.rest))for(var i=0;i<t.rest.length;i++)t.measure.caches[i]={}}function Jf(t){t.display.externalMeasure=null,H(t.display.lineMeasure);for(var i=0;i<t.display.view.length;i++)Qf(t.display.view[i])}function Wi(t){Jf(t),t.display.cachedCharWidth=t.display.cachedTextHeight=t.display.cachedPaddingH=null,t.options.lineWrapping||(t.display.maxLineChanged=!0),t.display.lineNumChars=null}function Zf(t){return v&&D?-(t.body.getBoundingClientRect().left-parseInt(getComputedStyle(t.body).marginLeft)):t.defaultView.pageXOffset||(t.documentElement||t.body).scrollLeft}function Xf(t){return v&&D?-(t.body.getBoundingClientRect().top-parseInt(getComputedStyle(t.body).marginTop)):t.defaultView.pageYOffset||(t.documentElement||t.body).scrollTop}function ol(t){var i=sn(t),l=i.widgets,s=0;if(l)for(var c=0;c<l.length;++c)l[c].above&&(s+=_i(l[c]));return s}function cs(t,i,l,s,c){if(!c){var p=ol(i);l.top+=p,l.bottom+=p}if(s=="line")return l;s||(s="local");var m=Fn(i);if(s=="local"?m+=us(t.display):m-=t.display.viewOffset,s=="page"||s=="window"){var y=t.display.lineSpace.getBoundingClientRect();m+=y.top+(s=="window"?0:Xf(Ke(t)));var b=y.left+(s=="window"?0:Zf(Ke(t)));l.left+=b,l.right+=b}return l.top+=m,l.bottom+=m,l}function ed(t,i,l){if(l=="div")return i;var s=i.left,c=i.top;if(l=="page")s-=Zf(Ke(t)),c-=Xf(Ke(t));else if(l=="local"||!l){var p=t.display.sizer.getBoundingClientRect();s+=p.left,c+=p.top}var m=t.display.lineSpace.getBoundingClientRect();return{left:s-m.left,top:c-m.top}}function fs(t,i,l,s,c){return s||(s=he(t.doc,i.line)),cs(t,s,Gf(t,s,i.ch,c),l)}function an(t,i,l,s,c,p){s=s||he(t.doc,i.line),c||(c=Vr(t,s));function m(Y,ee){var oe=wn(t,c,Y,ee?"right":"left",p);return ee?oe.left=oe.right:oe.right=oe.left,cs(t,s,oe,l)}var y=Fe(s,t.doc.direction),b=i.ch,k=i.sticky;if(b>=s.text.length?(b=s.text.length,k="before"):b<=0&&(b=0,k="after"),!y)return m(k=="before"?b-1:b,k=="before");function P(Y,ee,oe){var le=y[ee],de=le.level==1;return m(oe?Y-1:Y,de!=oe)}var j=zn(y,b,k),q=or,R=P(b,j,k=="before");return q!=null&&(R.other=P(b,q,k!="before")),R}function td(t,i){var l=0;i=De(t.doc,i),t.options.lineWrapping||(l=Kr(t.display)*i.ch);var s=he(t.doc,i.line),c=Fn(s)+us(t.display);return{left:l,right:l,top:c,bottom:c+s.height}}function sl(t,i,l,s,c){var p=K(t,i,l);return p.xRel=c,s&&(p.outside=s),p}function al(t,i,l){var s=t.doc;if(l+=t.display.viewOffset,l<0)return sl(s.first,0,null,-1,-1);var c=I(s,l),p=s.first+s.size-1;if(c>p)return sl(s.first+s.size-1,he(s,p).text.length,null,1,1);i<0&&(i=0);for(var m=he(s,c);;){var y=fw(t,m,c,i,l),b=Rb(m,y.ch+(y.xRel>0||y.outside>0?1:0));if(!b)return y;var k=b.find(1);if(k.line==c)return k;m=he(s,c=k.line)}}function nd(t,i,l,s){s-=ol(i);var c=i.text.length,p=mn(function(m){return wn(t,l,m-1).bottom<=s},c,0);return c=mn(function(m){return wn(t,l,m).top>s},p,c),{begin:p,end:c}}function rd(t,i,l,s){l||(l=Vr(t,i));var c=cs(t,i,wn(t,l,s),"line").top;return nd(t,i,l,c)}function ll(t,i,l,s){return t.bottom<=l?!1:t.top>l?!0:(s?t.left:t.right)>i}function fw(t,i,l,s,c){c-=Fn(i);var p=Vr(t,i),m=ol(i),y=0,b=i.text.length,k=!0,P=Fe(i,t.doc.direction);if(P){var j=(t.options.lineWrapping?pw:dw)(t,i,l,p,P,s,c);k=j.level!=1,y=k?j.from:j.to-1,b=k?j.to:j.from-1}var q=null,R=null,Y=mn(function(ve){var ge=wn(t,p,ve);return ge.top+=m,ge.bottom+=m,ll(ge,s,c,!1)?(ge.top<=c&&ge.left<=s&&(q=ve,R=ge),!0):!1},y,b),ee,oe,le=!1;if(R){var de=s-R.left<R.right-s,ue=de==k;Y=q+(ue?0:1),oe=ue?"after":"before",ee=de?R.left:R.right}else{!k&&(Y==b||Y==y)&&Y++,oe=Y==0?"after":Y==i.text.length?"before":wn(t,p,Y-(k?1:0)).bottom+m<=c==k?"after":"before";var pe=an(t,K(l,Y,oe),"line",i,p);ee=pe.left,le=c<pe.top?-1:c>=pe.bottom?1:0}return Y=In(i.text,Y,1),sl(l,Y,oe,le,s-ee)}function dw(t,i,l,s,c,p,m){var y=mn(function(j){var q=c[j],R=q.level!=1;return ll(an(t,K(l,R?q.to:q.from,R?"before":"after"),"line",i,s),p,m,!0)},0,c.length-1),b=c[y];if(y>0){var k=b.level!=1,P=an(t,K(l,k?b.from:b.to,k?"after":"before"),"line",i,s);ll(P,p,m,!0)&&P.top>m&&(b=c[y-1])}return b}function pw(t,i,l,s,c,p,m){var y=nd(t,i,s,m),b=y.begin,k=y.end;/\s/.test(i.text.charAt(k-1))&&k--;for(var P=null,j=null,q=0;q<c.length;q++){var R=c[q];if(!(R.from>=k||R.to<=b)){var Y=R.level!=1,ee=wn(t,s,Y?Math.min(k,R.to)-1:Math.max(b,R.from)).right,oe=ee<p?p-ee+1e9:ee-p;(!P||j>oe)&&(P=R,j=oe)}}return P||(P=c[c.length-1]),P.from<b&&(P={from:b,to:P.to,level:P.level}),P.to>k&&(P={from:P.from,to:k,level:P.level}),P}var lr;function Gr(t){if(t.cachedTextHeight!=null)return t.cachedTextHeight;if(lr==null){lr=A("pre",null,"CodeMirror-line-like");for(var i=0;i<49;++i)lr.appendChild(document.createTextNode("x")),lr.appendChild(A("br"));lr.appendChild(document.createTextNode("x"))}X(t.measure,lr);var l=lr.offsetHeight/50;return l>3&&(t.cachedTextHeight=l),H(t.measure),l||1}function Kr(t){if(t.cachedCharWidth!=null)return t.cachedCharWidth;var i=A("span","xxxxxxxxxx"),l=A("pre",[i],"CodeMirror-line-like");X(t.measure,l);var s=i.getBoundingClientRect(),c=(s.right-s.left)/10;return c>2&&(t.cachedCharWidth=c),c||10}function ul(t){for(var i=t.display,l={},s={},c=i.gutters.clientLeft,p=i.gutters.firstChild,m=0;p;p=p.nextSibling,++m){var y=t.display.gutterSpecs[m].className;l[y]=p.offsetLeft+p.clientLeft+c,s[y]=p.clientWidth}return{fixedPos:cl(i),gutterTotalWidth:i.gutters.offsetWidth,gutterLeft:l,gutterWidth:s,wrapperWidth:i.wrapper.clientWidth}}function cl(t){return t.scroller.getBoundingClientRect().left-t.sizer.getBoundingClientRect().left}function id(t){var i=Gr(t.display),l=t.options.lineWrapping,s=l&&Math.max(5,t.display.scroller.clientWidth/Kr(t.display)-3);return function(c){if(Wn(t.doc,c))return 0;var p=0;if(c.widgets)for(var m=0;m<c.widgets.length;m++)c.widgets[m].height&&(p+=c.widgets[m].height);return l?p+(Math.ceil(c.text.length/s)||1)*i:p+i}}function fl(t){var i=t.doc,l=id(t);i.iter(function(s){var c=l(s);c!=s.height&&$t(s,c)})}function ur(t,i,l,s){var c=t.display;if(!l&&Oi(i).getAttribute("cm-not-content")=="true")return null;var p,m,y=c.lineSpace.getBoundingClientRect();try{p=i.clientX-y.left,m=i.clientY-y.top}catch{return null}var b=al(t,p,m),k;if(s&&b.xRel>0&&(k=he(t.doc,b.line).text).length==b.ch){var P=ae(k,k.length,t.options.tabSize)-k.length;b=K(b.line,Math.max(0,Math.round((p-Uf(t.display).left)/Kr(t.display))-P))}return b}function cr(t,i){if(i>=t.display.viewTo||(i-=t.display.viewFrom,i<0))return null;for(var l=t.display.view,s=0;s<l.length;s++)if(i-=l[s].size,i<0)return s}function Tt(t,i,l,s){i==null&&(i=t.doc.first),l==null&&(l=t.doc.first+t.doc.size),s||(s=0);var c=t.display;if(s&&l<c.viewTo&&(c.updateLineNumbers==null||c.updateLineNumbers>i)&&(c.updateLineNumbers=i),t.curOp.viewChanged=!0,i>=c.viewTo)Tn&&Za(t.doc,i)<c.viewTo&&Un(t);else if(l<=c.viewFrom)Tn&&Pf(t.doc,l+s)>c.viewFrom?Un(t):(c.viewFrom+=s,c.viewTo+=s);else if(i<=c.viewFrom&&l>=c.viewTo)Un(t);else if(i<=c.viewFrom){var p=ds(t,l,l+s,1);p?(c.view=c.view.slice(p.index),c.viewFrom=p.lineN,c.viewTo+=s):Un(t)}else if(l>=c.viewTo){var m=ds(t,i,i,-1);m?(c.view=c.view.slice(0,m.index),c.viewTo=m.lineN):Un(t)}else{var y=ds(t,i,i,-1),b=ds(t,l,l+s,1);y&&b?(c.view=c.view.slice(0,y.index).concat(ls(t,y.lineN,b.lineN)).concat(c.view.slice(b.index)),c.viewTo+=s):Un(t)}var k=c.externalMeasured;k&&(l<k.lineN?k.lineN+=s:i<k.lineN+k.size&&(c.externalMeasured=null))}function $n(t,i,l){t.curOp.viewChanged=!0;var s=t.display,c=t.display.externalMeasured;if(c&&i>=c.lineN&&i<c.lineN+c.size&&(s.externalMeasured=null),!(i<s.viewFrom||i>=s.viewTo)){var p=s.view[cr(t,i)];if(p.node!=null){var m=p.changes||(p.changes=[]);re(m,l)==-1&&m.push(l)}}}function Un(t){t.display.viewFrom=t.display.viewTo=t.doc.first,t.display.view=[],t.display.viewOffset=0}function ds(t,i,l,s){var c=cr(t,i),p,m=t.display.view;if(!Tn||l==t.doc.first+t.doc.size)return{index:c,lineN:l};for(var y=t.display.viewFrom,b=0;b<c;b++)y+=m[b].size;if(y!=i){if(s>0){if(c==m.length-1)return null;p=y+m[c].size-i,c++}else p=y-i;i+=p,l+=p}for(;Za(t.doc,l)!=l;){if(c==(s<0?0:m.length-1))return null;l+=s*m[c-(s<0?1:0)].size,c+=s}return{index:c,lineN:l}}function hw(t,i,l){var s=t.display,c=s.view;c.length==0||i>=s.viewTo||l<=s.viewFrom?(s.view=ls(t,i,l),s.viewFrom=i):(s.viewFrom>i?s.view=ls(t,i,s.viewFrom).concat(s.view):s.viewFrom<i&&(s.view=s.view.slice(cr(t,i))),s.viewFrom=i,s.viewTo<l?s.view=s.view.concat(ls(t,s.viewTo,l)):s.viewTo>l&&(s.view=s.view.slice(0,cr(t,l)))),s.viewTo=l}function od(t){for(var i=t.display.view,l=0,s=0;s<i.length;s++){var c=i[s];!c.hidden&&(!c.node||c.changes)&&++l}return l}function $i(t){t.display.input.showSelection(t.display.input.prepareSelection())}function sd(t,i){i===void 0&&(i=!0);var l=t.doc,s={},c=s.cursors=document.createDocumentFragment(),p=s.selection=document.createDocumentFragment(),m=t.options.$customCursor;m&&(i=!0);for(var y=0;y<l.sel.ranges.length;y++)if(!(!i&&y==l.sel.primIndex)){var b=l.sel.ranges[y];if(!(b.from().line>=t.display.viewTo||b.to().line<t.display.viewFrom)){var k=b.empty();if(m){var P=m(t,b);P&&dl(t,P,c)}else(k||t.options.showCursorWhenSelecting)&&dl(t,b.head,c);k||gw(t,b,p)}}return s}function dl(t,i,l){var s=an(t,i,"div",null,null,!t.options.singleCursorHeightPerLine),c=l.appendChild(A("div","\xA0","CodeMirror-cursor"));if(c.style.left=s.left+"px",c.style.top=s.top+"px",c.style.height=Math.max(0,s.bottom-s.top)*t.options.cursorHeight+"px",/\bcm-fat-cursor\b/.test(t.getWrapperElement().className)){var p=fs(t,i,"div",null,null),m=p.right-p.left;c.style.width=(m>0?m:t.defaultCharWidth())+"px"}if(s.other){var y=l.appendChild(A("div","\xA0","CodeMirror-cursor CodeMirror-secondarycursor"));y.style.display="",y.style.left=s.other.left+"px",y.style.top=s.other.top+"px",y.style.height=(s.other.bottom-s.other.top)*.85+"px"}}function ps(t,i){return t.top-i.top||t.left-i.left}function gw(t,i,l){var s=t.display,c=t.doc,p=document.createDocumentFragment(),m=Uf(t.display),y=m.left,b=Math.max(s.sizerWidth,ar(t)-s.sizer.offsetLeft)-m.right,k=c.direction=="ltr";function P(ue,pe,ve,ge){pe<0&&(pe=0),pe=Math.round(pe),ge=Math.round(ge),p.appendChild(A("div",null,"CodeMirror-selected","position: absolute; left: "+ue+`px;
                             top: `+pe+"px; width: "+(ve??b-ue)+`px;
                             height: `+(ge-pe)+"px"))}function j(ue,pe,ve){var ge=he(c,ue),Se=ge.text.length,Re,ft;function Ge(nt,Mt){return fs(t,K(ue,nt),"div",ge,Mt)}function Pt(nt,Mt,pt){var ot=rd(t,ge,null,nt),rt=Mt=="ltr"==(pt=="after")?"left":"right",Ze=pt=="after"?ot.begin:ot.end-(/\s/.test(ge.text.charAt(ot.end-1))?2:1);return Ge(Ze,rt)[rt]}var Lt=Fe(ge,c.direction);return jn(Lt,pe||0,ve??Se,function(nt,Mt,pt,ot){var rt=pt=="ltr",Ze=Ge(nt,rt?"left":"right"),Nt=Ge(Mt-1,rt?"right":"left"),ai=pe==null&&nt==0,Jn=ve==null&&Mt==Se,bt=ot==0,xn=!Lt||ot==Lt.length-1;if(Nt.top-Ze.top<=3){var dt=(k?ai:Jn)&&bt,Rl=(k?Jn:ai)&&xn,Bn=dt?y:(rt?Ze:Nt).left,gr=Rl?b:(rt?Nt:Ze).right;P(Bn,Ze.top,gr-Bn,Ze.bottom)}else{var mr,Ct,li,Hl;rt?(mr=k&&ai&&bt?y:Ze.left,Ct=k?b:Pt(nt,pt,"before"),li=k?y:Pt(Mt,pt,"after"),Hl=k&&Jn&&xn?b:Nt.right):(mr=k?Pt(nt,pt,"before"):y,Ct=!k&&ai&&bt?b:Ze.right,li=!k&&Jn&&xn?y:Nt.left,Hl=k?Pt(Mt,pt,"after"):b),P(mr,Ze.top,Ct-mr,Ze.bottom),Ze.bottom<Nt.top&&P(y,Ze.bottom,null,Nt.top),P(li,Nt.top,Hl-li,Nt.bottom)}(!Re||ps(Ze,Re)<0)&&(Re=Ze),ps(Nt,Re)<0&&(Re=Nt),(!ft||ps(Ze,ft)<0)&&(ft=Ze),ps(Nt,ft)<0&&(ft=Nt)}),{start:Re,end:ft}}var q=i.from(),R=i.to();if(q.line==R.line)j(q.line,q.ch,R.ch);else{var Y=he(c,q.line),ee=he(c,R.line),oe=sn(Y)==sn(ee),le=j(q.line,q.ch,oe?Y.text.length+1:null).end,de=j(R.line,oe?0:null,R.ch).start;oe&&(le.top<de.top-2?(P(le.right,le.top,null,le.bottom),P(y,de.top,de.left,de.bottom)):P(le.right,le.top,de.left-le.right,le.bottom)),le.bottom<de.top&&P(y,le.bottom,null,de.top)}l.appendChild(p)}function pl(t){if(t.state.focused){var i=t.display;clearInterval(i.blinker);var l=!0;i.cursorDiv.style.visibility="",t.options.cursorBlinkRate>0?i.blinker=setInterval(function(){t.hasFocus()||Yr(t),i.cursorDiv.style.visibility=(l=!l)?"":"hidden"},t.options.cursorBlinkRate):t.options.cursorBlinkRate<0&&(i.cursorDiv.style.visibility="hidden")}}function ad(t){t.hasFocus()||(t.display.input.focus(),t.state.focused||gl(t))}function hl(t){t.state.delayingBlurEvent=!0,setTimeout(function(){t.state.delayingBlurEvent&&(t.state.delayingBlurEvent=!1,t.state.focused&&Yr(t))},100)}function gl(t,i){t.state.delayingBlurEvent&&!t.state.draggingText&&(t.state.delayingBlurEvent=!1),t.options.readOnly!="nocursor"&&(t.state.focused||(Ye(t,"focus",t,i),t.state.focused=!0,Le(t.display.wrapper,"CodeMirror-focused"),!t.curOp&&t.display.selForContextMenu!=t.doc.sel&&(t.display.input.reset(),h&&setTimeout(function(){return t.display.input.reset(!0)},20)),t.display.input.receivedFocus()),pl(t))}function Yr(t,i){t.state.delayingBlurEvent||(t.state.focused&&(Ye(t,"blur",t,i),t.state.focused=!1,te(t.display.wrapper,"CodeMirror-focused")),clearInterval(t.display.blinker),setTimeout(function(){t.state.focused||(t.display.shift=!1)},150))}function hs(t){for(var i=t.display,l=i.lineDiv.offsetTop,s=Math.max(0,i.scroller.getBoundingClientRect().top),c=i.lineDiv.getBoundingClientRect().top,p=0,m=0;m<i.view.length;m++){var y=i.view[m],b=t.options.lineWrapping,k=void 0,P=0;if(!y.hidden){if(c+=y.line.height,f&&d<8){var j=y.node.offsetTop+y.node.offsetHeight;k=j-l,l=j}else{var q=y.node.getBoundingClientRect();k=q.bottom-q.top,!b&&y.text.firstChild&&(P=y.text.firstChild.getBoundingClientRect().right-q.left-1)}var R=y.line.height-k;if((R>.005||R<-.005)&&(c<s&&(p-=R),$t(y.line,k),ld(y.line),y.rest))for(var Y=0;Y<y.rest.length;Y++)ld(y.rest[Y]);if(P>t.display.sizerWidth){var ee=Math.ceil(P/Kr(t.display));ee>t.display.maxLineLength&&(t.display.maxLineLength=ee,t.display.maxLine=y.line,t.display.maxLineChanged=!0)}}}Math.abs(p)>2&&(i.scroller.scrollTop+=p)}function ld(t){if(t.widgets)for(var i=0;i<t.widgets.length;++i){var l=t.widgets[i],s=l.node.parentNode;s&&(l.height=s.offsetHeight)}}function gs(t,i,l){var s=l&&l.top!=null?Math.max(0,l.top):t.scroller.scrollTop;s=Math.floor(s-us(t));var c=l&&l.bottom!=null?l.bottom:s+t.wrapper.clientHeight,p=I(i,s),m=I(i,c);if(l&&l.ensure){var y=l.ensure.from.line,b=l.ensure.to.line;y<p?(p=y,m=I(i,Fn(he(i,y))+t.wrapper.clientHeight)):Math.min(b,i.lastLine())>=m&&(p=I(i,Fn(he(i,b))-t.wrapper.clientHeight),m=b)}return{from:p,to:Math.max(m,p+1)}}function mw(t,i){if(!Qe(t,"scrollCursorIntoView")){var l=t.display,s=l.sizer.getBoundingClientRect(),c=null,p=l.wrapper.ownerDocument;if(i.top+s.top<0?c=!0:i.bottom+s.top>(p.defaultView.innerHeight||p.documentElement.clientHeight)&&(c=!1),c!=null&&!M){var m=A("div","\u200B",null,`position: absolute;
                         top: `+(i.top-l.viewOffset-us(t.display))+`px;
                         height: `+(i.bottom-i.top+bn(t)+l.barHeight)+`px;
                         left: `+i.left+"px; width: "+Math.max(2,i.right-i.left)+"px;");t.display.lineSpace.appendChild(m),m.scrollIntoView(c),t.display.lineSpace.removeChild(m)}}}function vw(t,i,l,s){s==null&&(s=0);var c;!t.options.lineWrapping&&i==l&&(l=i.sticky=="before"?K(i.line,i.ch+1,"before"):i,i=i.ch?K(i.line,i.sticky=="before"?i.ch-1:i.ch,"after"):i);for(var p=0;p<5;p++){var m=!1,y=an(t,i),b=!l||l==i?y:an(t,l);c={left:Math.min(y.left,b.left),top:Math.min(y.top,b.top)-s,right:Math.max(y.left,b.left),bottom:Math.max(y.bottom,b.bottom)+s};var k=ml(t,c),P=t.doc.scrollTop,j=t.doc.scrollLeft;if(k.scrollTop!=null&&(Vi(t,k.scrollTop),Math.abs(t.doc.scrollTop-P)>1&&(m=!0)),k.scrollLeft!=null&&(fr(t,k.scrollLeft),Math.abs(t.doc.scrollLeft-j)>1&&(m=!0)),!m)break}return c}function yw(t,i){var l=ml(t,i);l.scrollTop!=null&&Vi(t,l.scrollTop),l.scrollLeft!=null&&fr(t,l.scrollLeft)}function ml(t,i){var l=t.display,s=Gr(t.display);i.top<0&&(i.top=0);var c=t.curOp&&t.curOp.scrollTop!=null?t.curOp.scrollTop:l.scroller.scrollTop,p=rl(t),m={};i.bottom-i.top>p&&(i.bottom=i.top+p);var y=t.doc.height+nl(l),b=i.top<s,k=i.bottom>y-s;if(i.top<c)m.scrollTop=b?0:i.top;else if(i.bottom>c+p){var P=Math.min(i.top,(k?y:i.bottom)-p);P!=c&&(m.scrollTop=P)}var j=t.options.fixedGutter?0:l.gutters.offsetWidth,q=t.curOp&&t.curOp.scrollLeft!=null?t.curOp.scrollLeft:l.scroller.scrollLeft-j,R=ar(t)-l.gutters.offsetWidth,Y=i.right-i.left>R;return Y&&(i.right=i.left+R),i.left<10?m.scrollLeft=0:i.left<q?m.scrollLeft=Math.max(0,i.left+j-(Y?0:10)):i.right>R+q-3&&(m.scrollLeft=i.right+(Y?0:10)-R),m}function vl(t,i){i!=null&&(ms(t),t.curOp.scrollTop=(t.curOp.scrollTop==null?t.doc.scrollTop:t.curOp.scrollTop)+i)}function Qr(t){ms(t);var i=t.getCursor();t.curOp.scrollToPos={from:i,to:i,margin:t.options.cursorScrollMargin}}function Ui(t,i,l){(i!=null||l!=null)&&ms(t),i!=null&&(t.curOp.scrollLeft=i),l!=null&&(t.curOp.scrollTop=l)}function bw(t,i){ms(t),t.curOp.scrollToPos=i}function ms(t){var i=t.curOp.scrollToPos;if(i){t.curOp.scrollToPos=null;var l=td(t,i.from),s=td(t,i.to);ud(t,l,s,i.margin)}}function ud(t,i,l,s){var c=ml(t,{left:Math.min(i.left,l.left),top:Math.min(i.top,l.top)-s,right:Math.max(i.right,l.right),bottom:Math.max(i.bottom,l.bottom)+s});Ui(t,c.scrollLeft,c.scrollTop)}function Vi(t,i){Math.abs(t.doc.scrollTop-i)<2||(r||bl(t,{top:i}),cd(t,i,!0),r&&bl(t),Yi(t,100))}function cd(t,i,l){i=Math.max(0,Math.min(t.display.scroller.scrollHeight-t.display.scroller.clientHeight,i)),!(t.display.scroller.scrollTop==i&&!l)&&(t.doc.scrollTop=i,t.display.scrollbars.setScrollTop(i),t.display.scroller.scrollTop!=i&&(t.display.scroller.scrollTop=i))}function fr(t,i,l,s){i=Math.max(0,Math.min(i,t.display.scroller.scrollWidth-t.display.scroller.clientWidth)),!((l?i==t.doc.scrollLeft:Math.abs(t.doc.scrollLeft-i)<2)&&!s)&&(t.doc.scrollLeft=i,gd(t),t.display.scroller.scrollLeft!=i&&(t.display.scroller.scrollLeft=i),t.display.scrollbars.setScrollLeft(i))}function Gi(t){var i=t.display,l=i.gutters.offsetWidth,s=Math.round(t.doc.height+nl(t.display));return{clientHeight:i.scroller.clientHeight,viewHeight:i.wrapper.clientHeight,scrollWidth:i.scroller.scrollWidth,clientWidth:i.scroller.clientWidth,viewWidth:i.wrapper.clientWidth,barLeft:t.options.fixedGutter?l:0,docHeight:s,scrollHeight:s+bn(t)+i.barHeight,nativeBarWidth:i.nativeBarWidth,gutterWidth:l}}var dr=function(t,i,l){this.cm=l;var s=this.vert=A("div",[A("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),c=this.horiz=A("div",[A("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");s.tabIndex=c.tabIndex=-1,t(s),t(c),me(s,"scroll",function(){s.clientHeight&&i(s.scrollTop,"vertical")}),me(c,"scroll",function(){c.clientWidth&&i(c.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,f&&d<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};dr.prototype.update=function(t){var i=t.scrollWidth>t.clientWidth+1,l=t.scrollHeight>t.clientHeight+1,s=t.nativeBarWidth;if(l){this.vert.style.display="block",this.vert.style.bottom=i?s+"px":"0";var c=t.viewHeight-(i?s:0);this.vert.firstChild.style.height=Math.max(0,t.scrollHeight-t.clientHeight+c)+"px"}else this.vert.scrollTop=0,this.vert.style.display="",this.vert.firstChild.style.height="0";if(i){this.horiz.style.display="block",this.horiz.style.right=l?s+"px":"0",this.horiz.style.left=t.barLeft+"px";var p=t.viewWidth-t.barLeft-(l?s:0);this.horiz.firstChild.style.width=Math.max(0,t.scrollWidth-t.clientWidth+p)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&t.clientHeight>0&&(s==0&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:l?s:0,bottom:i?s:0}},dr.prototype.setScrollLeft=function(t){this.horiz.scrollLeft!=t&&(this.horiz.scrollLeft=t),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},dr.prototype.setScrollTop=function(t){this.vert.scrollTop!=t&&(this.vert.scrollTop=t),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},dr.prototype.zeroWidthHack=function(){var t=L&&!E?"12px":"18px";this.horiz.style.height=this.vert.style.width=t,this.horiz.style.visibility=this.vert.style.visibility="hidden",this.disableHoriz=new ne,this.disableVert=new ne},dr.prototype.enableZeroWidthBar=function(t,i,l){t.style.visibility="";function s(){var c=t.getBoundingClientRect(),p=l=="vert"?document.elementFromPoint(c.right-1,(c.top+c.bottom)/2):document.elementFromPoint((c.right+c.left)/2,c.bottom-1);p!=t?t.style.visibility="hidden":i.set(1e3,s)}i.set(1e3,s)},dr.prototype.clear=function(){var t=this.horiz.parentNode;t.removeChild(this.horiz),t.removeChild(this.vert)};var Ki=function(){};Ki.prototype.update=function(){return{bottom:0,right:0}},Ki.prototype.setScrollLeft=function(){},Ki.prototype.setScrollTop=function(){},Ki.prototype.clear=function(){};function Jr(t,i){i||(i=Gi(t));var l=t.display.barWidth,s=t.display.barHeight;fd(t,i);for(var c=0;c<4&&l!=t.display.barWidth||s!=t.display.barHeight;c++)l!=t.display.barWidth&&t.options.lineWrapping&&hs(t),fd(t,Gi(t)),l=t.display.barWidth,s=t.display.barHeight}function fd(t,i){var l=t.display,s=l.scrollbars.update(i);l.sizer.style.paddingRight=(l.barWidth=s.right)+"px",l.sizer.style.paddingBottom=(l.barHeight=s.bottom)+"px",l.heightForcer.style.borderBottom=s.bottom+"px solid transparent",s.right&&s.bottom?(l.scrollbarFiller.style.display="block",l.scrollbarFiller.style.height=s.bottom+"px",l.scrollbarFiller.style.width=s.right+"px"):l.scrollbarFiller.style.display="",s.bottom&&t.options.coverGutterNextToScrollbar&&t.options.fixedGutter?(l.gutterFiller.style.display="block",l.gutterFiller.style.height=s.bottom+"px",l.gutterFiller.style.width=i.gutterWidth+"px"):l.gutterFiller.style.display=""}var dd={native:dr,null:Ki};function pd(t){t.display.scrollbars&&(t.display.scrollbars.clear(),t.display.scrollbars.addClass&&te(t.display.wrapper,t.display.scrollbars.addClass)),t.display.scrollbars=new dd[t.options.scrollbarStyle](function(i){t.display.wrapper.insertBefore(i,t.display.scrollbarFiller),me(i,"mousedown",function(){t.state.focused&&setTimeout(function(){return t.display.input.focus()},0)}),i.setAttribute("cm-not-content","true")},function(i,l){l=="horizontal"?fr(t,i):Vi(t,i)},t),t.display.scrollbars.addClass&&Le(t.display.wrapper,t.display.scrollbars.addClass)}var ww=0;function pr(t){t.curOp={cm:t,viewChanged:!1,startHeight:t.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++ww,markArrays:null},Jb(t.curOp)}function hr(t){var i=t.curOp;i&&Xb(i,function(l){for(var s=0;s<l.ops.length;s++)l.ops[s].cm.curOp=null;xw(l)})}function xw(t){for(var i=t.ops,l=0;l<i.length;l++)kw(i[l]);for(var s=0;s<i.length;s++)Cw(i[s]);for(var c=0;c<i.length;c++)Dw(i[c]);for(var p=0;p<i.length;p++)Aw(i[p]);for(var m=0;m<i.length;m++)Sw(i[m])}function kw(t){var i=t.cm,l=i.display;Tw(i),t.updateMaxLine&&el(i),t.mustUpdate=t.viewChanged||t.forceUpdate||t.scrollTop!=null||t.scrollToPos&&(t.scrollToPos.from.line<l.viewFrom||t.scrollToPos.to.line>=l.viewTo)||l.maxLineChanged&&i.options.lineWrapping,t.update=t.mustUpdate&&new vs(i,t.mustUpdate&&{top:t.scrollTop,ensure:t.scrollToPos},t.forceUpdate)}function Cw(t){t.updatedDisplay=t.mustUpdate&&yl(t.cm,t.update)}function Dw(t){var i=t.cm,l=i.display;t.updatedDisplay&&hs(i),t.barMeasure=Gi(i),l.maxLineChanged&&!i.options.lineWrapping&&(t.adjustWidthTo=Gf(i,l.maxLine,l.maxLine.text.length).left+3,i.display.sizerWidth=t.adjustWidthTo,t.barMeasure.scrollWidth=Math.max(l.scroller.clientWidth,l.sizer.offsetLeft+t.adjustWidthTo+bn(i)+i.display.barWidth),t.maxScrollLeft=Math.max(0,l.sizer.offsetLeft+t.adjustWidthTo-ar(i))),(t.updatedDisplay||t.selectionChanged)&&(t.preparedSelection=l.input.prepareSelection())}function Aw(t){var i=t.cm;t.adjustWidthTo!=null&&(i.display.sizer.style.minWidth=t.adjustWidthTo+"px",t.maxScrollLeft<i.doc.scrollLeft&&fr(i,Math.min(i.display.scroller.scrollLeft,t.maxScrollLeft),!0),i.display.maxLineChanged=!1);var l=t.focus&&t.focus==xe(ht(i));t.preparedSelection&&i.display.input.showSelection(t.preparedSelection,l),(t.updatedDisplay||t.startHeight!=i.doc.height)&&Jr(i,t.barMeasure),t.updatedDisplay&&xl(i,t.barMeasure),t.selectionChanged&&pl(i),i.state.focused&&t.updateInput&&i.display.input.reset(t.typing),l&&ad(t.cm)}function Sw(t){var i=t.cm,l=i.display,s=i.doc;if(t.updatedDisplay&&hd(i,t.update),l.wheelStartX!=null&&(t.scrollTop!=null||t.scrollLeft!=null||t.scrollToPos)&&(l.wheelStartX=l.wheelStartY=null),t.scrollTop!=null&&cd(i,t.scrollTop,t.forceScroll),t.scrollLeft!=null&&fr(i,t.scrollLeft,!0,!0),t.scrollToPos){var c=vw(i,De(s,t.scrollToPos.from),De(s,t.scrollToPos.to),t.scrollToPos.margin);mw(i,c)}var p=t.maybeHiddenMarkers,m=t.maybeUnhiddenMarkers;if(p)for(var y=0;y<p.length;++y)p[y].lines.length||Ye(p[y],"hide");if(m)for(var b=0;b<m.length;++b)m[b].lines.length&&Ye(m[b],"unhide");l.wrapper.offsetHeight&&(s.scrollTop=i.display.scroller.scrollTop),t.changeObjs&&Ye(i,"changes",i,t.changeObjs),t.update&&t.update.finish()}function Ot(t,i){if(t.curOp)return i();pr(t);try{return i()}finally{hr(t)}}function ut(t,i){return function(){if(t.curOp)return i.apply(t,arguments);pr(t);try{return i.apply(t,arguments)}finally{hr(t)}}}function kt(t){return function(){if(this.curOp)return t.apply(this,arguments);pr(this);try{return t.apply(this,arguments)}finally{hr(this)}}}function ct(t){return function(){var i=this.cm;if(!i||i.curOp)return t.apply(this,arguments);pr(i);try{return t.apply(this,arguments)}finally{hr(i)}}}function Yi(t,i){t.doc.highlightFrontier<t.display.viewTo&&t.state.highlight.set(i,be(Ew,t))}function Ew(t){var i=t.doc;if(!(i.highlightFrontier>=t.display.viewTo)){var l=+new Date+t.options.workTime,s=zi(t,i.highlightFrontier),c=[];i.iter(s.line,Math.min(i.first+i.size,t.display.viewTo+500),function(p){if(s.line>=t.display.viewFrom){var m=p.styles,y=p.text.length>t.options.maxHighlightLength?vn(i.mode,s.state):null,b=xf(t,p,s,!0);y&&(s.state=y),p.styles=b.styles;var k=p.styleClasses,P=b.classes;P?p.styleClasses=P:k&&(p.styleClasses=null);for(var j=!m||m.length!=p.styles.length||k!=P&&(!k||!P||k.bgClass!=P.bgClass||k.textClass!=P.textClass),q=0;!j&&q<m.length;++q)j=m[q]!=p.styles[q];j&&c.push(s.line),p.stateAfter=s.save(),s.nextLine()}else p.text.length<=t.options.maxHighlightLength&&Ka(t,p.text,s),p.stateAfter=s.line%5==0?s.save():null,s.nextLine();if(+new Date>l)return Yi(t,t.options.workDelay),!0}),i.highlightFrontier=s.line,i.modeFrontier=Math.max(i.modeFrontier,s.line),c.length&&Ot(t,function(){for(var p=0;p<c.length;p++)$n(t,c[p],"text")})}}var vs=function(t,i,l){var s=t.display;this.viewport=i,this.visible=gs(s,t.doc,i),this.editorIsHidden=!s.wrapper.offsetWidth,this.wrapperHeight=s.wrapper.clientHeight,this.wrapperWidth=s.wrapper.clientWidth,this.oldDisplayWidth=ar(t),this.force=l,this.dims=ul(t),this.events=[]};vs.prototype.signal=function(t,i){Bt(t,i)&&this.events.push(arguments)},vs.prototype.finish=function(){for(var t=0;t<this.events.length;t++)Ye.apply(null,this.events[t])};function Tw(t){var i=t.display;!i.scrollbarsClipped&&i.scroller.offsetWidth&&(i.nativeBarWidth=i.scroller.offsetWidth-i.scroller.clientWidth,i.heightForcer.style.height=bn(t)+"px",i.sizer.style.marginBottom=-i.nativeBarWidth+"px",i.sizer.style.borderRightWidth=bn(t)+"px",i.scrollbarsClipped=!0)}function Fw(t){if(t.hasFocus())return null;var i=xe(ht(t));if(!i||!ce(t.display.lineDiv,i))return null;var l={activeElt:i};if(window.getSelection){var s=ke(t).getSelection();s.anchorNode&&s.extend&&ce(t.display.lineDiv,s.anchorNode)&&(l.anchorNode=s.anchorNode,l.anchorOffset=s.anchorOffset,l.focusNode=s.focusNode,l.focusOffset=s.focusOffset)}return l}function Lw(t){if(!(!t||!t.activeElt||t.activeElt==xe(Pe(t.activeElt)))&&(t.activeElt.focus(),!/^(INPUT|TEXTAREA)$/.test(t.activeElt.nodeName)&&t.anchorNode&&ce(document.body,t.anchorNode)&&ce(document.body,t.focusNode))){var i=t.activeElt.ownerDocument,l=i.defaultView.getSelection(),s=i.createRange();s.setEnd(t.anchorNode,t.anchorOffset),s.collapse(!1),l.removeAllRanges(),l.addRange(s),l.extend(t.focusNode,t.focusOffset)}}function yl(t,i){var l=t.display,s=t.doc;if(i.editorIsHidden)return Un(t),!1;if(!i.force&&i.visible.from>=l.viewFrom&&i.visible.to<=l.viewTo&&(l.updateLineNumbers==null||l.updateLineNumbers>=l.viewTo)&&l.renderedView==l.view&&od(t)==0)return!1;md(t)&&(Un(t),i.dims=ul(t));var c=s.first+s.size,p=Math.max(i.visible.from-t.options.viewportMargin,s.first),m=Math.min(c,i.visible.to+t.options.viewportMargin);l.viewFrom<p&&p-l.viewFrom<20&&(p=Math.max(s.first,l.viewFrom)),l.viewTo>m&&l.viewTo-m<20&&(m=Math.min(c,l.viewTo)),Tn&&(p=Za(t.doc,p),m=Pf(t.doc,m));var y=p!=l.viewFrom||m!=l.viewTo||l.lastWrapHeight!=i.wrapperHeight||l.lastWrapWidth!=i.wrapperWidth;hw(t,p,m),l.viewOffset=Fn(he(t.doc,l.viewFrom)),t.display.mover.style.top=l.viewOffset+"px";var b=od(t);if(!y&&b==0&&!i.force&&l.renderedView==l.view&&(l.updateLineNumbers==null||l.updateLineNumbers>=l.viewTo))return!1;var k=Fw(t);return b>4&&(l.lineDiv.style.display="none"),Mw(t,l.updateLineNumbers,i.dims),b>4&&(l.lineDiv.style.display=""),l.renderedView=l.view,Lw(k),H(l.cursorDiv),H(l.selectionDiv),l.gutters.style.height=l.sizer.style.minHeight=0,y&&(l.lastWrapHeight=i.wrapperHeight,l.lastWrapWidth=i.wrapperWidth,Yi(t,400)),l.updateLineNumbers=null,!0}function hd(t,i){for(var l=i.viewport,s=!0;;s=!1){if(!s||!t.options.lineWrapping||i.oldDisplayWidth==ar(t)){if(l&&l.top!=null&&(l={top:Math.min(t.doc.height+nl(t.display)-rl(t),l.top)}),i.visible=gs(t.display,t.doc,l),i.visible.from>=t.display.viewFrom&&i.visible.to<=t.display.viewTo)break}else s&&(i.visible=gs(t.display,t.doc,l));if(!yl(t,i))break;hs(t);var c=Gi(t);$i(t),Jr(t,c),xl(t,c),i.force=!1}i.signal(t,"update",t),(t.display.viewFrom!=t.display.reportedViewFrom||t.display.viewTo!=t.display.reportedViewTo)&&(i.signal(t,"viewportChange",t,t.display.viewFrom,t.display.viewTo),t.display.reportedViewFrom=t.display.viewFrom,t.display.reportedViewTo=t.display.viewTo)}function bl(t,i){var l=new vs(t,i);if(yl(t,l)){hs(t),hd(t,l);var s=Gi(t);$i(t),Jr(t,s),xl(t,s),l.finish()}}function Mw(t,i,l){var s=t.display,c=t.options.lineNumbers,p=s.lineDiv,m=p.firstChild;function y(Y){var ee=Y.nextSibling;return h&&L&&t.display.currentWheelTarget==Y?Y.style.display="none":Y.parentNode.removeChild(Y),ee}for(var b=s.view,k=s.viewFrom,P=0;P<b.length;P++){var j=b[P];if(!j.hidden)if(!j.node||j.node.parentNode!=p){var q=iw(t,j,k,l);p.insertBefore(q,m)}else{for(;m!=j.node;)m=y(m);var R=c&&i!=null&&i<=k&&j.lineNumber;j.changes&&(re(j.changes,"gutter")>-1&&(R=!1),Hf(t,j,k,l)),R&&(H(j.lineNumber),j.lineNumber.appendChild(document.createTextNode(ie(t.options,k)))),m=j.node.nextSibling}k+=j.size}for(;m;)m=y(m)}function wl(t){var i=t.gutters.offsetWidth;t.sizer.style.marginLeft=i+"px",lt(t,"gutterChanged",t)}function xl(t,i){t.display.sizer.style.minHeight=i.docHeight+"px",t.display.heightForcer.style.top=i.docHeight+"px",t.display.gutters.style.height=i.docHeight+t.display.barHeight+bn(t)+"px"}function gd(t){var i=t.display,l=i.view;if(!(!i.alignWidgets&&(!i.gutters.firstChild||!t.options.fixedGutter))){for(var s=cl(i)-i.scroller.scrollLeft+t.doc.scrollLeft,c=i.gutters.offsetWidth,p=s+"px",m=0;m<l.length;m++)if(!l[m].hidden){t.options.fixedGutter&&(l[m].gutter&&(l[m].gutter.style.left=p),l[m].gutterBackground&&(l[m].gutterBackground.style.left=p));var y=l[m].alignable;if(y)for(var b=0;b<y.length;b++)y[b].style.left=p}t.options.fixedGutter&&(i.gutters.style.left=s+c+"px")}}function md(t){if(!t.options.lineNumbers)return!1;var i=t.doc,l=ie(t.options,i.first+i.size-1),s=t.display;if(l.length!=s.lineNumChars){var c=s.measure.appendChild(A("div",[A("div",l)],"CodeMirror-linenumber CodeMirror-gutter-elt")),p=c.firstChild.offsetWidth,m=c.offsetWidth-p;return s.lineGutter.style.width="",s.lineNumInnerWidth=Math.max(p,s.lineGutter.offsetWidth-m)+1,s.lineNumWidth=s.lineNumInnerWidth+m,s.lineNumChars=s.lineNumInnerWidth?l.length:-1,s.lineGutter.style.width=s.lineNumWidth+"px",wl(t.display),!0}return!1}function kl(t,i){for(var l=[],s=!1,c=0;c<t.length;c++){var p=t[c],m=null;if(typeof p!="string"&&(m=p.style,p=p.className),p=="CodeMirror-linenumbers")if(i)s=!0;else continue;l.push({className:p,style:m})}return i&&!s&&l.push({className:"CodeMirror-linenumbers",style:null}),l}function vd(t){var i=t.gutters,l=t.gutterSpecs;H(i),t.lineGutter=null;for(var s=0;s<l.length;++s){var c=l[s],p=c.className,m=c.style,y=i.appendChild(A("div",null,"CodeMirror-gutter "+p));m&&(y.style.cssText=m),p=="CodeMirror-linenumbers"&&(t.lineGutter=y,y.style.width=(t.lineNumWidth||1)+"px")}i.style.display=l.length?"":"none",wl(t)}function Qi(t){vd(t.display),Tt(t),gd(t)}function Nw(t,i,l,s){var c=this;this.input=l,c.scrollbarFiller=A("div",null,"CodeMirror-scrollbar-filler"),c.scrollbarFiller.setAttribute("cm-not-content","true"),c.gutterFiller=A("div",null,"CodeMirror-gutter-filler"),c.gutterFiller.setAttribute("cm-not-content","true"),c.lineDiv=Q("div",null,"CodeMirror-code"),c.selectionDiv=A("div",null,null,"position: relative; z-index: 1"),c.cursorDiv=A("div",null,"CodeMirror-cursors"),c.measure=A("div",null,"CodeMirror-measure"),c.lineMeasure=A("div",null,"CodeMirror-measure"),c.lineSpace=Q("div",[c.measure,c.lineMeasure,c.selectionDiv,c.cursorDiv,c.lineDiv],null,"position: relative; outline: none");var p=Q("div",[c.lineSpace],"CodeMirror-lines");c.mover=A("div",[p],null,"position: relative"),c.sizer=A("div",[c.mover],"CodeMirror-sizer"),c.sizerWidth=null,c.heightForcer=A("div",null,null,"position: absolute; height: "+Ee+"px; width: 1px;"),c.gutters=A("div",null,"CodeMirror-gutters"),c.lineGutter=null,c.scroller=A("div",[c.sizer,c.heightForcer,c.gutters],"CodeMirror-scroll"),c.scroller.setAttribute("tabIndex","-1"),c.wrapper=A("div",[c.scrollbarFiller,c.gutterFiller,c.scroller],"CodeMirror"),v&&w>=105&&(c.wrapper.style.clipPath="inset(0px)"),c.wrapper.setAttribute("translate","no"),f&&d<8&&(c.gutters.style.zIndex=-1,c.scroller.style.paddingRight=0),!h&&!(r&&C)&&(c.scroller.draggable=!0),t&&(t.appendChild?t.appendChild(c.wrapper):t(c.wrapper)),c.viewFrom=c.viewTo=i.first,c.reportedViewFrom=c.reportedViewTo=i.first,c.view=[],c.renderedView=null,c.externalMeasured=null,c.viewOffset=0,c.lastWrapHeight=c.lastWrapWidth=0,c.updateLineNumbers=null,c.nativeBarWidth=c.barHeight=c.barWidth=0,c.scrollbarsClipped=!1,c.lineNumWidth=c.lineNumInnerWidth=c.lineNumChars=null,c.alignWidgets=!1,c.cachedCharWidth=c.cachedTextHeight=c.cachedPaddingH=null,c.maxLine=null,c.maxLineLength=0,c.maxLineChanged=!1,c.wheelDX=c.wheelDY=c.wheelStartX=c.wheelStartY=null,c.shift=!1,c.selForContextMenu=null,c.activeTouch=null,c.gutterSpecs=kl(s.gutters,s.lineNumbers),vd(c),l.init(c)}var ys=0,Mn=null;f?Mn=-.53:r?Mn=15:v?Mn=-.7:T&&(Mn=-1/3);function yd(t){var i=t.wheelDeltaX,l=t.wheelDeltaY;return i==null&&t.detail&&t.axis==t.HORIZONTAL_AXIS&&(i=t.detail),l==null&&t.detail&&t.axis==t.VERTICAL_AXIS?l=t.detail:l==null&&(l=t.wheelDelta),{x:i,y:l}}function Bw(t){var i=yd(t);return i.x*=Mn,i.y*=Mn,i}function bd(t,i){v&&w==102&&(t.display.chromeScrollHack==null?t.display.sizer.style.pointerEvents="none":clearTimeout(t.display.chromeScrollHack),t.display.chromeScrollHack=setTimeout(function(){t.display.chromeScrollHack=null,t.display.sizer.style.pointerEvents=""},100));var l=yd(i),s=l.x,c=l.y,p=Mn;i.deltaMode===0&&(s=i.deltaX,c=i.deltaY,p=1);var m=t.display,y=m.scroller,b=y.scrollWidth>y.clientWidth,k=y.scrollHeight>y.clientHeight;if(s&&b||c&&k){if(c&&L&&h){e:for(var P=i.target,j=m.view;P!=y;P=P.parentNode)for(var q=0;q<j.length;q++)if(j[q].node==P){t.display.currentWheelTarget=P;break e}}if(s&&!r&&!x&&p!=null){c&&k&&Vi(t,Math.max(0,y.scrollTop+c*p)),fr(t,Math.max(0,y.scrollLeft+s*p)),(!c||c&&k)&&vt(i),m.wheelStartX=null;return}if(c&&p!=null){var R=c*p,Y=t.doc.scrollTop,ee=Y+m.wrapper.clientHeight;R<0?Y=Math.max(0,Y+R-50):ee=Math.min(t.doc.height,ee+R+50),bl(t,{top:Y,bottom:ee})}ys<20&&i.deltaMode!==0&&(m.wheelStartX==null?(m.wheelStartX=y.scrollLeft,m.wheelStartY=y.scrollTop,m.wheelDX=s,m.wheelDY=c,setTimeout(function(){if(m.wheelStartX!=null){var oe=y.scrollLeft-m.wheelStartX,le=y.scrollTop-m.wheelStartY,de=le&&m.wheelDY&&le/m.wheelDY||oe&&m.wheelDX&&oe/m.wheelDX;m.wheelStartX=m.wheelStartY=null,de&&(Mn=(Mn*ys+de)/(ys+1),++ys)}},200)):(m.wheelDX+=s,m.wheelDY+=c))}}var Ut=function(t,i){this.ranges=t,this.primIndex=i};Ut.prototype.primary=function(){return this.ranges[this.primIndex]},Ut.prototype.equals=function(t){if(t==this)return!0;if(t.primIndex!=this.primIndex||t.ranges.length!=this.ranges.length)return!1;for(var i=0;i<this.ranges.length;i++){var l=this.ranges[i],s=t.ranges[i];if(!Be(l.anchor,s.anchor)||!Be(l.head,s.head))return!1}return!0},Ut.prototype.deepCopy=function(){for(var t=[],i=0;i<this.ranges.length;i++)t[i]=new Oe(at(this.ranges[i].anchor),at(this.ranges[i].head));return new Ut(t,this.primIndex)},Ut.prototype.somethingSelected=function(){for(var t=0;t<this.ranges.length;t++)if(!this.ranges[t].empty())return!0;return!1},Ut.prototype.contains=function(t,i){i||(i=t);for(var l=0;l<this.ranges.length;l++){var s=this.ranges[l];if(fe(i,s.from())>=0&&fe(t,s.to())<=0)return l}return-1};var Oe=function(t,i){this.anchor=t,this.head=i};Oe.prototype.from=function(){return Wr(this.anchor,this.head)},Oe.prototype.to=function(){return Et(this.anchor,this.head)},Oe.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch};function ln(t,i,l){var s=t&&t.options.selectionsMayTouch,c=i[l];i.sort(function(q,R){return fe(q.from(),R.from())}),l=re(i,c);for(var p=1;p<i.length;p++){var m=i[p],y=i[p-1],b=fe(y.to(),m.from());if(s&&!m.empty()?b>0:b>=0){var k=Wr(y.from(),m.from()),P=Et(y.to(),m.to()),j=y.empty()?m.from()==m.head:y.from()==y.head;p<=l&&--l,i.splice(--p,2,new Oe(j?P:k,j?k:P))}}return new Ut(i,l)}function Vn(t,i){return new Ut([new Oe(t,i||t)],0)}function Gn(t){return t.text?K(t.from.line+t.text.length-1,Me(t.text).length+(t.text.length==1?t.from.ch:0)):t.to}function wd(t,i){if(fe(t,i.from)<0)return t;if(fe(t,i.to)<=0)return Gn(i);var l=t.line+i.text.length-(i.to.line-i.from.line)-1,s=t.ch;return t.line==i.to.line&&(s+=Gn(i).ch-i.to.ch),K(l,s)}function Cl(t,i){for(var l=[],s=0;s<t.sel.ranges.length;s++){var c=t.sel.ranges[s];l.push(new Oe(wd(c.anchor,i),wd(c.head,i)))}return ln(t.cm,l,t.sel.primIndex)}function xd(t,i,l){return t.line==i.line?K(l.line,t.ch-i.ch+l.ch):K(l.line+(t.line-i.line),t.ch)}function Ow(t,i,l){for(var s=[],c=K(t.first,0),p=c,m=0;m<i.length;m++){var y=i[m],b=xd(y.from,c,p),k=xd(Gn(y),c,p);if(c=y.to,p=k,l=="around"){var P=t.sel.ranges[m],j=fe(P.head,P.anchor)<0;s[m]=new Oe(j?k:b,j?b:k)}else s[m]=new Oe(b,b)}return new Ut(s,t.sel.primIndex)}function Dl(t){t.doc.mode=Hr(t.options,t.doc.modeOption),Ji(t)}function Ji(t){t.doc.iter(function(i){i.stateAfter&&(i.stateAfter=null),i.styles&&(i.styles=null)}),t.doc.modeFrontier=t.doc.highlightFrontier=t.doc.first,Yi(t,100),t.state.modeGen++,t.curOp&&Tt(t)}function kd(t,i){return i.from.ch==0&&i.to.ch==0&&Me(i.text)==""&&(!t.cm||t.cm.options.wholeLineUpdateBefore)}function Al(t,i,l,s){function c(de){return l?l[de]:null}function p(de,ue,pe){_b(de,ue,pe,s),lt(de,"change",de,i)}function m(de,ue){for(var pe=[],ve=de;ve<ue;++ve)pe.push(new $r(k[ve],c(ve),s));return pe}var y=i.from,b=i.to,k=i.text,P=he(t,y.line),j=he(t,b.line),q=Me(k),R=c(k.length-1),Y=b.line-y.line;if(i.full)t.insert(0,m(0,k.length)),t.remove(k.length,t.size-k.length);else if(kd(t,i)){var ee=m(0,k.length-1);p(j,j.text,R),Y&&t.remove(y.line,Y),ee.length&&t.insert(y.line,ee)}else if(P==j)if(k.length==1)p(P,P.text.slice(0,y.ch)+q+P.text.slice(b.ch),R);else{var oe=m(1,k.length-1);oe.push(new $r(q+P.text.slice(b.ch),R,s)),p(P,P.text.slice(0,y.ch)+k[0],c(0)),t.insert(y.line+1,oe)}else if(k.length==1)p(P,P.text.slice(0,y.ch)+k[0]+j.text.slice(b.ch),c(0)),t.remove(y.line+1,Y);else{p(P,P.text.slice(0,y.ch)+k[0],c(0)),p(j,q+j.text.slice(b.ch),R);var le=m(1,k.length-1);Y>1&&t.remove(y.line+1,Y-1),t.insert(y.line+1,le)}lt(t,"change",t,i)}function Kn(t,i,l){function s(c,p,m){if(c.linked)for(var y=0;y<c.linked.length;++y){var b=c.linked[y];if(b.doc!=p){var k=m&&b.sharedHist;l&&!k||(i(b.doc,k),s(b.doc,c,k))}}}s(t,null,!0)}function Cd(t,i){if(i.cm)throw new Error("This document is already in use.");t.doc=i,i.cm=t,fl(t),Dl(t),Dd(t),t.options.direction=i.direction,t.options.lineWrapping||el(t),t.options.mode=i.modeOption,Tt(t)}function Dd(t){(t.doc.direction=="rtl"?Le:te)(t.display.lineDiv,"CodeMirror-rtl")}function Pw(t){Ot(t,function(){Dd(t),Tt(t)})}function bs(t){this.done=[],this.undone=[],this.undoDepth=t?t.undoDepth:1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=t?t.maxGeneration:1}function Sl(t,i){var l={from:at(i.from),to:Gn(i),text:En(t,i.from,i.to)};return Ed(t,l,i.from.line,i.to.line+1),Kn(t,function(s){return Ed(s,l,i.from.line,i.to.line+1)},!0),l}function Ad(t){for(;t.length;){var i=Me(t);if(i.ranges)t.pop();else break}}function Iw(t,i){if(i)return Ad(t.done),Me(t.done);if(t.done.length&&!Me(t.done).ranges)return Me(t.done);if(t.done.length>1&&!t.done[t.done.length-2].ranges)return t.done.pop(),Me(t.done)}function Sd(t,i,l,s){var c=t.history;c.undone.length=0;var p=+new Date,m,y;if((c.lastOp==s||c.lastOrigin==i.origin&&i.origin&&(i.origin.charAt(0)=="+"&&c.lastModTime>p-(t.cm?t.cm.options.historyEventDelay:500)||i.origin.charAt(0)=="*"))&&(m=Iw(c,c.lastOp==s)))y=Me(m.changes),fe(i.from,i.to)==0&&fe(i.from,y.to)==0?y.to=Gn(i):m.changes.push(Sl(t,i));else{var b=Me(c.done);for((!b||!b.ranges)&&ws(t.sel,c.done),m={changes:[Sl(t,i)],generation:c.generation},c.done.push(m);c.done.length>c.undoDepth;)c.done.shift(),c.done[0].ranges||c.done.shift()}c.done.push(l),c.generation=++c.maxGeneration,c.lastModTime=c.lastSelTime=p,c.lastOp=c.lastSelOp=s,c.lastOrigin=c.lastSelOrigin=i.origin,y||Ye(t,"historyAdded")}function jw(t,i,l,s){var c=i.charAt(0);return c=="*"||c=="+"&&l.ranges.length==s.ranges.length&&l.somethingSelected()==s.somethingSelected()&&new Date-t.history.lastSelTime<=(t.cm?t.cm.options.historyEventDelay:500)}function zw(t,i,l,s){var c=t.history,p=s&&s.origin;l==c.lastSelOp||p&&c.lastSelOrigin==p&&(c.lastModTime==c.lastSelTime&&c.lastOrigin==p||jw(t,p,Me(c.done),i))?c.done[c.done.length-1]=i:ws(i,c.done),c.lastSelTime=+new Date,c.lastSelOrigin=p,c.lastSelOp=l,s&&s.clearRedo!==!1&&Ad(c.undone)}function ws(t,i){var l=Me(i);l&&l.ranges&&l.equals(t)||i.push(t)}function Ed(t,i,l,s){var c=i["spans_"+t.id],p=0;t.iter(Math.max(t.first,l),Math.min(t.first+t.size,s),function(m){m.markedSpans&&((c||(c=i["spans_"+t.id]={}))[p]=m.markedSpans),++p})}function Rw(t){if(!t)return null;for(var i,l=0;l<t.length;++l)t[l].marker.explicitlyCleared?i||(i=t.slice(0,l)):i&&i.push(t[l]);return i?i.length?i:null:t}function Hw(t,i){var l=i["spans_"+t.id];if(!l)return null;for(var s=[],c=0;c<i.text.length;++c)s.push(Rw(l[c]));return s}function Td(t,i){var l=Hw(t,i),s=Qa(t,i);if(!l)return s;if(!s)return l;for(var c=0;c<l.length;++c){var p=l[c],m=s[c];if(p&&m)e:for(var y=0;y<m.length;++y){for(var b=m[y],k=0;k<p.length;++k)if(p[k].marker==b.marker)continue e;p.push(b)}else m&&(l[c]=m)}return l}function Zr(t,i,l){for(var s=[],c=0;c<t.length;++c){var p=t[c];if(p.ranges){s.push(l?Ut.prototype.deepCopy.call(p):p);continue}var m=p.changes,y=[];s.push({changes:y});for(var b=0;b<m.length;++b){var k=m[b],P=void 0;if(y.push({from:k.from,to:k.to,text:k.text}),i)for(var j in k)(P=j.match(/^spans_(\d+)$/))&&re(i,Number(P[1]))>-1&&(Me(y)[j]=k[j],delete k[j])}}return s}function El(t,i,l,s){if(s){var c=t.anchor;if(l){var p=fe(i,c)<0;p!=fe(l,c)<0?(c=i,i=l):p!=fe(i,l)<0&&(i=l)}return new Oe(c,i)}else return new Oe(l||i,i)}function xs(t,i,l,s,c){c==null&&(c=t.cm&&(t.cm.display.shift||t.extend)),yt(t,new Ut([El(t.sel.primary(),i,l,c)],0),s)}function Fd(t,i,l){for(var s=[],c=t.cm&&(t.cm.display.shift||t.extend),p=0;p<t.sel.ranges.length;p++)s[p]=El(t.sel.ranges[p],i[p],null,c);var m=ln(t.cm,s,t.sel.primIndex);yt(t,m,l)}function Tl(t,i,l,s){var c=t.sel.ranges.slice(0);c[i]=l,yt(t,ln(t.cm,c,t.sel.primIndex),s)}function Ld(t,i,l,s){yt(t,Vn(i,l),s)}function qw(t,i,l){var s={ranges:i.ranges,update:function(c){this.ranges=[];for(var p=0;p<c.length;p++)this.ranges[p]=new Oe(De(t,c[p].anchor),De(t,c[p].head))},origin:l&&l.origin};return Ye(t,"beforeSelectionChange",t,s),t.cm&&Ye(t.cm,"beforeSelectionChange",t.cm,s),s.ranges!=i.ranges?ln(t.cm,s.ranges,s.ranges.length-1):i}function Md(t,i,l){var s=t.history.done,c=Me(s);c&&c.ranges?(s[s.length-1]=i,ks(t,i,l)):yt(t,i,l)}function yt(t,i,l){ks(t,i,l),zw(t,t.sel,t.cm?t.cm.curOp.id:NaN,l)}function ks(t,i,l){(Bt(t,"beforeSelectionChange")||t.cm&&Bt(t.cm,"beforeSelectionChange"))&&(i=qw(t,i,l));var s=l&&l.bias||(fe(i.primary().head,t.sel.primary().head)<0?-1:1);Nd(t,Od(t,i,s,!0)),!(l&&l.scroll===!1)&&t.cm&&t.cm.getOption("readOnly")!="nocursor"&&Qr(t.cm)}function Nd(t,i){i.equals(t.sel)||(t.sel=i,t.cm&&(t.cm.curOp.updateInput=1,t.cm.curOp.selectionChanged=!0,Yt(t.cm)),lt(t,"cursorActivity",t))}function Bd(t){Nd(t,Od(t,t.sel,null,!1))}function Od(t,i,l,s){for(var c,p=0;p<i.ranges.length;p++){var m=i.ranges[p],y=i.ranges.length==t.sel.ranges.length&&t.sel.ranges[p],b=Cs(t,m.anchor,y&&y.anchor,l,s),k=m.head==m.anchor?b:Cs(t,m.head,y&&y.head,l,s);(c||b!=m.anchor||k!=m.head)&&(c||(c=i.ranges.slice(0,p)),c[p]=new Oe(b,k))}return c?ln(t.cm,c,i.primIndex):i}function Xr(t,i,l,s,c){var p=he(t,i.line);if(p.markedSpans)for(var m=0;m<p.markedSpans.length;++m){var y=p.markedSpans[m],b=y.marker,k="selectLeft"in b?!b.selectLeft:b.inclusiveLeft,P="selectRight"in b?!b.selectRight:b.inclusiveRight;if((y.from==null||(k?y.from<=i.ch:y.from<i.ch))&&(y.to==null||(P?y.to>=i.ch:y.to>i.ch))){if(c&&(Ye(b,"beforeCursorEnter"),b.explicitlyCleared))if(p.markedSpans){--m;continue}else break;if(!b.atomic)continue;if(l){var j=b.find(s<0?1:-1),q=void 0;if((s<0?P:k)&&(j=Pd(t,j,-s,j&&j.line==i.line?p:null)),j&&j.line==i.line&&(q=fe(j,l))&&(s<0?q<0:q>0))return Xr(t,j,i,s,c)}var R=b.find(s<0?-1:1);return(s<0?k:P)&&(R=Pd(t,R,s,R.line==i.line?p:null)),R?Xr(t,R,i,s,c):null}}return i}function Cs(t,i,l,s,c){var p=s||1,m=Xr(t,i,l,p,c)||!c&&Xr(t,i,l,p,!0)||Xr(t,i,l,-p,c)||!c&&Xr(t,i,l,-p,!0);return m||(t.cantEdit=!0,K(t.first,0))}function Pd(t,i,l,s){return l<0&&i.ch==0?i.line>t.first?De(t,K(i.line-1)):null:l>0&&i.ch==(s||he(t,i.line)).text.length?i.line<t.first+t.size-1?K(i.line+1,0):null:new K(i.line,i.ch+l)}function Id(t){t.setSelection(K(t.firstLine(),0),K(t.lastLine()),we)}function jd(t,i,l){var s={canceled:!1,from:i.from,to:i.to,text:i.text,origin:i.origin,cancel:function(){return s.canceled=!0}};return l&&(s.update=function(c,p,m,y){c&&(s.from=De(t,c)),p&&(s.to=De(t,p)),m&&(s.text=m),y!==void 0&&(s.origin=y)}),Ye(t,"beforeChange",t,s),t.cm&&Ye(t.cm,"beforeChange",t.cm,s),s.canceled?(t.cm&&(t.cm.curOp.updateInput=2),null):{from:s.from,to:s.to,text:s.text,origin:s.origin}}function ei(t,i,l){if(t.cm){if(!t.cm.curOp)return ut(t.cm,ei)(t,i,l);if(t.cm.state.suppressEdits)return}if(!((Bt(t,"beforeChange")||t.cm&&Bt(t.cm,"beforeChange"))&&(i=jd(t,i,!0),!i))){var s=Tf&&!l&&zb(t,i.from,i.to);if(s)for(var c=s.length-1;c>=0;--c)zd(t,{from:s[c].from,to:s[c].to,text:c?[""]:i.text,origin:i.origin});else zd(t,i)}}function zd(t,i){if(!(i.text.length==1&&i.text[0]==""&&fe(i.from,i.to)==0)){var l=Cl(t,i);Sd(t,i,l,t.cm?t.cm.curOp.id:NaN),Zi(t,i,l,Qa(t,i));var s=[];Kn(t,function(c,p){!p&&re(s,c.history)==-1&&(_d(c.history,i),s.push(c.history)),Zi(c,i,null,Qa(c,i))})}}function Ds(t,i,l){var s=t.cm&&t.cm.state.suppressEdits;if(!(s&&!l)){for(var c=t.history,p,m=t.sel,y=i=="undo"?c.done:c.undone,b=i=="undo"?c.undone:c.done,k=0;k<y.length&&(p=y[k],!(l?p.ranges&&!p.equals(t.sel):!p.ranges));k++);if(k!=y.length){for(c.lastOrigin=c.lastSelOrigin=null;;)if(p=y.pop(),p.ranges){if(ws(p,b),l&&!p.equals(t.sel)){yt(t,p,{clearRedo:!1});return}m=p}else if(s){y.push(p);return}else break;var P=[];ws(m,b),b.push({changes:P,generation:c.generation}),c.generation=p.generation||++c.maxGeneration;for(var j=Bt(t,"beforeChange")||t.cm&&Bt(t.cm,"beforeChange"),q=function(ee){var oe=p.changes[ee];if(oe.origin=i,j&&!jd(t,oe,!1))return y.length=0,{};P.push(Sl(t,oe));var le=ee?Cl(t,oe):Me(y);Zi(t,oe,le,Td(t,oe)),!ee&&t.cm&&t.cm.scrollIntoView({from:oe.from,to:Gn(oe)});var de=[];Kn(t,function(ue,pe){!pe&&re(de,ue.history)==-1&&(_d(ue.history,oe),de.push(ue.history)),Zi(ue,oe,null,Td(ue,oe))})},R=p.changes.length-1;R>=0;--R){var Y=q(R);if(Y)return Y.v}}}}function Rd(t,i){if(i!=0&&(t.first+=i,t.sel=new Ut(ze(t.sel.ranges,function(c){return new Oe(K(c.anchor.line+i,c.anchor.ch),K(c.head.line+i,c.head.ch))}),t.sel.primIndex),t.cm)){Tt(t.cm,t.first,t.first-i,i);for(var l=t.cm.display,s=l.viewFrom;s<l.viewTo;s++)$n(t.cm,s,"gutter")}}function Zi(t,i,l,s){if(t.cm&&!t.cm.curOp)return ut(t.cm,Zi)(t,i,l,s);if(i.to.line<t.first){Rd(t,i.text.length-1-(i.to.line-i.from.line));return}if(!(i.from.line>t.lastLine())){if(i.from.line<t.first){var c=i.text.length-1-(t.first-i.from.line);Rd(t,c),i={from:K(t.first,0),to:K(i.to.line+c,i.to.ch),text:[Me(i.text)],origin:i.origin}}var p=t.lastLine();i.to.line>p&&(i={from:i.from,to:K(p,he(t,p).text.length),text:[i.text[0]],origin:i.origin}),i.removed=En(t,i.from,i.to),l||(l=Cl(t,i)),t.cm?_w(t.cm,i,s):Al(t,i,s),ks(t,l,we),t.cantEdit&&Cs(t,K(t.firstLine(),0))&&(t.cantEdit=!1)}}function _w(t,i,l){var s=t.doc,c=t.display,p=i.from,m=i.to,y=!1,b=p.line;t.options.lineWrapping||(b=S(sn(he(s,p.line))),s.iter(b,m.line+1,function(R){if(R==c.maxLine)return y=!0,!0})),s.sel.contains(i.from,i.to)>-1&&Yt(t),Al(s,i,l,id(t)),t.options.lineWrapping||(s.iter(b,p.line+i.text.length,function(R){var Y=as(R);Y>c.maxLineLength&&(c.maxLine=R,c.maxLineLength=Y,c.maxLineChanged=!0,y=!1)}),y&&(t.curOp.updateMaxLine=!0)),Mb(s,p.line),Yi(t,400);var k=i.text.length-(m.line-p.line)-1;i.full?Tt(t):p.line==m.line&&i.text.length==1&&!kd(t.doc,i)?$n(t,p.line,"text"):Tt(t,p.line,m.line+1,k);var P=Bt(t,"changes"),j=Bt(t,"change");if(j||P){var q={from:p,to:m,text:i.text,removed:i.removed,origin:i.origin};j&&lt(t,"change",t,q),P&&(t.curOp.changeObjs||(t.curOp.changeObjs=[])).push(q)}t.display.selForContextMenu=null}function ti(t,i,l,s,c){var p;s||(s=l),fe(s,l)<0&&(p=[s,l],l=p[0],s=p[1]),typeof i=="string"&&(i=t.splitLines(i)),ei(t,{from:l,to:s,text:i,origin:c})}function Hd(t,i,l,s){l<t.line?t.line+=s:i<t.line&&(t.line=i,t.ch=0)}function qd(t,i,l,s){for(var c=0;c<t.length;++c){var p=t[c],m=!0;if(p.ranges){p.copied||(p=t[c]=p.deepCopy(),p.copied=!0);for(var y=0;y<p.ranges.length;y++)Hd(p.ranges[y].anchor,i,l,s),Hd(p.ranges[y].head,i,l,s);continue}for(var b=0;b<p.changes.length;++b){var k=p.changes[b];if(l<k.from.line)k.from=K(k.from.line+s,k.from.ch),k.to=K(k.to.line+s,k.to.ch);else if(i<=k.to.line){m=!1;break}}m||(t.splice(0,c+1),c=0)}}function _d(t,i){var l=i.from.line,s=i.to.line,c=i.text.length-(s-l)-1;qd(t.done,l,s,c),qd(t.undone,l,s,c)}function Xi(t,i,l,s){var c=i,p=i;return typeof i=="number"?p=he(t,bf(t,i)):c=S(i),c==null?null:(s(p,c)&&t.cm&&$n(t.cm,c,l),p)}function eo(t){this.lines=t,this.parent=null;for(var i=0,l=0;l<t.length;++l)t[l].parent=this,i+=t[l].height;this.height=i}eo.prototype={chunkSize:function(){return this.lines.length},removeInner:function(t,i){for(var l=t,s=t+i;l<s;++l){var c=this.lines[l];this.height-=c.height,Wb(c),lt(c,"delete")}this.lines.splice(t,i)},collapse:function(t){t.push.apply(t,this.lines)},insertInner:function(t,i,l){this.height+=l,this.lines=this.lines.slice(0,t).concat(i).concat(this.lines.slice(t));for(var s=0;s<i.length;++s)i[s].parent=this},iterN:function(t,i,l){for(var s=t+i;t<s;++t)if(l(this.lines[t]))return!0}};function to(t){this.children=t;for(var i=0,l=0,s=0;s<t.length;++s){var c=t[s];i+=c.chunkSize(),l+=c.height,c.parent=this}this.size=i,this.height=l,this.parent=null}to.prototype={chunkSize:function(){return this.size},removeInner:function(t,i){this.size-=i;for(var l=0;l<this.children.length;++l){var s=this.children[l],c=s.chunkSize();if(t<c){var p=Math.min(i,c-t),m=s.height;if(s.removeInner(t,p),this.height-=m-s.height,c==p&&(this.children.splice(l--,1),s.parent=null),(i-=p)==0)break;t=0}else t-=c}if(this.size-i<25&&(this.children.length>1||!(this.children[0]instanceof eo))){var y=[];this.collapse(y),this.children=[new eo(y)],this.children[0].parent=this}},collapse:function(t){for(var i=0;i<this.children.length;++i)this.children[i].collapse(t)},insertInner:function(t,i,l){this.size+=i.length,this.height+=l;for(var s=0;s<this.children.length;++s){var c=this.children[s],p=c.chunkSize();if(t<=p){if(c.insertInner(t,i,l),c.lines&&c.lines.length>50){for(var m=c.lines.length%25+25,y=m;y<c.lines.length;){var b=new eo(c.lines.slice(y,y+=25));c.height-=b.height,this.children.splice(++s,0,b),b.parent=this}c.lines=c.lines.slice(0,m),this.maybeSpill()}break}t-=p}},maybeSpill:function(){if(!(this.children.length<=10)){var t=this;do{var i=t.children.splice(t.children.length-5,5),l=new to(i);if(t.parent){t.size-=l.size,t.height-=l.height;var c=re(t.parent.children,t);t.parent.children.splice(c+1,0,l)}else{var s=new to(t.children);s.parent=t,t.children=[s,l],t=s}l.parent=t.parent}while(t.children.length>10);t.parent.maybeSpill()}},iterN:function(t,i,l){for(var s=0;s<this.children.length;++s){var c=this.children[s],p=c.chunkSize();if(t<p){var m=Math.min(i,p-t);if(c.iterN(t,m,l))return!0;if((i-=m)==0)break;t=0}else t-=p}}};var no=function(t,i,l){if(l)for(var s in l)l.hasOwnProperty(s)&&(this[s]=l[s]);this.doc=t,this.node=i};no.prototype.clear=function(){var t=this.doc.cm,i=this.line.widgets,l=this.line,s=S(l);if(!(s==null||!i)){for(var c=0;c<i.length;++c)i[c]==this&&i.splice(c--,1);i.length||(l.widgets=null);var p=_i(this);$t(l,Math.max(0,l.height-p)),t&&(Ot(t,function(){Wd(t,l,-p),$n(t,s,"widget")}),lt(t,"lineWidgetCleared",t,this,s))}},no.prototype.changed=function(){var t=this,i=this.height,l=this.doc.cm,s=this.line;this.height=null;var c=_i(this)-i;c&&(Wn(this.doc,s)||$t(s,s.height+c),l&&Ot(l,function(){l.curOp.forceUpdate=!0,Wd(l,s,c),lt(l,"lineWidgetChanged",l,t,S(s))}))},en(no);function Wd(t,i,l){Fn(i)<(t.curOp&&t.curOp.scrollTop||t.doc.scrollTop)&&vl(t,l)}function Ww(t,i,l,s){var c=new no(t,l,s),p=t.cm;return p&&c.noHScroll&&(p.display.alignWidgets=!0),Xi(t,i,"widget",function(m){var y=m.widgets||(m.widgets=[]);if(c.insertAt==null?y.push(c):y.splice(Math.min(y.length,Math.max(0,c.insertAt)),0,c),c.line=m,p&&!Wn(t,m)){var b=Fn(m)<t.scrollTop;$t(m,m.height+_i(c)),b&&vl(p,c.height),p.curOp.forceUpdate=!0}return!0}),p&&lt(p,"lineWidgetAdded",p,c,typeof i=="number"?i:S(i)),c}var $d=0,Yn=function(t,i){this.lines=[],this.type=i,this.doc=t,this.id=++$d};Yn.prototype.clear=function(){if(!this.explicitlyCleared){var t=this.doc.cm,i=t&&!t.curOp;if(i&&pr(t),Bt(this,"clear")){var l=this.find();l&&lt(this,"clear",l.from,l.to)}for(var s=null,c=null,p=0;p<this.lines.length;++p){var m=this.lines[p],y=Ri(m.markedSpans,this);t&&!this.collapsed?$n(t,S(m),"text"):t&&(y.to!=null&&(c=S(m)),y.from!=null&&(s=S(m))),m.markedSpans=Ob(m.markedSpans,y),y.from==null&&this.collapsed&&!Wn(this.doc,m)&&t&&$t(m,Gr(t.display))}if(t&&this.collapsed&&!t.options.lineWrapping)for(var b=0;b<this.lines.length;++b){var k=sn(this.lines[b]),P=as(k);P>t.display.maxLineLength&&(t.display.maxLine=k,t.display.maxLineLength=P,t.display.maxLineChanged=!0)}s!=null&&t&&this.collapsed&&Tt(t,s,c+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,t&&Bd(t.doc)),t&&lt(t,"markerCleared",t,this,s,c),i&&hr(t),this.parent&&this.parent.clear()}},Yn.prototype.find=function(t,i){t==null&&this.type=="bookmark"&&(t=1);for(var l,s,c=0;c<this.lines.length;++c){var p=this.lines[c],m=Ri(p.markedSpans,this);if(m.from!=null&&(l=K(i?p:S(p),m.from),t==-1))return l;if(m.to!=null&&(s=K(i?p:S(p),m.to),t==1))return s}return l&&{from:l,to:s}},Yn.prototype.changed=function(){var t=this,i=this.find(-1,!0),l=this,s=this.doc.cm;!i||!s||Ot(s,function(){var c=i.line,p=S(i.line),m=il(s,p);if(m&&(Qf(m),s.curOp.selectionChanged=s.curOp.forceUpdate=!0),s.curOp.updateMaxLine=!0,!Wn(l.doc,c)&&l.height!=null){var y=l.height;l.height=null;var b=_i(l)-y;b&&$t(c,c.height+b)}lt(s,"markerChanged",s,t)})},Yn.prototype.attachLine=function(t){if(!this.lines.length&&this.doc.cm){var i=this.doc.cm.curOp;(!i.maybeHiddenMarkers||re(i.maybeHiddenMarkers,this)==-1)&&(i.maybeUnhiddenMarkers||(i.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(t)},Yn.prototype.detachLine=function(t){if(this.lines.splice(re(this.lines,t),1),!this.lines.length&&this.doc.cm){var i=this.doc.cm.curOp;(i.maybeHiddenMarkers||(i.maybeHiddenMarkers=[])).push(this)}},en(Yn);function ni(t,i,l,s,c){if(s&&s.shared)return $w(t,i,l,s,c);if(t.cm&&!t.cm.curOp)return ut(t.cm,ni)(t,i,l,s,c);var p=new Yn(t,c),m=fe(i,l);if(s&&G(s,p,!1),m>0||m==0&&p.clearWhenEmpty!==!1)return p;if(p.replacedWith&&(p.collapsed=!0,p.widgetNode=Q("span",[p.replacedWith],"CodeMirror-widget"),s.handleMouseEvents||p.widgetNode.setAttribute("cm-ignore-events","true"),s.insertLeft&&(p.widgetNode.insertLeft=!0)),p.collapsed){if(Of(t,i.line,i,l,p)||i.line!=l.line&&Of(t,l.line,i,l,p))throw new Error("Inserting collapsed marker partially overlapping an existing one");Bb()}p.addToHistory&&Sd(t,{from:i,to:l,origin:"markText"},t.sel,NaN);var y=i.line,b=t.cm,k;if(t.iter(y,l.line+1,function(j){b&&p.collapsed&&!b.options.lineWrapping&&sn(j)==b.display.maxLine&&(k=!0),p.collapsed&&y!=i.line&&$t(j,0),Pb(j,new rs(p,y==i.line?i.ch:null,y==l.line?l.ch:null),t.cm&&t.cm.curOp),++y}),p.collapsed&&t.iter(i.line,l.line+1,function(j){Wn(t,j)&&$t(j,0)}),p.clearOnEnter&&me(p,"beforeCursorEnter",function(){return p.clear()}),p.readOnly&&(Nb(),(t.history.done.length||t.history.undone.length)&&t.clearHistory()),p.collapsed&&(p.id=++$d,p.atomic=!0),b){if(k&&(b.curOp.updateMaxLine=!0),p.collapsed)Tt(b,i.line,l.line+1);else if(p.className||p.startStyle||p.endStyle||p.css||p.attributes||p.title)for(var P=i.line;P<=l.line;P++)$n(b,P,"text");p.atomic&&Bd(b.doc),lt(b,"markerAdded",b,p)}return p}var ro=function(t,i){this.markers=t,this.primary=i;for(var l=0;l<t.length;++l)t[l].parent=this};ro.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var t=0;t<this.markers.length;++t)this.markers[t].clear();lt(this,"clear")}},ro.prototype.find=function(t,i){return this.primary.find(t,i)},en(ro);function $w(t,i,l,s,c){s=G(s),s.shared=!1;var p=[ni(t,i,l,s,c)],m=p[0],y=s.widgetNode;return Kn(t,function(b){y&&(s.widgetNode=y.cloneNode(!0)),p.push(ni(b,De(b,i),De(b,l),s,c));for(var k=0;k<b.linked.length;++k)if(b.linked[k].isParent)return;m=Me(p)}),new ro(p,m)}function Ud(t){return t.findMarks(K(t.first,0),t.clipPos(K(t.lastLine())),function(i){return i.parent})}function Uw(t,i){for(var l=0;l<i.length;l++){var s=i[l],c=s.find(),p=t.clipPos(c.from),m=t.clipPos(c.to);if(fe(p,m)){var y=ni(t,p,m,s.primary,s.primary.type);s.markers.push(y),y.parent=s}}}function Vw(t){for(var i=function(s){var c=t[s],p=[c.primary.doc];Kn(c.primary.doc,function(b){return p.push(b)});for(var m=0;m<c.markers.length;m++){var y=c.markers[m];re(p,y.doc)==-1&&(y.parent=null,c.markers.splice(m--,1))}},l=0;l<t.length;l++)i(l)}var Gw=0,Ft=function(t,i,l,s,c){if(!(this instanceof Ft))return new Ft(t,i,l,s,c);l==null&&(l=0),to.call(this,[new eo([new $r("",null)])]),this.first=l,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=l;var p=K(l,0);this.sel=Vn(p),this.history=new bs(null),this.id=++Gw,this.modeOption=i,this.lineSep=s,this.direction=c=="rtl"?"rtl":"ltr",this.extend=!1,typeof t=="string"&&(t=this.splitLines(t)),Al(this,{from:p,to:p,text:t}),yt(this,Vn(p),we)};Ft.prototype=J(to.prototype,{constructor:Ft,iter:function(t,i,l){l?this.iterN(t-this.first,i-t,l):this.iterN(this.first,this.first+this.size,t)},insert:function(t,i){for(var l=0,s=0;s<i.length;++s)l+=i[s].height;this.insertInner(t-this.first,i,l)},remove:function(t,i){this.removeInner(t-this.first,i)},getValue:function(t){var i=ji(this,this.first,this.first+this.size);return t===!1?i:i.join(t||this.lineSeparator())},setValue:ct(function(t){var i=K(this.first,0),l=this.first+this.size-1;ei(this,{from:i,to:K(l,he(this,l).text.length),text:this.splitLines(t),origin:"setValue",full:!0},!0),this.cm&&Ui(this.cm,0,0),yt(this,Vn(i),we)}),replaceRange:function(t,i,l,s){i=De(this,i),l=l?De(this,l):i,ti(this,t,i,l,s)},getRange:function(t,i,l){var s=En(this,De(this,t),De(this,i));return l===!1?s:l===""?s.join(""):s.join(l||this.lineSeparator())},getLine:function(t){var i=this.getLineHandle(t);return i&&i.text},getLineHandle:function(t){if(Z(this,t))return he(this,t)},getLineNumber:function(t){return S(t)},getLineHandleVisualStart:function(t){return typeof t=="number"&&(t=he(this,t)),sn(t)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(t){return De(this,t)},getCursor:function(t){var i=this.sel.primary(),l;return t==null||t=="head"?l=i.head:t=="anchor"?l=i.anchor:t=="end"||t=="to"||t===!1?l=i.to():l=i.from(),l},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:ct(function(t,i,l){Ld(this,De(this,typeof t=="number"?K(t,i||0):t),null,l)}),setSelection:ct(function(t,i,l){Ld(this,De(this,t),De(this,i||t),l)}),extendSelection:ct(function(t,i,l){xs(this,De(this,t),i&&De(this,i),l)}),extendSelections:ct(function(t,i){Fd(this,wf(this,t),i)}),extendSelectionsBy:ct(function(t,i){var l=ze(this.sel.ranges,t);Fd(this,wf(this,l),i)}),setSelections:ct(function(t,i,l){if(t.length){for(var s=[],c=0;c<t.length;c++)s[c]=new Oe(De(this,t[c].anchor),De(this,t[c].head||t[c].anchor));i==null&&(i=Math.min(t.length-1,this.sel.primIndex)),yt(this,ln(this.cm,s,i),l)}}),addSelection:ct(function(t,i,l){var s=this.sel.ranges.slice(0);s.push(new Oe(De(this,t),De(this,i||t))),yt(this,ln(this.cm,s,s.length-1),l)}),getSelection:function(t){for(var i=this.sel.ranges,l,s=0;s<i.length;s++){var c=En(this,i[s].from(),i[s].to());l=l?l.concat(c):c}return t===!1?l:l.join(t||this.lineSeparator())},getSelections:function(t){for(var i=[],l=this.sel.ranges,s=0;s<l.length;s++){var c=En(this,l[s].from(),l[s].to());t!==!1&&(c=c.join(t||this.lineSeparator())),i[s]=c}return i},replaceSelection:function(t,i,l){for(var s=[],c=0;c<this.sel.ranges.length;c++)s[c]=t;this.replaceSelections(s,i,l||"+input")},replaceSelections:ct(function(t,i,l){for(var s=[],c=this.sel,p=0;p<c.ranges.length;p++){var m=c.ranges[p];s[p]={from:m.from(),to:m.to(),text:this.splitLines(t[p]),origin:l}}for(var y=i&&i!="end"&&Ow(this,s,i),b=s.length-1;b>=0;b--)ei(this,s[b]);y?Md(this,y):this.cm&&Qr(this.cm)}),undo:ct(function(){Ds(this,"undo")}),redo:ct(function(){Ds(this,"redo")}),undoSelection:ct(function(){Ds(this,"undo",!0)}),redoSelection:ct(function(){Ds(this,"redo",!0)}),setExtending:function(t){this.extend=t},getExtending:function(){return this.extend},historySize:function(){for(var t=this.history,i=0,l=0,s=0;s<t.done.length;s++)t.done[s].ranges||++i;for(var c=0;c<t.undone.length;c++)t.undone[c].ranges||++l;return{undo:i,redo:l}},clearHistory:function(){var t=this;this.history=new bs(this.history),Kn(this,function(i){return i.history=t.history},!0)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(t){return t&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(t){return this.history.generation==(t||this.cleanGeneration)},getHistory:function(){return{done:Zr(this.history.done),undone:Zr(this.history.undone)}},setHistory:function(t){var i=this.history=new bs(this.history);i.done=Zr(t.done.slice(0),null,!0),i.undone=Zr(t.undone.slice(0),null,!0)},setGutterMarker:ct(function(t,i,l){return Xi(this,t,"gutter",function(s){var c=s.gutterMarkers||(s.gutterMarkers={});return c[i]=l,!l&&Zo(c)&&(s.gutterMarkers=null),!0})}),clearGutter:ct(function(t){var i=this;this.iter(function(l){l.gutterMarkers&&l.gutterMarkers[t]&&Xi(i,l,"gutter",function(){return l.gutterMarkers[t]=null,Zo(l.gutterMarkers)&&(l.gutterMarkers=null),!0})})}),lineInfo:function(t){var i;if(typeof t=="number"){if(!Z(this,t)||(i=t,t=he(this,t),!t))return null}else if(i=S(t),i==null)return null;return{line:i,handle:t,text:t.text,gutterMarkers:t.gutterMarkers,textClass:t.textClass,bgClass:t.bgClass,wrapClass:t.wrapClass,widgets:t.widgets}},addLineClass:ct(function(t,i,l){return Xi(this,t,i=="gutter"?"gutter":"class",function(s){var c=i=="text"?"textClass":i=="background"?"bgClass":i=="gutter"?"gutterClass":"wrapClass";if(!s[c])s[c]=l;else{if(W(l).test(s[c]))return!1;s[c]+=" "+l}return!0})}),removeLineClass:ct(function(t,i,l){return Xi(this,t,i=="gutter"?"gutter":"class",function(s){var c=i=="text"?"textClass":i=="background"?"bgClass":i=="gutter"?"gutterClass":"wrapClass",p=s[c];if(p)if(l==null)s[c]=null;else{var m=p.match(W(l));if(!m)return!1;var y=m.index+m[0].length;s[c]=p.slice(0,m.index)+(!m.index||y==p.length?"":" ")+p.slice(y)||null}else return!1;return!0})}),addLineWidget:ct(function(t,i,l){return Ww(this,t,i,l)}),removeLineWidget:function(t){t.clear()},markText:function(t,i,l){return ni(this,De(this,t),De(this,i),l,l&&l.type||"range")},setBookmark:function(t,i){var l={replacedWith:i&&(i.nodeType==null?i.widget:i),insertLeft:i&&i.insertLeft,clearWhenEmpty:!1,shared:i&&i.shared,handleMouseEvents:i&&i.handleMouseEvents};return t=De(this,t),ni(this,t,t,l,"bookmark")},findMarksAt:function(t){t=De(this,t);var i=[],l=he(this,t.line).markedSpans;if(l)for(var s=0;s<l.length;++s){var c=l[s];(c.from==null||c.from<=t.ch)&&(c.to==null||c.to>=t.ch)&&i.push(c.marker.parent||c.marker)}return i},findMarks:function(t,i,l){t=De(this,t),i=De(this,i);var s=[],c=t.line;return this.iter(t.line,i.line+1,function(p){var m=p.markedSpans;if(m)for(var y=0;y<m.length;y++){var b=m[y];!(b.to!=null&&c==t.line&&t.ch>=b.to||b.from==null&&c!=t.line||b.from!=null&&c==i.line&&b.from>=i.ch)&&(!l||l(b.marker))&&s.push(b.marker.parent||b.marker)}++c}),s},getAllMarks:function(){var t=[];return this.iter(function(i){var l=i.markedSpans;if(l)for(var s=0;s<l.length;++s)l[s].from!=null&&t.push(l[s].marker)}),t},posFromIndex:function(t){var i,l=this.first,s=this.lineSeparator().length;return this.iter(function(c){var p=c.text.length+s;if(p>t)return i=t,!0;t-=p,++l}),De(this,K(l,i))},indexFromPos:function(t){t=De(this,t);var i=t.ch;if(t.line<this.first||t.ch<0)return 0;var l=this.lineSeparator().length;return this.iter(this.first,t.line,function(s){i+=s.text.length+l}),i},copy:function(t){var i=new Ft(ji(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return i.scrollTop=this.scrollTop,i.scrollLeft=this.scrollLeft,i.sel=this.sel,i.extend=!1,t&&(i.history.undoDepth=this.history.undoDepth,i.setHistory(this.getHistory())),i},linkedDoc:function(t){t||(t={});var i=this.first,l=this.first+this.size;t.from!=null&&t.from>i&&(i=t.from),t.to!=null&&t.to<l&&(l=t.to);var s=new Ft(ji(this,i,l),t.mode||this.modeOption,i,this.lineSep,this.direction);return t.sharedHist&&(s.history=this.history),(this.linked||(this.linked=[])).push({doc:s,sharedHist:t.sharedHist}),s.linked=[{doc:this,isParent:!0,sharedHist:t.sharedHist}],Uw(s,Ud(this)),s},unlinkDoc:function(t){if(t instanceof Ve&&(t=t.doc),this.linked)for(var i=0;i<this.linked.length;++i){var l=this.linked[i];if(l.doc==t){this.linked.splice(i,1),t.unlinkDoc(this),Vw(Ud(this));break}}if(t.history==this.history){var s=[t.id];Kn(t,function(c){return s.push(c.id)},!0),t.history=new bs(null),t.history.done=Zr(this.history.done,s),t.history.undone=Zr(this.history.undone,s)}},iterLinkedDocs:function(t){Kn(this,t)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(t){return this.lineSep?t.split(this.lineSep):Qt(t)},lineSeparator:function(){return this.lineSep||`
`},setDirection:ct(function(t){t!="rtl"&&(t="ltr"),t!=this.direction&&(this.direction=t,this.iter(function(i){return i.order=null}),this.cm&&Pw(this.cm))})}),Ft.prototype.eachLine=Ft.prototype.iter;var Vd=0;function Kw(t){var i=this;if(Gd(i),!(Qe(i,t)||Ln(i.display,t))){vt(t),f&&(Vd=+new Date);var l=ur(i,t,!0),s=t.dataTransfer.files;if(!(!l||i.isReadOnly()))if(s&&s.length&&window.FileReader&&window.File)for(var c=s.length,p=Array(c),m=0,y=function(){++m==c&&ut(i,function(){l=De(i.doc,l);var R={from:l,to:l,text:i.doc.splitLines(p.filter(function(Y){return Y!=null}).join(i.doc.lineSeparator())),origin:"paste"};ei(i.doc,R),Md(i.doc,Vn(De(i.doc,l),De(i.doc,Gn(R))))})()},b=function(R,Y){if(i.options.allowDropFileTypes&&re(i.options.allowDropFileTypes,R.type)==-1){y();return}var ee=new FileReader;ee.onerror=function(){return y()},ee.onload=function(){var oe=ee.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(oe)){y();return}p[Y]=oe,y()},ee.readAsText(R)},k=0;k<s.length;k++)b(s[k],k);else{if(i.state.draggingText&&i.doc.sel.contains(l)>-1){i.state.draggingText(t),setTimeout(function(){return i.display.input.focus()},20);return}try{var P=t.dataTransfer.getData("Text");if(P){var j;if(i.state.draggingText&&!i.state.draggingText.copy&&(j=i.listSelections()),ks(i.doc,Vn(l,l)),j)for(var q=0;q<j.length;++q)ti(i.doc,"",j[q].anchor,j[q].head,"drag");i.replaceSelection(P,"around","paste"),i.display.input.focus()}}catch{}}}}function Yw(t,i){if(f&&(!t.state.draggingText||+new Date-Vd<100)){Rn(i);return}if(!(Qe(t,i)||Ln(t.display,i))&&(i.dataTransfer.setData("Text",t.getSelection()),i.dataTransfer.effectAllowed="copyMove",i.dataTransfer.setDragImage&&!T)){var l=A("img",null,null,"position: fixed; left: 0; top: 0;");l.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",x&&(l.width=l.height=1,t.display.wrapper.appendChild(l),l._top=l.offsetTop),i.dataTransfer.setDragImage(l,0,0),x&&l.parentNode.removeChild(l)}}function Qw(t,i){var l=ur(t,i);if(l){var s=document.createDocumentFragment();dl(t,l,s),t.display.dragCursor||(t.display.dragCursor=A("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),t.display.lineSpace.insertBefore(t.display.dragCursor,t.display.cursorDiv)),X(t.display.dragCursor,s)}}function Gd(t){t.display.dragCursor&&(t.display.lineSpace.removeChild(t.display.dragCursor),t.display.dragCursor=null)}function Kd(t){if(document.getElementsByClassName){for(var i=document.getElementsByClassName("CodeMirror"),l=[],s=0;s<i.length;s++){var c=i[s].CodeMirror;c&&l.push(c)}l.length&&l[0].operation(function(){for(var p=0;p<l.length;p++)t(l[p])})}}var Yd=!1;function Jw(){Yd||(Zw(),Yd=!0)}function Zw(){var t;me(window,"resize",function(){t==null&&(t=setTimeout(function(){t=null,Kd(Xw)},100))}),me(window,"blur",function(){return Kd(Yr)})}function Xw(t){var i=t.display;i.cachedCharWidth=i.cachedTextHeight=i.cachedPaddingH=null,i.scrollbarsClipped=!1,t.setSize()}for(var Qn={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Mod",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},io=0;io<10;io++)Qn[io+48]=Qn[io+96]=String(io);for(var As=65;As<=90;As++)Qn[As]=String.fromCharCode(As);for(var oo=1;oo<=12;oo++)Qn[oo+111]=Qn[oo+63235]="F"+oo;var Nn={};Nn.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Nn.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Nn.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},Nn.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Nn.default=L?Nn.macDefault:Nn.pcDefault;function e0(t){var i=t.split(/-(?!$)/);t=i[i.length-1];for(var l,s,c,p,m=0;m<i.length-1;m++){var y=i[m];if(/^(cmd|meta|m)$/i.test(y))p=!0;else if(/^a(lt)?$/i.test(y))l=!0;else if(/^(c|ctrl|control)$/i.test(y))s=!0;else if(/^s(hift)?$/i.test(y))c=!0;else throw new Error("Unrecognized modifier name: "+y)}return l&&(t="Alt-"+t),s&&(t="Ctrl-"+t),p&&(t="Cmd-"+t),c&&(t="Shift-"+t),t}function t0(t){var i={};for(var l in t)if(t.hasOwnProperty(l)){var s=t[l];if(/^(name|fallthrough|(de|at)tach)$/.test(l))continue;if(s=="..."){delete t[l];continue}for(var c=ze(l.split(" "),e0),p=0;p<c.length;p++){var m=void 0,y=void 0;p==c.length-1?(y=c.join(" "),m=s):(y=c.slice(0,p+1).join(" "),m="...");var b=i[y];if(!b)i[y]=m;else if(b!=m)throw new Error("Inconsistent bindings for "+y)}delete t[l]}for(var k in i)t[k]=i[k];return t}function ri(t,i,l,s){i=Ss(i);var c=i.call?i.call(t,s):i[t];if(c===!1)return"nothing";if(c==="...")return"multi";if(c!=null&&l(c))return"handled";if(i.fallthrough){if(Object.prototype.toString.call(i.fallthrough)!="[object Array]")return ri(t,i.fallthrough,l,s);for(var p=0;p<i.fallthrough.length;p++){var m=ri(t,i.fallthrough[p],l,s);if(m)return m}}}function Qd(t){var i=typeof t=="string"?t:Qn[t.keyCode];return i=="Ctrl"||i=="Alt"||i=="Shift"||i=="Mod"}function Jd(t,i,l){var s=t;return i.altKey&&s!="Alt"&&(t="Alt-"+t),(z?i.metaKey:i.ctrlKey)&&s!="Ctrl"&&(t="Ctrl-"+t),(z?i.ctrlKey:i.metaKey)&&s!="Mod"&&(t="Cmd-"+t),!l&&i.shiftKey&&s!="Shift"&&(t="Shift-"+t),t}function Zd(t,i){if(x&&t.keyCode==34&&t.char)return!1;var l=Qn[t.keyCode];return l==null||t.altGraphKey?!1:(t.keyCode==3&&t.code&&(l=t.code),Jd(l,t,i))}function Ss(t){return typeof t=="string"?Nn[t]:t}function ii(t,i){for(var l=t.doc.sel.ranges,s=[],c=0;c<l.length;c++){for(var p=i(l[c]);s.length&&fe(p.from,Me(s).to)<=0;){var m=s.pop();if(fe(m.from,p.from)<0){p.from=m.from;break}}s.push(p)}Ot(t,function(){for(var y=s.length-1;y>=0;y--)ti(t.doc,"",s[y].from,s[y].to,"+delete");Qr(t)})}function Fl(t,i,l){var s=In(t.text,i+l,l);return s<0||s>t.text.length?null:s}function Ll(t,i,l){var s=Fl(t,i.ch,l);return s==null?null:new K(i.line,s,l<0?"after":"before")}function Ml(t,i,l,s,c){if(t){i.doc.direction=="rtl"&&(c=-c);var p=Fe(l,i.doc.direction);if(p){var m=c<0?Me(p):p[0],y=c<0==(m.level==1),b=y?"after":"before",k;if(m.level>0||i.doc.direction=="rtl"){var P=Vr(i,l);k=c<0?l.text.length-1:0;var j=wn(i,P,k).top;k=mn(function(q){return wn(i,P,q).top==j},c<0==(m.level==1)?m.from:m.to-1,k),b=="before"&&(k=Fl(l,k,1))}else k=c<0?m.to:m.from;return new K(s,k,b)}}return new K(s,c<0?l.text.length:0,c<0?"before":"after")}function n0(t,i,l,s){var c=Fe(i,t.doc.direction);if(!c)return Ll(i,l,s);l.ch>=i.text.length?(l.ch=i.text.length,l.sticky="before"):l.ch<=0&&(l.ch=0,l.sticky="after");var p=zn(c,l.ch,l.sticky),m=c[p];if(t.doc.direction=="ltr"&&m.level%2==0&&(s>0?m.to>l.ch:m.from<l.ch))return Ll(i,l,s);var y=function(le,de){return Fl(i,le instanceof K?le.ch:le,de)},b,k=function(le){return t.options.lineWrapping?(b=b||Vr(t,i),rd(t,i,b,le)):{begin:0,end:i.text.length}},P=k(l.sticky=="before"?y(l,-1):l.ch);if(t.doc.direction=="rtl"||m.level==1){var j=m.level==1==s<0,q=y(l,j?1:-1);if(q!=null&&(j?q<=m.to&&q<=P.end:q>=m.from&&q>=P.begin)){var R=j?"before":"after";return new K(l.line,q,R)}}var Y=function(le,de,ue){for(var pe=function(Re,ft){return ft?new K(l.line,y(Re,1),"before"):new K(l.line,Re,"after")};le>=0&&le<c.length;le+=de){var ve=c[le],ge=de>0==(ve.level!=1),Se=ge?ue.begin:y(ue.end,-1);if(ve.from<=Se&&Se<ve.to||(Se=ge?ve.from:y(ve.to,-1),ue.begin<=Se&&Se<ue.end))return pe(Se,ge)}},ee=Y(p+s,s,P);if(ee)return ee;var oe=s>0?P.end:y(P.begin,-1);return oe!=null&&!(s>0&&oe==i.text.length)&&(ee=Y(s>0?0:c.length-1,s,k(oe)),ee)?ee:null}var so={selectAll:Id,singleSelection:function(t){return t.setSelection(t.getCursor("anchor"),t.getCursor("head"),we)},killLine:function(t){return ii(t,function(i){if(i.empty()){var l=he(t.doc,i.head.line).text.length;return i.head.ch==l&&i.head.line<t.lastLine()?{from:i.head,to:K(i.head.line+1,0)}:{from:i.head,to:K(i.head.line,l)}}else return{from:i.from(),to:i.to()}})},deleteLine:function(t){return ii(t,function(i){return{from:K(i.from().line,0),to:De(t.doc,K(i.to().line+1,0))}})},delLineLeft:function(t){return ii(t,function(i){return{from:K(i.from().line,0),to:i.from()}})},delWrappedLineLeft:function(t){return ii(t,function(i){var l=t.charCoords(i.head,"div").top+5,s=t.coordsChar({left:0,top:l},"div");return{from:s,to:i.from()}})},delWrappedLineRight:function(t){return ii(t,function(i){var l=t.charCoords(i.head,"div").top+5,s=t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:l},"div");return{from:i.from(),to:s}})},undo:function(t){return t.undo()},redo:function(t){return t.redo()},undoSelection:function(t){return t.undoSelection()},redoSelection:function(t){return t.redoSelection()},goDocStart:function(t){return t.extendSelection(K(t.firstLine(),0))},goDocEnd:function(t){return t.extendSelection(K(t.lastLine()))},goLineStart:function(t){return t.extendSelectionsBy(function(i){return Xd(t,i.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(t){return t.extendSelectionsBy(function(i){return ep(t,i.head)},{origin:"+move",bias:1})},goLineEnd:function(t){return t.extendSelectionsBy(function(i){return r0(t,i.head.line)},{origin:"+move",bias:-1})},goLineRight:function(t){return t.extendSelectionsBy(function(i){var l=t.cursorCoords(i.head,"div").top+5;return t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:l},"div")},Te)},goLineLeft:function(t){return t.extendSelectionsBy(function(i){var l=t.cursorCoords(i.head,"div").top+5;return t.coordsChar({left:0,top:l},"div")},Te)},goLineLeftSmart:function(t){return t.extendSelectionsBy(function(i){var l=t.cursorCoords(i.head,"div").top+5,s=t.coordsChar({left:0,top:l},"div");return s.ch<t.getLine(s.line).search(/\S/)?ep(t,i.head):s},Te)},goLineUp:function(t){return t.moveV(-1,"line")},goLineDown:function(t){return t.moveV(1,"line")},goPageUp:function(t){return t.moveV(-1,"page")},goPageDown:function(t){return t.moveV(1,"page")},goCharLeft:function(t){return t.moveH(-1,"char")},goCharRight:function(t){return t.moveH(1,"char")},goColumnLeft:function(t){return t.moveH(-1,"column")},goColumnRight:function(t){return t.moveH(1,"column")},goWordLeft:function(t){return t.moveH(-1,"word")},goGroupRight:function(t){return t.moveH(1,"group")},goGroupLeft:function(t){return t.moveH(-1,"group")},goWordRight:function(t){return t.moveH(1,"word")},delCharBefore:function(t){return t.deleteH(-1,"codepoint")},delCharAfter:function(t){return t.deleteH(1,"char")},delWordBefore:function(t){return t.deleteH(-1,"word")},delWordAfter:function(t){return t.deleteH(1,"word")},delGroupBefore:function(t){return t.deleteH(-1,"group")},delGroupAfter:function(t){return t.deleteH(1,"group")},indentAuto:function(t){return t.indentSelection("smart")},indentMore:function(t){return t.indentSelection("add")},indentLess:function(t){return t.indentSelection("subtract")},insertTab:function(t){return t.replaceSelection("	")},insertSoftTab:function(t){for(var i=[],l=t.listSelections(),s=t.options.tabSize,c=0;c<l.length;c++){var p=l[c].from(),m=ae(t.getLine(p.line),p.ch,s);i.push(it(s-m%s))}t.replaceSelections(i)},defaultTab:function(t){t.somethingSelected()?t.indentSelection("add"):t.execCommand("insertTab")},transposeChars:function(t){return Ot(t,function(){for(var i=t.listSelections(),l=[],s=0;s<i.length;s++)if(i[s].empty()){var c=i[s].head,p=he(t.doc,c.line).text;if(p){if(c.ch==p.length&&(c=new K(c.line,c.ch-1)),c.ch>0)c=new K(c.line,c.ch+1),t.replaceRange(p.charAt(c.ch-1)+p.charAt(c.ch-2),K(c.line,c.ch-2),c,"+transpose");else if(c.line>t.doc.first){var m=he(t.doc,c.line-1).text;m&&(c=new K(c.line,1),t.replaceRange(p.charAt(0)+t.doc.lineSeparator()+m.charAt(m.length-1),K(c.line-1,m.length-1),c,"+transpose"))}}l.push(new Oe(c,c))}t.setSelections(l)})},newlineAndIndent:function(t){return Ot(t,function(){for(var i=t.listSelections(),l=i.length-1;l>=0;l--)t.replaceRange(t.doc.lineSeparator(),i[l].anchor,i[l].head,"+input");i=t.listSelections();for(var s=0;s<i.length;s++)t.indentLine(i[s].from().line,null,!0);Qr(t)})},openLine:function(t){return t.replaceSelection(`
`,"start")},toggleOverwrite:function(t){return t.toggleOverwrite()}};function Xd(t,i){var l=he(t.doc,i),s=sn(l);return s!=l&&(i=S(s)),Ml(!0,t,s,i,1)}function r0(t,i){var l=he(t.doc,i),s=Hb(l);return s!=l&&(i=S(s)),Ml(!0,t,l,i,-1)}function ep(t,i){var l=Xd(t,i.line),s=he(t.doc,l.line),c=Fe(s,t.doc.direction);if(!c||c[0].level==0){var p=Math.max(l.ch,s.text.search(/\S/)),m=i.line==l.line&&i.ch<=p&&i.ch;return K(l.line,m?0:p,l.sticky)}return l}function Es(t,i,l){if(typeof i=="string"&&(i=so[i],!i))return!1;t.display.input.ensurePolled();var s=t.display.shift,c=!1;try{t.isReadOnly()&&(t.state.suppressEdits=!0),l&&(t.display.shift=!1),c=i(t)!=Ae}finally{t.display.shift=s,t.state.suppressEdits=!1}return c}function i0(t,i,l){for(var s=0;s<t.state.keyMaps.length;s++){var c=ri(i,t.state.keyMaps[s],l,t);if(c)return c}return t.options.extraKeys&&ri(i,t.options.extraKeys,l,t)||ri(i,t.options.keyMap,l,t)}var o0=new ne;function ao(t,i,l,s){var c=t.state.keySeq;if(c){if(Qd(i))return"handled";if(/\'$/.test(i)?t.state.keySeq=null:o0.set(50,function(){t.state.keySeq==c&&(t.state.keySeq=null,t.display.input.reset())}),tp(t,c+" "+i,l,s))return!0}return tp(t,i,l,s)}function tp(t,i,l,s){var c=i0(t,i,s);return c=="multi"&&(t.state.keySeq=i),c=="handled"&&lt(t,"keyHandled",t,i,l),(c=="handled"||c=="multi")&&(vt(l),pl(t)),!!c}function np(t,i){var l=Zd(i,!0);return l?i.shiftKey&&!t.state.keySeq?ao(t,"Shift-"+l,i,function(s){return Es(t,s,!0)})||ao(t,l,i,function(s){if(typeof s=="string"?/^go[A-Z]/.test(s):s.motion)return Es(t,s)}):ao(t,l,i,function(s){return Es(t,s)}):!1}function s0(t,i,l){return ao(t,"'"+l+"'",i,function(s){return Es(t,s,!0)})}var Nl=null;function rp(t){var i=this;if(!(t.target&&t.target!=i.display.input.getField())&&(i.curOp.focus=xe(ht(i)),!Qe(i,t))){f&&d<11&&t.keyCode==27&&(t.returnValue=!1);var l=t.keyCode;i.display.shift=l==16||t.shiftKey;var s=np(i,t);x&&(Nl=s?l:null,!s&&l==88&&!ts&&(L?t.metaKey:t.ctrlKey)&&i.replaceSelection("",null,"cut")),r&&!L&&!s&&l==46&&t.shiftKey&&!t.ctrlKey&&document.execCommand&&document.execCommand("cut"),l==18&&!/\bCodeMirror-crosshair\b/.test(i.display.lineDiv.className)&&a0(i)}}function a0(t){var i=t.display.lineDiv;Le(i,"CodeMirror-crosshair");function l(s){(s.keyCode==18||!s.altKey)&&(te(i,"CodeMirror-crosshair"),mt(document,"keyup",l),mt(document,"mouseover",l))}me(document,"keyup",l),me(document,"mouseover",l)}function ip(t){t.keyCode==16&&(this.doc.sel.shift=!1),Qe(this,t)}function op(t){var i=this;if(!(t.target&&t.target!=i.display.input.getField())&&!(Ln(i.display,t)||Qe(i,t)||t.ctrlKey&&!t.altKey||L&&t.metaKey)){var l=t.keyCode,s=t.charCode;if(x&&l==Nl){Nl=null,vt(t);return}if(!(x&&(!t.which||t.which<10)&&np(i,t))){var c=String.fromCharCode(s??l);c!="\b"&&(s0(i,t,c)||i.display.input.onKeyPress(t))}}}var l0=400,Bl=function(t,i,l){this.time=t,this.pos=i,this.button=l};Bl.prototype.compare=function(t,i,l){return this.time+l0>t&&fe(i,this.pos)==0&&l==this.button};var lo,uo;function u0(t,i){var l=+new Date;return uo&&uo.compare(l,t,i)?(lo=uo=null,"triple"):lo&&lo.compare(l,t,i)?(uo=new Bl(l,t,i),lo=null,"double"):(lo=new Bl(l,t,i),uo=null,"single")}function sp(t){var i=this,l=i.display;if(!(Qe(i,t)||l.activeTouch&&l.input.supportsTouch())){if(l.input.ensurePolled(),l.shift=t.shiftKey,Ln(l,t)){h||(l.scroller.draggable=!1,setTimeout(function(){return l.scroller.draggable=!0},100));return}if(!Ol(i,t)){var s=ur(i,t),c=tn(t),p=s?u0(s,c):"single";ke(i).focus(),c==1&&i.state.selectingText&&i.state.selectingText(t),!(s&&c0(i,c,s,p,t))&&(c==1?s?d0(i,s,p,t):Oi(t)==l.scroller&&vt(t):c==2?(s&&xs(i.doc,s),setTimeout(function(){return l.input.focus()},20)):c==3&&(_?i.display.input.onContextMenu(t):hl(i)))}}}function c0(t,i,l,s,c){var p="Click";return s=="double"?p="Double"+p:s=="triple"&&(p="Triple"+p),p=(i==1?"Left":i==2?"Middle":"Right")+p,ao(t,Jd(p,c),c,function(m){if(typeof m=="string"&&(m=so[m]),!m)return!1;var y=!1;try{t.isReadOnly()&&(t.state.suppressEdits=!0),y=m(t,l)!=Ae}finally{t.state.suppressEdits=!1}return y})}function f0(t,i,l){var s=t.getOption("configureMouse"),c=s?s(t,i,l):{};if(c.unit==null){var p=N?l.shiftKey&&l.metaKey:l.altKey;c.unit=p?"rectangle":i=="single"?"char":i=="double"?"word":"line"}return(c.extend==null||t.doc.extend)&&(c.extend=t.doc.extend||l.shiftKey),c.addNew==null&&(c.addNew=L?l.metaKey:l.ctrlKey),c.moveOnDrag==null&&(c.moveOnDrag=!(L?l.altKey:l.ctrlKey)),c}function d0(t,i,l,s){f?setTimeout(be(ad,t),0):t.curOp.focus=xe(ht(t));var c=f0(t,l,s),p=t.doc.sel,m;t.options.dragDrop&&Va&&!t.isReadOnly()&&l=="single"&&(m=p.contains(i))>-1&&(fe((m=p.ranges[m]).from(),i)<0||i.xRel>0)&&(fe(m.to(),i)>0||i.xRel<0)?p0(t,s,i,c):h0(t,s,i,c)}function p0(t,i,l,s){var c=t.display,p=!1,m=ut(t,function(k){h&&(c.scroller.draggable=!1),t.state.draggingText=!1,t.state.delayingBlurEvent&&(t.hasFocus()?t.state.delayingBlurEvent=!1:hl(t)),mt(c.wrapper.ownerDocument,"mouseup",m),mt(c.wrapper.ownerDocument,"mousemove",y),mt(c.scroller,"dragstart",b),mt(c.scroller,"drop",m),p||(vt(k),s.addNew||xs(t.doc,l,null,null,s.extend),h&&!T||f&&d==9?setTimeout(function(){c.wrapper.ownerDocument.body.focus({preventScroll:!0}),c.input.focus()},20):c.input.focus())}),y=function(k){p=p||Math.abs(i.clientX-k.clientX)+Math.abs(i.clientY-k.clientY)>=10},b=function(){return p=!0};h&&(c.scroller.draggable=!0),t.state.draggingText=m,m.copy=!s.moveOnDrag,me(c.wrapper.ownerDocument,"mouseup",m),me(c.wrapper.ownerDocument,"mousemove",y),me(c.scroller,"dragstart",b),me(c.scroller,"drop",m),t.state.delayingBlurEvent=!0,setTimeout(function(){return c.input.focus()},20),c.scroller.dragDrop&&c.scroller.dragDrop()}function ap(t,i,l){if(l=="char")return new Oe(i,i);if(l=="word")return t.findWordAt(i);if(l=="line")return new Oe(K(i.line,0),De(t.doc,K(i.line+1,0)));var s=l(t,i);return new Oe(s.from,s.to)}function h0(t,i,l,s){f&&hl(t);var c=t.display,p=t.doc;vt(i);var m,y,b=p.sel,k=b.ranges;if(s.addNew&&!s.extend?(y=p.sel.contains(l),y>-1?m=k[y]:m=new Oe(l,l)):(m=p.sel.primary(),y=p.sel.primIndex),s.unit=="rectangle")s.addNew||(m=new Oe(l,l)),l=ur(t,i,!0,!0),y=-1;else{var P=ap(t,l,s.unit);s.extend?m=El(m,P.anchor,P.head,s.extend):m=P}s.addNew?y==-1?(y=k.length,yt(p,ln(t,k.concat([m]),y),{scroll:!1,origin:"*mouse"})):k.length>1&&k[y].empty()&&s.unit=="char"&&!s.extend?(yt(p,ln(t,k.slice(0,y).concat(k.slice(y+1)),0),{scroll:!1,origin:"*mouse"}),b=p.sel):Tl(p,y,m,We):(y=0,yt(p,new Ut([m],0),We),b=p.sel);var j=l;function q(ue){if(fe(j,ue)!=0)if(j=ue,s.unit=="rectangle"){for(var pe=[],ve=t.options.tabSize,ge=ae(he(p,l.line).text,l.ch,ve),Se=ae(he(p,ue.line).text,ue.ch,ve),Re=Math.min(ge,Se),ft=Math.max(ge,Se),Ge=Math.min(l.line,ue.line),Pt=Math.min(t.lastLine(),Math.max(l.line,ue.line));Ge<=Pt;Ge++){var Lt=he(p,Ge).text,nt=$e(Lt,Re,ve);Re==ft?pe.push(new Oe(K(Ge,nt),K(Ge,nt))):Lt.length>nt&&pe.push(new Oe(K(Ge,nt),K(Ge,$e(Lt,ft,ve))))}pe.length||pe.push(new Oe(l,l)),yt(p,ln(t,b.ranges.slice(0,y).concat(pe),y),{origin:"*mouse",scroll:!1}),t.scrollIntoView(ue)}else{var Mt=m,pt=ap(t,ue,s.unit),ot=Mt.anchor,rt;fe(pt.anchor,ot)>0?(rt=pt.head,ot=Wr(Mt.from(),pt.anchor)):(rt=pt.anchor,ot=Et(Mt.to(),pt.head));var Ze=b.ranges.slice(0);Ze[y]=g0(t,new Oe(De(p,ot),rt)),yt(p,ln(t,Ze,y),We)}}var R=c.wrapper.getBoundingClientRect(),Y=0;function ee(ue){var pe=++Y,ve=ur(t,ue,!0,s.unit=="rectangle");if(ve)if(fe(ve,j)!=0){t.curOp.focus=xe(ht(t)),q(ve);var ge=gs(c,p);(ve.line>=ge.to||ve.line<ge.from)&&setTimeout(ut(t,function(){Y==pe&&ee(ue)}),150)}else{var Se=ue.clientY<R.top?-20:ue.clientY>R.bottom?20:0;Se&&setTimeout(ut(t,function(){Y==pe&&(c.scroller.scrollTop+=Se,ee(ue))}),50)}}function oe(ue){t.state.selectingText=!1,Y=1/0,ue&&(vt(ue),c.input.focus()),mt(c.wrapper.ownerDocument,"mousemove",le),mt(c.wrapper.ownerDocument,"mouseup",de),p.history.lastSelOrigin=null}var le=ut(t,function(ue){ue.buttons===0||!tn(ue)?oe(ue):ee(ue)}),de=ut(t,oe);t.state.selectingText=de,me(c.wrapper.ownerDocument,"mousemove",le),me(c.wrapper.ownerDocument,"mouseup",de)}function g0(t,i){var l=i.anchor,s=i.head,c=he(t.doc,l.line);if(fe(l,s)==0&&l.sticky==s.sticky)return i;var p=Fe(c);if(!p)return i;var m=zn(p,l.ch,l.sticky),y=p[m];if(y.from!=l.ch&&y.to!=l.ch)return i;var b=m+(y.from==l.ch==(y.level!=1)?0:1);if(b==0||b==p.length)return i;var k;if(s.line!=l.line)k=(s.line-l.line)*(t.doc.direction=="ltr"?1:-1)>0;else{var P=zn(p,s.ch,s.sticky),j=P-m||(s.ch-l.ch)*(y.level==1?-1:1);P==b-1||P==b?k=j<0:k=j>0}var q=p[b+(k?-1:0)],R=k==(q.level==1),Y=R?q.from:q.to,ee=R?"after":"before";return l.ch==Y&&l.sticky==ee?i:new Oe(new K(l.line,Y,ee),s)}function lp(t,i,l,s){var c,p;if(i.touches)c=i.touches[0].clientX,p=i.touches[0].clientY;else try{c=i.clientX,p=i.clientY}catch{return!1}if(c>=Math.floor(t.display.gutters.getBoundingClientRect().right))return!1;s&&vt(i);var m=t.display,y=m.lineDiv.getBoundingClientRect();if(p>y.bottom||!Bt(t,l))return St(i);p-=y.top-m.viewOffset;for(var b=0;b<t.display.gutterSpecs.length;++b){var k=m.gutters.childNodes[b];if(k&&k.getBoundingClientRect().right>=c){var P=I(t.doc,p),j=t.display.gutterSpecs[b];return Ye(t,l,t,P,j.className,i),St(i)}}}function Ol(t,i){return lp(t,i,"gutterClick",!0)}function up(t,i){Ln(t.display,i)||m0(t,i)||Qe(t,i,"contextmenu")||_||t.display.input.onContextMenu(i)}function m0(t,i){return Bt(t,"gutterContextMenu")?lp(t,i,"gutterContextMenu",!1):!1}function cp(t){t.display.wrapper.className=t.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+t.options.theme.replace(/(^|\s)\s*/g," cm-s-"),Wi(t)}var oi={toString:function(){return"CodeMirror.Init"}},fp={},Ts={};function v0(t){var i=t.optionHandlers;function l(s,c,p,m){t.defaults[s]=c,p&&(i[s]=m?function(y,b,k){k!=oi&&p(y,b,k)}:p)}t.defineOption=l,t.Init=oi,l("value","",function(s,c){return s.setValue(c)},!0),l("mode",null,function(s,c){s.doc.modeOption=c,Dl(s)},!0),l("indentUnit",2,Dl,!0),l("indentWithTabs",!1),l("smartIndent",!0),l("tabSize",4,function(s){Ji(s),Wi(s),Tt(s)},!0),l("lineSeparator",null,function(s,c){if(s.doc.lineSep=c,!!c){var p=[],m=s.doc.first;s.doc.iter(function(b){for(var k=0;;){var P=b.text.indexOf(c,k);if(P==-1)break;k=P+c.length,p.push(K(m,P))}m++});for(var y=p.length-1;y>=0;y--)ti(s.doc,c,p[y],K(p[y].line,p[y].ch+c.length))}}),l("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\u202d\u202e\u2066\u2067\u2069\ufeff\ufff9-\ufffc]/g,function(s,c,p){s.state.specialChars=new RegExp(c.source+(c.test("	")?"":"|	"),"g"),p!=oi&&s.refresh()}),l("specialCharPlaceholder",Vb,function(s){return s.refresh()},!0),l("electricChars",!0),l("inputStyle",C?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),l("spellcheck",!1,function(s,c){return s.getInputField().spellcheck=c},!0),l("autocorrect",!1,function(s,c){return s.getInputField().autocorrect=c},!0),l("autocapitalize",!1,function(s,c){return s.getInputField().autocapitalize=c},!0),l("rtlMoveVisually",!B),l("wholeLineUpdateBefore",!0),l("theme","default",function(s){cp(s),Qi(s)},!0),l("keyMap","default",function(s,c,p){var m=Ss(c),y=p!=oi&&Ss(p);y&&y.detach&&y.detach(s,m),m.attach&&m.attach(s,y||null)}),l("extraKeys",null),l("configureMouse",null),l("lineWrapping",!1,b0,!0),l("gutters",[],function(s,c){s.display.gutterSpecs=kl(c,s.options.lineNumbers),Qi(s)},!0),l("fixedGutter",!0,function(s,c){s.display.gutters.style.left=c?cl(s.display)+"px":"0",s.refresh()},!0),l("coverGutterNextToScrollbar",!1,function(s){return Jr(s)},!0),l("scrollbarStyle","native",function(s){pd(s),Jr(s),s.display.scrollbars.setScrollTop(s.doc.scrollTop),s.display.scrollbars.setScrollLeft(s.doc.scrollLeft)},!0),l("lineNumbers",!1,function(s,c){s.display.gutterSpecs=kl(s.options.gutters,c),Qi(s)},!0),l("firstLineNumber",1,Qi,!0),l("lineNumberFormatter",function(s){return s},Qi,!0),l("showCursorWhenSelecting",!1,$i,!0),l("resetSelectionOnContextMenu",!0),l("lineWiseCopyCut",!0),l("pasteLinesPerSelection",!0),l("selectionsMayTouch",!1),l("readOnly",!1,function(s,c){c=="nocursor"&&(Yr(s),s.display.input.blur()),s.display.input.readOnlyChanged(c)}),l("screenReaderLabel",null,function(s,c){c=c===""?null:c,s.display.input.screenReaderLabelChanged(c)}),l("disableInput",!1,function(s,c){c||s.display.input.reset()},!0),l("dragDrop",!0,y0),l("allowDropFileTypes",null),l("cursorBlinkRate",530),l("cursorScrollMargin",0),l("cursorHeight",1,$i,!0),l("singleCursorHeightPerLine",!0,$i,!0),l("workTime",100),l("workDelay",100),l("flattenSpans",!0,Ji,!0),l("addModeClass",!1,Ji,!0),l("pollInterval",100),l("undoDepth",200,function(s,c){return s.doc.history.undoDepth=c}),l("historyEventDelay",1250),l("viewportMargin",10,function(s){return s.refresh()},!0),l("maxHighlightLength",1e4,Ji,!0),l("moveInputWithCursor",!0,function(s,c){c||s.display.input.resetPosition()}),l("tabindex",null,function(s,c){return s.display.input.getField().tabIndex=c||""}),l("autofocus",null),l("direction","ltr",function(s,c){return s.doc.setDirection(c)},!0),l("phrases",null)}function y0(t,i,l){var s=l&&l!=oi;if(!i!=!s){var c=t.display.dragFunctions,p=i?me:mt;p(t.display.scroller,"dragstart",c.start),p(t.display.scroller,"dragenter",c.enter),p(t.display.scroller,"dragover",c.over),p(t.display.scroller,"dragleave",c.leave),p(t.display.scroller,"drop",c.drop)}}function b0(t){t.options.lineWrapping?(Le(t.display.wrapper,"CodeMirror-wrap"),t.display.sizer.style.minWidth="",t.display.sizerWidth=null):(te(t.display.wrapper,"CodeMirror-wrap"),el(t)),fl(t),Tt(t),Wi(t),setTimeout(function(){return Jr(t)},100)}function Ve(t,i){var l=this;if(!(this instanceof Ve))return new Ve(t,i);this.options=i=i?G(i):{},G(fp,i,!1);var s=i.value;typeof s=="string"?s=new Ft(s,i.mode,null,i.lineSeparator,i.direction):i.mode&&(s.modeOption=i.mode),this.doc=s;var c=new Ve.inputStyles[i.inputStyle](this),p=this.display=new Nw(t,s,c,i);p.wrapper.CodeMirror=this,cp(this),i.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),pd(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new ne,keySeq:null,specialChars:null},i.autofocus&&!C&&p.input.focus(),f&&d<11&&setTimeout(function(){return l.display.input.reset(!0)},20),w0(this),Jw(),pr(this),this.curOp.forceUpdate=!0,Cd(this,s),i.autofocus&&!C||this.hasFocus()?setTimeout(function(){l.hasFocus()&&!l.state.focused&&gl(l)},20):Yr(this);for(var m in Ts)Ts.hasOwnProperty(m)&&Ts[m](this,i[m],oi);md(this),i.finishInit&&i.finishInit(this);for(var y=0;y<Pl.length;++y)Pl[y](this);hr(this),h&&i.lineWrapping&&getComputedStyle(p.lineDiv).textRendering=="optimizelegibility"&&(p.lineDiv.style.textRendering="auto")}Ve.defaults=fp,Ve.optionHandlers=Ts;function w0(t){var i=t.display;me(i.scroller,"mousedown",ut(t,sp)),f&&d<11?me(i.scroller,"dblclick",ut(t,function(b){if(!Qe(t,b)){var k=ur(t,b);if(!(!k||Ol(t,b)||Ln(t.display,b))){vt(b);var P=t.findWordAt(k);xs(t.doc,P.anchor,P.head)}}})):me(i.scroller,"dblclick",function(b){return Qe(t,b)||vt(b)}),me(i.scroller,"contextmenu",function(b){return up(t,b)}),me(i.input.getField(),"contextmenu",function(b){i.scroller.contains(b.target)||up(t,b)});var l,s={end:0};function c(){i.activeTouch&&(l=setTimeout(function(){return i.activeTouch=null},1e3),s=i.activeTouch,s.end=+new Date)}function p(b){if(b.touches.length!=1)return!1;var k=b.touches[0];return k.radiusX<=1&&k.radiusY<=1}function m(b,k){if(k.left==null)return!0;var P=k.left-b.left,j=k.top-b.top;return P*P+j*j>20*20}me(i.scroller,"touchstart",function(b){if(!Qe(t,b)&&!p(b)&&!Ol(t,b)){i.input.ensurePolled(),clearTimeout(l);var k=+new Date;i.activeTouch={start:k,moved:!1,prev:k-s.end<=300?s:null},b.touches.length==1&&(i.activeTouch.left=b.touches[0].pageX,i.activeTouch.top=b.touches[0].pageY)}}),me(i.scroller,"touchmove",function(){i.activeTouch&&(i.activeTouch.moved=!0)}),me(i.scroller,"touchend",function(b){var k=i.activeTouch;if(k&&!Ln(i,b)&&k.left!=null&&!k.moved&&new Date-k.start<300){var P=t.coordsChar(i.activeTouch,"page"),j;!k.prev||m(k,k.prev)?j=new Oe(P,P):!k.prev.prev||m(k,k.prev.prev)?j=t.findWordAt(P):j=new Oe(K(P.line,0),De(t.doc,K(P.line+1,0))),t.setSelection(j.anchor,j.head),t.focus(),vt(b)}c()}),me(i.scroller,"touchcancel",c),me(i.scroller,"scroll",function(){i.scroller.clientHeight&&(Vi(t,i.scroller.scrollTop),fr(t,i.scroller.scrollLeft,!0),Ye(t,"scroll",t))}),me(i.scroller,"mousewheel",function(b){return bd(t,b)}),me(i.scroller,"DOMMouseScroll",function(b){return bd(t,b)}),me(i.wrapper,"scroll",function(){return i.wrapper.scrollTop=i.wrapper.scrollLeft=0}),i.dragFunctions={enter:function(b){Qe(t,b)||Rn(b)},over:function(b){Qe(t,b)||(Qw(t,b),Rn(b))},start:function(b){return Yw(t,b)},drop:ut(t,Kw),leave:function(b){Qe(t,b)||Gd(t)}};var y=i.input.getField();me(y,"keyup",function(b){return ip.call(t,b)}),me(y,"keydown",ut(t,rp)),me(y,"keypress",ut(t,op)),me(y,"focus",function(b){return gl(t,b)}),me(y,"blur",function(b){return Yr(t,b)})}var Pl=[];Ve.defineInitHook=function(t){return Pl.push(t)};function co(t,i,l,s){var c=t.doc,p;l==null&&(l="add"),l=="smart"&&(c.mode.indent?p=zi(t,i).state:l="prev");var m=t.options.tabSize,y=he(c,i),b=ae(y.text,null,m);y.stateAfter&&(y.stateAfter=null);var k=y.text.match(/^\s*/)[0],P;if(!s&&!/\S/.test(y.text))P=0,l="not";else if(l=="smart"&&(P=c.mode.indent(p,y.text.slice(k.length),y.text),P==Ae||P>150)){if(!s)return;l="prev"}l=="prev"?i>c.first?P=ae(he(c,i-1).text,null,m):P=0:l=="add"?P=b+t.options.indentUnit:l=="subtract"?P=b-t.options.indentUnit:typeof l=="number"&&(P=b+l),P=Math.max(0,P);var j="",q=0;if(t.options.indentWithTabs)for(var R=Math.floor(P/m);R;--R)q+=m,j+="	";if(q<P&&(j+=it(P-q)),j!=k)return ti(c,j,K(i,0),K(i,k.length),"+input"),y.stateAfter=null,!0;for(var Y=0;Y<c.sel.ranges.length;Y++){var ee=c.sel.ranges[Y];if(ee.head.line==i&&ee.head.ch<k.length){var oe=K(i,k.length);Tl(c,Y,new Oe(oe,oe));break}}}var un=null;function Fs(t){un=t}function Il(t,i,l,s,c){var p=t.doc;t.display.shift=!1,s||(s=p.sel);var m=+new Date-200,y=c=="paste"||t.state.pasteIncoming>m,b=Qt(i),k=null;if(y&&s.ranges.length>1)if(un&&un.text.join(`
`)==i){if(s.ranges.length%un.text.length==0){k=[];for(var P=0;P<un.text.length;P++)k.push(p.splitLines(un.text[P]))}}else b.length==s.ranges.length&&t.options.pasteLinesPerSelection&&(k=ze(b,function(le){return[le]}));for(var j=t.curOp.updateInput,q=s.ranges.length-1;q>=0;q--){var R=s.ranges[q],Y=R.from(),ee=R.to();R.empty()&&(l&&l>0?Y=K(Y.line,Y.ch-l):t.state.overwrite&&!y?ee=K(ee.line,Math.min(he(p,ee.line).text.length,ee.ch+Me(b).length)):y&&un&&un.lineWise&&un.text.join(`
`)==b.join(`
`)&&(Y=ee=K(Y.line,0)));var oe={from:Y,to:ee,text:k?k[q%k.length]:b,origin:c||(y?"paste":t.state.cutIncoming>m?"cut":"+input")};ei(t.doc,oe),lt(t,"inputRead",t,oe)}i&&!y&&pp(t,i),Qr(t),t.curOp.updateInput<2&&(t.curOp.updateInput=j),t.curOp.typing=!0,t.state.pasteIncoming=t.state.cutIncoming=-1}function dp(t,i){var l=t.clipboardData&&t.clipboardData.getData("Text");if(l)return t.preventDefault(),!i.isReadOnly()&&!i.options.disableInput&&i.hasFocus()&&Ot(i,function(){return Il(i,l,0,null,"paste")}),!0}function pp(t,i){if(!(!t.options.electricChars||!t.options.smartIndent))for(var l=t.doc.sel,s=l.ranges.length-1;s>=0;s--){var c=l.ranges[s];if(!(c.head.ch>100||s&&l.ranges[s-1].head.line==c.head.line)){var p=t.getModeAt(c.head),m=!1;if(p.electricChars){for(var y=0;y<p.electricChars.length;y++)if(i.indexOf(p.electricChars.charAt(y))>-1){m=co(t,c.head.line,"smart");break}}else p.electricInput&&p.electricInput.test(he(t.doc,c.head.line).text.slice(0,c.head.ch))&&(m=co(t,c.head.line,"smart"));m&&lt(t,"electricInput",t,c.head.line)}}}function hp(t){for(var i=[],l=[],s=0;s<t.doc.sel.ranges.length;s++){var c=t.doc.sel.ranges[s].head.line,p={anchor:K(c,0),head:K(c+1,0)};l.push(p),i.push(t.getRange(p.anchor,p.head))}return{text:i,ranges:l}}function jl(t,i,l,s){t.setAttribute("autocorrect",l?"on":"off"),t.setAttribute("autocapitalize",s?"on":"off"),t.setAttribute("spellcheck",!!i)}function gp(){var t=A("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; min-height: 1em; outline: none"),i=A("div",[t],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return h?t.style.width="1000px":t.setAttribute("wrap","off"),F&&(t.style.border="1px solid black"),i}function x0(t){var i=t.optionHandlers,l=t.helpers={};t.prototype={constructor:t,focus:function(){ke(this).focus(),this.display.input.focus()},setOption:function(s,c){var p=this.options,m=p[s];p[s]==c&&s!="mode"||(p[s]=c,i.hasOwnProperty(s)&&ut(this,i[s])(this,c,m),Ye(this,"optionChange",this,s))},getOption:function(s){return this.options[s]},getDoc:function(){return this.doc},addKeyMap:function(s,c){this.state.keyMaps[c?"push":"unshift"](Ss(s))},removeKeyMap:function(s){for(var c=this.state.keyMaps,p=0;p<c.length;++p)if(c[p]==s||c[p].name==s)return c.splice(p,1),!0},addOverlay:kt(function(s,c){var p=s.token?s:t.getMode(this.options,s);if(p.startState)throw new Error("Overlays may not be stateful.");V(this.state.overlays,{mode:p,modeSpec:s,opaque:c&&c.opaque,priority:c&&c.priority||0},function(m){return m.priority}),this.state.modeGen++,Tt(this)}),removeOverlay:kt(function(s){for(var c=this.state.overlays,p=0;p<c.length;++p){var m=c[p].modeSpec;if(m==s||typeof s=="string"&&m.name==s){c.splice(p,1),this.state.modeGen++,Tt(this);return}}}),indentLine:kt(function(s,c,p){typeof c!="string"&&typeof c!="number"&&(c==null?c=this.options.smartIndent?"smart":"prev":c=c?"add":"subtract"),Z(this.doc,s)&&co(this,s,c,p)}),indentSelection:kt(function(s){for(var c=this.doc.sel.ranges,p=-1,m=0;m<c.length;m++){var y=c[m];if(y.empty())y.head.line>p&&(co(this,y.head.line,s,!0),p=y.head.line,m==this.doc.sel.primIndex&&Qr(this));else{var b=y.from(),k=y.to(),P=Math.max(p,b.line);p=Math.min(this.lastLine(),k.line-(k.ch?0:1))+1;for(var j=P;j<p;++j)co(this,j,s);var q=this.doc.sel.ranges;b.ch==0&&c.length==q.length&&q[m].from().ch>0&&Tl(this.doc,m,new Oe(b,q[m].to()),we)}}}),getTokenAt:function(s,c){return Af(this,s,c)},getLineTokens:function(s,c){return Af(this,K(s),c,!0)},getTokenTypeAt:function(s){s=De(this.doc,s);var c=kf(this,he(this.doc,s.line)),p=0,m=(c.length-1)/2,y=s.ch,b;if(y==0)b=c[2];else for(;;){var k=p+m>>1;if((k?c[k*2-1]:0)>=y)m=k;else if(c[k*2+1]<y)p=k+1;else{b=c[k*2+2];break}}var P=b?b.indexOf("overlay "):-1;return P<0?b:P==0?null:b.slice(0,P-1)},getModeAt:function(s){var c=this.doc.mode;return c.innerMode?t.innerMode(c,this.getTokenAt(s).state).mode:c},getHelper:function(s,c){return this.getHelpers(s,c)[0]},getHelpers:function(s,c){var p=[];if(!l.hasOwnProperty(c))return p;var m=l[c],y=this.getModeAt(s);if(typeof y[c]=="string")m[y[c]]&&p.push(m[y[c]]);else if(y[c])for(var b=0;b<y[c].length;b++){var k=m[y[c][b]];k&&p.push(k)}else y.helperType&&m[y.helperType]?p.push(m[y.helperType]):m[y.name]&&p.push(m[y.name]);for(var P=0;P<m._global.length;P++){var j=m._global[P];j.pred(y,this)&&re(p,j.val)==-1&&p.push(j.val)}return p},getStateAfter:function(s,c){var p=this.doc;return s=bf(p,s??p.first+p.size-1),zi(this,s+1,c).state},cursorCoords:function(s,c){var p,m=this.doc.sel.primary();return s==null?p=m.head:typeof s=="object"?p=De(this.doc,s):p=s?m.from():m.to(),an(this,p,c||"page")},charCoords:function(s,c){return fs(this,De(this.doc,s),c||"page")},coordsChar:function(s,c){return s=ed(this,s,c||"page"),al(this,s.left,s.top)},lineAtHeight:function(s,c){return s=ed(this,{top:s,left:0},c||"page").top,I(this.doc,s+this.display.viewOffset)},heightAtLine:function(s,c,p){var m=!1,y;if(typeof s=="number"){var b=this.doc.first+this.doc.size-1;s<this.doc.first?s=this.doc.first:s>b&&(s=b,m=!0),y=he(this.doc,s)}else y=s;return cs(this,y,{top:0,left:0},c||"page",p||m).top+(m?this.doc.height-Fn(y):0)},defaultTextHeight:function(){return Gr(this.display)},defaultCharWidth:function(){return Kr(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(s,c,p,m,y){var b=this.display;s=an(this,De(this.doc,s));var k=s.bottom,P=s.left;if(c.style.position="absolute",c.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(c),b.sizer.appendChild(c),m=="over")k=s.top;else if(m=="above"||m=="near"){var j=Math.max(b.wrapper.clientHeight,this.doc.height),q=Math.max(b.sizer.clientWidth,b.lineSpace.clientWidth);(m=="above"||s.bottom+c.offsetHeight>j)&&s.top>c.offsetHeight?k=s.top-c.offsetHeight:s.bottom+c.offsetHeight<=j&&(k=s.bottom),P+c.offsetWidth>q&&(P=q-c.offsetWidth)}c.style.top=k+"px",c.style.left=c.style.right="",y=="right"?(P=b.sizer.clientWidth-c.offsetWidth,c.style.right="0px"):(y=="left"?P=0:y=="middle"&&(P=(b.sizer.clientWidth-c.offsetWidth)/2),c.style.left=P+"px"),p&&yw(this,{left:P,top:k,right:P+c.offsetWidth,bottom:k+c.offsetHeight})},triggerOnKeyDown:kt(rp),triggerOnKeyPress:kt(op),triggerOnKeyUp:ip,triggerOnMouseDown:kt(sp),execCommand:function(s){if(so.hasOwnProperty(s))return so[s].call(null,this)},triggerElectric:kt(function(s){pp(this,s)}),findPosH:function(s,c,p,m){var y=1;c<0&&(y=-1,c=-c);for(var b=De(this.doc,s),k=0;k<c&&(b=zl(this.doc,b,y,p,m),!b.hitSide);++k);return b},moveH:kt(function(s,c){var p=this;this.extendSelectionsBy(function(m){return p.display.shift||p.doc.extend||m.empty()?zl(p.doc,m.head,s,c,p.options.rtlMoveVisually):s<0?m.from():m.to()},Te)}),deleteH:kt(function(s,c){var p=this.doc.sel,m=this.doc;p.somethingSelected()?m.replaceSelection("",null,"+delete"):ii(this,function(y){var b=zl(m,y.head,s,c,!1);return s<0?{from:b,to:y.head}:{from:y.head,to:b}})}),findPosV:function(s,c,p,m){var y=1,b=m;c<0&&(y=-1,c=-c);for(var k=De(this.doc,s),P=0;P<c;++P){var j=an(this,k,"div");if(b==null?b=j.left:j.left=b,k=mp(this,j,y,p),k.hitSide)break}return k},moveV:kt(function(s,c){var p=this,m=this.doc,y=[],b=!this.display.shift&&!m.extend&&m.sel.somethingSelected();if(m.extendSelectionsBy(function(P){if(b)return s<0?P.from():P.to();var j=an(p,P.head,"div");P.goalColumn!=null&&(j.left=P.goalColumn),y.push(j.left);var q=mp(p,j,s,c);return c=="page"&&P==m.sel.primary()&&vl(p,fs(p,q,"div").top-j.top),q},Te),y.length)for(var k=0;k<m.sel.ranges.length;k++)m.sel.ranges[k].goalColumn=y[k]}),findWordAt:function(s){var c=this.doc,p=he(c,s.line).text,m=s.ch,y=s.ch;if(p){var b=this.getHelper(s,"wordChars");(s.sticky=="before"||y==p.length)&&m?--m:++y;for(var k=p.charAt(m),P=Dn(k,b)?function(j){return Dn(j,b)}:/\s/.test(k)?function(j){return/\s/.test(j)}:function(j){return!/\s/.test(j)&&!Dn(j)};m>0&&P(p.charAt(m-1));)--m;for(;y<p.length&&P(p.charAt(y));)++y}return new Oe(K(s.line,m),K(s.line,y))},toggleOverwrite:function(s){s!=null&&s==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?Le(this.display.cursorDiv,"CodeMirror-overwrite"):te(this.display.cursorDiv,"CodeMirror-overwrite"),Ye(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==xe(ht(this))},isReadOnly:function(){return!!(this.options.readOnly||this.doc.cantEdit)},scrollTo:kt(function(s,c){Ui(this,s,c)}),getScrollInfo:function(){var s=this.display.scroller;return{left:s.scrollLeft,top:s.scrollTop,height:s.scrollHeight-bn(this)-this.display.barHeight,width:s.scrollWidth-bn(this)-this.display.barWidth,clientHeight:rl(this),clientWidth:ar(this)}},scrollIntoView:kt(function(s,c){s==null?(s={from:this.doc.sel.primary().head,to:null},c==null&&(c=this.options.cursorScrollMargin)):typeof s=="number"?s={from:K(s,0),to:null}:s.from==null&&(s={from:s,to:null}),s.to||(s.to=s.from),s.margin=c||0,s.from.line!=null?bw(this,s):ud(this,s.from,s.to,s.margin)}),setSize:kt(function(s,c){var p=this,m=function(b){return typeof b=="number"||/^\d+$/.test(String(b))?b+"px":b};s!=null&&(this.display.wrapper.style.width=m(s)),c!=null&&(this.display.wrapper.style.height=m(c)),this.options.lineWrapping&&Jf(this);var y=this.display.viewFrom;this.doc.iter(y,this.display.viewTo,function(b){if(b.widgets){for(var k=0;k<b.widgets.length;k++)if(b.widgets[k].noHScroll){$n(p,y,"widget");break}}++y}),this.curOp.forceUpdate=!0,Ye(this,"refresh",this)}),operation:function(s){return Ot(this,s)},startOperation:function(){return pr(this)},endOperation:function(){return hr(this)},refresh:kt(function(){var s=this.display.cachedTextHeight;Tt(this),this.curOp.forceUpdate=!0,Wi(this),Ui(this,this.doc.scrollLeft,this.doc.scrollTop),wl(this.display),(s==null||Math.abs(s-Gr(this.display))>.5||this.options.lineWrapping)&&fl(this),Ye(this,"refresh",this)}),swapDoc:kt(function(s){var c=this.doc;return c.cm=null,this.state.selectingText&&this.state.selectingText(),Cd(this,s),Wi(this),this.display.input.reset(),Ui(this,s.scrollLeft,s.scrollTop),this.curOp.forceScroll=!0,lt(this,"swapDoc",this,c),c}),phrase:function(s){var c=this.options.phrases;return c&&Object.prototype.hasOwnProperty.call(c,s)?c[s]:s},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},en(t),t.registerHelper=function(s,c,p){l.hasOwnProperty(s)||(l[s]=t[s]={_global:[]}),l[s][c]=p},t.registerGlobalHelper=function(s,c,p,m){t.registerHelper(s,c,m),l[s]._global.push({pred:p,val:m})}}function zl(t,i,l,s,c){var p=i,m=l,y=he(t,i.line),b=c&&t.direction=="rtl"?-l:l;function k(){var de=i.line+b;return de<t.first||de>=t.first+t.size?!1:(i=new K(de,i.ch,i.sticky),y=he(t,de))}function P(de){var ue;if(s=="codepoint"){var pe=y.text.charCodeAt(i.ch+(l>0?0:-1));if(isNaN(pe))ue=null;else{var ve=l>0?pe>=55296&&pe<56320:pe>=56320&&pe<57343;ue=new K(i.line,Math.max(0,Math.min(y.text.length,i.ch+l*(ve?2:1))),-l)}}else c?ue=n0(t.cm,y,i,l):ue=Ll(y,i,l);if(ue==null)if(!de&&k())i=Ml(c,t.cm,y,i.line,b);else return!1;else i=ue;return!0}if(s=="char"||s=="codepoint")P();else if(s=="column")P(!0);else if(s=="word"||s=="group")for(var j=null,q=s=="group",R=t.cm&&t.cm.getHelper(i,"wordChars"),Y=!0;!(l<0&&!P(!Y));Y=!1){var ee=y.text.charAt(i.ch)||`
`,oe=Dn(ee,R)?"w":q&&ee==`
`?"n":!q||/\s/.test(ee)?null:"p";if(q&&!Y&&!oe&&(oe="s"),j&&j!=oe){l<0&&(l=1,P(),i.sticky="after");break}if(oe&&(j=oe),l>0&&!P(!Y))break}var le=Cs(t,i,p,m,!0);return Be(p,le)&&(le.hitSide=!0),le}function mp(t,i,l,s){var c=t.doc,p=i.left,m;if(s=="page"){var y=Math.min(t.display.wrapper.clientHeight,ke(t).innerHeight||c(t).documentElement.clientHeight),b=Math.max(y-.5*Gr(t.display),3);m=(l>0?i.bottom:i.top)+l*b}else s=="line"&&(m=l>0?i.bottom+3:i.top-3);for(var k;k=al(t,p,m),!!k.outside;){if(l<0?m<=0:m>=c.height){k.hitSide=!0;break}m+=l*5}return k}var Ie=function(t){this.cm=t,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new ne,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};Ie.prototype.init=function(t){var i=this,l=this,s=l.cm,c=l.div=t.lineDiv;c.contentEditable=!0,jl(c,s.options.spellcheck,s.options.autocorrect,s.options.autocapitalize);function p(y){for(var b=y.target;b;b=b.parentNode){if(b==c)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(b.className))break}return!1}me(c,"paste",function(y){!p(y)||Qe(s,y)||dp(y,s)||d<=11&&setTimeout(ut(s,function(){return i.updateFromDOM()}),20)}),me(c,"compositionstart",function(y){i.composing={data:y.data,done:!1}}),me(c,"compositionupdate",function(y){i.composing||(i.composing={data:y.data,done:!1})}),me(c,"compositionend",function(y){i.composing&&(y.data!=i.composing.data&&i.readFromDOMSoon(),i.composing.done=!0)}),me(c,"touchstart",function(){return l.forceCompositionEnd()}),me(c,"input",function(){i.composing||i.readFromDOMSoon()});function m(y){if(!(!p(y)||Qe(s,y))){if(s.somethingSelected())Fs({lineWise:!1,text:s.getSelections()}),y.type=="cut"&&s.replaceSelection("",null,"cut");else if(s.options.lineWiseCopyCut){var b=hp(s);Fs({lineWise:!0,text:b.text}),y.type=="cut"&&s.operation(function(){s.setSelections(b.ranges,0,we),s.replaceSelection("",null,"cut")})}else return;if(y.clipboardData){y.clipboardData.clearData();var k=un.text.join(`
`);if(y.clipboardData.setData("Text",k),y.clipboardData.getData("Text")==k){y.preventDefault();return}}var P=gp(),j=P.firstChild;jl(j),s.display.lineSpace.insertBefore(P,s.display.lineSpace.firstChild),j.value=un.text.join(`
`);var q=xe(Pe(c));et(j),setTimeout(function(){s.display.lineSpace.removeChild(P),q.focus(),q==c&&l.showPrimarySelection()},50)}}me(c,"copy",m),me(c,"cut",m)},Ie.prototype.screenReaderLabelChanged=function(t){t?this.div.setAttribute("aria-label",t):this.div.removeAttribute("aria-label")},Ie.prototype.prepareSelection=function(){var t=sd(this.cm,!1);return t.focus=xe(Pe(this.div))==this.div,t},Ie.prototype.showSelection=function(t,i){!t||!this.cm.display.view.length||((t.focus||i)&&this.showPrimarySelection(),this.showMultipleSelections(t))},Ie.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()},Ie.prototype.showPrimarySelection=function(){var t=this.getSelection(),i=this.cm,l=i.doc.sel.primary(),s=l.from(),c=l.to();if(i.display.viewTo==i.display.viewFrom||s.line>=i.display.viewTo||c.line<i.display.viewFrom){t.removeAllRanges();return}var p=Ls(i,t.anchorNode,t.anchorOffset),m=Ls(i,t.focusNode,t.focusOffset);if(!(p&&!p.bad&&m&&!m.bad&&fe(Wr(p,m),s)==0&&fe(Et(p,m),c)==0)){var y=i.display.view,b=s.line>=i.display.viewFrom&&vp(i,s)||{node:y[0].measure.map[2],offset:0},k=c.line<i.display.viewTo&&vp(i,c);if(!k){var P=y[y.length-1].measure,j=P.maps?P.maps[P.maps.length-1]:P.map;k={node:j[j.length-1],offset:j[j.length-2]-j[j.length-3]}}if(!b||!k){t.removeAllRanges();return}var q=t.rangeCount&&t.getRangeAt(0),R;try{R=U(b.node,b.offset,k.offset,k.node)}catch{}R&&(!r&&i.state.focused?(t.collapse(b.node,b.offset),R.collapsed||(t.removeAllRanges(),t.addRange(R))):(t.removeAllRanges(),t.addRange(R)),q&&t.anchorNode==null?t.addRange(q):r&&this.startGracePeriod()),this.rememberSelection()}},Ie.prototype.startGracePeriod=function(){var t=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){t.gracePeriod=!1,t.selectionChanged()&&t.cm.operation(function(){return t.cm.curOp.selectionChanged=!0})},20)},Ie.prototype.showMultipleSelections=function(t){X(this.cm.display.cursorDiv,t.cursors),X(this.cm.display.selectionDiv,t.selection)},Ie.prototype.rememberSelection=function(){var t=this.getSelection();this.lastAnchorNode=t.anchorNode,this.lastAnchorOffset=t.anchorOffset,this.lastFocusNode=t.focusNode,this.lastFocusOffset=t.focusOffset},Ie.prototype.selectionInEditor=function(){var t=this.getSelection();if(!t.rangeCount)return!1;var i=t.getRangeAt(0).commonAncestorContainer;return ce(this.div,i)},Ie.prototype.focus=function(){this.cm.options.readOnly!="nocursor"&&((!this.selectionInEditor()||xe(Pe(this.div))!=this.div)&&this.showSelection(this.prepareSelection(),!0),this.div.focus())},Ie.prototype.blur=function(){this.div.blur()},Ie.prototype.getField=function(){return this.div},Ie.prototype.supportsTouch=function(){return!0},Ie.prototype.receivedFocus=function(){var t=this,i=this;this.selectionInEditor()?setTimeout(function(){return t.pollSelection()},20):Ot(this.cm,function(){return i.cm.curOp.selectionChanged=!0});function l(){i.cm.state.focused&&(i.pollSelection(),i.polling.set(i.cm.options.pollInterval,l))}this.polling.set(this.cm.options.pollInterval,l)},Ie.prototype.selectionChanged=function(){var t=this.getSelection();return t.anchorNode!=this.lastAnchorNode||t.anchorOffset!=this.lastAnchorOffset||t.focusNode!=this.lastFocusNode||t.focusOffset!=this.lastFocusOffset},Ie.prototype.pollSelection=function(){if(!(this.readDOMTimeout!=null||this.gracePeriod||!this.selectionChanged())){var t=this.getSelection(),i=this.cm;if(D&&v&&this.cm.display.gutterSpecs.length&&k0(t.anchorNode)){this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),this.focus();return}if(!this.composing){this.rememberSelection();var l=Ls(i,t.anchorNode,t.anchorOffset),s=Ls(i,t.focusNode,t.focusOffset);l&&s&&Ot(i,function(){yt(i.doc,Vn(l,s),we),(l.bad||s.bad)&&(i.curOp.selectionChanged=!0)})}}},Ie.prototype.pollContent=function(){this.readDOMTimeout!=null&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var t=this.cm,i=t.display,l=t.doc.sel.primary(),s=l.from(),c=l.to();if(s.ch==0&&s.line>t.firstLine()&&(s=K(s.line-1,he(t.doc,s.line-1).length)),c.ch==he(t.doc,c.line).text.length&&c.line<t.lastLine()&&(c=K(c.line+1,0)),s.line<i.viewFrom||c.line>i.viewTo-1)return!1;var p,m,y;s.line==i.viewFrom||(p=cr(t,s.line))==0?(m=S(i.view[0].line),y=i.view[0].node):(m=S(i.view[p].line),y=i.view[p-1].node.nextSibling);var b=cr(t,c.line),k,P;if(b==i.view.length-1?(k=i.viewTo-1,P=i.lineDiv.lastChild):(k=S(i.view[b+1].line)-1,P=i.view[b+1].node.previousSibling),!y)return!1;for(var j=t.doc.splitLines(C0(t,y,P,m,k)),q=En(t.doc,K(m,0),K(k,he(t.doc,k).text.length));j.length>1&&q.length>1;)if(Me(j)==Me(q))j.pop(),q.pop(),k--;else if(j[0]==q[0])j.shift(),q.shift(),m++;else break;for(var R=0,Y=0,ee=j[0],oe=q[0],le=Math.min(ee.length,oe.length);R<le&&ee.charCodeAt(R)==oe.charCodeAt(R);)++R;for(var de=Me(j),ue=Me(q),pe=Math.min(de.length-(j.length==1?R:0),ue.length-(q.length==1?R:0));Y<pe&&de.charCodeAt(de.length-Y-1)==ue.charCodeAt(ue.length-Y-1);)++Y;if(j.length==1&&q.length==1&&m==s.line)for(;R&&R>s.ch&&de.charCodeAt(de.length-Y-1)==ue.charCodeAt(ue.length-Y-1);)R--,Y++;j[j.length-1]=de.slice(0,de.length-Y).replace(/^\u200b+/,""),j[0]=j[0].slice(R).replace(/\u200b+$/,"");var ve=K(m,R),ge=K(k,q.length?Me(q).length-Y:0);if(j.length>1||j[0]||fe(ve,ge))return ti(t.doc,j,ve,ge,"+input"),!0},Ie.prototype.ensurePolled=function(){this.forceCompositionEnd()},Ie.prototype.reset=function(){this.forceCompositionEnd()},Ie.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},Ie.prototype.readFromDOMSoon=function(){var t=this;this.readDOMTimeout==null&&(this.readDOMTimeout=setTimeout(function(){if(t.readDOMTimeout=null,t.composing)if(t.composing.done)t.composing=null;else return;t.updateFromDOM()},80))},Ie.prototype.updateFromDOM=function(){var t=this;(this.cm.isReadOnly()||!this.pollContent())&&Ot(this.cm,function(){return Tt(t.cm)})},Ie.prototype.setUneditable=function(t){t.contentEditable="false"},Ie.prototype.onKeyPress=function(t){t.charCode==0||this.composing||(t.preventDefault(),this.cm.isReadOnly()||ut(this.cm,Il)(this.cm,String.fromCharCode(t.charCode==null?t.keyCode:t.charCode),0))},Ie.prototype.readOnlyChanged=function(t){this.div.contentEditable=String(t!="nocursor")},Ie.prototype.onContextMenu=function(){},Ie.prototype.resetPosition=function(){},Ie.prototype.needsContentAttribute=!0;function vp(t,i){var l=il(t,i.line);if(!l||l.hidden)return null;var s=he(t.doc,i.line),c=Vf(l,s,i.line),p=Fe(s,t.doc.direction),m="left";if(p){var y=zn(p,i.ch);m=y%2?"right":"left"}var b=Yf(c.map,i.ch,m);return b.offset=b.collapse=="right"?b.end:b.start,b}function k0(t){for(var i=t;i;i=i.parentNode)if(/CodeMirror-gutter-wrapper/.test(i.className))return!0;return!1}function si(t,i){return i&&(t.bad=!0),t}function C0(t,i,l,s,c){var p="",m=!1,y=t.doc.lineSeparator(),b=!1;function k(R){return function(Y){return Y.id==R}}function P(){m&&(p+=y,b&&(p+=y),m=b=!1)}function j(R){R&&(P(),p+=R)}function q(R){if(R.nodeType==1){var Y=R.getAttribute("cm-text");if(Y){j(Y);return}var ee=R.getAttribute("cm-marker"),oe;if(ee){var le=t.findMarks(K(s,0),K(c+1,0),k(+ee));le.length&&(oe=le[0].find(0))&&j(En(t.doc,oe.from,oe.to).join(y));return}if(R.getAttribute("contenteditable")=="false")return;var de=/^(pre|div|p|li|table|br)$/i.test(R.nodeName);if(!/^br$/i.test(R.nodeName)&&R.textContent.length==0)return;de&&P();for(var ue=0;ue<R.childNodes.length;ue++)q(R.childNodes[ue]);/^(pre|p)$/i.test(R.nodeName)&&(b=!0),de&&(m=!0)}else R.nodeType==3&&j(R.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}for(;q(i),i!=l;)i=i.nextSibling,b=!1;return p}function Ls(t,i,l){var s;if(i==t.display.lineDiv){if(s=t.display.lineDiv.childNodes[l],!s)return si(t.clipPos(K(t.display.viewTo-1)),!0);i=null,l=0}else for(s=i;;s=s.parentNode){if(!s||s==t.display.lineDiv)return null;if(s.parentNode&&s.parentNode==t.display.lineDiv)break}for(var c=0;c<t.display.view.length;c++){var p=t.display.view[c];if(p.node==s)return D0(p,i,l)}}function D0(t,i,l){var s=t.text.firstChild,c=!1;if(!i||!ce(s,i))return si(K(S(t.line),0),!0);if(i==s&&(c=!0,i=s.childNodes[l],l=0,!i)){var p=t.rest?Me(t.rest):t.line;return si(K(S(p),p.text.length),c)}var m=i.nodeType==3?i:null,y=i;for(!m&&i.childNodes.length==1&&i.firstChild.nodeType==3&&(m=i.firstChild,l&&(l=m.nodeValue.length));y.parentNode!=s;)y=y.parentNode;var b=t.measure,k=b.maps;function P(oe,le,de){for(var ue=-1;ue<(k?k.length:0);ue++)for(var pe=ue<0?b.map:k[ue],ve=0;ve<pe.length;ve+=3){var ge=pe[ve+2];if(ge==oe||ge==le){var Se=S(ue<0?t.line:t.rest[ue]),Re=pe[ve]+de;return(de<0||ge!=oe)&&(Re=pe[ve+(de?1:0)]),K(Se,Re)}}}var j=P(m,y,l);if(j)return si(j,c);for(var q=y.nextSibling,R=m?m.nodeValue.length-l:0;q;q=q.nextSibling){if(j=P(q,q.firstChild,0),j)return si(K(j.line,j.ch-R),c);R+=q.textContent.length}for(var Y=y.previousSibling,ee=l;Y;Y=Y.previousSibling){if(j=P(Y,Y.firstChild,-1),j)return si(K(j.line,j.ch+ee),c);ee+=Y.textContent.length}}var Xe=function(t){this.cm=t,this.prevInput="",this.pollingFast=!1,this.polling=new ne,this.hasSelection=!1,this.composing=null,this.resetting=!1};Xe.prototype.init=function(t){var i=this,l=this,s=this.cm;this.createField(t);var c=this.textarea;t.wrapper.insertBefore(this.wrapper,t.wrapper.firstChild),F&&(c.style.width="0px"),me(c,"input",function(){f&&d>=9&&i.hasSelection&&(i.hasSelection=null),l.poll()}),me(c,"paste",function(m){Qe(s,m)||dp(m,s)||(s.state.pasteIncoming=+new Date,l.fastPoll())});function p(m){if(!Qe(s,m)){if(s.somethingSelected())Fs({lineWise:!1,text:s.getSelections()});else if(s.options.lineWiseCopyCut){var y=hp(s);Fs({lineWise:!0,text:y.text}),m.type=="cut"?s.setSelections(y.ranges,null,we):(l.prevInput="",c.value=y.text.join(`
`),et(c))}else return;m.type=="cut"&&(s.state.cutIncoming=+new Date)}}me(c,"cut",p),me(c,"copy",p),me(t.scroller,"paste",function(m){if(!(Ln(t,m)||Qe(s,m))){if(!c.dispatchEvent){s.state.pasteIncoming=+new Date,l.focus();return}var y=new Event("paste");y.clipboardData=m.clipboardData,c.dispatchEvent(y)}}),me(t.lineSpace,"selectstart",function(m){Ln(t,m)||vt(m)}),me(c,"compositionstart",function(){var m=s.getCursor("from");l.composing&&l.composing.range.clear(),l.composing={start:m,range:s.markText(m,s.getCursor("to"),{className:"CodeMirror-composing"})}}),me(c,"compositionend",function(){l.composing&&(l.poll(),l.composing.range.clear(),l.composing=null)})},Xe.prototype.createField=function(t){this.wrapper=gp(),this.textarea=this.wrapper.firstChild;var i=this.cm.options;jl(this.textarea,i.spellcheck,i.autocorrect,i.autocapitalize)},Xe.prototype.screenReaderLabelChanged=function(t){t?this.textarea.setAttribute("aria-label",t):this.textarea.removeAttribute("aria-label")},Xe.prototype.prepareSelection=function(){var t=this.cm,i=t.display,l=t.doc,s=sd(t);if(t.options.moveInputWithCursor){var c=an(t,l.sel.primary().head,"div"),p=i.wrapper.getBoundingClientRect(),m=i.lineDiv.getBoundingClientRect();s.teTop=Math.max(0,Math.min(i.wrapper.clientHeight-10,c.top+m.top-p.top)),s.teLeft=Math.max(0,Math.min(i.wrapper.clientWidth-10,c.left+m.left-p.left))}return s},Xe.prototype.showSelection=function(t){var i=this.cm,l=i.display;X(l.cursorDiv,t.cursors),X(l.selectionDiv,t.selection),t.teTop!=null&&(this.wrapper.style.top=t.teTop+"px",this.wrapper.style.left=t.teLeft+"px")},Xe.prototype.reset=function(t){if(!(this.contextMenuPending||this.composing&&t)){var i=this.cm;if(this.resetting=!0,i.somethingSelected()){this.prevInput="";var l=i.getSelection();this.textarea.value=l,i.state.focused&&et(this.textarea),f&&d>=9&&(this.hasSelection=l)}else t||(this.prevInput=this.textarea.value="",f&&d>=9&&(this.hasSelection=null));this.resetting=!1}},Xe.prototype.getField=function(){return this.textarea},Xe.prototype.supportsTouch=function(){return!1},Xe.prototype.focus=function(){if(this.cm.options.readOnly!="nocursor"&&(!C||xe(Pe(this.textarea))!=this.textarea))try{this.textarea.focus()}catch{}},Xe.prototype.blur=function(){this.textarea.blur()},Xe.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},Xe.prototype.receivedFocus=function(){this.slowPoll()},Xe.prototype.slowPoll=function(){var t=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){t.poll(),t.cm.state.focused&&t.slowPoll()})},Xe.prototype.fastPoll=function(){var t=!1,i=this;i.pollingFast=!0;function l(){var s=i.poll();!s&&!t?(t=!0,i.polling.set(60,l)):(i.pollingFast=!1,i.slowPoll())}i.polling.set(20,l)},Xe.prototype.poll=function(){var t=this,i=this.cm,l=this.textarea,s=this.prevInput;if(this.contextMenuPending||this.resetting||!i.state.focused||qn(l)&&!s&&!this.composing||i.isReadOnly()||i.options.disableInput||i.state.keySeq)return!1;var c=l.value;if(c==s&&!i.somethingSelected())return!1;if(f&&d>=9&&this.hasSelection===c||L&&/[\uf700-\uf7ff]/.test(c))return i.display.input.reset(),!1;if(i.doc.sel==i.display.selForContextMenu){var p=c.charCodeAt(0);if(p==8203&&!s&&(s="\u200B"),p==8666)return this.reset(),this.cm.execCommand("undo")}for(var m=0,y=Math.min(s.length,c.length);m<y&&s.charCodeAt(m)==c.charCodeAt(m);)++m;return Ot(i,function(){Il(i,c.slice(m),s.length-m,null,t.composing?"*compose":null),c.length>1e3||c.indexOf(`
`)>-1?l.value=t.prevInput="":t.prevInput=c,t.composing&&(t.composing.range.clear(),t.composing.range=i.markText(t.composing.start,i.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},Xe.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},Xe.prototype.onKeyPress=function(){f&&d>=9&&(this.hasSelection=null),this.fastPoll()},Xe.prototype.onContextMenu=function(t){var i=this,l=i.cm,s=l.display,c=i.textarea;i.contextMenuPending&&i.contextMenuPending();var p=ur(l,t),m=s.scroller.scrollTop;if(!p||x)return;var y=l.options.resetSelectionOnContextMenu;y&&l.doc.sel.contains(p)==-1&&ut(l,yt)(l.doc,Vn(p),we);var b=c.style.cssText,k=i.wrapper.style.cssText,P=i.wrapper.offsetParent.getBoundingClientRect();i.wrapper.style.cssText="position: static",c.style.cssText=`position: absolute; width: 30px; height: 30px;
      top: `+(t.clientY-P.top-5)+"px; left: "+(t.clientX-P.left-5)+`px;
      z-index: 1000; background: `+(f?"rgba(255, 255, 255, .05)":"transparent")+`;
      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);`;var j;h&&(j=c.ownerDocument.defaultView.scrollY),s.input.focus(),h&&c.ownerDocument.defaultView.scrollTo(null,j),s.input.reset(),l.somethingSelected()||(c.value=i.prevInput=" "),i.contextMenuPending=R,s.selForContextMenu=l.doc.sel,clearTimeout(s.detectingSelectAll);function q(){if(c.selectionStart!=null){var ee=l.somethingSelected(),oe="\u200B"+(ee?c.value:"");c.value="\u21DA",c.value=oe,i.prevInput=ee?"":"\u200B",c.selectionStart=1,c.selectionEnd=oe.length,s.selForContextMenu=l.doc.sel}}function R(){if(i.contextMenuPending==R&&(i.contextMenuPending=!1,i.wrapper.style.cssText=k,c.style.cssText=b,f&&d<9&&s.scrollbars.setScrollTop(s.scroller.scrollTop=m),c.selectionStart!=null)){(!f||f&&d<9)&&q();var ee=0,oe=function(){s.selForContextMenu==l.doc.sel&&c.selectionStart==0&&c.selectionEnd>0&&i.prevInput=="\u200B"?ut(l,Id)(l):ee++<10?s.detectingSelectAll=setTimeout(oe,500):(s.selForContextMenu=null,s.input.reset())};s.detectingSelectAll=setTimeout(oe,200)}}if(f&&d>=9&&q(),_){Rn(t);var Y=function(){mt(window,"mouseup",Y),setTimeout(R,20)};me(window,"mouseup",Y)}else setTimeout(R,50)},Xe.prototype.readOnlyChanged=function(t){t||this.reset(),this.textarea.disabled=t=="nocursor",this.textarea.readOnly=!!t},Xe.prototype.setUneditable=function(){},Xe.prototype.needsContentAttribute=!1;function A0(t,i){if(i=i?G(i):{},i.value=t.value,!i.tabindex&&t.tabIndex&&(i.tabindex=t.tabIndex),!i.placeholder&&t.placeholder&&(i.placeholder=t.placeholder),i.autofocus==null){var l=xe(Pe(t));i.autofocus=l==t||t.getAttribute("autofocus")!=null&&l==document.body}function s(){t.value=y.getValue()}var c;if(t.form&&(me(t.form,"submit",s),!i.leaveSubmitMethodAlone)){var p=t.form;c=p.submit;try{var m=p.submit=function(){s(),p.submit=c,p.submit(),p.submit=m}}catch{}}i.finishInit=function(b){b.save=s,b.getTextArea=function(){return t},b.toTextArea=function(){b.toTextArea=isNaN,s(),t.parentNode.removeChild(b.getWrapperElement()),t.style.display="",t.form&&(mt(t.form,"submit",s),!i.leaveSubmitMethodAlone&&typeof t.form.submit=="function"&&(t.form.submit=c))}},t.style.display="none";var y=Ve(function(b){return t.parentNode.insertBefore(b,t.nextSibling)},i);return y}function S0(t){t.off=mt,t.on=me,t.wheelEventPixels=Bw,t.Doc=Ft,t.splitLines=Qt,t.countColumn=ae,t.findColumn=$e,t.isWordChar=gt,t.Pass=Ae,t.signal=Ye,t.Line=$r,t.changeEnd=Gn,t.scrollbarModel=dd,t.Pos=K,t.cmpPos=fe,t.modes=zr,t.mimeModes=rn,t.resolveMode=Rr,t.getMode=Hr,t.modeExtensions=_n,t.extendMode=qr,t.copyState=vn,t.startState=_r,t.innerMode=Ii,t.commands=so,t.keyMap=Nn,t.keyName=Zd,t.isModifierKey=Qd,t.lookupKey=ri,t.normalizeKeyMap=t0,t.StringStream=Je,t.SharedTextMarker=ro,t.TextMarker=Yn,t.LineWidget=no,t.e_preventDefault=vt,t.e_stopPropagation=Ir,t.e_stop=Rn,t.addClass=Le,t.contains=ce,t.rmClass=te,t.keyNames=Qn}v0(Ve),x0(Ve);var E0="iter insert remove copy getEditor constructor".split(" ");for(var Ms in Ft.prototype)Ft.prototype.hasOwnProperty(Ms)&&re(E0,Ms)<0&&(Ve.prototype[Ms]=function(t){return function(){return t.apply(this.doc,arguments)}}(Ft.prototype[Ms]));return en(Ft),Ve.inputStyles={textarea:Xe,contenteditable:Ie},Ve.defineMode=function(t){!Ve.defaults.mode&&t!="null"&&(Ve.defaults.mode=t),on.apply(this,arguments)},Ve.defineMIME=sr,Ve.defineMode("null",function(){return{token:function(t){return t.skipToEnd()}}}),Ve.defineMIME("text/plain","null"),Ve.defineExtension=function(t,i){Ve.prototype[t]=i},Ve.defineDocExtension=function(t,i){Ft.prototype[t]=i},Ve.fromTextArea=A0,S0(Ve),Ve.version="5.65.19",Ve})});var Nc=wt((rm,im)=>{(function(n){typeof rm=="object"&&typeof im=="object"?n(Cn()):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)})(function(n){"use strict";n.defineMode("javascript",function(e,r){var o=e.indentUnit,a=r.statementIndent,u=r.jsonld,f=r.json||u,d=r.trackScope!==!1,h=r.typescript,g=r.wordCharacters||/[\w$\xa1-\uffff]/,v=function(){function S(at){return{type:at,style:"keyword"}}var I=S("keyword a"),Z=S("keyword b"),ie=S("keyword c"),K=S("keyword d"),fe=S("operator"),Be={type:"atom",style:"atom"};return{if:S("if"),while:I,with:I,else:Z,do:Z,try:Z,finally:Z,return:K,break:K,continue:K,new:S("new"),delete:ie,void:ie,throw:ie,debugger:S("debugger"),var:S("var"),const:S("var"),let:S("var"),function:S("function"),catch:S("catch"),for:S("for"),switch:S("switch"),case:S("case"),default:S("default"),in:fe,typeof:fe,instanceof:fe,true:Be,false:Be,null:Be,undefined:Be,NaN:Be,Infinity:Be,this:S("this"),class:S("class"),super:S("atom"),yield:ie,export:S("export"),import:S("import"),extends:ie,await:ie}}(),w=/[+\-*&%=<>!?|~^@]/,x=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function T(S){for(var I=!1,Z,ie=!1;(Z=S.next())!=null;){if(!I){if(Z=="/"&&!ie)return;Z=="["?ie=!0:ie&&Z=="]"&&(ie=!1)}I=!I&&Z=="\\"}}var E,M;function F(S,I,Z){return E=S,M=Z,I}function D(S,I){var Z=S.next();if(Z=='"'||Z=="'")return I.tokenize=C(Z),I.tokenize(S,I);if(Z=="."&&S.match(/^\d[\d_]*(?:[eE][+\-]?[\d_]+)?/))return F("number","number");if(Z=="."&&S.match(".."))return F("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(Z))return F(Z);if(Z=="="&&S.eat(">"))return F("=>","operator");if(Z=="0"&&S.match(/^(?:x[\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/))return F("number","number");if(/\d/.test(Z))return S.match(/^[\d_]*(?:n|(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?/),F("number","number");if(Z=="/")return S.eat("*")?(I.tokenize=L,L(S,I)):S.eat("/")?(S.skipToEnd(),F("comment","comment")):$t(S,I,1)?(T(S),S.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),F("regexp","string-2")):(S.eat("="),F("operator","operator",S.current()));if(Z=="`")return I.tokenize=N,N(S,I);if(Z=="#"&&S.peek()=="!")return S.skipToEnd(),F("meta","meta");if(Z=="#"&&S.eatWhile(g))return F("variable","property");if(Z=="<"&&S.match("!--")||Z=="-"&&S.match("->")&&!/\S/.test(S.string.slice(0,S.start)))return S.skipToEnd(),F("comment","comment");if(w.test(Z))return(Z!=">"||!I.lexical||I.lexical.type!=">")&&(S.eat("=")?(Z=="!"||Z=="=")&&S.eat("="):/[<>*+\-|&?]/.test(Z)&&(S.eat(Z),Z==">"&&S.eat(Z))),Z=="?"&&S.eat(".")?F("."):F("operator","operator",S.current());if(g.test(Z)){S.eatWhile(g);var ie=S.current();if(I.lastType!="."){if(v.propertyIsEnumerable(ie)){var K=v[ie];return F(K.type,K.style,ie)}if(ie=="async"&&S.match(/^(\s|\/\*([^*]|\*(?!\/))*?\*\/)*[\[\(\w]/,!1))return F("async","keyword",ie)}return F("variable","variable",ie)}}function C(S){return function(I,Z){var ie=!1,K;if(u&&I.peek()=="@"&&I.match(x))return Z.tokenize=D,F("jsonld-keyword","meta");for(;(K=I.next())!=null&&!(K==S&&!ie);)ie=!ie&&K=="\\";return ie||(Z.tokenize=D),F("string","string")}}function L(S,I){for(var Z=!1,ie;ie=S.next();){if(ie=="/"&&Z){I.tokenize=D;break}Z=ie=="*"}return F("comment","comment")}function N(S,I){for(var Z=!1,ie;(ie=S.next())!=null;){if(!Z&&(ie=="`"||ie=="$"&&S.eat("{"))){I.tokenize=D;break}Z=!Z&&ie=="\\"}return F("quasi","string-2",S.current())}var B="([{}])";function O(S,I){I.fatArrowAt&&(I.fatArrowAt=null);var Z=S.string.indexOf("=>",S.start);if(!(Z<0)){if(h){var ie=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(S.string.slice(S.start,Z));ie&&(Z=ie.index)}for(var K=0,fe=!1,Be=Z-1;Be>=0;--Be){var at=S.string.charAt(Be),Et=B.indexOf(at);if(Et>=0&&Et<3){if(!K){++Be;break}if(--K==0){at=="("&&(fe=!0);break}}else if(Et>=3&&Et<6)++K;else if(g.test(at))fe=!0;else if(/["'\/`]/.test(at))for(;;--Be){if(Be==0)return;var Wr=S.string.charAt(Be-1);if(Wr==at&&S.string.charAt(Be-2)!="\\"){Be--;break}}else if(fe&&!K){++Be;break}}fe&&!K&&(I.fatArrowAt=Be)}}var z={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,import:!0,"jsonld-keyword":!0};function _(S,I,Z,ie,K,fe){this.indented=S,this.column=I,this.type=Z,this.prev=K,this.info=fe,ie!=null&&(this.align=ie)}function W(S,I){if(!d)return!1;for(var Z=S.localVars;Z;Z=Z.next)if(Z.name==I)return!0;for(var ie=S.context;ie;ie=ie.prev)for(var Z=ie.vars;Z;Z=Z.next)if(Z.name==I)return!0}function te(S,I,Z,ie,K){var fe=S.cc;for(H.state=S,H.stream=K,H.marked=null,H.cc=fe,H.style=I,S.lexical.hasOwnProperty("align")||(S.lexical.align=!0);;){var Be=fe.length?fe.pop():f?re:ae;if(Be(Z,ie)){for(;fe.length&&fe[fe.length-1].lex;)fe.pop()();return H.marked?H.marked:Z=="variable"&&W(S,ie)?"variable-2":I}}}var H={state:null,column:null,marked:null,cc:null};function X(){for(var S=arguments.length-1;S>=0;S--)H.cc.push(arguments[S])}function A(){return X.apply(null,arguments),!0}function Q(S,I){for(var Z=I;Z;Z=Z.next)if(Z.name==S)return!0;return!1}function U(S){var I=H.state;if(H.marked="def",!!d){if(I.context){if(I.lexical.info=="var"&&I.context&&I.context.block){var Z=ce(S,I.context);if(Z!=null){I.context=Z;return}}else if(!Q(S,I.localVars)){I.localVars=new _e(S,I.localVars);return}}r.globalVars&&!Q(S,I.globalVars)&&(I.globalVars=new _e(S,I.globalVars))}}function ce(S,I){if(I)if(I.block){var Z=ce(S,I.prev);return Z?Z==I.prev?I:new Le(Z,I.vars,!0):null}else return Q(S,I.vars)?I:new Le(I.prev,new _e(S,I.vars),!1);else return null}function xe(S){return S=="public"||S=="private"||S=="protected"||S=="abstract"||S=="readonly"}function Le(S,I,Z){this.prev=S,this.vars=I,this.block=Z}function _e(S,I){this.name=S,this.next=I}var et=new _e("this",new _e("arguments",null));function Ke(){H.state.context=new Le(H.state.context,H.state.localVars,!1),H.state.localVars=et}function ht(){H.state.context=new Le(H.state.context,H.state.localVars,!0),H.state.localVars=null}Ke.lex=ht.lex=!0;function Pe(){H.state.localVars=H.state.context.vars,H.state.context=H.state.context.prev}Pe.lex=!0;function ke(S,I){var Z=function(){var ie=H.state,K=ie.indented;if(ie.lexical.type=="stat")K=ie.lexical.indented;else for(var fe=ie.lexical;fe&&fe.type==")"&&fe.align;fe=fe.prev)K=fe.indented;ie.lexical=new _(K,H.stream.column(),S,null,ie.lexical,I)};return Z.lex=!0,Z}function be(){var S=H.state;S.lexical.prev&&(S.lexical.type==")"&&(S.indented=S.lexical.indented),S.lexical=S.lexical.prev)}be.lex=!0;function G(S){function I(Z){return Z==S?A():S==";"||Z=="}"||Z==")"||Z=="]"?X():A(I)}return I}function ae(S,I){return S=="var"?A(ke("vardef",I),Ir,G(";"),be):S=="keyword a"?A(ke("form"),Ae,ae,be):S=="keyword b"?A(ke("form"),ae,be):S=="keyword d"?H.stream.match(/^\s*$/,!1)?A():A(ke("stat"),We,G(";"),be):S=="debugger"?A(G(";")):S=="{"?A(ke("}"),ht,mn,be,Pe):S==";"?A():S=="if"?(H.state.lexical.info=="else"&&H.state.cc[H.state.cc.length-1]==be&&H.state.cc.pop()(),A(ke("form"),Ae,ae,be,jr)):S=="function"?A(Qt):S=="for"?A(ke("form"),ht,es,ae,Pe,be):S=="class"||h&&I=="interface"?(H.marked="keyword",A(ke("form",S=="class"?S:I),zr,be)):S=="variable"?h&&I=="declare"?(H.marked="keyword",A(ae)):h&&(I=="module"||I=="enum"||I=="type")&&H.stream.match(/^\s*\w/,!1)?(H.marked="keyword",I=="enum"?A(he):I=="type"?A(ts,G("operator"),Fe,G(";")):A(ke("form"),St,G("{"),ke("}"),mn,be,be)):h&&I=="namespace"?(H.marked="keyword",A(ke("form"),re,ae,be)):h&&I=="abstract"?(H.marked="keyword",A(ae)):A(ke("stat"),Ne):S=="switch"?A(ke("form"),Ae,G("{"),ke("}","switch"),ht,mn,be,be,Pe):S=="case"?A(re,G(":")):S=="default"?A(G(":")):S=="catch"?A(ke("form"),Ke,ne,ae,be,Pe):S=="export"?A(ke("stat"),Rr,be):S=="import"?A(ke("stat"),_n,be):S=="async"?A(ae):I=="@"?A(re,ae):X(ke("stat"),re,G(";"),be)}function ne(S){if(S=="(")return A(nn,G(")"))}function re(S,I){return we(S,I,!1)}function Ee(S,I){return we(S,I,!0)}function Ae(S){return S!="("?X():A(ke(")"),We,G(")"),be)}function we(S,I,Z){if(H.state.fatArrowAt==H.stream.start){var ie=Z?ze:Me;if(S=="(")return A(Ke,ke(")"),tt(nn,")"),be,G("=>"),ie,Pe);if(S=="variable")return X(Ke,St,G("=>"),ie,Pe)}var K=Z?$e:Te;return z.hasOwnProperty(S)?A(K):S=="function"?A(Qt,K):S=="class"||h&&I=="interface"?(H.marked="keyword",A(ke("form"),Ga,be)):S=="keyword c"||S=="async"?A(Z?Ee:re):S=="("?A(ke(")"),We,G(")"),be,K):S=="operator"||S=="spread"?A(Z?Ee:re):S=="["?A(ke("]"),Je,be,K):S=="{"?In(Dn,"}",null,K):S=="quasi"?X(st,K):S=="new"?A(V(Z)):A()}function We(S){return S.match(/[;\}\)\],]/)?X():X(re)}function Te(S,I){return S==","?A(We):$e(S,I,!1)}function $e(S,I,Z){var ie=Z==!1?Te:$e,K=Z==!1?re:Ee;if(S=="=>")return A(Ke,Z?ze:Me,Pe);if(S=="operator")return/\+\+|--/.test(I)||h&&I=="!"?A(ie):h&&I=="<"&&H.stream.match(/^([^<>]|<[^<>]*>)*>\s*\(/,!1)?A(ke(">"),tt(Fe,">"),be,ie):I=="?"?A(re,G(":"),K):A(K);if(S=="quasi")return X(st,ie);if(S!=";"){if(S=="(")return In(Ee,")","call",ie);if(S==".")return A(gt,ie);if(S=="[")return A(ke("]"),We,G("]"),be,ie);if(h&&I=="as")return H.marked="keyword",A(Fe,ie);if(S=="regexp")return H.state.lastType=H.marked="operator",H.stream.backUp(H.stream.pos-H.stream.start-1),A(K)}}function st(S,I){return S!="quasi"?X():I.slice(I.length-2)!="${"?A(st):A(We,it)}function it(S){if(S=="}")return H.marked="string-2",H.state.tokenize=N,A(st)}function Me(S){return O(H.stream,H.state),X(S=="{"?ae:re)}function ze(S){return O(H.stream,H.state),X(S=="{"?ae:Ee)}function V(S){return function(I){return I=="."?A(S?J:se):I=="variable"&&h?A(Bt,S?$e:Te):X(S?Ee:re)}}function se(S,I){if(I=="target")return H.marked="keyword",A(Te)}function J(S,I){if(I=="target")return H.marked="keyword",A($e)}function Ne(S){return S==":"?A(be,ae):X(Te,G(";"),be)}function gt(S){if(S=="variable")return H.marked="property",A()}function Dn(S,I){if(S=="async")return H.marked="property",A(Dn);if(S=="variable"||H.style=="keyword"){if(H.marked="property",I=="get"||I=="set")return A(Zo);var Z;return h&&H.state.fatArrowAt==H.stream.start&&(Z=H.stream.match(/^\s*:\s*/,!1))&&(H.state.fatArrowAt=H.stream.pos+Z[0].length),A(An)}else{if(S=="number"||S=="string")return H.marked=u?"property":H.style+" property",A(An);if(S=="jsonld-keyword")return A(An);if(h&&xe(I))return H.marked="keyword",A(Dn);if(S=="[")return A(re,jn,G("]"),An);if(S=="spread")return A(Ee,An);if(I=="*")return H.marked="keyword",A(Dn);if(S==":")return X(An)}}function Zo(S){return S!="variable"?X(An):(H.marked="property",A(Qt))}function An(S){if(S==":")return A(Ee);if(S=="(")return X(Qt)}function tt(S,I,Z){function ie(K,fe){if(Z?Z.indexOf(K)>-1:K==","){var Be=H.state.lexical;return Be.info=="call"&&(Be.pos=(Be.pos||0)+1),A(function(at,Et){return at==I||Et==I?X():X(S)},ie)}return K==I||fe==I?A():Z&&Z.indexOf(";")>-1?X(S):A(G(I))}return function(K,fe){return K==I||fe==I?A():X(S,ie)}}function In(S,I,Z){for(var ie=3;ie<arguments.length;ie++)H.cc.push(arguments[ie]);return A(ke(I,Z),tt(S,I),be)}function mn(S){return S=="}"?A():X(ae,mn)}function jn(S,I){if(h){if(S==":")return A(Fe);if(I=="?")return A(jn)}}function or(S,I){if(h&&(S==":"||I=="in"))return A(Fe)}function zn(S){if(h&&S==":")return H.stream.match(/^\s*\w+\s+is\b/,!1)?A(re,Ua,Fe):A(Fe)}function Ua(S,I){if(I=="is")return H.marked="keyword",A()}function Fe(S,I){if(I=="keyof"||I=="typeof"||I=="infer"||I=="readonly")return H.marked="keyword",A(I=="typeof"?Ee:Fe);if(S=="variable"||I=="void")return H.marked="type",A(Yt);if(I=="|"||I=="&")return A(Fe);if(S=="string"||S=="number"||S=="atom")return A(Yt);if(S=="[")return A(ke("]"),tt(Fe,"]",","),be,Yt);if(S=="{")return A(ke("}"),me,be,Yt);if(S=="(")return A(tt(Qe,")"),Xo,Yt);if(S=="<")return A(tt(Fe,">"),Fe);if(S=="quasi")return X(mt,Yt)}function Xo(S){if(S=="=>")return A(Fe)}function me(S){return S.match(/[\}\)\]]/)?A():S==","||S==";"?A(me):X(Sn,me)}function Sn(S,I){if(S=="variable"||H.style=="keyword")return H.marked="property",A(Sn);if(I=="?"||S=="number"||S=="string")return A(Sn);if(S==":")return A(Fe);if(S=="[")return A(G("variable"),or,G("]"),Sn);if(S=="(")return X(qn,Sn);if(!S.match(/[;\}\)\],]/))return A()}function mt(S,I){return S!="quasi"?X():I.slice(I.length-2)!="${"?A(mt):A(Fe,Ye)}function Ye(S){if(S=="}")return H.marked="string-2",H.state.tokenize=N,A(mt)}function Qe(S,I){return S=="variable"&&H.stream.match(/^\s*[?:]/,!1)||I=="?"?A(Qe):S==":"?A(Fe):S=="spread"?A(Qe):X(Fe)}function Yt(S,I){if(I=="<")return A(ke(">"),tt(Fe,">"),be,Yt);if(I=="|"||S=="."||I=="&")return A(Fe);if(S=="[")return A(Fe,G("]"),Yt);if(I=="extends"||I=="implements")return H.marked="keyword",A(Fe);if(I=="?")return A(Fe,G(":"),Fe)}function Bt(S,I){if(I=="<")return A(ke(">"),tt(Fe,">"),be,Yt)}function en(){return X(Fe,vt)}function vt(S,I){if(I=="=")return A(Fe)}function Ir(S,I){return I=="enum"?(H.marked="keyword",A(he)):X(St,jn,tn,Va)}function St(S,I){if(h&&xe(I))return H.marked="keyword",A(St);if(S=="variable")return U(I),A();if(S=="spread")return A(St);if(S=="[")return In(Oi,"]");if(S=="{")return In(Rn,"}")}function Rn(S,I){return S=="variable"&&!H.stream.match(/^\s*:/,!1)?(U(I),A(tn)):(S=="variable"&&(H.marked="property"),S=="spread"?A(St):S=="}"?X():S=="["?A(re,G("]"),G(":"),Rn):A(G(":"),St,tn))}function Oi(){return X(St,tn)}function tn(S,I){if(I=="=")return A(Ee)}function Va(S){if(S==",")return A(Ir)}function jr(S,I){if(S=="keyword b"&&I=="else")return A(ke("form","else"),ae,be)}function es(S,I){if(I=="await")return A(es);if(S=="(")return A(ke(")"),Pi,be)}function Pi(S){return S=="var"?A(Ir,Hn):S=="variable"?A(Hn):X(Hn)}function Hn(S,I){return S==")"?A():S==";"?A(Hn):I=="in"||I=="of"?(H.marked="keyword",A(re,Hn)):X(re,Hn)}function Qt(S,I){if(I=="*")return H.marked="keyword",A(Qt);if(S=="variable")return U(I),A(Qt);if(S=="(")return A(Ke,ke(")"),tt(nn,")"),be,zn,ae,Pe);if(h&&I=="<")return A(ke(">"),tt(en,">"),be,Qt)}function qn(S,I){if(I=="*")return H.marked="keyword",A(qn);if(S=="variable")return U(I),A(qn);if(S=="(")return A(Ke,ke(")"),tt(nn,")"),be,zn,Pe);if(h&&I=="<")return A(ke(">"),tt(en,">"),be,qn)}function ts(S,I){if(S=="keyword"||S=="variable")return H.marked="type",A(ts);if(I=="<")return A(ke(">"),tt(en,">"),be)}function nn(S,I){return I=="@"&&A(re,nn),S=="spread"?A(nn):h&&xe(I)?(H.marked="keyword",A(nn)):h&&S=="this"?A(jn,tn):X(St,jn,tn)}function Ga(S,I){return S=="variable"?zr(S,I):rn(S,I)}function zr(S,I){if(S=="variable")return U(I),A(rn)}function rn(S,I){if(I=="<")return A(ke(">"),tt(en,">"),be,rn);if(I=="extends"||I=="implements"||h&&S==",")return I=="implements"&&(H.marked="keyword"),A(h?Fe:re,rn);if(S=="{")return A(ke("}"),on,be)}function on(S,I){if(S=="async"||S=="variable"&&(I=="static"||I=="get"||I=="set"||h&&xe(I))&&H.stream.match(/^\s+#?[\w$\xa1-\uffff]/,!1))return H.marked="keyword",A(on);if(S=="variable"||H.style=="keyword")return H.marked="property",A(sr,on);if(S=="number"||S=="string")return A(sr,on);if(S=="[")return A(re,jn,G("]"),sr,on);if(I=="*")return H.marked="keyword",A(on);if(h&&S=="(")return X(qn,on);if(S==";"||S==",")return A(on);if(S=="}")return A();if(I=="@")return A(re,on)}function sr(S,I){if(I=="!"||I=="?")return A(sr);if(S==":")return A(Fe,tn);if(I=="=")return A(Ee);var Z=H.state.lexical.prev,ie=Z&&Z.info=="interface";return X(ie?qn:Qt)}function Rr(S,I){return I=="*"?(H.marked="keyword",A(_r,G(";"))):I=="default"?(H.marked="keyword",A(re,G(";"))):S=="{"?A(tt(Hr,"}"),_r,G(";")):X(ae)}function Hr(S,I){if(I=="as")return H.marked="keyword",A(G("variable"));if(S=="variable")return X(Ee,Hr)}function _n(S){return S=="string"?A():S=="("?X(re):S=="."?X(Te):X(qr,vn,_r)}function qr(S,I){return S=="{"?In(qr,"}"):(S=="variable"&&U(I),I=="*"&&(H.marked="keyword"),A(Ii))}function vn(S){if(S==",")return A(qr,vn)}function Ii(S,I){if(I=="as")return H.marked="keyword",A(qr)}function _r(S,I){if(I=="from")return H.marked="keyword",A(re)}function Je(S){return S=="]"?A():X(tt(Ee,"]"))}function he(){return X(ke("form"),St,G("{"),ke("}"),tt(En,"}"),be,be)}function En(){return X(St,tn)}function ji(S,I){return S.lastType=="operator"||S.lastType==","||w.test(I.charAt(0))||/[,.]/.test(I.charAt(0))}function $t(S,I,Z){return I.tokenize==D&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(I.lastType)||I.lastType=="quasi"&&/\{\s*$/.test(S.string.slice(0,S.pos-(Z||0)))}return{startState:function(S){var I={tokenize:D,lastType:"sof",cc:[],lexical:new _((S||0)-o,0,"block",!1),localVars:r.localVars,context:r.localVars&&new Le(null,null,!1),indented:S||0};return r.globalVars&&typeof r.globalVars=="object"&&(I.globalVars=r.globalVars),I},token:function(S,I){if(S.sol()&&(I.lexical.hasOwnProperty("align")||(I.lexical.align=!1),I.indented=S.indentation(),O(S,I)),I.tokenize!=L&&S.eatSpace())return null;var Z=I.tokenize(S,I);return E=="comment"?Z:(I.lastType=E=="operator"&&(M=="++"||M=="--")?"incdec":E,te(I,Z,E,M,S))},indent:function(S,I){if(S.tokenize==L||S.tokenize==N)return n.Pass;if(S.tokenize!=D)return 0;var Z=I&&I.charAt(0),ie=S.lexical,K;if(!/^\s*else\b/.test(I))for(var fe=S.cc.length-1;fe>=0;--fe){var Be=S.cc[fe];if(Be==be)ie=ie.prev;else if(Be!=jr&&Be!=Pe)break}for(;(ie.type=="stat"||ie.type=="form")&&(Z=="}"||(K=S.cc[S.cc.length-1])&&(K==Te||K==$e)&&!/^[,\.=+\-*:?[\(]/.test(I));)ie=ie.prev;a&&ie.type==")"&&ie.prev.type=="stat"&&(ie=ie.prev);var at=ie.type,Et=Z==at;return at=="vardef"?ie.indented+(S.lastType=="operator"||S.lastType==","?ie.info.length+1:0):at=="form"&&Z=="{"?ie.indented:at=="form"?ie.indented+o:at=="stat"?ie.indented+(ji(S,I)?a||o:0):ie.info=="switch"&&!Et&&r.doubleIndentSwitch!=!1?ie.indented+(/^(?:case|default)\b/.test(I)?o:2*o):ie.align?ie.column+(Et?0:1):ie.indented+(Et?0:o)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:f?null:"/*",blockCommentEnd:f?null:"*/",blockCommentContinue:f?null:" * ",lineComment:f?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:f?"json":"javascript",jsonldMode:u,jsonMode:f,expressionAllowed:$t,skipExpression:function(S){te(S,"atom","atom","true",new n.StringStream("",2,null))}}}),n.registerHelper("wordChars","javascript",/[\w$]/),n.defineMIME("text/javascript","javascript"),n.defineMIME("text/ecmascript","javascript"),n.defineMIME("application/javascript","javascript"),n.defineMIME("application/x-javascript","javascript"),n.defineMIME("application/ecmascript","javascript"),n.defineMIME("application/json",{name:"javascript",json:!0}),n.defineMIME("application/x-json",{name:"javascript",json:!0}),n.defineMIME("application/manifest+json",{name:"javascript",json:!0}),n.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),n.defineMIME("text/typescript",{name:"javascript",typescript:!0}),n.defineMIME("application/typescript",{name:"javascript",typescript:!0})})});var Na=wt((pO,xv)=>{function DS(n,e){switch(n.charCodeAt(e)){default:return 0;case 10:return 1;case 13:return e+1<n.length&&n.charCodeAt(e+1)===10?2:1}}xv.exports={newLineLength:DS}});var Cv=wt((hO,kv)=>{var{newLineLength:AS}=Na();kv.exports=(n,e)=>{let r=1,o=0;for(let a=0;a<n.length;a++){let u=AS(n,a);u!==0&&(e(o,a+u,r++),o=a+u,a+=u-1)}e(o,n.length,r++)}});var Av=wt((gO,Dv)=>{var{newLineLength:SS}=Na();Dv.exports=(n,e)=>{let r=1,o=0;for(let a=0;a<n.length;a++){let u=SS(n,a);u!==0&&(e(o,a,r++),o=a+u,a+=u-1)}e(o,n.length,r++)}});var Ev=wt((mO,Sv)=>{Sv.exports=function(n){if(n instanceof RegExp){let e=n.flags.indexOf("g")!==-1?n.flags:n.flags+"g",r=new RegExp(n,e);return function(o,a){let u;for(;u=r.exec(o);)a(u.index,u.index+u[0].length)}}return n=String(n),function(e,r){let o=-1;for(;o=e.indexOf(n,o+1),o!==-1;)r(o,o+n.length)}}});var Fv=wt((vO,Tv)=>{var{newLineLength:ES}=Na();Tv.exports=(n,e)=>{let r=1;for(let o=0;o<n.length;o++){let a=ES(n,o);a!==0&&(e(o,o+a,r++),o+=a-1)}}});var Mv=wt((yO,Lv)=>{Lv.exports={lines:Cv(),lineContents:Av(),matches:Ev(),newlines:Fv()}});var Ba=wt((bO,Ov)=>{function Nv(n){return Jc.call(null,n)}function Jc(n){let e=this===globalThis?{}:this||{},r={};return Object.assign(r,e,n,{fork:Jc.bind(r),ranges:Object.assign({},e.ranges,n&&n.ranges)}),typeof r.createHook!="function"&&(r.createHook=o=>o()),r}function Bv(n){let e=Object.assign({},this);for(let r in n){let o=n[r];if(!(!o||typeof o!="object"))if(hasOwnProperty.call(e,r)){let a=e[r];e[r]=a&&typeof a.fork=="function"?a.fork(n[r]):a}else e[r]=Nv(n[r])}return e.fork=Bv.bind(e),e}Ov.exports={createPrinter:Nv,forkPrinter:Jc,forkPrinterSet:Bv}});var Zc=wt((wO,Pv)=>{Pv.exports=Ba().createPrinter()});var jv=wt((xO,Iv)=>{var{createPrinter:TS}=Ba();Iv.exports=TS({print:n=>n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")})});var Rv=wt((kO,zv)=>{var{forkPrinterSet:FS}=Ba();zv.exports=FS.call({},{noop:Zc(),html:jv(),tty:Zc()})});var qv=wt((CO,Hv)=>{Hv.exports=function(e,r){let o=[];return r.forEach(({generate:a,marker:u})=>a(e,(f,d,h)=>o.push({type:u,start:f,end:d,data:h}))),o}});var Wv=wt((DO,_v)=>{var Oa=()=>"",LS=function(){};function Mr(n,e){return typeof n=="function"?n:e||LS}_v.exports=function(e,r,o){let a=Mr(o.print,L=>L),u=Object.assign(Object.defineProperties(Object.create(null),{offset:{get:()=>w},line:{get:()=>x},column:{get:()=>T},start:{get:()=>d.start},end:{get:()=>d.end},data:{get:()=>d.data}}),Mr(o.createContext)()),f=[],d={start:0,end:e.length},h=o.ranges||{},g=[],v=1/0,w=0,x=1,T=1,E="";E+=Mr(o.open,Oa)(u),h=[].concat(Object.getOwnPropertyNames(h),Object.getOwnPropertySymbols(h)).reduce((L,N)=>{let B=h[N];return typeof B=="function"&&(h[N]=B=o.createHook(B)),B&&(g.push(N),L[N]={open:Mr(B.open,Oa),close:Mr(B.close,Oa),print:Mr(B.print,a)}),L},{}),r=r.slice().sort((L,N)=>L.start-N.start||N.end-L.end||g.indexOf(L.type)-g.indexOf(N.type));let M=L=>h[(d=f[L]).type].open(u)||"",F=L=>h[(d=f[L]).type].close(u)||"",D=L=>{if(w!==L){let N=e.substring(w,L),B=f.length?h[f[f.length-1].type].print:a;for(let O=w;O<L;O++){let z=e.charCodeAt(O);z===10||z===13&&(O>=e.length||e.charCodeAt(O+1)!==10)?(x++,T=1):T++}E+=B(N,u),w=L}},C=L=>{for(;v<=L;){D(v);for(let N=f.length-1;N>=0&&f[N].end===v;N--)E+=F(N),f.pop();v=1/0;for(let N=0;N<f.length;N++)f[N].end<v&&(v=f[N].end)}};for(let L=0;L<r.length;L++){let N=r[L],B=0;if(h.hasOwnProperty(N.type)!==!1&&!(N.start>N.end||!Number.isFinite(N.start)||!Number.isFinite(N.end))){for(C(N.start),D(N.start),B=0;B<f.length;B++)if(f[B].end<N.end){for(let O=f.length-1;O>=B;O--)E+=F(O);break}for(f.splice(B,0,N);B<f.length;B++)E+=M(B);N.end<v&&(v=N.end)}}C(e.length),D(e.length);for(let L=f.length-1;L>=0;L--)E+=F(L);return E+=Mr(o.close,Oa)(u)||"",E}});var Vv=wt((AO,Uv)=>{var MS=Mv(),tf=Rv(),$v=qv(),NS=Wv();function BS(n,e){return{marker:n,generate:e}}function OS(n,e){let r={};for(let o in e)r[o]={ranges:{[n]:e[o]}};return r}function ef(n,e,r){let o=(a,u)=>{let f=e[u||r]||tf.noop,d=$v(a,n);return NS(a,d,f)};return Object.assign(o,{print:o,generateRanges(a){return $v(a,n)},use(a,u){let f=Symbol(a.name),d=a.ranges||a,h=Array.isArray(d)?(g,v)=>d.forEach(w=>v(...w)):d;return typeof h!="function"||(u||(u=a.printer),!u)?o:ef(n.concat(BS(f,h)),e.fork(OS(f,u)),r)},printer(a){return ef(n,e,a)}})}function Xc(n,e,r){let o=ef([],r||tf,e);return Array.isArray(n)&&(o=n.reduce((a,u)=>Array.isArray(u)?a.use(...u):a.use(u),o)),o}Uv.exports=Object.assign(Xc,{gen:MS,printer:Object.assign((...n)=>Xc().printer(...n),tf),use(...n){return Xc().use(...n)}})});var Yv=wt((Gv,Kv)=>{(function(n){typeof Gv=="object"&&typeof Kv=="object"?n(Cn()):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)})(function(n){"use strict";n.defineMode("css",function(_,W){var te=W.inline;W.propertyKeywords||(W=n.resolveMode("text/css"));var H=_.indentUnit,X=W.tokenHooks,A=W.documentTypes||{},Q=W.mediaTypes||{},U=W.mediaFeatures||{},ce=W.mediaValueKeywords||{},xe=W.propertyKeywords||{},Le=W.nonStandardPropertyKeywords||{},_e=W.fontProperties||{},et=W.counterDescriptors||{},Ke=W.colorKeywords||{},ht=W.valueKeywords||{},Pe=W.allowNested,ke=W.lineComment,be=W.supportsAtComponent===!0,G=_.highlightNonStandardPropertyKeywords!==!1,ae,ne;function re(V,se){return ae=se,V}function Ee(V,se){var J=V.next();if(X[J]){var Ne=X[J](V,se);if(Ne!==!1)return Ne}if(J=="@")return V.eatWhile(/[\w\\\-]/),re("def",V.current());if(J=="="||(J=="~"||J=="|")&&V.eat("="))return re(null,"compare");if(J=='"'||J=="'")return se.tokenize=Ae(J),se.tokenize(V,se);if(J=="#")return V.eatWhile(/[\w\\\-]/),re("atom","hash");if(J=="!")return V.match(/^\s*\w*/),re("keyword","important");if(/\d/.test(J)||J=="."&&V.eat(/\d/))return V.eatWhile(/[\w.%]/),re("number","unit");if(J==="-"){if(/[\d.]/.test(V.peek()))return V.eatWhile(/[\w.%]/),re("number","unit");if(V.match(/^-[\w\\\-]*/))return V.eatWhile(/[\w\\\-]/),V.match(/^\s*:/,!1)?re("variable-2","variable-definition"):re("variable-2","variable");if(V.match(/^\w+-/))return re("meta","meta")}else return/[,+>*\/]/.test(J)?re(null,"select-op"):J=="."&&V.match(/^-?[_a-z][_a-z0-9-]*/i)?re("qualifier","qualifier"):/[:;{}\[\]\(\)]/.test(J)?re(null,J):V.match(/^[\w-.]+(?=\()/)?(/^(url(-prefix)?|domain|regexp)$/i.test(V.current())&&(se.tokenize=we),re("variable callee","variable")):/[\w\\\-]/.test(J)?(V.eatWhile(/[\w\\\-]/),re("property","word")):re(null,null)}function Ae(V){return function(se,J){for(var Ne=!1,gt;(gt=se.next())!=null;){if(gt==V&&!Ne){V==")"&&se.backUp(1);break}Ne=!Ne&&gt=="\\"}return(gt==V||!Ne&&V!=")")&&(J.tokenize=null),re("string","string")}}function we(V,se){return V.next(),V.match(/^\s*[\"\')]/,!1)?se.tokenize=null:se.tokenize=Ae(")"),re(null,"(")}function We(V,se,J){this.type=V,this.indent=se,this.prev=J}function Te(V,se,J,Ne){return V.context=new We(J,se.indentation()+(Ne===!1?0:H),V.context),J}function $e(V){return V.context.prev&&(V.context=V.context.prev),V.context.type}function st(V,se,J){return ze[J.context.type](V,se,J)}function it(V,se,J,Ne){for(var gt=Ne||1;gt>0;gt--)J.context=J.context.prev;return st(V,se,J)}function Me(V){var se=V.current().toLowerCase();ht.hasOwnProperty(se)?ne="atom":Ke.hasOwnProperty(se)?ne="keyword":ne="variable"}var ze={};return ze.top=function(V,se,J){if(V=="{")return Te(J,se,"block");if(V=="}"&&J.context.prev)return $e(J);if(be&&/@component/i.test(V))return Te(J,se,"atComponentBlock");if(/^@(-moz-)?document$/i.test(V))return Te(J,se,"documentTypes");if(/^@(media|supports|(-moz-)?document|import)$/i.test(V))return Te(J,se,"atBlock");if(/^@(font-face|counter-style)/i.test(V))return J.stateArg=V,"restricted_atBlock_before";if(/^@(-(moz|ms|o|webkit)-)?keyframes$/i.test(V))return"keyframes";if(V&&V.charAt(0)=="@")return Te(J,se,"at");if(V=="hash")ne="builtin";else if(V=="word")ne="tag";else{if(V=="variable-definition")return"maybeprop";if(V=="interpolation")return Te(J,se,"interpolation");if(V==":")return"pseudo";if(Pe&&V=="(")return Te(J,se,"parens")}return J.context.type},ze.block=function(V,se,J){if(V=="word"){var Ne=se.current().toLowerCase();return xe.hasOwnProperty(Ne)?(ne="property","maybeprop"):Le.hasOwnProperty(Ne)?(ne=G?"string-2":"property","maybeprop"):Pe?(ne=se.match(/^\s*:(?:\s|$)/,!1)?"property":"tag","block"):(ne+=" error","maybeprop")}else return V=="meta"?"block":!Pe&&(V=="hash"||V=="qualifier")?(ne="error","block"):ze.top(V,se,J)},ze.maybeprop=function(V,se,J){return V==":"?Te(J,se,"prop"):st(V,se,J)},ze.prop=function(V,se,J){if(V==";")return $e(J);if(V=="{"&&Pe)return Te(J,se,"propBlock");if(V=="}"||V=="{")return it(V,se,J);if(V=="(")return Te(J,se,"parens");if(V=="hash"&&!/^#([0-9a-fA-F]{3,4}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/.test(se.current()))ne+=" error";else if(V=="word")Me(se);else if(V=="interpolation")return Te(J,se,"interpolation");return"prop"},ze.propBlock=function(V,se,J){return V=="}"?$e(J):V=="word"?(ne="property","maybeprop"):J.context.type},ze.parens=function(V,se,J){return V=="{"||V=="}"?it(V,se,J):V==")"?$e(J):V=="("?Te(J,se,"parens"):V=="interpolation"?Te(J,se,"interpolation"):(V=="word"&&Me(se),"parens")},ze.pseudo=function(V,se,J){return V=="meta"?"pseudo":V=="word"?(ne="variable-3",J.context.type):st(V,se,J)},ze.documentTypes=function(V,se,J){return V=="word"&&A.hasOwnProperty(se.current())?(ne="tag",J.context.type):ze.atBlock(V,se,J)},ze.atBlock=function(V,se,J){if(V=="(")return Te(J,se,"atBlock_parens");if(V=="}"||V==";")return it(V,se,J);if(V=="{")return $e(J)&&Te(J,se,Pe?"block":"top");if(V=="interpolation")return Te(J,se,"interpolation");if(V=="word"){var Ne=se.current().toLowerCase();Ne=="only"||Ne=="not"||Ne=="and"||Ne=="or"?ne="keyword":Q.hasOwnProperty(Ne)?ne="attribute":U.hasOwnProperty(Ne)?ne="property":ce.hasOwnProperty(Ne)?ne="keyword":xe.hasOwnProperty(Ne)?ne="property":Le.hasOwnProperty(Ne)?ne=G?"string-2":"property":ht.hasOwnProperty(Ne)?ne="atom":Ke.hasOwnProperty(Ne)?ne="keyword":ne="error"}return J.context.type},ze.atComponentBlock=function(V,se,J){return V=="}"?it(V,se,J):V=="{"?$e(J)&&Te(J,se,Pe?"block":"top",!1):(V=="word"&&(ne="error"),J.context.type)},ze.atBlock_parens=function(V,se,J){return V==")"?$e(J):V=="{"||V=="}"?it(V,se,J,2):ze.atBlock(V,se,J)},ze.restricted_atBlock_before=function(V,se,J){return V=="{"?Te(J,se,"restricted_atBlock"):V=="word"&&J.stateArg=="@counter-style"?(ne="variable","restricted_atBlock_before"):st(V,se,J)},ze.restricted_atBlock=function(V,se,J){return V=="}"?(J.stateArg=null,$e(J)):V=="word"?(J.stateArg=="@font-face"&&!_e.hasOwnProperty(se.current().toLowerCase())||J.stateArg=="@counter-style"&&!et.hasOwnProperty(se.current().toLowerCase())?ne="error":ne="property","maybeprop"):"restricted_atBlock"},ze.keyframes=function(V,se,J){return V=="word"?(ne="variable","keyframes"):V=="{"?Te(J,se,"top"):st(V,se,J)},ze.at=function(V,se,J){return V==";"?$e(J):V=="{"||V=="}"?it(V,se,J):(V=="word"?ne="tag":V=="hash"&&(ne="builtin"),"at")},ze.interpolation=function(V,se,J){return V=="}"?$e(J):V=="{"||V==";"?it(V,se,J):(V=="word"?ne="variable":V!="variable"&&V!="("&&V!=")"&&(ne="error"),"interpolation")},{startState:function(V){return{tokenize:null,state:te?"block":"top",stateArg:null,context:new We(te?"block":"top",V||0,null)}},token:function(V,se){if(!se.tokenize&&V.eatSpace())return null;var J=(se.tokenize||Ee)(V,se);return J&&typeof J=="object"&&(ae=J[1],J=J[0]),ne=J,ae!="comment"&&(se.state=ze[se.state](ae,V,se)),ne},indent:function(V,se){var J=V.context,Ne=se&&se.charAt(0),gt=J.indent;return J.type=="prop"&&(Ne=="}"||Ne==")")&&(J=J.prev),J.prev&&(Ne=="}"&&(J.type=="block"||J.type=="top"||J.type=="interpolation"||J.type=="restricted_atBlock")?(J=J.prev,gt=J.indent):(Ne==")"&&(J.type=="parens"||J.type=="atBlock_parens")||Ne=="{"&&(J.type=="at"||J.type=="atBlock"))&&(gt=Math.max(0,J.indent-H))),gt},electricChars:"}",blockCommentStart:"/*",blockCommentEnd:"*/",blockCommentContinue:" * ",lineComment:ke,fold:"brace"}});function e(_){for(var W={},te=0;te<_.length;++te)W[_[te].toLowerCase()]=!0;return W}var r=["domain","regexp","url","url-prefix"],o=e(r),a=["all","aural","braille","handheld","print","projection","screen","tty","tv","embossed"],u=e(a),f=["width","min-width","max-width","height","min-height","max-height","device-width","min-device-width","max-device-width","device-height","min-device-height","max-device-height","aspect-ratio","min-aspect-ratio","max-aspect-ratio","device-aspect-ratio","min-device-aspect-ratio","max-device-aspect-ratio","color","min-color","max-color","color-index","min-color-index","max-color-index","monochrome","min-monochrome","max-monochrome","resolution","min-resolution","max-resolution","scan","grid","orientation","device-pixel-ratio","min-device-pixel-ratio","max-device-pixel-ratio","pointer","any-pointer","hover","any-hover","prefers-color-scheme","dynamic-range","video-dynamic-range"],d=e(f),h=["landscape","portrait","none","coarse","fine","on-demand","hover","interlace","progressive","dark","light","standard","high"],g=e(h),v=["align-content","align-items","align-self","alignment-adjust","alignment-baseline","all","anchor-point","animation","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","appearance","azimuth","backdrop-filter","backface-visibility","background","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-position-x","background-position-y","background-repeat","background-size","baseline-shift","binding","bleed","block-size","bookmark-label","bookmark-level","bookmark-state","bookmark-target","border","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","caret-color","clear","clip","color","color-profile","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","contain","content","counter-increment","counter-reset","crop","cue","cue-after","cue-before","cursor","direction","display","dominant-baseline","drop-initial-after-adjust","drop-initial-after-align","drop-initial-before-adjust","drop-initial-before-align","drop-initial-size","drop-initial-value","elevation","empty-cells","fit","fit-content","fit-position","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","float-offset","flow-from","flow-into","font","font-family","font-feature-settings","font-kerning","font-language-override","font-optical-sizing","font-size","font-size-adjust","font-stretch","font-style","font-synthesis","font-variant","font-variant-alternates","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-variation-settings","font-weight","gap","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-rows","grid-column","grid-column-end","grid-column-gap","grid-column-start","grid-gap","grid-row","grid-row-end","grid-row-gap","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphens","icon","image-orientation","image-rendering","image-resolution","inline-box-align","inset","inset-block","inset-block-end","inset-block-start","inset-inline","inset-inline-end","inset-inline-start","isolation","justify-content","justify-items","justify-self","left","letter-spacing","line-break","line-height","line-height-step","line-stacking","line-stacking-ruby","line-stacking-shift","line-stacking-strategy","list-style","list-style-image","list-style-position","list-style-type","margin","margin-bottom","margin-left","margin-right","margin-top","marks","marquee-direction","marquee-loop","marquee-play-count","marquee-speed","marquee-style","mask-clip","mask-composite","mask-image","mask-mode","mask-origin","mask-position","mask-repeat","mask-size","mask-type","max-block-size","max-height","max-inline-size","max-width","min-block-size","min-height","min-inline-size","min-width","mix-blend-mode","move-to","nav-down","nav-index","nav-left","nav-right","nav-up","object-fit","object-position","offset","offset-anchor","offset-distance","offset-path","offset-position","offset-rotate","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-style","overflow-wrap","overflow-x","overflow-y","padding","padding-bottom","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","page-break-inside","page-policy","pause","pause-after","pause-before","perspective","perspective-origin","pitch","pitch-range","place-content","place-items","place-self","play-during","position","presentation-level","punctuation-trim","quotes","region-break-after","region-break-before","region-break-inside","region-fragment","rendering-intent","resize","rest","rest-after","rest-before","richness","right","rotate","rotation","rotation-point","row-gap","ruby-align","ruby-overhang","ruby-position","ruby-span","scale","scroll-behavior","scroll-margin","scroll-margin-block","scroll-margin-block-end","scroll-margin-block-start","scroll-margin-bottom","scroll-margin-inline","scroll-margin-inline-end","scroll-margin-inline-start","scroll-margin-left","scroll-margin-right","scroll-margin-top","scroll-padding","scroll-padding-block","scroll-padding-block-end","scroll-padding-block-start","scroll-padding-bottom","scroll-padding-inline","scroll-padding-inline-end","scroll-padding-inline-start","scroll-padding-left","scroll-padding-right","scroll-padding-top","scroll-snap-align","scroll-snap-type","shape-image-threshold","shape-inside","shape-margin","shape-outside","size","speak","speak-as","speak-header","speak-numeral","speak-punctuation","speech-rate","stress","string-set","tab-size","table-layout","target","target-name","target-new","target-position","text-align","text-align-last","text-combine-upright","text-decoration","text-decoration-color","text-decoration-line","text-decoration-skip","text-decoration-skip-ink","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-height","text-indent","text-justify","text-orientation","text-outline","text-overflow","text-rendering","text-shadow","text-size-adjust","text-space-collapse","text-transform","text-underline-position","text-wrap","top","touch-action","transform","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","translate","unicode-bidi","user-select","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","volume","white-space","widows","width","will-change","word-break","word-spacing","word-wrap","writing-mode","z-index","clip-path","clip-rule","mask","enable-background","filter","flood-color","flood-opacity","lighting-color","stop-color","stop-opacity","pointer-events","color-interpolation","color-interpolation-filters","color-rendering","fill","fill-opacity","fill-rule","image-rendering","marker","marker-end","marker-mid","marker-start","paint-order","shape-rendering","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-rendering","baseline-shift","dominant-baseline","glyph-orientation-horizontal","glyph-orientation-vertical","text-anchor","writing-mode"],w=e(v),x=["accent-color","aspect-ratio","border-block","border-block-color","border-block-end","border-block-end-color","border-block-end-style","border-block-end-width","border-block-start","border-block-start-color","border-block-start-style","border-block-start-width","border-block-style","border-block-width","border-inline","border-inline-color","border-inline-end","border-inline-end-color","border-inline-end-style","border-inline-end-width","border-inline-start","border-inline-start-color","border-inline-start-style","border-inline-start-width","border-inline-style","border-inline-width","content-visibility","margin-block","margin-block-end","margin-block-start","margin-inline","margin-inline-end","margin-inline-start","overflow-anchor","overscroll-behavior","padding-block","padding-block-end","padding-block-start","padding-inline","padding-inline-end","padding-inline-start","scroll-snap-stop","scrollbar-3d-light-color","scrollbar-arrow-color","scrollbar-base-color","scrollbar-dark-shadow-color","scrollbar-face-color","scrollbar-highlight-color","scrollbar-shadow-color","scrollbar-track-color","searchfield-cancel-button","searchfield-decoration","searchfield-results-button","searchfield-results-decoration","shape-inside","zoom"],T=e(x),E=["font-display","font-family","src","unicode-range","font-variant","font-feature-settings","font-stretch","font-weight","font-style"],M=e(E),F=["additive-symbols","fallback","negative","pad","prefix","range","speak-as","suffix","symbols","system"],D=e(F),C=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"],L=e(C),N=["above","absolute","activeborder","additive","activecaption","afar","after-white-space","ahead","alias","all","all-scroll","alphabetic","alternate","always","amharic","amharic-abegede","antialiased","appworkspace","arabic-indic","armenian","asterisks","attr","auto","auto-flow","avoid","avoid-column","avoid-page","avoid-region","axis-pan","background","backwards","baseline","below","bidi-override","binary","bengali","blink","block","block-axis","blur","bold","bolder","border","border-box","both","bottom","break","break-all","break-word","brightness","bullets","button","buttonface","buttonhighlight","buttonshadow","buttontext","calc","cambodian","capitalize","caps-lock-indicator","caption","captiontext","caret","cell","center","checkbox","circle","cjk-decimal","cjk-earthly-branch","cjk-heavenly-stem","cjk-ideographic","clear","clip","close-quote","col-resize","collapse","color","color-burn","color-dodge","column","column-reverse","compact","condensed","conic-gradient","contain","content","contents","content-box","context-menu","continuous","contrast","copy","counter","counters","cover","crop","cross","crosshair","cubic-bezier","currentcolor","cursive","cyclic","darken","dashed","decimal","decimal-leading-zero","default","default-button","dense","destination-atop","destination-in","destination-out","destination-over","devanagari","difference","disc","discard","disclosure-closed","disclosure-open","document","dot-dash","dot-dot-dash","dotted","double","down","drop-shadow","e-resize","ease","ease-in","ease-in-out","ease-out","element","ellipse","ellipsis","embed","end","ethiopic","ethiopic-abegede","ethiopic-abegede-am-et","ethiopic-abegede-gez","ethiopic-abegede-ti-er","ethiopic-abegede-ti-et","ethiopic-halehame-aa-er","ethiopic-halehame-aa-et","ethiopic-halehame-am-et","ethiopic-halehame-gez","ethiopic-halehame-om-et","ethiopic-halehame-sid-et","ethiopic-halehame-so-et","ethiopic-halehame-ti-er","ethiopic-halehame-ti-et","ethiopic-halehame-tig","ethiopic-numeric","ew-resize","exclusion","expanded","extends","extra-condensed","extra-expanded","fantasy","fast","fill","fill-box","fixed","flat","flex","flex-end","flex-start","footnotes","forwards","from","geometricPrecision","georgian","grayscale","graytext","grid","groove","gujarati","gurmukhi","hand","hangul","hangul-consonant","hard-light","hebrew","help","hidden","hide","higher","highlight","highlighttext","hiragana","hiragana-iroha","horizontal","hsl","hsla","hue","hue-rotate","icon","ignore","inactiveborder","inactivecaption","inactivecaptiontext","infinite","infobackground","infotext","inherit","initial","inline","inline-axis","inline-block","inline-flex","inline-grid","inline-table","inset","inside","intrinsic","invert","italic","japanese-formal","japanese-informal","justify","kannada","katakana","katakana-iroha","keep-all","khmer","korean-hangul-formal","korean-hanja-formal","korean-hanja-informal","landscape","lao","large","larger","left","level","lighter","lighten","line-through","linear","linear-gradient","lines","list-item","listbox","listitem","local","logical","loud","lower","lower-alpha","lower-armenian","lower-greek","lower-hexadecimal","lower-latin","lower-norwegian","lower-roman","lowercase","ltr","luminosity","malayalam","manipulation","match","matrix","matrix3d","media-play-button","media-slider","media-sliderthumb","media-volume-slider","media-volume-sliderthumb","medium","menu","menulist","menulist-button","menutext","message-box","middle","min-intrinsic","mix","mongolian","monospace","move","multiple","multiple_mask_images","multiply","myanmar","n-resize","narrower","ne-resize","nesw-resize","no-close-quote","no-drop","no-open-quote","no-repeat","none","normal","not-allowed","nowrap","ns-resize","numbers","numeric","nw-resize","nwse-resize","oblique","octal","opacity","open-quote","optimizeLegibility","optimizeSpeed","oriya","oromo","outset","outside","outside-shape","overlay","overline","padding","padding-box","painted","page","paused","persian","perspective","pinch-zoom","plus-darker","plus-lighter","pointer","polygon","portrait","pre","pre-line","pre-wrap","preserve-3d","progress","push-button","radial-gradient","radio","read-only","read-write","read-write-plaintext-only","rectangle","region","relative","repeat","repeating-linear-gradient","repeating-radial-gradient","repeating-conic-gradient","repeat-x","repeat-y","reset","reverse","rgb","rgba","ridge","right","rotate","rotate3d","rotateX","rotateY","rotateZ","round","row","row-resize","row-reverse","rtl","run-in","running","s-resize","sans-serif","saturate","saturation","scale","scale3d","scaleX","scaleY","scaleZ","screen","scroll","scrollbar","scroll-position","se-resize","searchfield","searchfield-cancel-button","searchfield-decoration","searchfield-results-button","searchfield-results-decoration","self-start","self-end","semi-condensed","semi-expanded","separate","sepia","serif","show","sidama","simp-chinese-formal","simp-chinese-informal","single","skew","skewX","skewY","skip-white-space","slide","slider-horizontal","slider-vertical","sliderthumb-horizontal","sliderthumb-vertical","slow","small","small-caps","small-caption","smaller","soft-light","solid","somali","source-atop","source-in","source-out","source-over","space","space-around","space-between","space-evenly","spell-out","square","square-button","start","static","status-bar","stretch","stroke","stroke-box","sub","subpixel-antialiased","svg_masks","super","sw-resize","symbolic","symbols","system-ui","table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row","table-row-group","tamil","telugu","text","text-bottom","text-top","textarea","textfield","thai","thick","thin","threeddarkshadow","threedface","threedhighlight","threedlightshadow","threedshadow","tibetan","tigre","tigrinya-er","tigrinya-er-abegede","tigrinya-et","tigrinya-et-abegede","to","top","trad-chinese-formal","trad-chinese-informal","transform","translate","translate3d","translateX","translateY","translateZ","transparent","ultra-condensed","ultra-expanded","underline","unidirectional-pan","unset","up","upper-alpha","upper-armenian","upper-greek","upper-hexadecimal","upper-latin","upper-norwegian","upper-roman","uppercase","urdu","url","var","vertical","vertical-text","view-box","visible","visibleFill","visiblePainted","visibleStroke","visual","w-resize","wait","wave","wider","window","windowframe","windowtext","words","wrap","wrap-reverse","x-large","x-small","xor","xx-large","xx-small"],B=e(N),O=r.concat(a).concat(f).concat(h).concat(v).concat(x).concat(C).concat(N);n.registerHelper("hintWords","css",O);function z(_,W){for(var te=!1,H;(H=_.next())!=null;){if(te&&H=="/"){W.tokenize=null;break}te=H=="*"}return["comment","comment"]}n.defineMIME("text/css",{documentTypes:o,mediaTypes:u,mediaFeatures:d,mediaValueKeywords:g,propertyKeywords:w,nonStandardPropertyKeywords:T,fontProperties:M,counterDescriptors:D,colorKeywords:L,valueKeywords:B,tokenHooks:{"/":function(_,W){return _.eat("*")?(W.tokenize=z,z(_,W)):!1}},name:"css"}),n.defineMIME("text/x-scss",{mediaTypes:u,mediaFeatures:d,mediaValueKeywords:g,propertyKeywords:w,nonStandardPropertyKeywords:T,colorKeywords:L,valueKeywords:B,fontProperties:M,allowNested:!0,lineComment:"//",tokenHooks:{"/":function(_,W){return _.eat("/")?(_.skipToEnd(),["comment","comment"]):_.eat("*")?(W.tokenize=z,z(_,W)):["operator","operator"]},":":function(_){return _.match(/^\s*\{/,!1)?[null,null]:!1},$:function(_){return _.match(/^[\w-]+/),_.match(/^\s*:/,!1)?["variable-2","variable-definition"]:["variable-2","variable"]},"#":function(_){return _.eat("{")?[null,"interpolation"]:!1}},name:"css",helperType:"scss"}),n.defineMIME("text/x-less",{mediaTypes:u,mediaFeatures:d,mediaValueKeywords:g,propertyKeywords:w,nonStandardPropertyKeywords:T,colorKeywords:L,valueKeywords:B,fontProperties:M,allowNested:!0,lineComment:"//",tokenHooks:{"/":function(_,W){return _.eat("/")?(_.skipToEnd(),["comment","comment"]):_.eat("*")?(W.tokenize=z,z(_,W)):["operator","operator"]},"@":function(_){return _.eat("{")?[null,"interpolation"]:_.match(/^(charset|document|font-face|import|(-(moz|ms|o|webkit)-)?keyframes|media|namespace|page|supports)\b/i,!1)?!1:(_.eatWhile(/[\w\\\-]/),_.match(/^\s*:/,!1)?["variable-2","variable-definition"]:["variable-2","variable"])},"&":function(){return["atom","atom"]}},name:"css",helperType:"less"}),n.defineMIME("text/x-gss",{documentTypes:o,mediaTypes:u,mediaFeatures:d,propertyKeywords:w,nonStandardPropertyKeywords:T,fontProperties:M,counterDescriptors:D,colorKeywords:L,valueKeywords:B,supportsAtComponent:!0,tokenHooks:{"/":function(_,W){return _.eat("*")?(W.tokenize=z,z(_,W)):!1}},name:"css",helperType:"gss"})})});var Zv=wt((Qv,Jv)=>{(function(n){typeof Qv=="object"&&typeof Jv=="object"?n(Cn()):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)})(function(n){"use strict";var e={autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,menuitem:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!0,caseFold:!0},r={autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1,allowMissingTagName:!1,caseFold:!1};n.defineMode("xml",function(o,a){var u=o.indentUnit,f={},d=a.htmlMode?e:r;for(var h in d)f[h]=d[h];for(var h in a)f[h]=a[h];var g,v;function w(A,Q){function U(Le){return Q.tokenize=Le,Le(A,Q)}var ce=A.next();if(ce=="<")return A.eat("!")?A.eat("[")?A.match("CDATA[")?U(E("atom","]]>")):null:A.match("--")?U(E("comment","-->")):A.match("DOCTYPE",!0,!0)?(A.eatWhile(/[\w\._\-]/),U(M(1))):null:A.eat("?")?(A.eatWhile(/[\w\._\-]/),Q.tokenize=E("meta","?>"),"meta"):(g=A.eat("/")?"closeTag":"openTag",Q.tokenize=x,"tag bracket");if(ce=="&"){var xe;return A.eat("#")?A.eat("x")?xe=A.eatWhile(/[a-fA-F\d]/)&&A.eat(";"):xe=A.eatWhile(/[\d]/)&&A.eat(";"):xe=A.eatWhile(/[\w\.\-:]/)&&A.eat(";"),xe?"atom":"error"}else return A.eatWhile(/[^&<]/),null}w.isInText=!0;function x(A,Q){var U=A.next();if(U==">"||U=="/"&&A.eat(">"))return Q.tokenize=w,g=U==">"?"endTag":"selfcloseTag","tag bracket";if(U=="=")return g="equals",null;if(U=="<"){Q.tokenize=w,Q.state=N,Q.tagName=Q.tagStart=null;var ce=Q.tokenize(A,Q);return ce?ce+" tag error":"tag error"}else return/[\'\"]/.test(U)?(Q.tokenize=T(U),Q.stringStartCol=A.column(),Q.tokenize(A,Q)):(A.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/),"word")}function T(A){var Q=function(U,ce){for(;!U.eol();)if(U.next()==A){ce.tokenize=x;break}return"string"};return Q.isInAttribute=!0,Q}function E(A,Q){return function(U,ce){for(;!U.eol();){if(U.match(Q)){ce.tokenize=w;break}U.next()}return A}}function M(A){return function(Q,U){for(var ce;(ce=Q.next())!=null;){if(ce=="<")return U.tokenize=M(A+1),U.tokenize(Q,U);if(ce==">")if(A==1){U.tokenize=w;break}else return U.tokenize=M(A-1),U.tokenize(Q,U)}return"meta"}}function F(A){return A&&A.toLowerCase()}function D(A,Q,U){this.prev=A.context,this.tagName=Q||"",this.indent=A.indented,this.startOfLine=U,(f.doNotIndent.hasOwnProperty(Q)||A.context&&A.context.noIndent)&&(this.noIndent=!0)}function C(A){A.context&&(A.context=A.context.prev)}function L(A,Q){for(var U;;){if(!A.context||(U=A.context.tagName,!f.contextGrabbers.hasOwnProperty(F(U))||!f.contextGrabbers[F(U)].hasOwnProperty(F(Q))))return;C(A)}}function N(A,Q,U){return A=="openTag"?(U.tagStart=Q.column(),B):A=="closeTag"?O:N}function B(A,Q,U){return A=="word"?(U.tagName=Q.current(),v="tag",W):f.allowMissingTagName&&A=="endTag"?(v="tag bracket",W(A,Q,U)):(v="error",B)}function O(A,Q,U){if(A=="word"){var ce=Q.current();return U.context&&U.context.tagName!=ce&&f.implicitlyClosed.hasOwnProperty(F(U.context.tagName))&&C(U),U.context&&U.context.tagName==ce||f.matchClosing===!1?(v="tag",z):(v="tag error",_)}else return f.allowMissingTagName&&A=="endTag"?(v="tag bracket",z(A,Q,U)):(v="error",_)}function z(A,Q,U){return A!="endTag"?(v="error",z):(C(U),N)}function _(A,Q,U){return v="error",z(A,Q,U)}function W(A,Q,U){if(A=="word")return v="attribute",te;if(A=="endTag"||A=="selfcloseTag"){var ce=U.tagName,xe=U.tagStart;return U.tagName=U.tagStart=null,A=="selfcloseTag"||f.autoSelfClosers.hasOwnProperty(F(ce))?L(U,ce):(L(U,ce),U.context=new D(U,ce,xe==U.indented)),N}return v="error",W}function te(A,Q,U){return A=="equals"?H:(f.allowMissing||(v="error"),W(A,Q,U))}function H(A,Q,U){return A=="string"?X:A=="word"&&f.allowUnquoted?(v="string",W):(v="error",W(A,Q,U))}function X(A,Q,U){return A=="string"?X:W(A,Q,U)}return{startState:function(A){var Q={tokenize:w,state:N,indented:A||0,tagName:null,tagStart:null,context:null};return A!=null&&(Q.baseIndent=A),Q},token:function(A,Q){if(!Q.tagName&&A.sol()&&(Q.indented=A.indentation()),A.eatSpace())return null;g=null;var U=Q.tokenize(A,Q);return(U||g)&&U!="comment"&&(v=null,Q.state=Q.state(g||U,A,Q),v&&(U=v=="error"?U+" error":v)),U},indent:function(A,Q,U){var ce=A.context;if(A.tokenize.isInAttribute)return A.tagStart==A.indented?A.stringStartCol+1:A.indented+u;if(ce&&ce.noIndent)return n.Pass;if(A.tokenize!=x&&A.tokenize!=w)return U?U.match(/^(\s*)/)[0].length:0;if(A.tagName)return f.multilineTagIndentPastTag!==!1?A.tagStart+A.tagName.length+2:A.tagStart+u*(f.multilineTagIndentFactor||1);if(f.alignCDATA&&/<!\[CDATA\[/.test(Q))return 0;var xe=Q&&/^<(\/)?([\w_:\.-]*)/.exec(Q);if(xe&&xe[1])for(;ce;)if(ce.tagName==xe[2]){ce=ce.prev;break}else if(f.implicitlyClosed.hasOwnProperty(F(ce.tagName)))ce=ce.prev;else break;else if(xe)for(;ce;){var Le=f.contextGrabbers[F(ce.tagName)];if(Le&&Le.hasOwnProperty(F(xe[2])))ce=ce.prev;else break}for(;ce&&ce.prev&&!ce.startOfLine;)ce=ce.prev;return ce?ce.indent+u:A.baseIndent||0},electricInput:/<\/[\s\w:]+>$/,blockCommentStart:"<!--",blockCommentEnd:"-->",configuration:f.htmlMode?"html":"xml",helperType:f.htmlMode?"html":"xml",skipAttribute:function(A){A.state==H&&(A.state=W)},xmlCurrentTag:function(A){return A.tagName?{name:A.tagName,close:A.type=="closeTag"}:null},xmlCurrentContext:function(A){for(var Q=[],U=A.context;U;U=U.prev)Q.push(U.tagName);return Q.reverse()}}}),n.defineMIME("text/xml","xml"),n.defineMIME("application/xml","xml"),n.mimeModes.hasOwnProperty("text/html")||n.defineMIME("text/html",{name:"xml",htmlMode:!0})})});function bp(n){let e=[].filter(r=>{if(typeof r=="function")return!0;console.warn('[discovery-cli] "prepare" module should return a function, but got '+typeof r)});e.length&&n.setPrepare(async(r,...o)=>{for(let a of e)r=await a(r,...o)||r;return r})}var ql=null;var wp=[];var Cp=[(kp(),O0(xp))];var _l="1.0.0-beta.95";var Dp="1.0.0-beta.13";var Dt=Object.hasOwn||((n,e)=>Object.hasOwnProperty.call(n,e)),I0=Object.prototype.toString;function ui(n,e){return e!==void 0&&(je(e)?e.forEach(r=>n.add(r)):n.add(e)),n}function Bs(n,e,r){n.has(e)?n.get(e).add(r):n.set(e,new Set([r]))}function Ap(n,e){return n&&Dt(n,e)?n[e]:void 0}function fn(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function Zn(n){return I0.call(n)==="[object RegExp]"}function On(n){return n&&(je(n)||Dt(n,"length")&&isFinite(n.length))}function je(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function vr(n,e=0){let r=parseInt(n,10);return isNaN(r)?e:r}function Vt(n){if(je(n))return n.length>0;if(fn(n)){for(let e in n)if(Dt(n,e))return!0;return!1}return!!n}var j0=function(){return{yy:{},options:{ranges:!0},rules:[/^(?:\/\/.*?(?:\n|\r\n?|\u2028|\u2029|$)|\/\*(?:.|\s)*?(?:\*\/|$))/,/^\s+/,/^\//,/^<(?!=)/,/^/,/^(?:(?:[a-zA-Z_]|\\u[0-9a-fA-F]{4})(?:[a-zA-Z_$0-9]|\\u[0-9a-fA-F]{4})*\(?)/,/^/,(e,r)=>{if(e[0]!==(r==="template"?"}":"`"))return null;for(let o=1;o<e.length;o++){if(e[o]==="`")return o+1;if(e[o]==="$"&&e[o+1]==="{")return o+2;e[o]==="\\"&&o++}return null},(e,r)=>{if(e[0]!==(r==="template"?"}":"`"))return null;for(let o=1;o<e.length;o++){if(e[o]==="`")return o+1;if(e[o]==="$"&&e[o+1]==="{")return o+2;e[o]==="\\"&&o++}return null},/^/,/^\(/,/^\)/,/^\[/,/^\]/,/^\{/,/^\}/,/^(?:(true|false|null|undefined|Infinity|NaN)\b)/,/^and\b/,/^or\b/,/^is\b/,/^has\s+no\b/,/^has\b/,/^in\b/,/^not\s+in\b/,/^not\b/,/^no\b/,/^(?:(asc|desc)(NA?|AN?)?\b)/,/^(?:(?:[a-zA-Z_]|\\u[0-9a-fA-F]{4})(?:[a-zA-Z_$0-9]|\\u[0-9a-fA-F]{4})*\()/,/^(?:\$(?:[a-zA-Z_]|\\u[0-9a-fA-F]{4})(?:[a-zA-Z_$0-9]|\\u[0-9a-fA-F]{4})*\()/,/^(?:(?:[a-zA-Z_]|\\u[0-9a-fA-F]{4})(?:[a-zA-Z_$0-9]|\\u[0-9a-fA-F]{4})*)/,/^(?:\$(?:[a-zA-Z_]|\\u[0-9a-fA-F]{4})(?:[a-zA-Z_$0-9]|\\u[0-9a-fA-F]{4})*)/,/^(?:[_\d]*\.)?[_\d]+(?:[eE][-+]?[_\d]+)?\b/,/^(?:\d*\.)?\d+(?:[eE][-+]?\d+)?\b/,/^0[xX][_0-9a-fA-F]+/,/^0[xX][0-9a-fA-F]+/,/^(?:"(?:\\[\\"]|[^"])*")/,/^(?:'(?:\\[\\']|[^'])*')/,/^(?:\/(?:\\.|[^/])+\/[gimsu]*)/,/^@/,/^#/,/^\$\$/,/^\$/,/^=>/,/^=/,/^!=/,/^~=/,/^>=/,/^<=/,/^</,/^>/,/^\.\.\(/,/^\.\(/,/^\.\[/,/^\.\.\./,/^\.\./,/^\./,/^\?\?/,/^\?/,/^,/,/^:/,/^;/,/^\-/,/^\+/,/^\*/,/^\//,/^\%/,/^(?:\|)/,/^./,/^$/],conditions:{preventPrimitive:{rules:[0,1,2,3,4,7,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68],inclusive:!0},preventKeyword:{rules:[5,6],inclusive:!1},template:{rules:[8,9],inclusive:!1},INITIAL:{rules:[0,1,7,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68],inclusive:!0}},performAction(e,r,o,a){let u=a;switch(o){case 0:{e.commentRanges.push(r.yylloc.range);break}case 1:break;case 2:{return this.popState(),40;break}case 3:{return this.popState(),44;break}case 4:{this.done=!1,this.popState();break}case 5:{if(this.popState(),r.yytext.endsWith("(")){this.unput(r.yytext);return}return e.pps(),r.yytext=this.ident(r.yytext),14;break}case 6:{this.done=!1,this.popState();break}case 7:{let f=r.yytext.endsWith("`")?"TEMPLATE":"TPL_START";return r.yytext=this.toStringLiteral(r.yytext,!0,1+ +(f!=="TEMPLATE")),f==="TEMPLATE"&&e.pps(),f;break}case 8:{let f=r.yytext.endsWith("`")?"TPL_END":"TPL_CONTINUE";return r.yytext=this.toStringLiteral(r.yytext,!0,1+ +(f!=="TPL_END")),this.popState(),f==="TPL_END"&&e.pps(),f;break}case 9:{this.parseError("Unexpected end of input");break}case 10:return 21;case 11:{return e.pps(),22;break}case 12:return 61;case 13:{return e.pps(),63;break}case 14:return 84;case 15:{if(this.bracketStack[this.bracketStack.length-1]!=="TPL_END")return e.pps(),85;this.unput("}"),this.begin("template");break}case 16:{return r.yytext=this.toLiteral(r.yytext),57;break}case 17:return 36;case 18:return 37;case 19:return 30;case 20:return 35;case 21:return 33;case 22:return 32;case 23:return 34;case 24:return 25;case 25:return 26;case 26:return 95;case 27:{return r.yytext=this.ident(r.yytext.slice(0,-1)),70;break}case 28:{return r.yytext=this.ident(r.yytext.slice(1,-1)),72;break}case 29:{return e.pps(),r.yytext=this.ident(r.yytext),14;break}case 30:{return e.pps(),r.yytext=this.ident(r.yytext.slice(1)),15;break}case 31:{return e.pps(),r.yytext=this.toNumberLiteral(r.yytext,!0),55;break}case 32:{return e.pps(),r.yytext=this.toNumberLiteral(r.yytext),55;break}case 33:{return e.pps(),r.yytext=this.toNumberLiteral(r.yytext,!0,!0),55;break}case 34:{return e.pps(),r.yytext=this.toNumberLiteral(r.yytext,!1,!0),55;break}case 35:{return e.pps(),r.yytext=this.toStringLiteral(r.yytext),54;break}case 36:{return e.pps(),r.yytext=this.toStringLiteral(r.yytext),54;break}case 37:{return e.pps(),r.yytext=this.toRegExp(r.yytext),56;break}case 38:{return e.pps(),51;break}case 39:{return e.pps(),52;break}case 40:{return e.pps(),53;break}case 41:{return e.pps(),9;break}case 42:return 20;case 43:return 42;case 44:return 43;case 45:return 48;case 46:return 47;case 47:return 45;case 48:return 44;case 49:return 46;case 50:return 69;case 51:return 66;case 52:return 67;case 53:return 89;case 54:{return e.pps(),e.pks(),68;break}case 55:{return e.pps(),e.pks(),65;break}case 56:return 38;case 57:return 17;case 58:return 73;case 59:return 11;case 60:return 10;case 61:return 27;case 62:return 28;case 63:return 39;case 64:return 40;case 65:return 41;case 66:return 29;case 67:{this.parseError(`Bad input on line ${r.yylloc.first_line} column ${r.yylloc.first_column}
`+this.showPosition(),{text:r.yytext,token:"BAD_TOKEN"});break}case 68:return 5}},setInput(e,r){return this.yy=r||this.yy||{},this._input=e,this._more=!1,this._backtrack=!1,this.done=!1,this.currentCondition="INITIAL",this.conditionStack=["INITIAL"],this.offset=0,this.yytext=this.match="",this.yyleng=0,this.yylineno=0,this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.yylloc.range=[0,0],this},parseError(e,r){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,r)},input(){let e=this._input[this.offset],r=/\n|\r\n?|\u2028|\u2029/g.test(e);return this.offset++,this.yyleng++,this.yytext=this.match=this.yytext+e,r?(this.yylineno++,this.yylloc.last_line++,this.yylloc.last_column=0):this.yylloc.last_column++,this.yylloc.range[1]++,e},lineColumnForOffset(e=this.offset,r=this._input,o=1,a=0){let u=/\n|\r\n?|\u2028|\u2029/g,f=o,d=a,h=0,g;for(;(g=u.exec(r))!==null;)if(g.index<e)f++,d=0,h=g.index+g[0].length;else{d+=e-h,h=-1;break}return h!==-1&&(d+=e-h),{line:f,column:d}},setMatch(e,r){let o=this._input.slice(e,r),a=e!==this.offset?this.lineColumnForOffset(e):{line:this.yylloc.last_line,column:this.yylloc.last_column},u=e!==r?this.lineColumnForOffset(r-e,o,a.line,a.column):a;this.yytext=this.match=o,this.yyleng=r-e,this.offset=r,this.yylineno=u.line-1,this.yylloc={first_line:a.line,first_column:a.column,last_line:u.line,last_column:u.column},this.yylloc.range=[e,r]},less(e){let r=this.offset-this.match.length;this.setMatch(r,r+e)},unput(e){let r=this.match.length-e.length;if(!this.match.startsWith(e,r))throw new Error("Lexer#unput() should receive a part of matched text only");this.less(r)},more(){this._more=!0},reject(){throw new Error("reject() is allowed only when options.backtrack_lexer = true")},showPosition(e=this.offset-this.match.length){let r=this._input,o=Math.max(e-20,0),a=Math.min(e+20,r.length),u=(o===0?"":"...")+r.slice(o,e).replace(/\n|\r\n?|\u2028|\u2029/g,"\\n"),f=r.slice(e,a).replace(/\n|\r\n?|\u2028|\u2029/g,"\\n")+(a===r.length?"":"...");return u+f+`
${"-".repeat(u.length)}^`},test_match(e,r){let o;this._more=!1,this._backtrack=!1,this.setMatch(this.offset,this.offset+e[0].length),this.matches=e;let a=this.performAction.call(this,this.yy,this,r,this.conditionStack[this.conditionStack.length-1]);return!a&&this._backtrack?(Object.assign(this,o),!1):(this.eof()||(this.done=!1),typeof a=="number"&&this.yy.parser?this.yy.parser.terminals_[a]:a||!1)},eof(){return this.offset===this._input.length},next(){if(this.done)return 1;this.eof()&&(this.done=!0),this._more||(this.yytext="",this.match="");let e,r;for(let o of this.conditions[this.currentCondition].rules){let a=this.rules[o],u=this._input.slice(this.offset),f;if(typeof a=="function"){let d=a(u,this.currentCondition);switch(typeof d){case"string":f=[d];break;case"number":f=[u.slice(0,d)];break;default:f=d}}else f=u.match(a);if(f&&(!e||f[0].length>e[0].length)){e=f,r=o;break}}if(e)return this.test_match(e,r);if(this.eof())return 1;this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex(){let e;for(;!e;)e=this.next();return e},begin(e){this.currentCondition=e,this.conditionStack.push(e)},pushState(e){this.begin(e)},popState(){return this.conditionStack.pop(),this.currentCondition=this.conditionStack.length?this.conditionStack[this.conditionStack.length-1]:"INITIAL"},topState(e){return e=this.conditionStack.length-1-Math.abs(e||0),e>=0?this.conditionStack[e]:"INITIAL"},stateStackSize(){return this.conditionStack.length}}}();function Wl(){this.yy={}}Wl.prototype={Parser:Wl,lexer:j0,symbols_:{error:2,root:3,block:4,EOF:5,definitions:6,e:7,def:8,$:9,";":10,":":11,$ident:12,ident:13,IDENT:14,$IDENT:15,condConsequent:16,"?":17,condAlternate:18,query:19,"=>":20,"(":21,")":22,functionArgs:23,compareFunction:24,NOT:25,NO:26,"-":27,"+":28,"|":29,IS:30,assertion:31,IN:32,HAS:33,NOTIN:34,HASNO:35,AND:36,OR:37,"??":38,"*":39,"/":40,"%":41,"=":42,"!=":43,"<":44,"<=":45,">":46,">=":47,"~=":48,queryRoot:49,relativePath:50,"@":51,"#":52,$$:53,STRING:54,NUMBER:55,REGEXP:56,LITERAL:57,template:58,object:59,array:60,"[":61,sliceNotation:62,"]":63,"method()":64,".":65,".(":66,".[":67,"..":68,"..(":69,"METHOD(":70,arguments:71,"$METHOD(":72,",":73,functionArg:74,templateString:75,templateStart:76,templateTail:77,templateEnd:78,templateContinue:79,TEMPLATE:80,TPL_START:81,TPL_CONTINUE:82,TPL_END:83,"{":84,"}":85,objectEntries:86,objectEntry:87,objectEntryKeyLiteral:88,"...":89,arrayElements:90,arrayElement:91,assertionTerm:92,assertionList:93,compareExpr:94,ORDER:95,sliceNotationComponent:96,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",9:"$",10:";",11:":",14:"IDENT",15:"$IDENT",17:"?",20:"=>",21:"(",22:")",25:"NOT",26:"NO",27:"-",28:"+",29:"|",30:"IS",32:"IN",33:"HAS",34:"NOTIN",35:"HASNO",36:"AND",37:"OR",38:"??",39:"*",40:"/",41:"%",42:"=",43:"!=",44:"<",45:"<=",46:">",47:">=",48:"~=",51:"@",52:"#",53:"$$",54:"STRING",55:"NUMBER",56:"REGEXP",57:"LITERAL",61:"[",63:"]",65:".",66:".(",67:".[",68:"..",69:"..(",70:"METHOD(",72:"$METHOD(",73:",",80:"TEMPLATE",81:"TPL_START",82:"TPL_CONTINUE",83:"TPL_END",84:"{",85:"}",89:"...",95:"ORDER"},productions_:[0,[3,2],[4,2],[4,1],[4,1],[4,0],[6,1],[6,2],[8,2],[8,4],[8,2],[8,4],[13,1],[12,1],[16,2],[16,1],[18,2],[18,1],[18,0],[7,1],[7,2],[7,3],[7,4],[7,5],[7,1],[7,2],[7,2],[7,2],[7,2],[7,3],[7,4],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[19,1],[19,1],[49,1],[49,1],[49,1],[49,1],[49,1],[49,1],[49,1],[49,1],[49,1],[49,1],[49,1],[49,1],[49,3],[49,2],[49,2],[49,1],[49,1],[49,3],[49,4],[49,2],[49,2],[49,3],[49,3],[49,2],[49,2],[49,3],[49,2],[49,3],[50,3],[50,4],[50,4],[50,3],[50,3],[50,4],[50,4],[50,3],[50,3],[50,4],[64,2],[64,3],[64,2],[64,3],[71,1],[71,3],[74,1],[23,1],[23,3],[58,1],[58,2],[77,1],[77,2],[77,2],[77,3],[75,1],[76,1],[79,1],[78,1],[59,2],[59,3],[59,4],[59,3],[59,4],[59,5],[86,1],[86,3],[88,1],[88,1],[88,1],[87,1],[87,1],[87,1],[87,1],[87,1],[87,3],[87,3],[87,3],[87,2],[87,2],[87,2],[87,5],[87,1],[87,2],[90,1],[90,3],[91,1],[91,1],[91,2],[60,2],[60,3],[60,4],[31,1],[31,2],[31,3],[31,4],[92,1],[92,1],[92,1],[92,1],[93,1],[93,3],[93,3],[24,1],[24,3],[94,2],[62,1],[62,2],[62,2],[62,3],[96,1],[96,2]],table:function(e){function r(x){let T=x.match(/[\x20-\x2f]/g),E=T?Math.max(...T.map(M=>M.charCodeAt()-32)):-1;for(let M=E;M>=0;M--){let F=(32+M).toString(16),D;x=x.replace(new RegExp("\\[\\x"+F+"(.+?)\\]"),(C,L)=>D=L).replace(new RegExp("\\x"+F,"g"),D)}return x=x.replace(/<([^>]+?)>/g,(M,F)=>{let D=u[F[0]],C=1;return D>>5===1&&(D=D&31|u[F[1]]<<5,C=2),F.slice(C).repeat(D)}),x}function o(x){let T=[];for(let E=0;E<x.length;E++){let M=u[x[E]];if(M&32){let F=u[x[++E]];T.push(M&31|F<<5)}else T.push(M)}return T}let u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789~|=".split("").reduce((x,T,E)=>(x[T]=E,x),Object.create(null)),[f,d,...h]=e.split("=").map(r),g=d.split(";").map(x=>{let T=[];for(let E=0;E<x.length;E++)for(let M=0,F=u[x[E]];M<3;M++)T.push(F>>M*2&3);return T}),v=h.map(o),w=o(f).map(x=>{let T=g[x],E=Object.create(null);for(let M=0;M<T.length;M++){let F=T[M];if(F!==0){let D=v[F-1].shift();E[M]=F===1?D:[F-1,D]}}return E});for(let x=0;x<v[3].length;x+=2)w[v[3][x]][v[3][x+1]]=[3];return w}(`ABCDEFGHIJKHHHHLL<NM>NOPMMQRSQRTMUVWXYYMZaEFTO<TH>PMbQRSQRcMMHdefgBhBiBHj[ BjBkBk]BFHFHlBMmBnBoBpBqBrBMMsBtBMMMMXMWMMuB[!lBMMuB]vBgBMMwBUMZMxByBzB0B1B2B3B4BH5<DB6>BvBXe7BXevBgBM<E8B>9B~ <DB|>BgCgC<EhC>gCMMiC<C!>cHdjCMfMkClClCMMmCnCnBoCpCMtBqCrCvBMMMvBMUMMsCMxBHtCHtCtCHuCvCTXHXvB<FM>cHhBhBMFFMpBpCnCqCMOOMMzBzB2BMsCwCtCtCxC7BcMrCrCHMHtCtC=A1[ V[!C["lmkCpqC]]]<FA>[#[$[%[&['UqqWJkq]K]C][([)FgCCAAE];]]A];Ag;AwU[*ClmkOpqC]<FA>[+[,U[-qqWJnqK]]C(A]wAA[.A[/kAMAqi]]<Fq>CAAAAD<JA>g;AwADwzwP8|D<GA>||DMz|PDAwDPw;AwA8AwAMA|z<F|>DAAAIjqCMAA8MAAw;AAE!<FA>#wA8AwgMA|z<F|>DAAAMz|DMAA8MAAw;AAVClmkapqC<FA>&S(AwA8AwAMA|z<F|>DAAAMz|DIAA8MAAw;AwAoAwAMA|z<F|>DAAAMz|DMAA8MAAw;AwA8AwAMA|z<F|>DAAAMz|DMAA8MAAw;AAEi"<FA>UqqWZmqKCFgCCgFEB;AAAChCACIAE<IA>C<KA>Q;AwAsAwBMA|z<F|>DAAAMz|DMAA8MAAw;AAAAk<QA>EAIC;AEV*<FA>#E <FA>+A <FA>#AE!<FA>%VlqCAAE;AARClC<MA>KCIEAICAAAYl;AwE~lmkOp6y<F|>X-OFg~OAA0;AwA|wzwP8|z<F|>D||DMz|PPAw|PAAw;AAEClmkKpqC<FA>'aC(AAADwzwD8|D<GA>||DMw|PDAw|D;M;AAEi"<FA>UqqWZmqKC)B;AwA8.<Fq>CAAAMz|DMAA8MAA<Cg;AAAAAA>AI<QA>I;<FA>kAIAqi<Fq>C<OA>g;AAU!<FA>$<HA>M<QA>M;AAA8AwgMA|z<F|>DAAAMw|DM<GA>w;AwA8A0AMA6jq|qqqCAAAMz|DMAA8MAAw;AwA8A0AMA|z||q||DAAAMz|DMAA8MAAw<C;AAAAAAAAAAAAAAAAAAAAAC>AAI;AAAg<RA>D<KA>B;AAAgAkAAAqi<Fq>CAAAADAAM<GA>gB;<VA>DAAM;AAEy"<FA>+AE!<FA>,O(AAAChCACA<KA>C<KA>Q;AAAChCACIAE<IA>C<KA>QB;<HA>I;AwA8AkAMA6i<Fq>CAAAMz|DMAA8MAAw;<FA>kAAAqi<Fq>C<JA>FoAAAg;<YA>IAAAI;AAQClC<MA>KCIEAICAAAYl;<YA>MAAAM;AAAo<UA>MAAAM;AAEq"<FA>&OFgCOAAE;AAEi"<FA>&OFgCOAAE;AAE!<FA>&OFgCOAAE;AAAg<UA>MAAAM;AAAClmECAgC<FA>&OFgCO;AAAw<UA>MAAAM;<FA>/<Fq>C<HA>M<GA>g;AwA8A0AMA6z||qqqCAAAMz|DMAA8MAAw;AwA8A0AMA6jqvqqqCAAAMz|DMAA8MAAw;AwA8A0AMA6jquqqqCAAAMz|DMAA8MAAw;AwA8A0AMA|z<F|>DAAAMz|DMAA8MAAw;AwA8A0AMA6z||qvqDAAAMz|DMAA8MAAw;AwA8A0AMA6z||q||DAAAMz|DMAA8MAAw;AAAgAkAAAqi<Fq><CCAAAA><FA>gB;<FA>C<SA>Q;<FA>kAAAqi<Fq>C<OA>g;AAAIAkAAAqi<Fq>C<OA>g;AAE!<FA>UqqWJmqKCFgCCgEE;<VA>D;AAAwAkAAAqi<Fq>CAAAAD<JA>g;<FA>kAAAqi<Fq>CAAAADAAM<GA>g;<HA>IAAAAK;<HA>MAAAAP;AAAClC<MA>KCIEAICAAAIl;<FA>kAAAqi<Fq>C<HA>MAAAMAAg;<FA>kAAAqi<Fq><CCAAAA><FA>g;<UA>IgqCMAAAM;AAAIAkAAAqi<Fq>C<HA>MAAAMAAg;AAAg=BC[ D[!E["[#F[$QhBgBG]][%[&['[(KRSbcd]iB]pBqB]T]]]]zB[)0B$%qC]y[*C[[,+[-0ChBgB]]G%]]5C4C#3C'6CpBqBT9*~*|*gD+pD-G(lD[.iBpBqB]nDqDToDzDtDuD2D4D5D6D 7D 8D9D~D gE|D"jE-G&hEiEkETpEF[/sEtEuE]oEqEvE1E+4E-G'3EpBqBT4E-G'6EpBqBTqC8E7!zD9EuD~E+|E+gF+hF+iF+jF+kF+lF+mF+nF+oF+pF+qF+rF+sF+tF+uF+vF+wF+xFzF-G(0F.ToD1F2F3F 4F 5F6F7F qC8F+qChG0B$%jG-G&iG<EqC>kG+lG+pGqCqGrG+sG+zDtGzDwGuDvGxG+qC1G)2G3GjE-G&4GiEkET0B/8GqEvE~G+gH+hH+jH,kHRSbcd.qCqCqCpH0B$%<UqC>qGqCvH+xH<EqC>4H-G&3HT5HqCqCzDwGuD6HqCqCjE-G&~HiEkETiItEuEgIvElI+qCmI+qCqCnI+qC5C4C"pI+qCqCqI+qCzDsIuDzDtIuD~G+iItEuEgIvE<FqC>xI+yI+qCqC=[ [!["P[#[$[%[&['tBIsBHJ]LMNO][(oB[)fUVWXYZae]]][*jBkBlBmBnBuBvBwBxB]]r]]B]y][+B[,![-[.sB|B~B][/1B2B3B4B5B6B7B8B9BgChCiCjCkClCmCnCoCpC]]]rC]sCtCuCvCwCxCzC#B1CPtB7CsBHJ2CLMNO(*rB8C<EzC#B>hDiDjDkDzCrD%mD*rBsDyDxD1DwDvD0D3D<CtBuBvB!!>zC$mElErBrEtB1DyEzE0EwEuBvBnExEzC&)*rBzC'2ELMNO(*rBzC'5ELMNO(*rB-rC DxD1DwDvD0D<TzC#B>3DzCrD%yF*rBtBuBv<CB">BtBuBv+zC#B9F~F|FsBgG|B~B/rC!1CzC#B<C|B~B3B4B5B6BgChCiCjCkClCmCnCoCpC><CgChCiC><CzC#B>mGnGoGrDrD-rC<CzC#B>yDxD1DuG0DyDxD1DwDvD0DzC&)*rByGzG0G.2B3B4B5B6B7B8B9BgChCiCjCkClCmCnCoCpC,mElErCzC$mElErB6G5GrEtB1DyEzE0EwEuBvB7GxEhDiDzCjD9G#BzC|G#BzC#BiHzC#BzCtB1DsBlH(*rB.2B3B4B5B6B7B8B9BgChCiCjCkClCmCnCoCpCmHnH-rCoHnH.2B3B4B5B6B7B8B9BgChCiCjCkClCmCnCoCpC!<E|B~BgChCiCjCkClCmCnCoCpC>|B~B3B4B5B6B9BgChCiCjCkClCmCnCoCpC|B~B3B4B5B6B7B9BgChCiCjCkClCmCnCoCpC|B~B3B4B5B6BgChCiCjCkClCmCnCoCp<CCgChCi><CC|B~BgChCiClCmCnCo><FC|B~BgChCi>ClCmCnCoCrD-qHrCrHsHtHuH-rCzC#BwHyHsBzH|B~B/rC-rC0H-rC1H-rCzC%2H*rBsDrD<C-rC>yDxD1DwDvD0D7H8H9H<C.2B3B4B5B6B7B8B9BgChCiCjCkClCmCnCoCpC>zC$mElErBhItB1DyEzE0EwEuBvB|HxEkIjI<CzC#B-rC>-rCzC#B-oIrCsCtCuCvCwCxC!zC#B.2B3B4B5B6B7B8B9BgChCiCjCkClCmCnCoCpC-rCzC#B-rCrI8H9H<CyDxD1DwDvD0D>zCuI#BhItB1DyEzE0EwEuBvBvIxE1H<D-rC>wI<C-rC><CzC#B><C-rC>=FDDDEEE<jBG><gBT><mBN><lBY><kB4B><kB6B><mB0B><mB1B><mB7E><mB2B><mB3B><mB5B><mB7B><mB8B><mB9B><mB~B><mB|B><mBgC><mBhC><lBS><mBlC><mBmC>FFF<mBlD><cP><5BM><mBrD><gBsD>BCCC<jBH><lBS><mB9E>FFF<PU><mB4B><mB6B>jDjDNNNiD<bN>iDN<WZ><Wa><jBb><jBc><jBI><jBK><mBtE>~EqEqEoEoEiFiFrErE<mBjC><mBwE><mB0E><mB1E><mB2E><mB3E><5BN><mBkC><cR><mBpC><mBqC><mBtC><mBuC><RwC><mBmD><mBnD><mBuD><gBtD><mBvD>1D1[ D6D6D7D7D]8D8D9D9D~D~DmEmE<D3D><D4D><D5D><RO><5B8C>gDgD<5B~C><Rd><mBf><agB><ahB><aiB><ajB><VkB><UlB><WmB><jBnB><jBoB><mBpB><mBqB><mBrB><dsB><dtB><hBuB><hBvB><hBwB><hBxB><dyB><mBzB><mByC><mB1C><mB2C><mB5C><mB6C><PV><mBnC><mB8E><mBiC><mBuE>|EgFjFjFsEsE<mBxE><D4E><RQ><mBrC><mBsC><mBvC><RxC><mBoD><mBpD><mBwD><mByD>iEiEjEjEkEkEnEnE<5B9C><5B|C><Re><mBzC><mB0C><mB3C><mB4C><mB7C><PW>kDkDiDiD<mBoC><jBJ><jBL><mBvE>pEpEqEqEhF<mByE><mBqD><mBxD>2D2 <mBzD>hEhE|D|DgEgEhDhD<PX><mBzE><D5E><D6E><mB0D>hEhElElE=BB`),defaultActions:{50:[2,1],201:[2,159],249:[2,161]},performAction(n,e,r,o,a,u,f){let d=u.length-1;switch(a){case 1:return o.buildResult(u[d-1]);case 2:this.$={type:"Block",definitions:u[d-1],body:u[d],range:this._$.range};break;case 3:this.$={type:"Block",definitions:u[d],body:{type:"Placeholder",range:[f[d].range[1],f[d].range[1]]},range:this._$.range};break;case 4:this.$={type:"Block",definitions:[],body:u[d],range:this._$.range};break;case 5:this.$={type:"Block",definitions:[],body:{type:"Placeholder",range:[f[d].range[1],f[d].range[1]]},range:this._$.range};break;case 6:case 96:case 99:case 101:case 117:case 136:case 152:case 155:this.$=[u[d]];break;case 7:u[d-1].push(u[d]);break;case 8:this.$={type:"Definition",declarator:{type:"Declarator",name:null,range:f[d-1].range},value:null,range:this._$.range};break;case 9:this.$={type:"Definition",declarator:{type:"Declarator",name:null,range:f[d-3].range},value:u[d-1],range:this._$.range};break;case 10:this.$={type:"Definition",declarator:{type:"Declarator",name:u[d-1].name,range:f[d-1].range},value:null,range:this._$.range};break;case 11:this.$={type:"Definition",declarator:{type:"Declarator",name:u[d-3].name,range:f[d-3].range},value:u[d-1],range:this._$.range};break;case 12:case 13:case 98:case 148:case 149:this.$={type:"Identifier",name:u[d],range:this._$.range};break;case 14:case 16:case 163:this.$=u[d];break;case 15:case 17:this.$={type:"Placeholder",range:[f[d].range[1],f[d].range[1]]};break;case 18:case 162:this.$=null;break;case 19:case 52:case 53:case 64:case 65:case 138:break;case 20:case 22:this.$={type:"Function",arguments:[],body:u[d],range:this._$.range};break;case 21:this.$={type:"Function",arguments:[{type:"Identifier",name:u[d-2]}],body:u[d],range:this._$.range};break;case 23:this.$={type:"Function",arguments:u[d-3],body:u[d],range:this._$.range};break;case 24:this.$={type:"CompareFunction",compares:u[d],range:this._$.range};break;case 25:case 26:case 27:case 28:case 67:this.$={type:"Prefix",operator:u[d-1],argument:u[d],range:this._$.range};break;case 29:this.$={type:"Pipeline",left:u[d-2],right:u[d],range:this._$.range};break;case 30:this.$={type:"Pipeline",left:u[d-3],right:{type:"Block",definitions:u[d-1],body:u[d]},range:this._$.range};break;case 31:this.$={type:"Postfix",operator:u[d],argument:u[d-2],range:this._$.range};break;case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:this.$={type:"Binary",operator:u[d-1],left:u[d-2],right:u[d],range:this._$.range};break;case 51:this.$={type:"Conditional",test:u[d-2],consequent:u[d-1],alternate:u[d],range:this._$.range};break;case 54:this.$={type:"Data",range:this._$.range};break;case 55:this.$={type:"Context",range:this._$.range};break;case 56:this.$={type:"Current",range:this._$.range};break;case 57:this.$={type:"Arg1",range:this._$.range};break;case 58:this.$={type:"Reference",name:u[d],range:this._$.range};break;case 59:case 60:case 61:case 62:case 107:case 108:case 109:case 110:case 119:case 120:case 121:this.$={type:"Literal",value:u[d],range:this._$.range};break;case 63:this.$={type:"Template",values:u[d],range:this._$.range};break;case 66:this.$={type:"SliceNotation",value:null,arguments:u[d-1],range:this._$.range};break;case 68:this.$={type:"Conditional",test:null,consequent:u[d-1],alternate:u[d],range:this._$.range};break;case 69:case 73:this.$={type:"GetProperty",value:null,property:u[d],range:this._$.range};break;case 70:case 74:this.$={type:"MethodCall",value:null,method:u[d],range:this._$.range};break;case 71:this.$={type:"Parentheses",body:u[d-1],range:this._$.range};break;case 72:this.$={type:"Parentheses",body:{type:"Block",definitions:u[d-2],body:u[d-1]},range:this._$.range};break;case 75:this.$={type:"Map",value:null,query:u[d-1],range:this._$.range};break;case 76:this.$={type:"Filter",value:null,query:u[d-1],range:this._$.range};break;case 77:this.$={type:"MapRecursive",value:null,query:{type:"GetProperty",value:null,property:u[d]},range:this._$.range};break;case 78:this.$={type:"MapRecursive",value:null,query:{type:"MethodCall",value:null,method:u[d]},range:this._$.range};break;case 79:this.$={type:"MapRecursive",value:null,query:u[d-1],range:this._$.range};break;case 80:this.$={type:"Pipeline",left:null,right:u[d],range:this._$.range};break;case 81:this.$={type:"Pipeline",left:null,right:{type:"Block",definitions:u[d-1],body:u[d]},range:this._$.range};break;case 82:this.$={type:"Pick",value:u[d-2],getter:null,range:this._$.range};break;case 83:this.$={type:"Pick",value:u[d-3],getter:u[d-1],range:this._$.range};break;case 84:this.$={type:"SliceNotation",value:u[d-3],arguments:u[d-1],range:this._$.range};break;case 85:this.$={type:"GetProperty",value:u[d-2],property:u[d],range:this._$.range};break;case 86:this.$={type:"MethodCall",value:u[d-2],method:u[d],range:this._$.range};break;case 87:this.$={type:"Map",value:u[d-3],query:u[d-1],range:this._$.range};break;case 88:this.$={type:"Filter",value:u[d-3],query:u[d-1],range:this._$.range};break;case 89:this.$={type:"MapRecursive",value:u[d-2],query:{type:"GetProperty",value:null,property:u[d]},range:this._$.range};break;case 90:this.$={type:"MapRecursive",value:u[d-2],query:{type:"MethodCall",value:null,method:u[d]},range:this._$.range};break;case 91:this.$={type:"MapRecursive",value:u[d-3],query:u[d-1],range:this._$.range};break;case 92:this.$={type:"Method",reference:{type:"Identifier",name:u[d-1],range:[f[d-1].range[0],f[d-1].range[1]-1]},arguments:[],range:this._$.range},this._mn=u[d-1];break;case 93:this.$={type:"Method",reference:{type:"Identifier",name:u[d-2],range:[f[d-2].range[0],f[d-2].range[1]-1]},arguments:u[d-1],range:this._$.range},this._mn=u[d-2];break;case 94:this.$={type:"Method",reference:{type:"Reference",name:{type:"Identifier",name:u[d-1],range:[f[d-1].range[0],f[d-1].range[1]-1]},range:[f[d-1].range[0],f[d-1].range[1]-1]},arguments:[],range:this._$.range},this._mn=u[d-1];break;case 95:this.$={type:"Method",reference:{type:"Reference",name:{type:"Identifier",name:u[d-2],range:[f[d-2].range[0],f[d-2].range[1]-1]},range:[f[d-2].range[0],f[d-2].range[1]-1]},arguments:u[d-1],range:this._$.range},this._mn=u[d-2];break;case 97:case 100:case 118:case 137:case 156:u[d-2].push(u[d]);break;case 102:this.$=[u[d-1],...u[d]];break;case 103:case 158:this.$=[null,u[d]];break;case 104:case 160:this.$=[u[d-1],u[d]];break;case 105:this.$=[null,u[d-1],...u[d]];break;case 106:this.$=[u[d-2],u[d-1],...u[d]];break;case 111:case 114:this.$={type:"Object",properties:[],range:this._$.range};break;case 112:this.$={type:"Object",properties:u[d-1],range:this._$.range};break;case 113:this.$={type:"Object",properties:u[d-2],range:this._$.range};break;case 115:this.$={type:"Block",definitions:u[d-2],body:{type:"Object",properties:u[d-1]},range:this._$.range};break;case 116:this.$={type:"Block",definitions:u[d-3],body:{type:"Object",properties:u[d-2]},range:this._$.range};break;case 122:this.$={type:"ObjectEntry",key:{type:"Current"},value:null,range:this._$.range};break;case 123:this.$={type:"ObjectEntry",key:{type:"Reference",name:u[d]},value:null,range:this._$.range};break;case 124:case 126:this.$={type:"ObjectEntry",key:u[d],value:null,range:this._$.range};break;case 125:this.$={type:"ObjectEntry",key:{type:"Literal",value:this._mn},value:u[d],range:this._$.range};break;case 127:case 128:this.$={type:"ObjectEntry",key:u[d-2],value:u[d],range:this._$.range};break;case 129:this.$={type:"ObjectEntry",key:{type:"Identifier",name:"$"+u[d-2].name},value:u[d],range:this._$.range};break;case 130:this.$={type:"ObjectEntry",key:u[d-1],value:{type:"Pipeline",left:{type:"Reference",name:u[d-1]},right:u[d]},range:this._$.range};break;case 131:this.$={type:"ObjectEntry",key:u[d-1],value:{type:"Pipeline",left:{type:"GetProperty",value:null,property:u[d-1]},right:u[d]},range:this._$.range};break;case 132:this.$={type:"ObjectEntry",key:{type:"Literal",value:this._mn},value:{type:"Pipeline",left:u[d-1],right:u[d]},range:this._$.range};break;case 133:this.$={type:"ObjectEntry",key:u[d-3],value:u[d],range:this._$.range};break;case 134:this.$={type:"Spread",query:null,array:!1,range:this._$.range};break;case 135:this.$={type:"Spread",query:u[d],array:!1,range:this._$.range};break;case 139:this.$={type:"Spread",query:null,array:!0,range:this._$.range};break;case 140:this.$={type:"Spread",query:u[d],array:!0,range:this._$.range};break;case 141:this.$={type:"Array",elements:[],range:this._$.range};break;case 142:this.$={type:"Array",elements:u[d-1],range:this._$.range};break;case 143:this.$={type:"Array",elements:u[d-2],range:this._$.range};break;case 144:this.$={type:"Assertion",negation:!1,assertion:u[d],range:this._$.range};break;case 145:this.$={type:"Assertion",negation:!0,assertion:u[d],range:this._$.range};break;case 146:this.$={type:"Assertion",negation:!1,assertion:u[d-1],range:this._$.range};break;case 147:this.$={type:"Assertion",negation:!0,assertion:u[d-1],range:this._$.range};break;case 150:this.$={type:"Method",reference:{type:"Reference",name:u[d]},arguments:[],range:this._$.range};break;case 151:this.$={type:"Identifier",name:String(u[d]),range:this._$.range};break;case 153:case 154:u[d-2].push(u[d-1],u[d]);break;case 157:this.$={type:"Compare",query:u[d-1],order:u[d],range:this._$.range};break;case 159:this.$=[null,u[d-1],u[d]];break;case 161:this.$=[u[d-2],u[d-1],u[d]];break}},trace(...n){this.DEBUG&&Jison.print(...n)},parseError(n,e){if(e.recoverable)this.trace(n);else{let r=new Error(n);throw r.hash=e,r}},parse(n,...e){let d=W=>{M.length-=2*W,F.length-=W,D.length-=W},h=()=>{let W=g.lex()||1;return typeof W!="number"&&(W=this.symbols_[W]||W),W},g=Object.create(this.lexer),v=g.options&&g.options.ranges,w={...this.yy,parser:this,lexer:g};g.setInput(n,w),typeof w.parseError=="function"&&(this.parseError=w.parseError),typeof g.yylloc>"u"&&(g.yylloc={});let x=this.table,T={},E=g.yylloc,M=[0],F=[null],D=[E],C=[],L="",N=0,B=0,O=0,z,_;for(;;){let W=M[M.length-1],te;if(this.defaultActions[W]?te=this.defaultActions[W]:((z===null||typeof z>"u")&&(z=h()),te=x[W]&&x[W][z]),!te||!te[0]){let A=function(Q){let U=M.length-1,ce=0;for(;;){if("2"in x[Q])return ce;if(Q===0||U<2)return!1;U-=2,Q=M[U],++ce}},H,X="";if(!O){let Q=[];for(let U in x[W])U in this.terminals_&&U>2&&Q.push("'"+this.terminals_[U]+"'");X=g.showPosition?"Parse error on line "+(N+1)+`:
`+g.showPosition()+`
Expecting `+Q.join(", ")+", got '"+(this.terminals_[z]||z)+"'":"Parse error on line "+(N+1)+": Unexpected "+(z===1?"end of input":"'"+(this.terminals_[z]||z)+"'"),this.parseError(X,{text:g.match,token:this.terminals_[z]||z,line:g.yylineno,loc:E,expected:Q})}if(O===3){if(z===1||_===1)throw new Error(X||"Parsing halted while starting to recover from another error.");B=g.yyleng,L=g.yytext,N=g.yylineno,E=g.yylloc,z=h()}if(H===!1)throw new Error(X||"Parsing halted. No suitable error recovery rule available.");d(H),_=z==2?null:z,z=2,W=M[M.length-1],te=x[W]&&x[W][2],O=3}if(Array.isArray(te[0])&&te.length>1)throw new Error("Parse Error: multiple actions possible at state: "+W+", token: "+z);switch(te[0]){case 1:M.push(z),F.push(g.yytext),D.push(g.yylloc),M.push(te[1]),z=null,_?(z=_,_=null):(B=g.yyleng,L=g.yytext,N=g.yylineno,E=g.yylloc,O>0&&O--);break;case 2:{let H=this.productions_[te[1]][1],X=D[D.length-(H||1)],A=D[D.length-1];T.$=F[F.length-H],T._$={first_line:X.first_line,last_line:A.last_line,first_column:X.first_column,last_column:A.last_column},v&&(T._$.range=[X.range[0],A.range[1]]);let Q=this.performAction.call(T,L,B,N,w,te[1],F,D,...e);if(typeof Q<"u")return Q;H&&d(H),M.push(this.productions_[te[1]][0]),F.push(T.$),D.push(T._$),M.push(x[M[M.length-2]][M[M.length-1]]);break}case 3:return!0}}}};var z0=function(e){function r(C,L){Object.entries(L).forEach(([N,B])=>C[N]=B(C[N]))}let o=new Map([["EOF",["<end of input>"]],["IDENT",["ident"]],["$IDENT",["$ident"]],["NOT",["'not'"]],["NO",["'no'"]],["IS",["'is'"]],["IN",["'in'"]],["HAS",["'has'"]],["NOTIN",["'not in'"]],["HASNO",["'has no'"]],["AND",["'and'"]],["OR",["'or'"]],["STRING",["string"]],["TPL_START",["template"]],["TEMPLATE",["template"]],["NUMBER",["number"]],["REGEXP",["regexp"]],["LITERAL",["'true'","'false'","'null'","'undefined'","'NaN'","'Infinity'"]],["ORDER",["'asc'","'desc'","'ascN'","'descN'"]],["METHOD(",["'method('"]],["$METHOD(",["'$method('"]]]),a=C=>o.get(C)||`'${C}'`,u=function(C,L={},N){if(L.recoverable)this.trace(C);else{if(Array.isArray(L.inside)){let W=N.lexer.offset-N.lexer.match.length;N.lexer.setMatch(W+L.inside[0],W+L.inside[1])}let B=N.lexer.yylloc,O=[C.split(/\n/)[0],"",N.lexer.showPosition()],z=Array.isArray(L.expected)?[...new Set([].concat(...L.expected.map(W=>a(W.slice(1,-1)))))]:null;z&&O.push("","Expecting "+z.join(", ")+" got "+a(L.token));let _=new SyntaxError(O.join(`
`));throw _.details={rawMessage:C,text:L.text,token:L.token,expected:z,loc:{range:B.range,start:{line:B.first_line,column:B.first_column,offset:B.range[0]},end:{line:B.last_line,column:B.last_column,offset:B.range[1]}}},_}},f=new Set([`
`,"\r","\u2028","\u2029"]),d=new Map([["undefined",void 0],["null",null],["false",!1],["true",!0],["Infinity",1/0],["NaN",NaN]]);Object.assign(e.lexer,{ident:C=>C.replace(/\\u[0-9a-fA-F]{4}/g,L=>String.fromCharCode(parseInt(L.slice(2),16))),toLiteral:C=>d.get(C),toNumberLiteral(C,L,N=!1){if(L){let B=C.match(N?/(?:^|[^0-9a-fA-F])_|_(?:[^0-9a-fA-F]|$)/:/(?:^|\D)_|_(?:\D|$)/);if(B){let O=B[0],z=B.index+ +(O[1]==="_"),_=O==="__"?"Only one underscore is allowed":"Wrong underscore";this.parseError(_+" as numeric separator",{inside:[z,z+1]})}C=C.replace(/_/g,"")}return N?parseInt(C,16):parseFloat(C)},toStringLiteral(C,L=!1,N=1){let B=C.length-N,O="";for(let z=1;z<B;z++){if(!L&&f.has(C[z])&&this.parseError("Invalid line terminator",{inside:[z,z+1]}),C[z]!=="\\"){O+=C[z];continue}z===B-1&&this.parseError("Invalid backslash",{inside:[z,z+1]});let _=C[++z];switch(_){case"\r":z+=C[z+1]===`
`;break;case`
`:case"\u2028":case"\u2029":break;case"0":O+="\0";break;case"b":O+="\b";break;case"n":O+=`
`;break;case"r":O+="\r";break;case"f":O+="\f";break;case"t":O+="	";break;case"v":O+="\v";break;case"u":{let[W=""]=C.slice(z+1,z+5).match(/^[0-9a-f]*/i)||[];if(W.length===4){O+=String.fromCharCode(parseInt(W,16)),z+=4;break}this.parseError("Invalid Unicode escape sequence",{inside:[z-1,Math.min(z+1+W.length,B)]});break}case"x":{let[W=""]=C.slice(z+1,z+3).match(/^[0-9a-f]*/i)||[];if(W.length===2){O+=String.fromCharCode(parseInt(W,16)),z+=2;break}this.parseError("Invalid hexadecimal escape sequence",{inside:[z-1,Math.min(z+1+W.length,B)]});break}default:O+=_}}return O},toRegExp(C){let L=C.lastIndexOf("/")+1,N=C.substr(L);return N.split("").forEach((B,O,z)=>{let _=z.indexOf(B,O+1);_!==-1&&this.parseError("Duplicate flag in regexp",{inside:[L+_,L+_+1]})}),new RegExp(C.substr(1,C.lastIndexOf("/")-1),N)}}),r(e.lexer,{setInput:C=>function(L,N){let B=[];return N.commentRanges=B,N.buildResult=O=>({ast:O,commentRanges:B}),N.parseError=function(...O){return u.call(this,...O,N)},N.pks=()=>{this.eof()||this.begin("preventKeyword")},N.pps=()=>{this.eof()||this.begin("preventPrimitive")},this.bracketStack=[],this.prevToken=null,this.prevYylloc={first_line:1,last_line:1,first_column:0,last_column:0,range:[0,0]},C.call(this,L,N)}});let h=new e.Parser;h.lexer={...e.lexer},h.yy={...e.yy};let g=["AND","OR","IN","NOTIN","HAS","HASNO","IS"],v=[...g,"NOT","NO","ORDER"],w=["+","-","*","/","%","|","=","!=","~=",">=","<=","<",">"],x=[null,"?",":",";",",",".","..","(",".(","..(","METHOD(","$METHOD(","[",".[","=>",...w,...g,"NOT","NO"],T=[",","?",":",";","EOF","]",")","}","TPL_CONTINUE","TPL_END",...w,...g,"ORDER"],E=new Map(x.map(C=>[C,new Set(T)]));for(let C of[".(","..(","METHOD(","$METHOD("])E.get(C).delete(")");for(let C of["[",".["])E.get(C).delete("]");r(h.lexer,{lex:C=>function(){let N=this.offset,B=C.call(this);if(E.has(this.prevToken)&&E.get(this.prevToken).has(B)){let O={first_line:this.prevYylloc.last_line,last_line:this.yylloc.first_line,first_column:this.prevYylloc.last_column,last_column:this.yylloc.first_column,range:[this.prevYylloc.range[1],this.yylloc.range[0]]};if(this.unput(this.match),this.pushState("preventPrimitive"),this.done=!1,this.yytext="",this.yylloc=this.prevYylloc=O,N!==this.offset&&v.includes(B))switch(this._input[N]){case" ":case"	":O.last_column--,O.range[1]--;break;case`
`:{let z=this._input.lastIndexOf(`
`,N-1);O.last_line--,O.last_column=z===-1?O.last_column-1:N-z,O.range[1]--;break}}return this.prevToken="IDENT"}if(this.prevYylloc=this.yylloc,v.includes(B))switch(this._input[this.offset]){case" ":case"	":this.prevYylloc={...this.prevYylloc,last_column:this.prevYylloc.last_column+1,range:[this.prevYylloc.range[0],this.prevYylloc.range[1]+1]};break;case`
`:this.prevYylloc={...this.prevYylloc,last_line:this.prevYylloc.last_line+1,last_column:0,range:[this.prevYylloc.range[0],this.prevYylloc.range[1]+1]};break}return this.prevToken=B}});let M=new Map([["(",")"],[".(",")"],["..(",")"],["METHOD(",")"],["$METHOD(",")"],["[","]"],[".[","]"],["{","}"],["TPL_START","TPL_END"]]),F=new Set([")","]","}","TPL_END"]),D=C=>function(){let N=C.call(this);if(F.has(N)){let B=this.bracketStack.pop();B!==N&&this.parseError(`Expected "${B}" got "${N}"`)}return M.has(N)&&this.bracketStack.push(M.get(N)),N};return r(e.lexer,{lex:D}),r(h.lexer,{lex:D}),{parse(C,L){return L?h.parse(C):e.parse(C)},*tokenize(C,L,N){let B=L?h:e,O=Object.create(B.lexer);for(O.setInput(C,{parser:B});!O.done;){let z={type:O.lex(),value:O.match,offset:O.yylloc.range[0]};N&&(z.loc={range:O.yylloc.range,start:{line:O.yylloc.first_line,column:O.yylloc.first_column},end:{line:O.yylloc.last_line,column:O.yylloc.last_column}}),yield z}}}}(new Wl),Os=z0;var $l={};Ce($l,{compile:()=>R0,stringify:()=>q0,walk:()=>H0});function R0(n,e){e.put(e.scope.arg1?"arguments[1]":"undefined")}function H0(){}function q0(n,e){e.put("$$")}var Ul={};Ce(Ul,{compile:()=>W0,stringify:()=>U0,suggest:()=>_0,walk:()=>$0});function _0(n,e){n.elements.length===0&&e.queryRoot(n.range[0]+1,n.range[1]-1)}function W0(n,e){e.put("["),e.list(n.elements,","),e.put("]")}function $0(n,e){e.list(n.elements)}function U0(n,e){e.put("["),e.list(n.elements,","),e.put("]")}var Vl={};Ce(Vl,{compile:()=>G0,stringify:()=>Y0,suggest:()=>V0,walk:()=>K0});function V0(n,e){Array.isArray(n.assertion)||(e.range(n.assertion.range,"var"),e.range(n.assertion.range,"assertion"))}function G0(n,e){if(Array.isArray(n.assertion)){e.put(n.negation?"!(":"(");for(let r=0;r<n.assertion.length;r++)if(r%2===0)e.node(n.assertion[r]);else switch(n.assertion[r]){case"and":e.put("&&");break;case"or":e.put("||");break;default:e.error("Bad conjuction operator in assertion",n)}e.put(")")}else switch(n.negation&&e.put("!"),n.assertion.type){case"Identifier":n.assertion.name?(e.put("!!"),e.tolerant&&e.put("(typeof "),e.put("a."),e.put(n.assertion.name),e.tolerant&&(e.put('==="function"?a.'),e.put(n.assertion.name)),e.put(".call(mctx,"),e.nodeOrCurrent(),e.put(")"),e.tolerant&&e.put(":false)"),e.usedAssertions.has(n.assertion.name)?e.usedAssertions.get(n.assertion.name).push(n.assertion.range):e.usedAssertions.set(n.assertion.name,n.assertion.range)):e.put("false");break;case"Method":e.put("!!"),e.node(n.assertion);break;default:e.error('Unknown assertion node type "'+n.assertion.type+'"',n.assertion)}}function K0(n,e){if(Array.isArray(n.assertion))for(let r=0;r<n.assertion.length;r++)r%2===0&&e.node(n.assertion[r]);else e.node(n.assertion)}function Y0(n,e){if(n.negation&&e.put("not "),Array.isArray(n.assertion)){e.put("(");for(let r=0;r<n.assertion.length;r++)r%2===0?e.node(n.assertion[r]):(e.put(" "),e.put(n.assertion[r]),e.put(" "));e.put(")")}else e.node(n.assertion)}var Gl={};Ce(Gl,{compile:()=>J0,stringify:()=>X0,suggest:()=>Q0,walk:()=>Z0});var Sp={in:"in","not in":"notIn",has:"has","has no":"hasNo",and:"and",or:"or","??":"nullish","+":"add","-":"sub","*":"mul","/":"div","%":"mod","=":"eq","!=":"ne","<":"lt","<=":"lte",">":"gt",">=":"gte","~=":"match"};function Ps(n,e,r){if(r.type==="Array"){if(r.elements.length===0){n.range([r.range[0]+1,r.range[1]-1],"value-subset",e,!1);return}let o=[];for(let{type:u,range:f,value:d}of r.elements)f&&(u==="Literal"||u==="Identifier")&&o.push(d);let a=o.length?n.literalList(o):!1;for(let{type:u,range:f,value:d}of r.elements)f&&(u==="Literal"||u==="Identifier"||u==="GetProperty"&&d===null)&&n.range(f,"value-subset",e,a)}}function Q0(n,e){switch(n.operator){case"in":e.range(n.left.range,"in-value",n.right,null),Ps(e,n.left,n.right);break;case"not in":Ps(e,n.left,n.right);break;case"has":e.range(n.right.range,"in-value",n.left,null),Ps(e,n.right,n.left);break;case"has no":Ps(e,n.right,n.left);break;case"=":case"!=":e.range(n.right.range,"value",n.left,null);break}}function J0(n,e){if(!(n.operator in Sp)){e.error('Unknown operator "'+n.operator+'"',n);return}switch(n.operator){case"and":e.put("!");case"or":{let r=e.allocateVar();e.put(`${e.buildinFn("bool")}(${r}=`),e.node(n.left),e.put(`)?${r}:`),e.createScope(()=>e.node(n.right),o=>(e.put(")"),"("+o+","),e.scope.$ref);break}case"??":{let r=e.allocateVar();e.put(`(${r}=`),e.node(n.left),e.put(`,${r}!==null&&${r}!==undefined)?${r}:`),e.createScope(()=>e.node(n.right),o=>(e.put(")"),"("+o+","),e.scope.$ref);break}case"has no":e.put("!");case"has":e.put(e.buildinFn("in")),e.put("("),e.node(n.right),e.put(","),e.node(n.left),e.put(")");break;default:e.put(e.buildinFn(Sp[n.operator])),e.put("("),e.node(n.left),e.put(","),e.node(n.right),e.put(")")}}function Z0(n,e){e.node(n.left),e.node(n.right)}function X0(n,e){e.node(n.left),/^[a-z]/i.test(n.operator)?(e.put(" "),e.put(n.operator),e.put(" ")):e.put(n.operator),e.node(n.right)}var Kl={};Ce(Kl,{compile:()=>tx,stringify:()=>rx,suggest:()=>ex,walk:()=>nx});function ex(n,e){n.body===null&&e.queryRoot(n.range[1])}function tx(n,e){n.definitions.length?(e.put("(()=>{"),e.createScope(()=>{for(let r of n.definitions)e.scope.awaitInit.add(r.declarator.name);e.list(n.definitions),e.put("return "),e.nodeOrCurrent(n.body)},r=>r+";",e.scope.$ref),e.put("})()")):n.body&&n.body.type==="Object"?(e.put("("),e.nodeOrCurrent(n.body),e.put(")")):e.nodeOrCurrent(n.body)}function nx(n,e){e.list(n.definitions),e.nodeOrNothing(n.body)}function rx(n,e){e.list(n.definitions),e.nodeOrNothing(n.body)}var Yl={};Ce(Yl,{compile:()=>ix,stringify:()=>sx,walk:()=>ox});var Ep={"":"cmp",N:"cmpNatural",A:"cmpAnalytical",NA:"cmpNaturalAnalytical",AN:"cmpNaturalAnalytical"};function ix(n,e){let r=n.order.startsWith("desc"),o=Ep[n.order.slice(r?4:3)]||Ep[""];r&&e.put("-"),e.put(e.buildinFn(o)),e.put("((_q=$=>("),e.createScope(()=>e.node(n.query),a=>a+","),e.put("))(_a),_q(_b))")}function ox(n,e){e.node(n.query)}function sx(n,e){e.node(n.query),e.put(" "),e.put(n.order)}var Ql={};Ce(Ql,{compile:()=>ax,stringify:()=>ux,walk:()=>lx});function ax(n,e){e.put("(_a, _b)=>{let _q;return "),e.list(n.compares,"||"),e.put("||0}")}function lx(n,e){e.list(n.compares)}function ux(n,e){e.list(n.compares,",")}var Jl={};Ce(Jl,{compile:()=>cx,stringify:()=>dx,walk:()=>fx});function cx(n,e){e.put(e.buildinFn("bool")),e.put("("),e.nodeOrCurrent(n.test),e.put(")?"),e.createScope(()=>e.nodeOrCurrent(n.consequent),r=>(e.put(")"),"("+r+","),e.scope.$ref),e.put(":"),e.createScope(()=>{n.alternate?n.alternate.type==="Placeholder"?(e.put("("),e.node(n.alternate),e.put(",undefined)")):e.node(n.alternate):e.put("undefined")},r=>(e.put(")"),"("+r+","),e.scope.$ref)}function fx(n,e){e.nodeOrNothing(n.test),e.nodeOrNothing(n.consequent),e.nodeOrNothing(n.alternate)}function dx(n,e){e.nodeOrNothing(n.test),e.put("?"),e.nodeOrNothing(n.consequent),n.alternate&&(e.put(":"),e.node(n.alternate))}var Zl={};Ce(Zl,{compile:()=>px,stringify:()=>gx,walk:()=>hx});function px(n,e){e.put("context")}function hx(){}function gx(n,e){e.put("#")}var Xl={};Ce(Xl,{compile:()=>vx,stringify:()=>bx,suggest:()=>mx,walk:()=>yx});function mx(n,e){n.range&&e.range(n.range,"var")}function vx(n,e){e.put(e.scope.$ref)}function yx(){}function bx(n,e){e.put("$")}var eu={};Ce(eu,{compile:()=>wx,stringify:()=>kx,walk:()=>xx});function wx(n,e){e.put("data")}function xx(){}function kx(n,e){e.put("@")}var tu={};Ce(tu,{compile:()=>Cx,stringify:()=>Ax,walk:()=>Dx});function Cx(n,e){n.name&&e.put("$"+n.name)}function Dx(){}function Ax(n,e){e.put(n.name?"$"+n.name:"$")}var nu={};Ce(nu,{compile:()=>Tx,stringify:()=>Lx,suggest:()=>Ex,walk:()=>Fx});function fo(n,e){return{type:"GetProperty",value:n,property:e}}function po(n){return{type:"Identifier",name:n}}var Sx=["data","context","ctx","array","idx","index"];function Ex(n,e){n.value===null&&e.range(n.declarator.range,"path")}function Tx(n,e){if(n.declarator.name===null){e.node(n.declarator),e.nodeOrCurrent(n.value),e.put(";");return}if(e.scope.own.has(n.declarator.name)){e.error(`Identifier "$${n.declarator.name}" has already been declared`,n.declarator);return}if(Sx.includes(n.declarator.name)){e.error(`Identifier "$${n.declarator.name}" is reserved for future use`,n.declarator);return}e.put("const "),e.node(n.declarator),e.put("="),e.node(n.value||fo(null,po(n.declarator.name))),e.put(";"),e.scope.add(n.declarator.name),e.scope.own.add(n.declarator.name),e.scope.awaitInit.delete(n.declarator.name)}function Fx(n,e){e.node(n.declarator),e.nodeOrNothing(n.value)}function Lx(n,e){e.node(n.declarator),n.value!==null&&(e.put(":"),e.node(n.value)),e.put(";")}var ru={};Ce(ru,{compile:()=>Mx,stringify:()=>Bx,walk:()=>Nx});function Mx(n,e){e.put(e.buildinFn("filter")),e.put("("),e.nodeOrCurrent(n.value),e.put(",$=>"),e.createScope(()=>e.node(n.query),r=>(e.put(")"),"("+r+",")),e.put(")")}function Nx(n,e){e.nodeOrNothing(n.value),e.node(n.query)}function Bx(n,e){e.nodeOrNothing(n.value),e.put(".["),e.node(n.query),e.put("]")}var iu={};Ce(iu,{compile:()=>Ox,stringify:()=>Ix,walk:()=>Px});function Ox(n,e){let r=n.arguments.map(a=>"$"+a.name),o=n.arguments.find((a,u)=>u>0&&r.lastIndexOf("$"+a.name,u-1)!==-1);o&&e.error('Duplicate parameter name "$'+o.name+'" is not allowed',o),e.put("function("),e.put(String(r)||"$"),e.put("){return "),e.createScope(()=>{e.scope.arg1=!0,e.scope.$ref=r[0]||"$";for(let a of n.arguments)e.scope.add(a.name);e.node(n.body)},a=>a+","),e.put("}")}function Px(n,e){e.node(n.body)}function Ix(n,e){e.put("=>"),e.node(n.body)}var ou={};Ce(ou,{compile:()=>zx,stringify:()=>Hx,suggest:()=>jx,walk:()=>Rx});function jx(n,e){e.range(n.property.range,"path",n.value||void 0,!n.value),n.value===null&&e.range(n.property.range,"var"),n.range&&n.value===null&&n.property.range[0]!==n.range[0]&&e.queryRoot(n.range[0])}function zx(n,e){e.put(e.buildinFn("map")),e.put("("),e.nodeOrCurrent(n.value),e.put(","),n.property.type==="Identifier"?e.put(JSON.stringify(n.property.name)):e.node(n.property),e.put(")")}function Rx(n,e){e.nodeOrNothing(n.value),e.node(n.property)}function Hx(n,e){e.nodeOrNothing(n.value)&&e.put("."),e.node(n.property)}var su={};Ce(su,{compile:()=>qx,stringify:()=>Wx,walk:()=>_x});function qx(n,e){e.put(n.name)}function _x(){}function Wx(n,e){e.put(n.name)}var au={};Ce(au,{compile:()=>$x,stringify:()=>Vx,walk:()=>Ux});function $x(n,e){e.put(typeof n.value=="string"?JSON.stringify(n.value):String(n.value))}function Ux(){}function Vx(n,e){e.put(typeof n.value=="string"?JSON.stringify(n.value):String(n.value))}var lu={};Ce(lu,{compile:()=>Gx,stringify:()=>Yx,walk:()=>Kx});function Gx(n,e){e.put(e.buildinFn("map")),e.put("("),e.nodeOrCurrent(n.value),e.put(",$=>"),e.createScope(()=>e.node(n.query),r=>(e.put(")"),"("+r+",")),e.put(")")}function Kx(n,e){e.nodeOrNothing(n.value),e.node(n.query)}function Yx(n,e){e.nodeOrNothing(n.value),e.put(".("),e.node(n.query),e.put(")")}var uu={};Ce(uu,{compile:()=>Qx,stringify:()=>Zx,walk:()=>Jx});function Qx(n,e){e.put(e.buildinFn("mapRecursive")),e.put("("),e.nodeOrCurrent(n.value),e.put(",$=>"),e.createScope(()=>e.node(n.query),r=>(e.put(")"),"("+r+",")),e.put(")")}function Jx(n,e){e.nodeOrNothing(n.value),e.node(n.query)}function Zx(n,e){e.nodeOrNothing(n.value),e.put(".."),e.isSimpleGetPropertyQuery(n.query)||e.isSimpleMethodCallQuery(n.query)?e.node(n.query):(e.put("("),e.node(n.query),e.put(")"))}var cu={};Ce(cu,{compile:()=>ek,stringify:()=>nk,suggest:()=>Xx,walk:()=>tk});function Xx(n,e){n.arguments.length===0&&e.queryRoot(n.range[1]-1)}function ek(n,e,r){let o=n.reference.type==="Identifier";e.tolerant&&e.put("(typeof "),o&&(e.usedMethods.has(n.reference.name)?e.usedMethods.get(n.reference.name).push(n.reference.range):e.usedMethods.set(n.reference.name,[n.reference.range]),e.put("m.")),e.node(n.reference),e.tolerant&&(e.put('==="function"?'),o&&e.put("m."),e.node(n.reference)),e.put(o?".call(mctx,":"("),e.nodeOrCurrent(r),n.arguments.length&&(e.put(","),e.list(n.arguments,",")),e.put(")"),e.tolerant&&e.put(":undefined)")}function tk(n,e){e.node(n.reference),e.list(n.arguments)}function nk(n,e){e.node(n.reference),e.put("("),e.list(n.arguments,","),e.put(")")}var fu={};Ce(fu,{compile:()=>rk,stringify:()=>ok,walk:()=>ik});function rk(n,e){e.node(n.method,n.value)}function ik(n,e){e.nodeOrNothing(n.value),e.node(n.method)}function ok(n,e){e.nodeOrNothing(n.value)&&e.put("."),e.node(n.method)}var du={};Ce(du,{compile:()=>ak,stringify:()=>uk,suggest:()=>sk,walk:()=>lk});function sk(n,e){n.properties.length===0&&e.queryRoot(n.range[0]+1,n.range[1]-1)}function ak(n,e){e.put("{"),e.list(n.properties,","),e.put("}")}function lk(n,e){e.list(n.properties)}function uk(n,e){e.put("{"),e.list(n.properties,","),e.put("}")}var pu={};Ce(pu,{compile:()=>dk,stringify:()=>hk,suggest:()=>fk,walk:()=>pk});var ck=new Set(["Literal","Identifier","Reference","Current"]);function fk(n,e){if(n.value===null)switch(n.key.type){case"Literal":case"Identifier":e.range(n.range,"path"),e.range(n.range,"var");break;case"Current":case"Reference":e.range(n.range,"var");break}}function dk(n,e){let r=n.value;switch(n.key.type){case"Current":e.put("...null");return;case"Literal":e.node(n.key),r=r||fo(null,po(String(n.key.value)));break;case"Identifier":e.node(n.key),r=r||fo(null,po(n.key.name));break;case"Reference":e.node(n.key.name),r=r||n.key;break;default:e.put("["),e.node(n.key),e.put("]")}e.put(":"),e.node(r)}function pk(n,e){e.node(n.key),e.nodeOrNothing(n.value)}function hk(n,e){if(ck.has(n.key.type)){if(e.node(n.key),n.value===null)return}else e.put("["),e.node(n.key),e.put("]");e.put(":"),e.node(n.value)}var hu={};Ce(hu,{compile:()=>gk,stringify:()=>vk,walk:()=>mk});function gk(n,e){e.put("("),e.node(n.body),e.put(")")}function mk(n,e){e.node(n.body)}function vk(n,e){e.put("("),e.node(n.body),e.put(")")}var gu={};Ce(gu,{compile:()=>bk,stringify:()=>xk,suggest:()=>yk,walk:()=>wk});function yk(n,e){if(n.getter===null){let r=n.range[1]-1;e.range([r,r],"key",n.value,!1),e.queryRoot(r)}else(n.getter.type==="GetProperty"||n.getter.type==="Reference"||n.getter.type==="Literal"&&typeof n.getter.value=="string")&&e.range(n.getter.range,"key",n.value,!1)}function bk(n,e){e.put(e.buildinFn("pick")),e.put("("),e.node(n.value),n.getter&&(e.put(","),e.node(n.getter)),e.put(")")}function wk(n,e){e.node(n.value),n.getter!==null&&e.node(n.getter)}function xk(n,e){e.node(n.value),e.put("["),n.getter!==null&&e.node(n.getter),e.put("]")}var mu={};Ce(mu,{compile:()=>kk,stringify:()=>Dk,walk:()=>Ck});function kk(n,e){e.put("($=>("),e.createScope(()=>e.node(n.right),r=>r+","),e.put("))"),e.put("("),e.nodeOrCurrent(n.left),e.put(")")}function Ck(n,e){e.node(n.left),e.node(n.right)}function Dk(n,e){e.node(n.left),e.put("|"),e.node(n.right)}var vu={};Ce(vu,{compile:()=>Sk,stringify:()=>Tk,suggest:()=>Ak,walk:()=>Ek});function Ak(n,e){e.queryRoot(n.range[1])}function Sk(n,e){e.put(e.scope.$ref)}function Ek(){}function Tk(){}var yu={};Ce(yu,{compile:()=>Fk,stringify:()=>Mk,walk:()=>Lk});function Fk(n,e){if(n.operator&&n.operator.type){e.put("($=>("),e.createScope(()=>e.node(n.operator),r=>r+","),e.put("))"),e.put("("),e.node(n.argument),e.put(")");return}e.error('Unknown operator "'+n.operator+'"',n)}function Lk(n,e){e.node(n.argument),n.operator&&n.operator.type&&e.node(n.operator)}function Mk(n,e){e.node(n.argument),e.put(" "),e.node(n.operator)}var bu={};Ce(bu,{compile:()=>Nk,stringify:()=>Ok,walk:()=>Bk});function Nk(n,e){switch(n.operator){case"no":case"not":e.put("!"),e.put(e.buildinFn("bool")),e.put("("),e.node(n.argument),e.put(")");break;case"+":case"-":e.put(n.operator),e.node(n.argument);break;case"is":e.put("!!("),e.node(n.argument),e.put(")");break;default:e.error('Unknown operator "'+n.operator+'"',n)}}function Bk(n,e){e.node(n.argument),n.operator&&n.operator.type&&e.node(n.operator)}function Ok(n,e){e.put(n.operator),n.operator!=="-"&&n.operator!=="+"&&e.put(" "),e.node(n.argument)}var wu={};Ce(wu,{compile:()=>Ik,stringify:()=>zk,suggest:()=>Pk,walk:()=>jk});function Pk(n,e){n.range&&e.range(n.range,"var")}function Ik(n,e){let r=n.name,o=e.scope.has(r.name),a=e.scope.awaitInit.has(r.name);if(!o||a){a?(e.put("f.unsafeRef(()=>$"),e.node(r),e.tolerant||(e.put(","),e.put(JSON.stringify(r.name)),e.put(","),e.put(JSON.stringify(r.range))),e.put(")")):e.tolerant?e.put("undefined"):e.error(`$${r.name} is not defined`,r);return}e.put("$"),e.node(r)}function jk(n,e){e.node(n.name)}function zk(n,e){e.put("$"),e.node(n.name)}var xu={};Ce(xu,{compile:()=>Rk,stringify:()=>qk,walk:()=>Hk});function Rk(n,e){e.put(e.buildinFn("slice")),e.put("("),e.nodeOrCurrent(n.value),n.arguments.slice(0,3).forEach(r=>{e.put(","),r?e.node(r):e.put("undefined")}),e.put(")")}function Hk(n,e){e.nodeOrNothing(n.value);for(let r of n.arguments.slice(0,3))r&&e.node(r)}function qk(n,e){let[r,o,a]=n.arguments;e.nodeOrNothing(n.value),e.put("["),r&&e.node(r),e.put(":"),o&&e.node(o),a&&(e.put(":"),e.node(a)),e.put("]")}var ku={};Ce(ku,{compile:()=>Wk,stringify:()=>Uk,suggest:()=>_k,walk:()=>$k});function _k(n,e){n.query===null&&e.queryRoot(n.range[1])}function Wk(n,e){if(n.array){e.put("..."),e.put(e.buildinFn("ensureArray")),e.put("("),e.nodeOrCurrent(n.query),e.put(")");return}e.put("..."),e.nodeOrCurrent(n.query)}function $k(n,e){e.nodeOrNothing(n.query)}function Uk(n,e){e.put("..."),e.nodeOrNothing(n.query)}var Cu={};Ce(Cu,{compile:()=>Gk,stringify:()=>Yk,suggest:()=>Vk,walk:()=>Kk});function Vk(n,e){for(let[r,o]of Object.entries(n.values))o===null&&e.queryRoot(n.values[Number(r)-1].range[1])}function Gk(n,e){for(let[r,o]of Object.entries(n.values)){let a=Number(r);o!==null&&(a!==0&&e.put("+"),a%2===0?e.put('"'+Tp(o.value,Qk)+'"'):(e.put("("),e.node(o),e.put(")")))}}function Kk(n,e){for(let r of n.values)r!==null&&e.node(r)}function Yk(n,e){let r=n.values.length-1;for(let[o,a]of Object.entries(n.values)){let u=Number(o);u%2===0?(e.put(u===0?"`":"}"),e.put(Tp(a.value,Jk)),e.put(u===r?"`":"${")):a!==null&&e.node(a)}}var Qk=new Map([["\b","\\b"],[`
`,"\\n"],["\r","\\r"],["\f","\\f"],["	","\\t"],["\v","\\v"],["\u2028","\\u2028"],["\u2029","\\u2029"],["\\","\\\\"],['"','\\"']]),Jk=new Map([["\b","\\b"],["\f","\\f"],["	","\\t"],["\v","\\v"],["\\","\\\\"],["$","\\$"]]);function Tp(n,e){let r="";for(let o=0;o<n.length;o++)r+=e.get(n[o])||n[o];return r}var Zk={Arg1:$l,Array:Ul,Assertion:Vl,Binary:Gl,Block:Kl,Compare:Yl,Conditional:Jl,Context:Zl,Current:Xl,Data:eu,Declarator:tu,Definition:nu,Filter:ru,Function:iu,GetProperty:ou,Identifier:su,Literal:au,Map:lu,MapRecursive:uu,Method:cu,MethodCall:fu,Object:du,ObjectEntry:pu,Parentheses:hu,Pick:gu,Pipeline:mu,Placeholder:vu,Postfix:yu,Prefix:bu,Reference:wu,SliceNotation:xu,CompareFunction:Ql,Spread:ku,Template:Cu},ho=n=>new Map(Object.entries(Zk).map(([e,r])=>[e,r[n]]).filter(([,e])=>typeof e=="function")),Xk={};ho("build").forEach((n,e)=>Xk[e]=n);var Du=ho("compile"),Au=ho("walk"),Su=ho("stringify"),Eu=ho("suggest");function go(n,e){function r(f){if(Au.has(f.type))a(f),Au.get(f.type)(f,o),u(f);else throw new Error('Unknown node type "'+f.type+'"')}let o={node:r,nodeOrNothing(f){f!==null&&r(f)},list(f){f.forEach(r)}},a=()=>{},u=()=>{};typeof e=="function"&&(e={enter:e}),e&&(typeof e.enter=="function"&&(a=e.enter),typeof e.leave=="function"&&(u=e.leave)),r(n)}function Fp(n,e){return e>=0&&e<n.length&&/[a-zA-Z_$0-9]/.test(n[e])}function Tu(n,e){let r=n.charCodeAt(e);return r===9||r===10||r===13||r===32}function eC(n,e,r){for(;e<r;e++)if(!Tu(n,e))return!1;return!0}function tC(n,e,r,o,a){let u=[];for(let f=0;f<o.length;f++){let[d,h]=o[f];if(d>=e)break;d<n||(u.push(n,d),n=h)}return(n!==r.length||!a)&&u.push(n,e),u}function nC(n,e,r,o){let a=[];for(let u=0;u<n.length;u++){let[f,d,h,g]=n[u];if(eC(e,f,d)){for(;f>=0&&Tu(e,f-1);)f--;for(;d<e.length&&Tu(e,d);)d++;if(Fp(e,f-1)){if(f===d)continue;f++}if(Fp(e,d)){if(f===d)continue;d--}}let v=tC(f,d,e,r,o);for(let w=0;w<v.length;w+=2)a.push([v[w],v[w+1],h,g])}return a}function rC(n){let e=null,r=[],o=Object.assign(new Map,{literalList:r}),a=(f,d)=>{o.has(f)?o.get(f).push(d):o.set(f,[d])},u={range(f,d,h=e,g=!0){a(h,[...f,d,g])},literalList(f){let d="l"+r.length;return r.push([d,f]),d},queryRoot(f,d=f){a(e,[f,d,"var",!0]),a(e,[f,d,"path",!0])}};return go(n,f=>{if(Eu.has(f.type)){let d=e;e=f,Eu.get(f.type)(f,u),e=d}}),o}function Is(n,{ast:e,commentRanges:r}){let o=rC(e),a=r.length&&r[r.length-1][1]===n.length&&!/[\r\n]$/.test(n);for(let[u,f]of o)o.set(u,nC(f,n,r,a));return o}function iC(n){return n.type==="GetProperty"}function oC(n){return n.type==="MethodCall"}function js(n){function e(a){if(Su.has(a.type))Su.get(a.type)(a,o);else throw new Error('Unknown node type "'+a.type+'"')}let r=[],o={isSimpleGetPropertyQuery:iC,isSimpleMethodCallQuery:oC,put(a){r.push(a)},node:e,nodeOrNothing(a){if(a!==null)return e(a),!0},list(a,u){if(!u){a.forEach(e);return}a.forEach((f,d)=>{d>0&&o.put(u),e(f)})}};return e(n),r.join("")}function Fu(n,e,r){let o=Object.assign(Object.create(SyntaxError.prototype),r),a=new Error;return o.name=n,o.message=e,Object.defineProperty(o,"stack",{get:function(){return(a.stack||"").replace(/^(.+\n){1,3}/,n+": "+e+`
`)}}),o}function Mu(n,e,r){return Lp(n,"query",e,r)}function Nu(n,e,r){return Lp(n,"method",e,r)}var Lu=class n extends Set{constructor(e,r=[],o=!1,a="$"){super(e),this.own=new Set,this.awaitInit=new Set(r),this.firstCurrent=null,this.captureCurrent=[],this.arg1=o,this.$ref=a}spawn(e,r){return new n(this,this.awaitInit,e,r)}};function Lp(n,e,r=!1,o=null){function a(D){let C="s"+g.length;return g.push(D?[C,D]:[C]),C}function u(D){let C=v.get(D);return C||v.set(D,C=a()),C}function f(D,C,L,N,B){let O=[D,C,JSON.stringify(L)];if(L==="var"){if(!F.scope.size)return;O.push(JSON.stringify([...F.scope]))}else N||(N=a()),O.push(N),B&&O.push(typeof B=="string"?B:u(B));return x.push(O),N}function d(D,C,L="$"){let N=F.scope,B=T.length-1;if(F.scope=N.spawn(N.arg1||e==="method",L),D(),F.scope.captureCurrent.length){let z="stat("+F.scope.captureCurrent.reduce((_,W)=>f(...W,_),void 0)+","+F.scope.$ref+")";F.scope.firstCurrent?T[F.scope.firstCurrent]=z:T[B]+=C(z)}F.scope=N}function h(D,C){let L=!1;if(o!==null){if(o.has(D))for(let[N,B,O,z]of o.get(D))O==="var"?f(N,B,O):z===!0?F.scope.captureCurrent.push([N,B,O]):(L||(L=u(D),T.push("stat("+L+",")),O&&f(N,B,O,L,z));D.type==="Current"&&F.scope.firstCurrent===null&&(F.scope.firstCurrent=T.length)}if(Du.has(D.type))Du.get(D.type)(D,F,C);else throw new Error('Unknown node type "'+D.type+'"');L&&T.push(")")}let g=[],v=new WeakMap,w=[],x=[],T=[{toString(){if(e==="query")return["((data,context)=>{",...F.usedMethods.size||F.usedAssertions.size?["const method = (name,...args)=>m[name].apply(mctx,args);","const assertion = (name,...args)=>a[name].apply(mctx,args);","const mctx = Object.freeze({context,method,assertion});"]:[]].join(`
`)+`
`;if(e==="method")return["(function(data){","const mctx = this;","const context = mctx.context;"].join(`
`)+`
`;throw new Error("Unknown kind: "+e)}},{toString(){return w.length>0?"let "+w+`;
`:""}},{toString(){return g.length>0?[`const stat=(s,v)=>(s.add(v),v);
`,"const "+g.map(([D,C])=>D+"=new Set("+(C?JSON.stringify(C):"")+")")+`;
`].join(""):""}},{toString(){let D=o&&Array.isArray(o.literalList)&&o.literalList.map(([C,L])=>C+"="+JSON.stringify(L));return D&&D.length?"const "+D+`;
`:""}},o===null?"return ":`return{
value: `],E={},M=new Set,F={tolerant:r,usedAssertions:new Map,usedMethods:new Map,suggestions:o!==null,buildinFn(D){return M.add(D),"f."+D},scope:new Lu,createScope:d,error:(D,C)=>{let L=new SyntaxError(D);if(C&&C.range&&(L.details={loc:{range:C.range}}),!r)throw L},allocateVar(){let D="tmp"+w.length;return w.push(D),D},put:D=>T.push(D),node:h,nodeOrCurrent(D,C){h(D||{type:"Current"},C)},list(D,C,L){D.forEach((N,B)=>{B>0&&T.push(C),h(N,L)})}};if(d(()=>h(n),D=>(T.push(")"),"("+D+","),"data"),!r){let{usedMethods:D,usedAssertions:C}=F;C.size&&(T.unshift(" this.assertAssertions(a)||"),E.assertAssertions=function(L){for(let[N,B]of C.entries())if(!Dt(L,N))return()=>{throw Object.assign(new Error(`Assertion "${N}" is not defined`),{details:{loc:{range:B}}})}}),D.size&&(T.unshift(" this.assertMethods(m)||"),E.assertMethods=function(L){for(let[N,B]of D.entries())if(!Dt(L,N))return()=>{throw Object.assign(new Error(`Method "${N}" is not defined. If that's a custom method make sure you added it with "methods" section in options`),{details:{loc:{range:B[0]}}})}})}o!==null&&T.push(`,
stats: [`+x.map(D=>"["+D+"]")+`],
methods: m,
assertions: a
}`);try{let D=new Function("f,m,a","return"+T.join("")+"})");return Object.assign(D.bind(E),{toString(){return D.toString().replace(/^(\S+\s+)anonymous([^)\s]+)\s*\)/,"$1query$2)")}})}catch(D){throw Fu("SyntaxError","Jora query compilation error",{compiledSource:T.join(""),details:D})}}var Mp=n=>typeof n=="number"||typeof n=="string",Gt=(n,e)=>e<n.length?n.charCodeAt(e):0,mo=n=>n===43||n===45,dn=n=>n>=48&&n<=57,Bu=n=>n===9||n===10||n===12||n===13||n===32,Ou=n=>n>32&&n<256&&(n<65||n>90)&&(n<97||n>122)&&!dn(n)&&!mo(n)||n===8470,sC=n=>n&&!Bu(n)&&!Ou(n)&&!dn(n),aC=(n,e,r)=>mo(n)?dn(e)?2:e===46&&dn(r)?3:0:dn(n)?1:0,ci=(n,e,r)=>{for(;r(Gt(n,++e)););return e},lC=(n,e,r)=>{let o=Gt(n,e);if(mo(o)&&(o=Gt(n,e+=1)),dn(o)&&(e=ci(n,e,dn),o=Gt(n,e)),o===46&&dn(Gt(n,e+1))){if(r)return e;let a=ci(n,e+1,dn);if(o=Gt(n,a),o===46)return e;e=a}if(o===69||o===101){let a=1;o=Gt(n,e+1),mo(o)&&(a=2,o=Gt(n,e+2)),dn(o)&&(e=ci(n,e+a,dn))}return e},Np=(n,e,r,o)=>{if(e>=n.length)return 0;let a=Gt(n,e);return Bu(a)?1|ci(n,e,Bu)-e<<4:Ou(a)||o&&mo(a)?2|ci(n,e,Ou)-e<<4:aC(a,Gt(n,e+1),Gt(n,e+2))?4|lC(n,e,r)-e<<4:8|ci(n,e,sC)-e<<4},uC=(n,e,r)=>{let o=0,a=0,u=!1,f=!1,d=0,h=0,g=!0;for(;;){let v=Np(n,o,u,f),w=Np(e,a,u,f),x=v&15,T=v>>4,E=w&15,M=w>>4;if(x!==E){if(g&&x&3&&E&12){d=1,h=x,o+=T;continue}if(g&&E&3&&x&12){d=-1,h=E,a+=M;continue}return x-E}if(x===0)return d;g=!1,u=!1,f=!1;let F=T<M?T:M,D=T-M,C="",L="";for(let N=0;N<F;N++)if(C=n[o+N],L=e[a+N],C!==L){D=C<L?-1:1;break}if(x&3)u=n[o+T-1]===".",D!==0&&x>h&&(h=x,d=D);else if(x&4){if(f=!0,D!==0){let N=n.substr(o,T)-e.substr(a,M);if(N!==0)return r?-N:N;if(x>h){let B=Gt(n,o),O=Gt(e,a),z=B===45?-1:1;h=x,d=B!==O&&(B===45||O===43)?-1:B!==O&&(B===43||O===45)?1:(T-M||D)<0?-z:z,r&&(d=-d)}}}else if(D!==0){if(C!==L){let N=n.substr(o,T),B=e.substr(a,M),O=N.toLowerCase(),z=B.toLowerCase();return O!==z?O<z?-1:1:N<B?-1:1}return D}o+=T,a+=M}},Bp=n=>(e,r)=>Mp(e)&&Mp(r)?Math.sign(uC(String(e),String(r),n)):0,Op=Bp(!1),Pp=Bp(!0);var cC=1,fC=2,fi=3,vo=4,dC=5,pC=6,hC=7,gC=8;function Xn(n){switch(typeof n){case"boolean":return cC;case"number":return n!==n?fC:fi;case"string":return vo;case"object":return n===null?dC:pC;case"undefined":return gC;default:return hC}}function di(n,e){let r=Xn(n),o=Xn(e);return r!==o?r<o?-1:1:n<e?-1:n>e?1:0}function Ip(n,e){let r=Xn(n),o=Xn(e);return r!==o?r<o?-1:1:r===fi?e-n:n<e?-1:n>e?1:0}function yr(n,e){let r=Xn(n),o=Xn(e);return(r===fi||r===vo)&&(o===fi||o===vo)?Op(n,e):r!==o?r<o?-1:1:n<e?-1:n>e?1:0}function jp(n,e){let r=Xn(n),o=Xn(e);return(r===fi||r===vo)&&(o===fi||o===vo)?Pp(n,e,!0):r!==o?r<o?-1:1:n<e?-1:n>e?1:0}function Pu(n,e){return n.length===1?(r,o)=>e(n(r),n(o)):n}var It=Object.freeze({unsafeRef:mC,ensureArray:vC,bool:Vt,and:(n,e)=>Vt(n)?e:n,or:(n,e)=>Vt(n)?n:e,add:yC,sub:bC,mul:wC,div:xC,mod:kC,eq:CC,ne:DC,lt:AC,lte:SC,gt:EC,gte:TC,in:zs,notIn:(n,e)=>!zs(n,e),has:(n,e)=>zs(e,n),hasNo:(n,e)=>!zs(e,n),cmp:di,cmpAnalytical:Ip,cmpNatural:yr,cmpNaturalAnalytical:jp,match:FC,pick:LC,indexOf:MC,lastIndexOf:NC,map:Iu,mapRecursive:OC,some:ju,filter:PC,slice:IC});function mC(n,e,r){try{return n()}catch{if(e)throw Object.assign(new ReferenceError(`Cannot access $${e} before initialization`),{details:{name:e,loc:{range:r}}})}}function vC(n){return je(n)?n:[n]}function yC(n,e){return je(n)||je(e)?[...new Set([...je(n)?n:[n],...je(e)?e:[e]])]:n+e}function bC(n,e){if(je(n)){let r=new Set(n);return je(e)?e.forEach(o=>r.delete(o)):r.delete(e),[...r]}return n-e}function wC(n,e){return n*e}function xC(n,e){return n/e}function kC(n,e){return n%e}function CC(n,e){return Object.is(n,e)}function DC(n,e){return!Object.is(n,e)}function AC(n,e){return n<e}function SC(n,e){return n<=e}function EC(n,e){return n>e}function TC(n,e){return n>=e}function zs(n,e){return fn(e)?Dt(e,n):e?zp(e,n)!==-1:!1}function FC(n,e){return typeof e=="function"?ju(n,e):Zn(e)?ju(n,e.test.bind(e)):e==null}function LC(n,e=()=>!0){if(n){if(typeof e=="function"){if(je(n)||typeof n=="string"){for(let r=0;r<n.length;r++)if(Vt(e(n[r],r)))return n[r]}for(let r in n)if(Dt(n,r)&&Vt(e(n[r],r)))return n[r];return}return je(n)||typeof n=="string"?isFinite(e)?n[e<0?n.length+Number(e):Number(e)||0]:void 0:Dt(n,e)?n[e]:void 0}}function MC(n,e,r){return n?zp(n,e,r):-1}function zp(n,e,r=0){if(Number.isNaN(e)&&On(n)){for(let o=vr(r,0);o<n.length;o++)if(Number.isNaN(n[o]))return o}return typeof n.indexOf=="function"?n.indexOf(e,r):-1}function NC(n,e,r){return n?BC(n,e,r):-1}function BC(n,e,r){if(Number.isNaN(e)&&On(n)){for(let o=vr(r,n.length-1);o>=0;o--)if(Number.isNaN(n[o]))return o}return typeof n.lastIndexOf=="function"?n.lastIndexOf(e,vr(r,n.length-1)):-1}function Iu(n,e){let r=typeof e=="function"?e:o=>Ap(o,e);return je(n)?[...n.reduce((o,a)=>ui(o,r(a)),new Set)]:n!==void 0?r(n):n}function OC(n,e){let r=new Set;return ui(r,Iu(n,e)),r.forEach(o=>ui(r,Iu(o,e))),[...r]}function ju(n,e){return je(n)?n.some(r=>Vt(e(r))):Vt(e(n))}function PC(n,e){return je(n)?n.filter(r=>Vt(e(r))):Vt(e(n))?n:void 0}function IC(n,e,r,o=1){if(!On(n))return[];if(e=vr(e,0),r=vr(r,n.length),o=vr(o,1)||1,e=e<0?Math.max(0,n.length+e):Math.min(n.length,e),r=r<0?Math.max(0,n.length+r):Math.min(n.length,r),e>=0&&r>=0&&e<=r&&o===1)return typeof n=="string"?n.slice(e,r):Array.prototype.slice.call(n,e,r);e>r&&([e,r]=[r,e],o=-o);let a=[];if(o>0)for(let u=e;u<r;u+=o)a.push(n[u]);else for(let u=r-1;u>=e;u+=o)a.push(n[u]);return typeof n=="string"?a.join(""):a}var jC=Rp(20)?1/0:Rp(10)?10:0;function Rp(n){return Array.from({length:n},(e,r)=>({idx:r})).sort((e,r)=>e.idx%2-r.idx%2).every((e,r)=>r<n/2?e.idx>>1===r:Math.ceil(n/2)+(e.idx>>1)===r)}function Hp(n,e){return n.length<=jC?n.slice().sort(e):n.map((r,o)=>({value:r,idx:o})).sort((r,o)=>(r.value===void 0?o.value!==void 0:o.value===void 0?-1:e(r.value,o.value))||r.idx-o.idx).map(r=>r.value)}var zC=(n,e)=>n-e,RC=(n,e)=>e-n,Rs=class{constructor(e,r,o,a=!1){this.maxSize=e||1/0,this.compare=r||RC,this.accept=o||null,this.values=[],this.valuesSet=a?new Set:null}add(e){this.accept!==null&&!this.accept(e)||this.valuesSet!==null&&this.valuesSet.has(e)||(this.values.length<this.maxSize?(this.valuesSet!==null&&this.valuesSet.add(e),this.values.push(e),this.heapifyUp(this.values.length-1)):this.compare(this.values[0],e)>0&&(this.valuesSet!==null&&(this.valuesSet.delete(this.values[0]),this.valuesSet.add(e)),this.values[0]=e,this.heapifyDown()))}addArray(e){for(let r=0;r<e.length;r++)this.add(e[r])}extract(){let e=this.values[0],r=this.values.pop();return this.values.length>0&&(this.values[0]=r,this.heapifyDown()),this.valuesSet!==null&&this.valuesSet.delete(e),e}heapifyUp(e){let r=this.values,o=r[e];for(;e>0;){let a=e-1>>1,u=r[a];if(this.compare(u,o)>0)break;r[a]=o,r[e]=u,e=a}}heapifyDown(){let e=this.values,r=e.length,o=r>>1,a=0,u=e[a],f=a,d=u;for(;a<o;){let h=2*a+1,g=e[h],v=h+1;if(this.compare(g,u)>0&&(f=h,d=g),v<r){let w=e[v];this.compare(w,d)>0&&(f=v,d=w)}if(f===a)break;e[a]=d,e[f]=u,a=f,d=u}}[Symbol.iterator](){return this.values.slice().sort(this.compare)[Symbol.iterator]()}},er=class extends Rs{},Hs=class extends Rs{constructor(e,r,o,a){super(e,r?(u,f)=>-r(u,f):zC,o,a)}};var HC=n=>n;function qC(n){return n!==null&&typeof n=="object"?NaN:Number(n)}function pi(n,e,r){if(On(n)){typeof e!="function"&&(e=HC);for(let o of n){let a=e(o);a!==void 0&&r(qC(a))}}}function qp(n,e,r,o,a){if(n.length===0||!isFinite(e)||e<0||e>100)return;let u=0,f=e*(n.length-1)/100,d=Math.floor(f),h=Math.ceil(f),g=!1,v=e<50?new Hs(h+1,a):new er(n.length-d,a);if(pi(n,r,w=>{Number.isNaN(w)&&(g=!0),v.add(w),u++}),g)return NaN;if(n.length!==u){if(u===0)return;f=e*(u-1)/100,d=Math.floor(f),h=Math.ceil(f);let w=e<50?h+1:u-d;for(let x=v.values.length;x>w;x--)v.extract()}if(d!==h){let w=v.extract(),x=v.values[0];return w<=x?w+(x-w)*(f-d):x+(w-x)*(f-d)}return v.values[0]}var _C=n=>n;function _p(n,e){let r,o=0,a=0;return pi(n,e,u=>{if(a++,r===void 0)r=u;else{let f=r,d=Math.abs(f),h=Math.abs(u);r+=u,d!==1/0&&h!==1/0&&(d>=h?o+=f-r+u:o+=u-r+f)}}),r!==void 0&&(r+=o),{sum:r,count:a}}function Wp(n,e){let r=[];return pi(n,e,r.push.bind(r)),r}function $p(n,e){let r=0;if(On(n)){typeof e!="function"&&(e=_C);for(let o of n)e(o)!==void 0&&r++}return r}function Up(n,e){return _p(n,e).sum}function Vp(n,e){let{sum:r,count:o}=_p(n,e);if(o>0)return r/o}function zu(n,e){let r=0,o=0,a=0;if(pi(n,e,u=>{r+=1;let f=u-o;o+=f/r,a+=f*(u-o)}),r>0)return a/r}function Gp(n,e){let r=zu(n,e);if(r!==void 0)return Math.sqrt(r)}function Kp(n,e=yr){let r;if(n&&isFinite(n.length)&&typeof e=="function"){e=Pu(e,yr);for(let o=0;o<n.length;o++){let a=n[o];(r===void 0||e(a,r)<0)&&e(a,void 0)!==0&&(r=a)}}return r}function Yp(n,e=yr){let r;if(n&&isFinite(n.length)&&typeof e=="function"){e=Pu(e,yr);for(let o=0;o<n.length;o++){let a=n[o];(r===void 0||e(a,r)>=0)&&e(a,void 0)!==0&&(r=a)}}return r}function qs(n,e,r){if(On(n))return qp(n,e,r)}function Qp(n,e){return qs(n,50,e)}function WC(){}function $C(n){return n}function Jp(n){return n===null?null:{matched:n.slice(),start:n.index,end:n.index+n[0].length,input:n.input,groups:n.groups||null}}function UC(n){let e=n.pop(),r=typeof e=="string"?null:e,o=r===null?e:n.pop(),a=n.pop();return{matched:n,start:a,end:a+n[0].length,input:o,groups:r}}var VC=String.prototype.replaceAll||function(n,e){return Zn(n)?this.replace(n,e):this.split(n).join(String(e))},yo=Object.freeze({bool:It.bool,filter:It.filter,map:It.map,pick:It.pick,indexOf:It.indexOf,lastIndexOf:It.lastIndexOf,keys(n){return Object.keys(n||{})},values(n){let e=new Set;for(let r in n)Dt(n,r)&&ui(e,n[r]);return[...e]},entries(n){let e=[];for(let r in n)Dt(n,r)&&e.push({key:r,value:n[r]});return e},fromEntries(n){let e=Object.create(null);if(Array.isArray(n))for(let r of n)r&&(e[r.key]=r.value);return e},size(n){return fn(n)?Object.keys(n).length:n&&n.length||0},sort(n,e=di){if(!je(n))return n;if(typeof e=="function"&&e.length!==2){let r=e;e=(o,a)=>{if(o=r(o),a=r(a),Array.isArray(o)&&Array.isArray(a)){if(o.length!==a.length)return o.length<a.length?-1:1;for(let u=0;u<o.length;u++){let f=di(o[u],a[u]);if(f!==0)return f}return 0}return di(o,a)}}return Hp(n,e)},reverse(n){return je(n)?n.slice().reverse():n},slice(n,e,r){return typeof n=="string"||je(n)?n.slice(e,r):Array.prototype.slice.call(n,e,r)},group(n,e,r){let o=new Map,a=[];typeof e!="function"&&(e=WC),typeof r!="function"&&(r=$C),je(n)||(n=[n]);for(let u of n){let f=e(u);if(je(f))if(f.length>0){let d=r(u);for(let h of f)Bs(o,h,d)}else Bs(o,void 0,r(u));else Bs(o,f,r(u))}for(let[u,f]of o)a.push({key:u,value:[...f]});return a},join(n,e){return je(n)?n.join(e):String(n)},match(n,e,r){let o=String(n),a=Zn(e)?e.flags:"";if(r||a.includes("g")){let u=[],f=new RegExp(e,(a||"").replace(/g|$/,"g")),d;for(;d=f.exec(o);)u.push(Jp(d));return u}return Jp(o.match(e))},reduce(n,e,r=void 0){return je(n)?r!==void 0?n.reduce((o,a)=>e(a,o),r):n.reduce((o,a)=>e(a,o)):e(n,r)},split(n,e){if(je(n)){let r=typeof e=="function"?e:Object.is.bind(null,e),o=[],a=0,u=0;for(;u<n.length;u++)r(n[u])&&(o.push(n.slice(a,u)),a=u+1);return o.push(n.slice(a,u)),o}return String(n).split(e)},replace(n,e,r){if(je(n)){let o=typeof e=="function"?e:Object.is.bind(null,e),a=[...n];for(let u=0;u<a.length;u++){let f=a[u];o(f)&&(a[u]=typeof r=="function"?r(f):r)}return a}return Zn(e)&&!e.flags.includes("g")&&(e=new RegExp(e,e.flags+"g")),VC.call(String(n),e,typeof r=="function"?(...o)=>r(UC(o)):r)},toLowerCase(n,e){return String(n).toLocaleLowerCase(e)},toUpperCase(n,e){return String(n).toLocaleUpperCase(e)},trim(n){return String(n).trim()},...["abs","acos","acosh","asin","asinh","atan","atan2","atanh","cbrt","ceil","clz32","cos","cosh","exp","expm1","floor","fround","hypot","imul","log10","log2","pow","round","sign","sin","sinh","sqrt","tan","tanh","trunc"].reduce((n,e)=>(n[e]=Math[e],n),{}),ln:Math.log,ln1p:Math.log1p,numbers:Wp,count:$p,sum:Up,avg:Vp,variance:zu,stdev:Gp,min:Kp,max:Yp,percentile:qs,p:qs,median:Qp});var bo=Object.freeze({function:n=>typeof n=="function",symbol:n=>typeof n=="symbol",primitive:n=>n===null||typeof n!="object"&&typeof n!="function",string:n=>typeof n=="string",number:n=>typeof n=="number",int:Number.isInteger,finite:n=>Number.isFinite(n),nan:n=>Number.isNaN(n),infinity:n=>n===1/0||n===-1/0,boolean:n=>n===!0||n===!1,null:n=>n===null,undefined:n=>n===void 0,nullish:n=>n==null,object:fn,array:je,regexp:Zn,truthy:Vt,falsy:n=>!Vt(n)});var GC={path:"property",key:"value",value:"value","in-value":"value","value-subset":"value",var:"variable",assertion:"assertion"};function _s(n,e){Object.keys(n).forEach(e.add,e)}function KC(n,e,r,o=new Set){let a=u=>{switch(typeof u){case"string":case"number":o.add(u);break}};switch(n){case"path":{let u=new Set;for(let f of e)if(Array.isArray(f))for(let d of f)fn(d)&&_s(d,u);else fn(f)&&_s(f,u);u.forEach(o.add,o);break}case"key":{let u=new Set;for(let f of e)f!==null&&typeof f=="object"&&!Array.isArray(f)&&_s(f,u);u.forEach(o.add,o);break}case"value":for(let u of e)a(u);break;case"in-value":{let u=new Set;for(let f of e)je(f)?f.forEach(a):fn(f)&&_s(f,u);u.forEach(o.add,o);break}case"var":for(let u of e)o.add("$"+u);break;case"value-subset":{let u=new Set(r);for(let f of e)u.has(f)||a(f);break}}return o}function Zp(n,e,r,o=!1){let a=[];for(let[u,f,d,h,g=null]of r)if(e>=u&&e<=f&&(o||h.size||h.length)){let v=n.substring(u,f);/\S/.test(v)||(u=f=e,v=""),a.push({context:d,from:u,to:f,text:v,values:h,related:g})}return a}function Xp(n,e){return typeof n=="function"?n:n===!0?e:!1}function eh(n){if(/^(["']).*\1$/.test(n))try{return n[0]==="'"&&(n=`"${n.slice(1,-1).replace(/\\.|"/g,e=>e==="\\'"?"'":e==='"'?'\\"':e)}"`),JSON.parse(n)}catch{}return n}function YC(n){return e=>(typeof e=="string"?e:String(e)).toLowerCase().indexOf(n)!==-1}var Ru=(n,{value:e,stats:r,assertions:o})=>({get value(){return e},stat(a,u){return Zp(n,a,r,u)},suggestion(a,u){let{limit:f=1/0,sort:d,filter:h}=u||{};d=Xp(d,It.cmp),h=Xp(h,YC);let g=d&&isFinite(f)?er:Set,v=Zp(n,a,r,!0),w=new Map,x=[];for(let T of v){let{context:E,text:M,from:F,to:D,values:C,related:L}=T,N=GC[E];if(!w.has(N)){let O;switch(g){case er:O=new er(f,d,h&&h(eh(M)),!0);break;case Set:O=new Set;break}w.set(N,{type:N,from:F,to:D,text:M,suggestions:O})}let{suggestions:B}=w.get(N);switch(E){case"assertion":if(B.size===0||B.values&&B.values.length===0)for(let O of Object.keys(o))B.add(O);break;default:KC(E,C,L,B)}}if(g===Set)for(let T of w.values()){let{suggestions:E}=T;if(d&&(E=[...E].sort(d)),h||isFinite(f)){let M=[],F=h?h(eh(T.text)):()=>!0;for(let D of E)if(F(D)&&M.push(D)>=f)break;E=M}T.suggestions=E}for(let T of w.values())T.suggestions=Array.isArray(T.suggestions)?T.suggestions:[...T.suggestions],T.suggestions.length&&x.push(T);return x.length?x:null}});var QC=new Map,JC=new Map,ZC=new Map,XC=new Map;function th(n,e,r,o,a){typeof r=="string"?Object.defineProperty(n,e,{configurable:!0,get(){let f=Hu(r,"method")(It,o,a);return Object.defineProperty(n,e,{enumerable:!0,value:f}),f}}):typeof r=="function"&&Object.defineProperty(n,e,{enumerable:!0,value:r})}function nh(n,e){if(!n&&!e)return{queryMethods:yo,queryAssertions:bo};let r={...yo},o={...bo};for(let[a,u]of Object.entries(n||{})){if(Dt(yo,a))throw new Error(`Builtin method "${a}" can't be overridden`);th(r,a,u,r,o)}for(let[a,u]of Object.entries(e||{})){if(Dt(bo,a))throw new Error(`Builtin assertion "${a}" can't be overridden`);th(o,a,u,r,o)}return{queryMethods:r,queryAssertions:o}}function e1(n,e){console.log(`[${n}]`),typeof e=="string"?console.log(e):e!==void 0&&console.dir(e,{depth:null}),console.log()}function Hu(n,e,r,o,a){a=typeof a=="function"?a:a?e1:!1,a&&(a("========================="),a("Compile query from source",n));let u=Os.parse(n,o);a&&(a("AST",u.ast),a("Restored source",js(u.ast)));let f=r?Is(n,u):null;if(a&&f){let h=x=>JSON.stringify(x).slice(1,-1),g=[].concat(...[...f.entries()].map(([x,T])=>T.map(E=>[x,...E]))),v=[],w=null;a("Stat/suggestion ranges",g.sort((x,T)=>x[1]-T[1]).map(([x,...T])=>{let[E,M,F,D]=T,C;if(E===v[0]&&M===v[1])C=" ".repeat(w.length);else{let L=h(n.slice(0,E)).length,N=h(n.substring(E,M)).length;v=T,w=" ".repeat(L)+(N?"~".repeat(N):"\\")+" "+E+":"+M,C=h(n)+`
`+w}return C+" ["+F+"] on "+x.type+(D===!0?" (current)":D&&D.type?" & "+D.type:"")}).join(`
`))}let d=e==="method"?Nu(u.ast,o,f):Mu(u.ast,o,f);return a&&a("Compiled code",d.toString()),d}function t1(n,e){e=e||{};let r=!!e.stat,o=!!e.tolerant,a=r?o?XC:JC:o?ZC:QC,{methods:u,assertions:f}=e||{},{queryMethods:d,queryAssertions:h}=nh(u,f),g;return n=String(n),a.has(n)&&!e.debug?g=a.get(n):(g=Hu(n,"query",r,o,e.debug),a.set(n,g)),g=g(It,d,h),r?Object.assign((v,w)=>Ru(n,g(v,w)),{query:g}):g}function n1(n){let e=new Map,r=new Map,o=new Map,a=new Map,{methods:u,assertions:f}=n||{},{queryMethods:d,queryAssertions:h}=nh(u,f);return function(v,w){w=w||{};let x=!!w.stat,T=!!w.tolerant,E=x?T?a:r:T?o:e,M;if(v=String(v),E.has(v)&&!w.debug)M=E.get(v);else{let F=Hu(v,"query",x,T,w.debug)(It,d,h);M=x?Object.assign((D,C)=>Ru(v,F(D,C)),{query:F}):F,E.set(v,M)}return M}}var Jt=Object.assign(t1,{version:Dp,buildin:It,methods:yo,assertions:bo,setup:n1,syntax:{tokenize:Os.tokenize,parse:Os.parse,suggest:Is,walk:go,stringify:js,compile:Mu,compileMethod:Nu}});function r1(n){if(!n||typeof n!="object")return"value is not an object";let{name:e,test:r,decode:o}=n;return typeof e!="string"?"missed name":typeof r!="function"?"missed test function":typeof o!="function"?"missed decode function":!1}function i1(n){let e=r1(n);if(e)throw new Error(`Bad encoding config${n?.name?` "${n.name}"`:""}: ${e}`);let{name:r,test:o,streaming:a,decode:u}=n;return Object.freeze(a?{name:r||"unknown",test:o,streaming:!0,decode:u}:{name:r||"unknown",test:o,streaming:!1,decode:u})}function Ws(n){if(!n)return[];if(!Array.isArray(n))throw new Error("Encodings must be an array");return n.map(i1)}var At=class{subscriber;value;constructor(e,r){this.subscriber=null,this.value=e,this.shouldUpdate=typeof r=="function"?r:this.shouldUpdate}get readonly(){let e=this;return{subscribe:this.subscribe.bind(this),subscribeSync:this.subscribeSync.bind(this),unsubscribe:this.unsubscribe.bind(this),get value(){return e.value}}}subscribe(e){return this.subscriber={callback:e,subscriber:this.subscriber},()=>this.unsubscribe(e)}subscribeSync(e){let r=this.subscribe(e);return e(this.value,r),r}unsubscribe(e){let r=this,o=this.subscriber;for(;o!==null;){if(o.callback===e){o.callback=null,r.subscriber=o.subscriber;break}r=o,o=o.subscriber}}shouldUpdate(e,r){return e!==r}set(e){return this.#e(e)!==!1}asyncSet(e){let r=this.#e(e);return r===!1?Promise.resolve(!1):Promise.all(r).then(()=>!0)}#e(e){if(!this.shouldUpdate(e,this.value))return!1;let r=[],o=this.subscriber;for(this.value=e;o!==null;){let{callback:a}=o;a!==null&&r.push(a(e,()=>this.unsubscribe(a))),o=o.subscriber}return r}};function qu(n){return typeof n=="object"&&n!==null&&(typeof n[Symbol.iterator]=="function"||typeof n[Symbol.asyncIterator]=="function")}function _u(n,e,r,o){switch(r&&typeof r.toJSON=="function"&&(r=r.toJSON()),o!==null&&(r=o.call(n,String(e),r)),typeof r){case"function":case"symbol":r=void 0;break;case"object":if(r!==null){let a=r.constructor;(a===String||a===Number||a===Boolean)&&(r=r.valueOf())}break}return r}function o1(n){return typeof n=="function"?n:Array.isArray(n)?[...new Set(n.map(r=>{let o=r&&r.constructor;return o===String||o===Number?String(r):null}).filter(r=>typeof r=="string"))]:null}function s1(n){return typeof n=="number"?!Number.isFinite(n)||n<1?!1:" ".repeat(Math.min(n,10)):typeof n=="string"&&n.slice(0,10)||!1}function Wu(n,e){(n===null||Array.isArray(n)||typeof n!="object")&&(n={replacer:n,space:e});let r=o1(n.replacer),o=Object.keys;if(Array.isArray(r)){let a=r;o=()=>a,r=null}return{...n,replacer:r,getKeys:o,space:s1(n.space)}}var wo=1,a1=2,l1=new TextDecoder;function u1(n,e){return n.name==="SyntaxError"&&e.jsonParseOffset&&(n.message=n.message.replace(/at position (\d+)/,(r,o)=>"at position "+(Number(o)+e.jsonParseOffset))),n}function c1(n,e){let r=n.length;n.length+=e.length;for(let o=0;o<e.length;o++)n[r+o]=e[o]}async function $s(n){let e=typeof n=="function"?n():n;if(qu(e)){let r=new $u;try{for await(let o of e){if(typeof o!="string"&&!ArrayBuffer.isView(o))throw new TypeError("Invalid chunk: Expected string, TypedArray or Buffer");r.push(o)}return r.finish()}catch(o){throw u1(o,r)}}throw new TypeError("Invalid chunk emitter: Expected an Iterable, AsyncIterable, generator, async generator, or a function returning an Iterable or AsyncIterable")}var $u=class{constructor(){this.value=void 0,this.valueStack=null,this.stack=new Array(100),this.lastFlushDepth=0,this.flushDepth=0,this.stateString=!1,this.stateStringEscape=!1,this.pendingByteSeq=null,this.pendingChunk=null,this.chunkOffset=0,this.jsonParseOffset=0}parseAndAppend(e,r){this.stack[this.lastFlushDepth-1]===wo?(r&&(this.jsonParseOffset--,e="{"+e+"}"),Object.assign(this.valueStack.value,JSON.parse(e))):(r&&(this.jsonParseOffset--,e="["+e+"]"),c1(this.valueStack.value,JSON.parse(e)))}prepareAddition(e){let{value:r}=this.valueStack;if(Array.isArray(r)?r.length!==0:Object.keys(r).length!==0){if(e[0]===",")return this.jsonParseOffset++,e.slice(1);if(e[0]!=="}"&&e[0]!=="]")return this.jsonParseOffset-=3,"[[]"+e}return e}flush(e,r,o){let a=e.slice(r,o);if(this.jsonParseOffset=this.chunkOffset+r,this.pendingChunk!==null&&(a=this.pendingChunk+a,this.jsonParseOffset-=this.pendingChunk.length,this.pendingChunk=null),this.flushDepth===this.lastFlushDepth)this.flushDepth>0?this.parseAndAppend(this.prepareAddition(a),!0):(this.value=JSON.parse(a),this.valueStack={value:this.value,prev:null});else if(this.flushDepth>this.lastFlushDepth){for(let u=this.flushDepth-1;u>=this.lastFlushDepth;u--)a+=this.stack[u]===wo?"}":"]";this.lastFlushDepth===0?(this.value=JSON.parse(a),this.valueStack={value:this.value,prev:null}):this.parseAndAppend(this.prepareAddition(a),!0);for(let u=this.lastFlushDepth||1;u<this.flushDepth;u++){let f=this.valueStack.value;if(this.stack[u-1]===wo){let d;for(d in f);f=f[d]}else f=f[f.length-1];this.valueStack={value:f,prev:this.valueStack}}}else{a=this.prepareAddition(a);for(let u=this.lastFlushDepth-1;u>=this.flushDepth;u--)this.jsonParseOffset--,a=(this.stack[u]===wo?"{":"[")+a;this.parseAndAppend(a,!1);for(let u=this.lastFlushDepth-1;u>=this.flushDepth;u--)this.valueStack=this.valueStack.prev}this.lastFlushDepth=this.flushDepth}push(e){if(typeof e!="string"){if(this.pendingByteSeq!==null){let u=e;e=new Uint8Array(this.pendingByteSeq.length+u.length),e.set(this.pendingByteSeq),e.set(u,this.pendingByteSeq.length),this.pendingByteSeq=null}if(e[e.length-1]>127)for(let u=0;u<e.length;u++){let f=e[e.length-1-u];if(f>>6===3){u++,(u!==4&&f>>3===30||u!==3&&f>>4===14||u!==2&&f>>5===6)&&(this.pendingByteSeq=e.slice(e.length-u),e=e.slice(0,-u));break}}e=l1.decode(e)}let r=e.length,o=0,a=0;e:for(let u=0;u<r;u++){if(this.stateString){for(;u<r;u++)if(this.stateStringEscape)this.stateStringEscape=!1;else switch(e.charCodeAt(u)){case 34:this.stateString=!1;continue e;case 92:this.stateStringEscape=!0}break}switch(e.charCodeAt(u)){case 34:this.stateString=!0,this.stateStringEscape=!1;break;case 44:a=u;break;case 123:a=u+1,this.stack[this.flushDepth++]=wo;break;case 91:a=u+1,this.stack[this.flushDepth++]=a1;break;case 93:case 125:a=u+1,this.flushDepth--,this.flushDepth<this.lastFlushDepth&&(this.flush(e,o,a),o=a);break;case 9:case 10:case 13:case 32:o===u&&o++,a===u&&a++;break}}a>o&&this.flush(e,o,a),a<r&&(this.pendingChunk!==null?this.pendingChunk+=e:this.pendingChunk=e.slice(a,r)),this.chunkOffset+=r}finish(){return this.pendingChunk!==null&&(this.flush("",0,0),this.pendingChunk=null),this.value}};var f1=typeof Object.hasOwn=="function"?Object.hasOwn:(n,e)=>Object.hasOwnProperty.call(n,e),d1={8:"\\b",9:"\\t",10:"\\n",12:"\\f",13:"\\r",34:'\\"',92:"\\\\"},p1=Uint8Array.from({length:2048},(n,e)=>f1(d1,e)?2:e<32?6:e<128?1:2);function h1(n){return n>=55296&&n<=56319}function g1(n){return n>=56320&&n<=57343}function rh(n){if(!/[^\x20\x21\x23-\x5B\x5D-\x7F]/.test(n))return n.length+2;let e=0,r=!1;for(let o=0;o<n.length;o++){let a=n.charCodeAt(o);if(a<2048)e+=p1[a];else if(h1(a)){e+=6,r=!0;continue}else g1(a)?e=r?e-2:e+6:e+=3;r=!1}return e+2}function m1(n){let e=0;return n<0&&(e=1,n=-n),n>=1e9&&(e+=9,n=(n-n%1e9)/1e9),n>=1e4?n>=1e6?e+(n>=1e8?9:n>=1e7?8:7):e+(n>=1e5?6:5):e+(n>=100?n>=1e3?4:3:n>=10?2:1)}function v1(n){switch(typeof n){case"string":return rh(n);case"number":return Number.isFinite(n)?Number.isInteger(n)?m1(n):String(n).length:4;case"boolean":return n?4:5;case"undefined":case"object":return 4;default:return 0}}function xo(n,...e){let{replacer:r,getKeys:o,...a}=Wu(...e),u=!!a.continueOnCircular,f=a.space?.length||0,d=new Map,h=new Map,g=new Set,v=[],w={"":n},x=!1,T=0,E=0,M=0;return F(w,"",n),T===0&&(T+=9),{bytes:isNaN(T)?1/0:T+E,spaceBytes:f>0&&isNaN(T)?1/0:E,circular:[...g]};function F(D,C,L){if(!x)if(L=_u(D,C,L,r),L===null||typeof L!="object")(L!==void 0||Array.isArray(D))&&(T+=v1(L));else{if(v.includes(L)){g.add(L),T+=4,u||(x=!0);return}if(h.has(L)){T+=h.get(L);return}M++;let N=M,B=T,O=0;if(v.push(L),Array.isArray(L)){O=L.length;for(let z=0;z<O;z++)F(L,z,L[z])}else{let z=T;for(let _ of o(L))if(F(L,_,L[_]),z!==T){let W=d.get(_);W===void 0&&d.set(_,W=rh(_)+1),T+=W,O++,z=T}}T+=O===0?2:1+O,f>0&&O>0&&(E+=(Array.isArray(L)?0:O)+(1+v.length*f)*(O+1)-f),v.pop(),N!==M&&h.set(L,T-B)}}}var Uu=Object.freeze({name:"json",test:()=>!0,streaming:!0,decode:$s});var b1=new Uint8Array([0,0,74,83,79,78,88,76]),ah=9,w1=268435455,x1=4294967295,Us=2,ko=4,Vu=8,Do=16,Vs=32,Gs=64,hi=128,k1=0,C1=1,D1=2,A1=3,S1=4,E1=5,T1=6,F1=8,L1=9,M1=10,N1=11,B1=12,O1=224,P1=7936,lh=0,Gu=1,I1=2,j1=3,z1=4,R1=5,uh=6,ch=7,H1=8,ih=16,oh=32,gF=~Do,q1=Us|Vs|Gs,fh=new Uint8Array(256).map((n,e)=>{for(let r=0;r<8;r++)n+=e>>r&1;return n});function _1(n,e,r,o=new Array(r)){let a=e&15,u=e&48,f=r,d=0,h=0;switch(u){case ih:{d=o[0]=n.readIntVar(),f--,h=1;break}case oh:{d=n.readIntVar();break}}switch(a){case I1:{for(let g=0;g<f;g++)o[h+g]=n.readVlq();break}case j1:{for(let g=0;g<f;g++)o[h+g]=n.readIntVar();break}case z1:{let g=n.readBytes(Math.ceil(f/2));for(let v=0,w=0;v<f;v++)w=v&1?w>>4:g[v>>1],o[h+v]=w&8?n.readVlq()*8+(w&7):w&7;break}case R1:{let g=n.readBytes(Math.ceil(f/2));for(let v=0,w=0;v<f;v++){w=v&1?w>>4:g[v>>1];let x=w&4?-1:1;o[h+v]=w&8?x*(n.readVlq()*4+(w&3)):x*(w&3)}break}case uh:{let g=e>>8,v=(1<<g)-1,w=n.readBytes(Math.ceil(f*g/8)),x=0,T=0,E=0;for(let M=0;M<f;M++){for(;T<g;)E|=w[x++]<<T,T+=8;o[h+M]=E&v,E>>=g,T-=g}break}case ch:{let g=e>>8,v=(1<<g)-1,w=n.readBytes(Math.ceil(f*g/8)),x=0,T=0,E=0;for(let M=0;M<f;M++){for(;T<g;)E|=w[x++]<<T,T+=8;o[h+M]=E&1?-((E&v)>>1):(E&v)>>1,E>>=g,T-=g}break}case H1:{let g=o[0]=n.readIntVar(),v=n.readIntVar();for(let w=1;w<r;w++)o[w]=g+=v;break}case lh:case Gu:{let g=a===Gu,v=e>>8,w=g?e&P1|v&O1:v;if(fh[v]>1){let x=n.readTypeIndex(f,w);for(let T=0;T<f;T++)o[h+T]=n.readNumber(x[T])}else{let x=31-Math.clz32(w);for(let T=0;T<f;T++)o[h+T]=n.readNumber(x)}break}default:throw new Error(`Unknown numeric array encoding method: ${a}`)}switch(u){case ih:{o[0]=d;for(let g=1;g<r;g++)o[g]+=o[g-1];break}case oh:{for(let g=0;g<r;g++)o[g]+=d;break}}return o}var Co=12;function W1(n){return n===ah||n===9}function dh(n){try{let{version:e}=ph(n);if(W1(e))return!0;throw new Error(`Unsupported jsonxl version "${e}", expected "${ah}"`)}catch{return!1}}function ph(n){if(n.byteLength<Co)throw new Error(`Header length must be at least ${Co} bytes`);let e=new Uint8Array(n.buffer,n.byteOffset,Co);if(e.subarray(0,8).some((u,f)=>u!==b1[f]))throw new Error("Bad magic number");let r=new DataView(e.buffer,e.byteOffset,Co),o=r.getUint16(8,!0),a=r.getUint16(10,!0);return{version:o,flags:a,headerSize:Co}}var $1=new TextDecoder("utf8",{ignoreBOM:!0});function U1(n){let e=$1.decode(n.readBytes(n.readVlq())),r=n.readNumericArray(),o=n.readNumericArray(),a=n.readNumericArray(),u=new Array(r);for(let f=0,d=0,h=0,g=0,v="";f<r.length;f++){let w=r[f],x=e.slice(d,d+=w>>2);w&2&&(x=v.slice(0,o[h++])+x),w&1&&(x=x+v.slice(-a[g++])),u[f]=x,v=x}return u}var V1=class{constructor(n,e){this.view=new DataView(n.buffer,n.byteOffset,n.byteLength),this.bytes=n,this.pos=0,typeof e=="function"&&e(this),this.consumeHeader(),this.loadStrings(),this.loadArrayLengths(),this.loadArrayHeaders(),this.loadObjectEntries()}consumeHeader(){let{version:n,flags:e,headerSize:r}=ph(this.view);return this.pos+=r,{version:n,flags:e}}loadStrings(){this.strings=U1(this),this.stringRefs=this.readNumericArray(),this.stringRefsCursor=0}loadArrayHeaders(){this.arrayHeaders=this.readNumericArray(),this.arrayHeaderRefs=this.readNumericArray(),this.arrayHeaderRefsCursor=0}loadArrayLengths(){this.arrayLengths=this.readNumericArray(),this.arrayLengthsCursor=0}loadObjectEntries(){let n=this.readVlq(),e=this.readVlq();this.objectEntries=new Array(n),this.objectKeys=e?this.stringRefs.slice(-e).map(r=>this.strings[r]):[];for(let r=0;r<n;r++)this.objectEntries[r]={dict:this.readNumericArray(),refs:this.readNumericArray(),cursor:0}}readString(){return this.strings[this.stringRefs[this.stringRefsCursor++]]}readArrayHeader(){return this.arrayHeaders[this.arrayHeaderRefs[this.arrayHeaderRefsCursor++]]}readArrayLength(){return this.arrayLengths[this.arrayLengthsCursor++]}readObjectEntry(n){let e=this.objectEntries[n],r=e.refs[e.cursor++],o=e.dict[r];return o===0?null:{key:this.objectKeys[o>>8],type:o&255}}readBytes(n){return this.bytes.subarray(this.pos,this.pos+=n)}readTypeIndex(n,e,r){let o=0,a=0,u=0;for(;e>0;)e&1&&(o|=u<<(a++<<2)),u++,e>>=1;let f=new Uint8Array(n),d=32-Math.clz32(a-1),h=(1<<d)-1,g=this.readBytes(Math.ceil(d*n/8)),v=0,w=0,x=0;for(let T=0;T<n;T++){x<d&&(w|=g[v++]<<x,x+=8);let E=o>>((w&h)<<2)&15;f[T]=r?1<<E:E,w>>=d,x-=d}return f}readVlq(){let n=this.view.getUint8(this.pos);if(!(n&1))n=n>>1,this.pos+=1;else if(!(n&2))n=this.view.getUint8(this.pos+1)<<6|n>>2,this.pos+=2;else if(!(n&4))n=this.view.getUint16(this.pos+1,!0)<<5|n>>3,this.pos+=3;else{let e=this.view.getUint32(this.pos,!0);n=e>>>3&w1,this.pos+=4,e>>>31&&(n+=this.readUintVar()*(1<<28))}return n}readUintVar(){let n=this.view.getUint8(this.pos++),e=n&127,r=128;for(;n&128;)n=this.view.getUint8(this.pos++),e+=(n&127)*r,r*=128;return e}readIntVar(){let n=this.readUintVar();return n&1?-(n-1)/2:n<=x1?n>>>1:n/2}readUint8(){let n=this.view.getUint8(this.pos);return this.pos++,n}readInt8(){let n=this.view.getInt8(this.pos);return this.pos++,n}readUint16(){let n=this.view.getUint16(this.pos,!0);return this.pos+=2,n}readInt16(){let n=this.view.getInt16(this.pos,!0);return this.pos+=2,n}readUint24(){let n=this.view.getUint16(this.pos,!0)|this.view.getUint8(this.pos+2)<<16;return this.pos+=3,n}readInt24(){let n=this.view.getUint16(this.pos,!0),e=this.view.getUint8(this.pos+2),r=e&128?(e<<16|n)-16777216:e<<16|n;return this.pos+=3,r}readUint32(){let n=this.view.getUint32(this.pos,!0);return this.pos+=4,n}readInt32(){let n=this.view.getInt32(this.pos,!0);return this.pos+=4,n}readFloat32(){let n=this.view.getFloat32(this.pos,!0);return this.pos+=4,n}readFloat64(){let n=this.view.getFloat64(this.pos,!0);return this.pos+=8,n}readNumber(n){switch(n){case k1:return this.readUint8();case C1:return this.readUint16();case D1:return this.readUint24();case A1:return this.readUint32();case S1:return this.readUintVar();case F1:return this.readInt8();case L1:return this.readInt16();case M1:return this.readInt24();case N1:return this.readInt32();case B1:return this.readIntVar();case E1:return this.readFloat32();case T1:return this.readFloat64()}}readNumericArrayEncoding(){let n=this.readUint8();switch(n&15){case lh:case Gu:case uh:case ch:n|=this.readUint8()<<8;break}return n}readNumericArray(n=this.readVlq()){if(n===0)return[];let e=this.readNumericArrayEncoding();return this.readNumbers(e,n)}readNumbers(n,e,r){return _1(this,n,e,r)}};function sh(n,e){let r=0;for(let o=0;o<n.length;o++)n[o]===e&&r++;return r}function hh(n,e){function r(d={}){let h=0,g;for(;g=u.readObjectEntry(h++);)d[g.key]=a(g.type);return d}function o(d=u.readArrayLength()){if(d===0)return[];let h=u.readArrayHeader(),g=h>>16,v=h&65535,w=g&1,x=g>>5&1,T=g>>9&1,E=g>>1&255|(g&1)<<4,M=new Array(d),F=fh[E]>1?u.readTypeIndex(d,E,!0):null;if(E&q1)if(F===null)switch(E){case Us:M.fill(null);break;case Vs:M.fill(!0);break;case Gs:M.fill(!1);break}else for(let D=0;D<d;D++)switch(F[D]){case Us:M[D]=null;break;case Vs:M[D]=!0;break;case Gs:M[D]=!1;break}if(E&Vu)for(let D=0;D<d;D++)(F===null||F[D]===Vu)&&(M[D]=u.readString());if(E&ko)if(E===ko)u.readNumbers(v,d,M);else{let D=sh(F,ko),C=u.readNumbers(v,D);for(let L=0,N=0;L<d;L++)F[L]===ko&&(M[L]=C[N++])}if(E&hi)if(T){let D=E===hi?d:sh(F,hi),C=u.readNumericArray(D),L=o();for(let N=0,B=0,O=0;N<d;N++)(F===null||F[N]===hi)&&(M[N]=L.slice(O,O+=C[B++]))}else for(let D=0;D<d;D++)(F===null||F[D]===hi)&&(M[D]=o());if(E&Do){let D=E===Do?M:[];for(let C=0,L=0;C<d;C++)(F===null||F[C]===Do)&&(M[C]=D[L++]={});if(x){let C=u.readVlq(),L=new Array(C);for(let N=0;N<C;N++)L[N]=u.readString();for(let N=0;N<C;N++){let B=L[N],O=o(D.length);for(let z=0;z<D.length;z++)O[z]!==void 0&&(D[z][B]=O[z])}}if(w)for(let C=0;C<D.length;C++)r(D[C])}return M}function a(d){switch(1<<(d&7)){case Us:return null;case Vu:return u.readString();case ko:return u.readNumber(d>>3);case Do:return r();case Vs:return!0;case Gs:return!1;case hi:return o()}}let u=new V1(n,e),f=a(u.readUint8());if(u.pos!==n.byteLength)throw new Error("End of input is not reached");return f}var Ks=Object.freeze({name:"jsonxl/snapshot9",test:dh,streaming:!1,decode:hh});var gh=[{name:"gzip",test:n=>n[0]===31&&n[1]===139&&n[2]===8,createTransformStream:()=>new DecompressionStream("gzip")},{name:"zlib",test:n=>(n[0]&15)===8&&n[0]>>4<=7&&(n[0]<<8|n[1])%31===0,createTransformStream:()=>new DecompressionStream("deflate")}];function K1(n){return n.reduce((e,r)=>e+r.byteLength,0)}function Y1(n,e){switch(n.length){case 0:return;case 1:return n[0];default:{let r=new Uint8Array(e||K1(n)),o=0;for(let a of n)r.set(a,o),o+=a.length;return r}}}async function mh(n){let e=[],r=0;for await(let o of n)e.push(o),r+=o.byteLength;return Y1(e,r)}function Q1(n,e){if(typeof n!="string"){for(let r of e)if(r.test(n))return r}return null}var Ys=class{#e;#t;#n;#i;constructor(e,r){this.#e=e,this.#t=r,this.#n=null,this.#i=null}transform(e,r){if(this.#i===null){let o=Q1(e,this.#e);if(o===null)this.#i=Promise.resolve();else{let{readable:a,writable:u}=o.createTransformStream();this.#n=u.getWriter(),this.#i=a.pipeTo(new WritableStream({write(f){r.enqueue(f)},close(){r.terminate()},abort(f){r.error(f)}})),typeof this.#t=="function"&&this.#t(o.name)}}if(this.#n!==null)return this.#n.write(e);r.enqueue(e)}async flush(){this.#n!==null&&(this.#n.close(),this.#n=null),this.#i!==null&&(await this.#i,this.#i=null)}},J1=1024*1024/4,Qs=class{#e;#t;#n;constructor(e,r=J1){this.#e=e,this.#t="",this.#n=r}async transform(e,r){if(typeof this.#t!="string"&&await this.#r(r),typeof e=="string"){if(this.#t+=e,this.#i>=this.#n)return this.#r(r)}else this.#t=e,await this.#r(r)}async flush(e){await this.#r(e),await this.#e(!0)}get#i(){return this.#t.length}async#r(e){let r=this.#t;if(this.#i!==0){this.#t="";for(let o=0;o<r.length;){let a=o===0&&r.length-o<this.#n*1.5?r:r.slice(o,o+this.#n);e.enqueue(a),o+=a.length,await this.#e(!1,a.length)}}}};var Js={stream:Ao,event:Ku,file:ea,url:Yu,push:Qu};function Z1(n){try{return new URL(n,location.origin).origin===location.origin}catch{return!1}}function X1(n){return n.ok}function eD(n){return n.headers.get("x-file-encoded-size")||n.headers.get("content-length")}function tD(n){return n.headers.get("x-file-size")||(Z1(n.url)&&!n.headers.get("content-encoding")?n.headers.get("content-length"):void 0)}function nD(n){return n.headers.get("x-file-created-at")||n.headers.get("last-modified")||void 0}function rD(n){let e=n?Object.keys(n):[],r=["name","createdAt","elapsedTime","data"];return!(e.length!==4||e.some(o=>!r.includes(o)))}function iD(n,e,{size:r,compression:o,encoding:a}){let u=null;if(rD(n)){let{data:F,...D}=n;n=F,e={...e,createdAt:F.createdAt},u=D}let f=n,d=u||{},{type:h,name:g,encoding:v,size:w,encodedSize:x,createdAt:T,...E}=e||{};return{resource:{type:h||"unknown",name:g||"unknown",compression:o,encoding:a,...Number.isFinite(r)?{size:r}:null,...Number.isFinite(x)?{encodedSize:x}:null,createdAt:new Date((typeof T=="string"?Date.parse(T):T)||Date.now()),...E},meta:d,data:f}}async function oD(n,e,r,o){let a=Date.now(),u=[...Ws(e),Ks,Uu],f=0,d=!1,h="unknown",g=0;await o("receiving",x(!1));let w=n.pipeThrough(new TransformStream(new Qs(T))).pipeThrough(new TransformStream(new Ys(gh,F=>d=F))).getReader();try{let F=await w.read(),{value:D,done:C}=F;if(C)throw new Error("Empty payload");for(let{name:L,test:N,streaming:B,decode:O}of u)if(N(D)){h=L;let z=E(w,F);return{data:await(B?O(z):mh(z).then(M(O))),compression:d,encoding:h,size:g,decodingTime:f}}throw new Error("No matched encoding found for the payload")}finally{w.releaseLock()}function x(F){return{done:F,elapsed:Date.now()-a,units:"bytes",completed:g,total:r}}async function T(F,D=0){g+=D,await o("receiving",x(F))}async function*E(F,D){for(;;){let{value:C,done:L}=D||await F.read();if(D=void 0,L)break;let N=performance.now();yield C,f+=performance.now()-N}}function M(F){return async D=>{await o("decoding",void 0,h);let C=performance.now();try{return await F(D)}finally{f=performance.now()-C}}}}async function sD(n,e){try{await e.asyncSet({stage:"request"});let r=new Date,{method:o,stream:a,resource:u,options:f,data:d}=await n(),h=new Date,g=u?.size,{encodings:v}=f||{},{data:w,compression:x=!1,encoding:T="unknown",size:E=void 0,decodingTime:M=0}=d?{data:d}:await oD(a,v,Number(g)||0,(O,z,_)=>e.asyncSet({stage:O,progress:z,step:_}));await e.asyncSet({stage:"received"});let{data:F,resource:D,meta:C}=iD(w,u,{size:E,compression:x,encoding:T}),L=new Date,N=Number(L)-Number(r),B=Math.round(M||0);return{loadMethod:o,resource:D,meta:C,data:F,timings:{time:N,start:r,end:L,loadingTime:N-B,decodingTime:B,requestTime:Number(h)-Number(r),requestStart:r,requestEnd:h,responseTime:Number(L)-Number(h),responseStart:h,responseEnd:L}}}catch(r){throw console.error("[Discovery] Error loading data:",r),await e.asyncSet({stage:"error",error:r}),r}}function Zs(n,e){let r=new At({stage:"inited"});return{state:r,dataset:n(r),...e}}function Xs(n){return e=>sD(n,e)}function Ao(n,e){return Zs(Xs(()=>({method:"stream",stream:n,resource:e?.resource,options:e})))}function ea(n,e){let r=vh(n);return Zs(Xs(()=>({method:"file",stream:n.stream(),resource:e?.resource||r,options:e})),{title:"Load data from file: "+(r?.name||"unknown")})}function Ku(n,e){let o=(n.dataTransfer||n.clipboardData||n.target)?.files?.[0];if(n.stopPropagation(),n.preventDefault(),!o)throw new Error("Can't extract a file from an event object");return ea(o,e)}function Yu(n,e){return e=e||{},Zs(Xs(async()=>{let r=await fetch(n,e.fetch),o=vh(r,e);if(o&&r.body)return{method:"fetch",stream:r.body,resource:e.resource||o,options:e};let a=r.headers.get("content-type")||"",u=await r.text();if(a.toLowerCase().startsWith("application/json"))try{let f=JSON.parse(u);u=f.error||f}catch{}throw u=new Error(u),u.isFetchError=!0,u.status=r.status,u.statusText=r.statusText,u.stack=null,u}),{title:`Load data from url: ${n}`})}function Qu(n){let e,r=new ReadableStream({start(f){e=f},cancel(){e=null}}),o,a=null,u=new Promise(f=>{o=d=>f({method:"push",stream:r,resource:d?a=d:n?.resource,options:n})});return n=n||{},Zs(Xs(()=>u),{start(f){o(f)},push(f){o(),e?.enqueue(f)},finish(f){e?.close(),e=null,f!==void 0&&isFinite(f)&&a!==null&&(a.encodedSize=Number(f)),a=null}})}function ta({dataset:n,state:e},r){return new Promise((o,a)=>e.subscribeSync(async(u,f)=>{if(u.stage==="error"){f(),a(u.error);return}let{stage:d,progress:h,step:g}=u;await r.setState({stage:d,progress:h},g),d==="received"&&(f(),o(n))}))}function vh(n,e){if(n instanceof Response){let r=e?.isResponseOk||X1,o=e?.getContentSize||tD,a=e?.getContentEncodedSize||eD,u=e?.getContentCreatedAt||nD;if(r(n))return{type:"url",name:n.url,size:Number(o(n))||null,encodedSize:Number(a(n)),createdAt:u(n)}}if(n instanceof File)return{type:"file",name:n.name,size:n.size,createdAt:n.lastModified};if(n instanceof Blob)return{size:n.size};if(ArrayBuffer.isView(n))return{size:n.byteLength};if(typeof n=="string")return{size:n.length}}var{toString:aD,hasOwnProperty:lD}=Object.prototype,pn=n=>aD.call(n),ye=Object.hasOwn||((n,e)=>lD.call(n,e));var tr=class{listeners;constructor(){this.listeners=Object.create(null)}on(e,r){return this.listeners[e]={callback:r,next:this.listeners[e]||null},this}once(e,r){return this.on(e,function o(...a){r.apply(this,a),this.off(e,o)})}off(e,r){let o=this.listeners[e]||null,a=null;for(;o!==null;){if(o.callback===r){o.callback=null,a?a.next=o.next:this.listeners[e]=o.next;break}a=o,o=o.next}return this}emit(e,...r){let o=this.listeners[e]||null,a=!1;for(;o!==null;)typeof o.callback=="function"&&o.callback.apply(this,r),a=!0,o=o.next;return a}};var jt=class extends tr{#e;#t;static define(e,r,o){return e.#e.set(r,o),e.emit("define",r,o),o}constructor(e){super(),this.#e=new Map,this.#t=!!e}revoke(e){if(!this.#t)throw new Error("Entry revoking is not allowed");this.#e.delete(e),this.emit("revoke",e)}isDefined(e){return this.#e.has(e)}has(e){return this.#e.has(e)}get(e){return this.#e.get(e)}get names(){return[...this.#e.keys()]}get keys(){return this.#e.keys()}get values(){return this.#e.values()}get entries(){return this.#e.entries()}};function na(n,e){let{ast:r}=Jt.syntax.parse(e),o={view:n};if(r.type!=="Block")throw new SyntaxError('[Discovery] ViewModel#queryToConfig(): query root must be a "Block"');if(r.body.type!=="Object")throw new SyntaxError('[Discovery] ViewModel#queryToConfig(): query root must return an "Object"');for(let a of r.body.properties){if(a.type!=="ObjectEntry")throw new SyntaxError('[Discovery] ViewModel#queryToConfig(): unsupported object entry type "'+a.type+'"');let u,f=a.value;switch(a.key.type){case"Literal":u=a.key.value;break;case"Identifier":u=a.key.name,f||=a.key;break;case"Reference":u=a.key.name.name,f||=a.key;break;default:throw new SyntaxError('[Discovery] ViewModel#queryToConfig(): unsupported object key type "'+a.key.type+'"')}if(u==="view"||u==="postRender")throw new SyntaxError('[Discovery] ViewModel#queryToConfig(): set a value for "'+u+'" property in shorthand notation is prohibited');u==="when"||u==="data"||u==="whenData"?o[u]=f.type==="Literal"&&typeof f.value!="string"?f.value:Jt.syntax.stringify(f):o[u]=f.type==="Literal"&&(typeof f.value!="string"||f.value[0]!=="=")?f.value:"="+Jt.syntax.stringify(f)}return o}var Dh=Object.freeze({type:void 0}),Ah=Object.freeze({view:""}),Sh=new WeakMap,yh=new WeakMap,uD=new Set(["view","when","context","data","whenData","postRender"]);function cD(n){return typeof n=="string"||Array.isArray(n)||n!==null&&typeof n=="object"&&typeof n.view=="string"}function br(n,e){return Sh.set(n,e),n}function fD(){return{name:"config-error",options:Dh,render(n,e){n.appendText(`[Error: ${e.reason}]`),"config"in e}}}function bh(n,e,r,o,a,u,f,d){return!ye(r,n)||r[n]===void 0||e.host.queryBool(r[n]===!0?"":r[n],o,a)?!0:(e.viewEls.set(d,{skipped:n,config:r,inputData:u,inputDataIndex:f,data:o,context:a}),!1)}var Zt=class n{type;children;border;constructor(e="inline",r){if(this.type=e,this.children=[],this.border=null,Array.isArray(r))for(let o of r)this.append(o)}appendText(e){this.append(new ra(e))}appendInlineBlock(){let e=new n("inline-block");return this.append(e),e}appendBlock(){let e=new n("block");return this.append(e),e}appendLine(){let e=new n("line");return this.append(e),e}append(e){return this.children.push(e),this}setBorder(e){if(!e){this.border=null;return}this.border=typeof e=="string"?new Eo(e,e,e,e):Array.isArray(e)?new Eo(...e):new Eo(e.top||null,e.right||null,e.bottom||null,e.left||null)}},ra=class{value;constructor(e){this.value=String(e)}},To=class{node;constructor(){this.node=null}setNode(e){this.node=e}};function So(n,e=0,r=n.length-1){let o=n[e].length;for(let a=e+1;a<=r;a++)o=Math.max(o,n[a].length);return o}function wh(n,e){return n.length>e?n.slice(0,e):n}function dD(n,e=n,r=e,o=n){return(a,u)=>u===1?o:a===0?n:a+1===u?r:e}function xh(n){return Array.isArray(n)?dD(...n):n}function pD(n,e=n,r=e){return(o,a,u)=>`${n}${"".padStart(o+a+u-n.length-r.length,e)}${r}`}function kh(n){return Array.isArray(n)?pD(...n):n}var Eo=class{top;left;right;bottom;constructor(e=null,r=null,o=e,a=r){this.top=e||null,this.left=a||null,this.right=r||null,this.bottom=o||null}render(e,r,o){let a=xh(this.left),u=xh(this.right),f=kh(this.top),d=kh(this.bottom),h=So(e),g=0,v=0;if(a){if(typeof a=="function"){let w=e.map((x,T)=>String(a(T,e.length)??""));g=So(w),e=e.map((x,T)=>w[T].padEnd(g)+x)}else g=a.length,e=e.map(w=>a+w);if(g>0)for(let w=0;w<e.length;w++)r[w].unshift({length:g,node:o})}if(u)if(typeof u=="function"){let w=e.map((x,T)=>String(u(T,e.length)??""));if(v=So(w),v>0){for(let x=0;x<e.length;x++)r[x].push({length:g+h-e[x].length+v,node:o});e=e.map((x,T)=>x.padEnd(g+h)+w[T].padStart(v))}}else{v=u.length;for(let w=0;w<e.length;w++)r[w].push({length:g+h-e[w].length+v,node:o});e=e.map(w=>w.padEnd(g+h)+u)}if(f||d){let w=h+g+v;if(f){let x=typeof f=="function"?f(h,g,v)||"":"".padStart(w,f);x&&(e.unshift(wh(x,w)),r.unshift([{length:e[0].length,node:o}]))}if(d){let x=typeof d=="function"?d(h,g,v)||"":"".padStart(w,d);x&&(e.push(wh(x,w)),r.push([{length:e[e.length-1].length,node:o}]))}}return{spans:r,lines:e}}};async function Eh(n,e,r,o,a,u,f,d,h){let g=new Zt(e.options.type||"inline");e.options.border&&g.setBorder(e.options.border),await e.render(g,a,u,f),typeof o.postRender=="function"&&await o.postRender(g,o,u,f);let v={config:o,props:a,inputData:d,inputDataIndex:h,data:u,context:f};return n.viewEls.set(g,v),r.setNode(g),r}function Ch(n,e,r,o){return Eh(n,n.defaultRenderErrorRenderer,r,Ah,{type:"render",reason:e,config:o})}function hD(n,e){return{name:e,normalizeConfig:n.normalizeConfig.bind(n),ensureValidConfig:n.ensureValidConfig.bind(n),composeConfig:n.composeConfig.bind(n),propsFromConfig:n.propsFromConfig.bind(n),render:n.render.bind(n),listLimit:n.listLimit.bind(n),renderList:n.renderList.bind(n)}}async function Th(n,e,r,o,a,u){if(Array.isArray(r))return Promise.all(r.map(g=>Th(n,e,g,o,a,u))).then(g=>new Zt("inline",g));let f=o&&typeof a=="number"?o[a]:o,d=null;switch(typeof r.view){case"function":d={name:!1,options:Dh,render:r.view};break;case"string":d=n.get(r.view)||null;break}e||(e=new Zt);let h=new To;if(e.append(h),!d){let g=typeof r.view=="string"?"View `"+r.view+"` is not found":"Render is not a function";return n.host.logger.error(g,r),Ch(n,g,h,r)}try{if(bh("when",n,r,f,u,o,a,h)){let g="context"in r?await n.host.query(r.context,f,u):u,v="data"in r?await n.host.query(r.data,f,g):f;if(bh("whenData",n,r,v,g,o,a,h))return await Eh(n,d,h,r,n.propsFromConfig(r,v,g),v,g,o,a)}return h}catch(g){return n.host.logger.error("View render error:",g.message),Ch(n,String(g),h,Ah)}}var ia=class n extends jt{host;defaultRenderErrorRenderer;viewEls;constructor(e){super(),this.host=e,this.defaultRenderErrorRenderer=fD(),this.viewEls=new WeakMap}define(e,r,o){let a=cD(r)||typeof r=="function"?{...o,render:r}:r,{render:u=[],...f}=a,{type:d,props:h}=f;return n.define(this,e,Object.freeze({name:e,options:Object.freeze({...a,type:typeof d=="string"||d===void 0?d:void 0,props:typeof h=="string"?this.host.queryFn(h):h}),render:typeof u=="function"?u.bind(hD(this,e)):(g,v,w,x)=>this.render(g,u,w,x)}))}normalizeConfig(e){if(!e)return null;if(Array.isArray(e)){let r=[];for(let o of e){let a=this.normalizeConfig(o);a!==null&&(Array.isArray(a)?r.push(...a):r.push(a))}return r}if(typeof e=="string"){let[,r,o,a]=e.match(/^(\S+?)([:{])((?:.|\s)+)$/)||[];if(r){if(o==="{")try{return br(na(r,o+a),e)}catch(u){return br(this.badConfig(e,u),e)}return br({view:r,data:a},e)}return br({view:e},e)}else if(typeof e=="function")return br({view:e},e);return e}badConfig(e,r){let o=r?.message||"Unknown error";return this.host.logger.error(o,{config:e,error:r}),{view:this.defaultRenderErrorRenderer.render,type:"config",reason:o,config:e}}ensureValidConfig(e){return Array.isArray(e)?e.map(r=>this.ensureValidConfig(r)).flat():!e||!e.view?this.badConfig(e,new Error(e?"Option `view` is missed":"Config is not a valid value")):e}composeConfig(e,r){return e=this.normalizeConfig(e),r=this.normalizeConfig(r),e&&r?Array.isArray(e)?e.map(o=>br({...o,...r},[o,r])):br({...e,...r},[e,r]):e||r}propsFromConfig(e,r,o,a=this.get(e?.view)?.options.props){let u={};for(let[f,d]of Object.entries(e))uD.has(f)||(u[f]=typeof d=="string"&&d.startsWith("=")?this.host.query(d.slice(1),r,o):d);if(typeof a=="function"){let f=a(r,{props:u,context:o});f!==null&&typeof f=="object"&&f!==u&&(yh.set(f,{props:u,fn:a}),u=f)}return u}textWidth(e){if(e===null)return 0;if(e instanceof Zt){let r=0;for(let o of e.children)r+=this.textWidth(o);return r}else return e instanceof To?this.textWidth(e.node):e.value.length}cleanUpRenderTree(e){if(e===null)return null;if(e instanceof To)return this.cleanUpRenderTree(e.node);if(e instanceof Zt){let r=e.children.map(this.cleanUpRenderTree,this).filter(u=>u!==null);if(r.length===0)return null;let o=this.viewEls.get(e),a=e.border;e=new Zt(e.type,r),e.border=a,o&&this.viewEls.set(e,o)}else if(e.value==="")return null;return e}serialize(e){let r=this.cleanUpRenderTree(e),o=[],a="";if(r!==null){let{lines:d,spans:h}=f(r,null),g=0;for(let v of h){for(let w of v)if(w.length>0){let x=g+w.length;o.push({range:[g,x],view:(w.node&&this.viewEls.get(w.node))??null}),g=x}g++}a=d.join(`
`)}return{text:a,ranges:o};function u(d,h,g,v,w){if(h<d.length&&d[h].length<g){let x=d[h],T=x.padEnd(g),M=v[h].at(-1);d[h]=T,M?M.length+=T.length-x.length:v[h].push({length:T.length,node:w})}}function f(d,h){if(d instanceof ra){let x=d.value.split(/\r\n?|\n/);return{spans:x.map(T=>[{length:T.length,node:h}]),lines:x}}let g=[[]],v=[""],w=0;if(d instanceof Zt){let x="none";for(let T of d.children){let E=T instanceof Zt?T.type:"inline",{lines:M,spans:F}=f(T,d);if(M.length>0){switch(E){case"block":w=v.length-1,v[w]!==""?(g.push([]),v.push("")):w>0&&v[w]!==""?(g.push([]),v.push("")):w===0&&(g.pop(),v.pop()),g.push(...F),v.push(...M),g.push([]),w=v.push("")-1;break;case"line":x==="block"||v[w]===""&&(g.pop(),v.pop()),g.push(...F),v.push(...M),g.push([]),w=v.push("")-1;break;case"inline-block":{x==="block"?(w=v.push("")-1,g.push([])):(x==="inline"||x==="inline-block")&&u(v,w,So(v,w)+1,g,d);let D=v[w].length;if(g[w].push(...F[0]),v[w]+=M[0],M.length>1){let C=M.length-(v.length-w);for(let L=0;L<C;L++)g.push([]),v.push("");for(let L=1;L<M.length;L++)u(v,w+L,D,g,d),g[w+L].push(...F[L]),v[w+L]+=M[L]}break}case"inline":if(x==="block"?(w=v.push("")-1,g.push([])):x==="inline-block"&&u(v,w,So(v,w)+1,g,d),g[w].push(...F[0]),v[w]+=M[0],M.length>1)for(let D=1;D<M.length;D++)w=v.push(M[D])-1,g[w]=F[D];break}x=E}}for(;x!=="inline"&&v[w]==="";)w--,g.pop(),v.pop();if(d.border)return d.border.render(v,g,d)}return{spans:g,lines:v}}}async render(e,r,o,a,u){return typeof e=="string"?e=new Zt(e):e||(e=new Zt),await Th(this,e,this.ensureValidConfig(this.normalizeConfig(r)),o,u,a),e}async renderString(e,r,o,a,u){return this.serialize(await this.render(e,r,o,a,u))}listLimit(e,r){return e===!1?!1:!e||isNaN(e)?r:Math.max(parseInt(e,10),0)||r}renderList(e,r,o,a,u){let{offset:f=0,moreContainer:d,beforeItem:h,afterItem:g,beforeMore:v=h,afterMore:w=g}=u,{limit:x=!1}=u;x===!1&&(x=o.length);let T=Promise.all(o.slice(f,f+x).map((E,M,F)=>{h&&e.appendText(h);let D=this.render(e,r,o,{...a,index:f+M,array:o,sliceIndex:M,slice:F},f+M);return g&&e.appendText(g),D}));return this.maybeMore(d||e,null,o.length,f+x,v,w),T}maybeMore(e,r,o,a,u,f){if(o>a){let d=o-a;e.appendText((u||"")+"("+d+" more\u2026)"+(f||""))}}getViewConfigTransitionTree(e){let r=Sh.get(e)||[];return Array.isArray(r)||(r=[r]),{value:e,deps:r.map(this.getViewConfigTransitionTree,this)}}getViewPropsTransition(e){let r=yh.get(e)||null;return r&&{props:r.props,fn:r.fn,query:r.fn.query||null}}};var la={};Ce(la,{alert:()=>Ju,badge:()=>Zu,block:()=>Xu,blockquote:()=>ec,context:()=>tc,headerViews:()=>nc,link:()=>rc,listViews:()=>ic,source:()=>oc,switchView:()=>sc,table:()=>lc,textViews:()=>uc});var Ju={};Ce(Ju,{default:()=>gD});var Fh=n=>({demo:`${n}:"hello world\\nsome text..."`});function gD({textView:n}){n.define("alert",{type:"block",usage:Fh,border:{top:["\u2554","\u2550","\u2557"],left:"\u2551 ",right:" \u2551",bottom:["\u255A","\u2550","\u255D"]},render(e,r,o,a){let{content:u="text"}=r;return n.render(e,u,o,a)}})}var Zu={};Ce(Zu,{default:()=>mD});var Lh=(n,e)=>({demo:{view:n,text:"hello world"},examples:[{title:"Variations",demo:e.map(r=>[`${r}:"${r}"`,`${r}:"${r}\\nmulti-line"`,`${r}:"${r}\\nmulti-line\\nmore..."`]).flat()},{title:"Complex content",highlightProps:["content"],demo:{view:n,content:['text:"text"','link:"#example"','text:"text"']}}]});function mD({textView:n}){let e={type:"inline-block",usage:Lh,props:`is not array? | {
            text: #.props has no 'content' ? is (string or number or boolean) ?: text,
            content: undefined,
            prefix,
            postfix
        } | overrideProps()`,render(r,o,a,u){let{text:f,content:d,prefix:h,postfix:g}=o,v;return h&&r.appendText(String(h)+" "),d?v=this.render(r,d,a,u):r.appendText(String(f)),g&&r.appendText(" "+String(g)),v}};n.define("badge",{...e,border:{left:["\u23A1","\u23A2","\u23A3","["],right:["\u23A4","\u23A5","\u23A6","]"]}}),n.define("pill-badge",{...e,border:{left:["\u23A7","\u23AA","\u23A9","("],right:["\u23AB","\u23AA","\u23AD",")"]}})}var Xu={};Ce(Xu,{default:()=>vD});var Fo=(n,e)=>({demo:`${n}:'just a text'`,examples:[{title:"Variations",demo:e.map(r=>[`header:"${r}"`,'text:"\u2026text\u2026"',`${r}:"\u23A1${r}\u23A6"`,'text:"\u2026text\u2026"',`${r}:"\u23A1${r}\\nmulti-line\u23A6"`,'text:"\u2026text\u2026"',`${r}:"\u23A1${r}\\nmulti-line\\nmore and more\u2026\u23A6"`,'text:"\u2026text\u2026"']).flat()},{title:"Variations with border",demo:e.map(r=>[`header:"${r}"`,'text:"\u2026text\u2026"',`${r}{ border: [null, " |", null, "| "], data:"\u23A1${r}\u23A6" }`,'text:"\u2026text\u2026"',`${r}{ border: [null, " |", null, "| "], data:"\u23A1${r}\\nmulti-line\u23A6" }`,'text:"\u2026text\u2026"',`${r}{ border: [null, " |", null, "| "], data:"\u23A1${r}\\nmulti-line\\nmore and more\u2026\u23A6" }`,'text:"\u2026text\u2026"']).flat()}]});function vD({textView:n}){function e(r,o,a,u){let{content:f="text",border:d}=o;return d&&r.setBorder(d),n.render(r,f,a,u)}n.define("inline",{type:"inline",usage:Fo,render:e}),n.define("inline-block",{type:"inline-block",usage:Fo,render:e}),n.define("block",{type:"block",usage:Fo,render:e}),n.define("line",{type:"line",usage:Fo,render:e})}var ec={};Ce(ec,{default:()=>yD});var oa=n=>({demo:{view:n,content:['text:"Blockquote text..."','blockquote:"Nested blockquote\\nmulti-line text..."']},examples:[{title:"Variations",demoData:"Blockquote text...",demo:[{kind:"",text:"Default blockquote without any kind."},{kind:"note",text:"Useful information that users should know, even when skimming content."},{kind:"tip",text:"Helpful advice for doing things better or more easily."},{kind:"important",text:"Key information users need to know to achieve their goal."},{kind:"warning",text:"Urgent info that needs immediate user attention to avoid problems."},{kind:"caution",text:"Advises about risks or negative outcomes of certain actions."}].map(({kind:e,text:r})=>e?`${n}{ kind: "${e}", data: ${JSON.stringify(r)} }`:`${n}:${JSON.stringify(r)}`)}]});var Mh=oa;function yD({textView:n}){n.define("blockquote",function(e,r,o,a){let{content:u="text",kind:f}=r;return typeof f=="string"&&/\S/.test(f)&&e.appendLine().appendText(`[!${f.trim().toUpperCase()}]`),n.render(e,u,o,a)},{type:"block",usage:Mh,border:{left:"> "}})}var tc={};Ce(tc,{default:()=>bD});var Nh={beforeDemo:['md:"A non-visual view used to group views, manage their visibility, or explicitly define data and context for nested views. In the example, the `context` view sets up specific data and context, allowing nested views (`content`) to utilize these shared definitions directly:"'],demo:{view:"context",data:{name:"World",age:"1000 years"},context:'{ ...#, greeting: "Hello" }',content:["text:`${#.greeting}, ${name}!`","table"]}};function bD({textView:n}){n.define("context",function(e,r,o,a){let{content:u=[]}=r;return n.render(e,u,o,a)},{usage:Nh})}var nc={};Ce(nc,{default:()=>wD});var wr=(n,e)=>({demo:`${n}:"Header \\"${n}\\""`,examples:[{title:"Variations",view:e.map(r=>`${r}:"Header \\"${r}\\""`)},{title:"Complex content",demo:{view:n,content:['text:"Text "','link:{ text: "Link" }']}},{title:"Using anchor",demo:[{view:n,anchor:"foo",content:'text:"Explicit value for an anchor"'},{view:n,anchor:!0,content:'text:"Auto generated anchor based on text content of header"'}]}]});function wD({textView:n}){function e(r){let o="#".repeat(r)+" ";return async function(u,f,d,h){let{content:g}=f;return u.appendText(o),n.render(u,g||"text",d,h)}}n.define("header",e(1),{type:"block",usage:wr}),n.define("h1",e(1),{type:"block",usage:wr}),n.define("h2",e(2),{type:"block",usage:wr}),n.define("h3",e(3),{type:"block",usage:wr}),n.define("h4",e(4),{type:"block",usage:wr}),n.define("h5",e(5),{type:"block",usage:wr})}var rc={};Ce(rc,{default:()=>kD});var Bh={demo:{view:"link",text:"I am a link",href:"#example"},examples:[{title:"Infering text \u21FF href",highlightProps:["text","href","data"],beforeDemo:['md:"When `text` is omitted but `href` is specified, or vice versa, the opposite component is inferred from the specified one"'],demo:[{view:"link",text:"http://example1.com"},{view:"link",href:"http://example2.com"},{view:"link",data:'"http://example3.com"'}]}]};var xD=`is not array? | {
    text: #.props.content is undefined ? is string ?: text,
    content: undefined,
    href
} | overrideProps() | {
    $text; $href;
    ...,
    text: $text | is not undefined or no $href ?: $href,
    href: $href | is not undefined or no $text ?: $text
}`;function kD({textView:n}){n.define("link",async function(e,r,o,a){let{text:u,content:f,href:d}=r;d&&e.appendText("["),f?await n.render(e,f,o,a):e.appendText(u),d&&e.appendText(`](${d})`)},{type:"inline-block",props:xD,usage:Bh})}var ic={};Ce(ic,{default:()=>CD});var gi=(n,e)=>({demo:{view:n,data:["one","two","three","four"]},examples:[{title:"Variations",demoData:["foo","bar","baz"],demo:e.map(r=>[`header:'view: \\"${r}\\"'`,r]).flat()},{title:"Variations long lists",demoData:Array.from({length:100},(r,o)=>"item#"+o),demo:e.map(r=>[`header:'view: \\"${r}\\"'`,{view:r,limit:3}]).flat()},{title:"Configure item's content",demo:[{view:n,data:["one","two","three","four"],item:['text:"<item> "',{view:"link",data:'{ href: "#" + $ }'}]}]}]});function CD({textView:n}){n.define("list",e("line",""),{type:"block",usage:gi}),n.define("inline-list",e("inline-block"),{type:"inline-block",usage:gi}),n.define("comma-list",e("inline-block","",","),{type:"inline-block",usage:gi}),n.define("ol",e("line",r=>1+r.index+". "),{type:"block",usage:gi}),n.define("ul",e("line","- "),{type:"block",usage:gi}),n.define("list-item",function(r,o,a,u){let{content:f="text",bullet:d,delim:h,renderType:g="line"}=o,v=typeof d=="function"?d:d?()=>d:null,w=typeof h=="function"?h:h?()=>h:null;return r.type=g,(v||w)&&r.setBorder({left:v?x=>x===0?v(u):"":null,right:w?x=>x===0&&u.index!==u.array.length-1?w(u):"":null}),n.render(r,f,a,u)});function e(r,o,a){return async function(f,d,h,g){let{item:v,itemConfig:w,limit:x,emptyText:T}=d,E;return!Array.isArray(h)&&h&&(h=[h]),Array.isArray(h)&&h.length>0?E=n.renderList(f,this.composeConfig({view:"list-item",content:v,bullet:o,delim:a,renderType:r},w),h,g,{limit:n.listLimit(x,25)}):f.appendText(String(T||"<empty list>")),E}}}var oc={};Ce(oc,{default:()=>SD});var sa='let name = "world";\n\nconsole.log(`Hello, ${name}!`);',DD=Function("return num => num + 5")(),Oh={demo:{view:"source",syntax:"js",source:sa},examples:[{title:"Custom line numbers",highlightProps:["lineNum"],demo:[{view:"source",source:sa,syntax:"js",lineNum:DD},{view:"source",source:sa,syntax:"js",lineNum:"==> $ + 12345"}]},{title:"Hide line numbers",highlightProps:["lineNum"],beforeDemo:['md:"Pass falsy value to `lineNum` option to hide line numbers:"'],demo:{view:"source",source:sa,syntax:"js",lineNum:!1}},{title:"Marks",highlightProps:["marks"],beforeDemo:{view:"md",source:["The `marks` option allows injecting text marks at specific points in the source text. The `marks` value must be an array of objects with the following fields:",`
`,"- `offset` (required) - the offset in the source where the mark is injected.","- `content` - view config for content (e.g., `'text:\"hello\"'` or `{ view: 'name', ... }`)","- `prefix` - text to display before the content of mark","- `postfix` - text to display after the content of mark"]},demo:{view:"source",source:`let demo = "mark";

if (expr) {
  // do something
}`,syntax:"js",marks:[{offset:4},{offset:4,content:'text:"mark"'},{offset:24,prefix:"self: ",content:'text:"123"',postfix:"ms"}]}}]};var AD=`is not array? | {
    source: #.props has no 'source' ? is string ?: content is string ? content : source,
    syntax,
    lineNum is function ?: is not undefined ? bool() : true,
    marks is array ?: null
} | overrideProps()`;function SD(n){n.textView.define("source",{type:"block",props:AD,usage:Oh,async render(e,r,o,a){let u=[],{source:f,syntax:d,lineNum:h=!0,marks:g}=r,v={...a,sourceViewProps:{source:f,syntax:d,lineNum:h,marks:g}};if(typeof f!="string")return;let w=typeof h=="function"?h:M=>M+1,x=h?f.split(/\r\n?|\n/g).map((M,F)=>String(w(F))):[];if(x.length>2){let M=x.reduce((F,D)=>Math.max(F,D.length),3);for(let F=0;F<x.length;F++)x[F].length<M&&(x[F]=x[F].padStart(M))}if(e.appendLine().appendText(`\`\`\`${d||""}`),e.appendText(T()),Array.isArray(g)){for(let F of g){if(!F||typeof F!="object"){n.logger.warn('Bad value for an entry in "source" view props.mark, must be an object',{props:r,mark:F});return}let D=typeof F.offset=="number"&&isFinite(F.offset)?Math.max(0,Math.round(F.offset)):void 0;if(typeof D!="number"){n.logger.warn('Bad "offset" value for an entry in "source" view props.marks',{props:r,mark:F});return}u.push({...F,offset:Math.max(0,Math.min(D,f.length))})}u.sort((F,D)=>F.offset-D.offset);let M=0;for(let F of u){let{offset:D,content:C=[],prefix:L="",postfix:N=""}=F;D>M&&(E(f.slice(M,D)),M=D),e.appendText("/* "+L),await this.render(e,C,F,v),e.appendText(N+" */")}M<f.length&&E(f.slice(M))}else E(f);e.appendLine().appendText("```");function T(){let M=x.shift();return typeof M=="string"?M+" \u2502 ":""}function E(M){let F=M.split(/\r\n?|\n/);e.appendText(F[0]);for(let D=1;D<F.length;D++)e.appendText(`
`+T()+F[D])}}})}var sc={};Ce(sc,{default:()=>ED});var Ph={demo:{view:"switch",content:[{when:"expr",content:'text:"Renders when `expr` is truthy"'},{content:'text:"Renders when all other `when` conditions are falsy"'}]}};function ED(n){n.textView.define("switch",function(e,r,o,a){let{content:u}=r,f='text:"<switch: no case choosen>"';if(Array.isArray(u)){for(let d of u)if(d&&n.queryBool(d.when||!0,o,a)){f="data"in d?{view:"context",data:d.data,content:d.content}:d.content;break}}return n.textView.render(e,f,o,a)},{usage:Ph})}var lc={};Ce(lc,{default:()=>LD});function aa(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function zt(n){return Array.isArray(n)||aa(n)}function kn(n){return pn(n)==="[object Set]"}function Lo(n){return pn(n)==="[object RegExp]"}var TD=[{name:"Alice",age:34,occupation:"Engineer"},{name:"Bob",age:42,occupation:"Doctor"},{name:"Charlie",age:9,occupation:"Student"},{name:"David",age:50,occupation:"Doctor"},{name:"Eve",age:15,occupation:"Engineer"}],Ih={demoData:TD,demo:"table"};function ac(n,e){return{header:n,view:"table-cell",data:e}}function FD(n,e,r){return typeof e=="string"&&(e={content:e}),ye(e,"content")||ye(e,"data")?{header:n,view:"table-cell",...e}:{...ac(n,r),...e}}function LD(n){let e=n.queryFn("is not object");n.textView.define("table",async function(r,o,a,u){let{rows:f,cols:d,limit:h=25,valueCol:g=!1}=o,v=0;"rows"in o||(f=a),kn(f)&&(f=[...f]),zt(f)||(f=f?[f]:[]),h!==!1&&f.length>h&&(v=f.length-h,f=f.slice(0,h));let w=[];if(Array.isArray(d))d=d.map((F,D)=>typeof F=="string"?ac(F,n.pathToQuery([F])):{header:"col"+D,view:"table-cell",...F});else{let F=new Set,D=d&&typeof d=="object"?d:{};d=[];for(let C of f)if(e(C))g=!0;else for(let L of Object.keys(C))F.add(L);for(let C of Object.keys(D))D[C]?F.add(C):F.delete(C);for(let C of F)d.push(ye(D,C)?FD(C,D[C],n.pathToQuery([C])):ac(C,n.pathToQuery([C])))}if(g&&d.unshift({header:"[value]",view:"table-cell",details:!1}),d=d.filter(F=>!ye(F,"colWhen")||n.queryBool(F.colWhen,a,u)),!d.length)return r.appendText(`
<empty table>
`);let x=Array.from(f,()=>[]),T=[];for(let F of d){let D=String(F.header).trim(),C=D.length,L=C;for(let N=0;N<f.length;N++){let B=await this.render(null,F,f[N],u),O=n.textView.textWidth(B);L=Math.max(L,O),x[N].push({width:O,align:F.align,content:B})}T.push(L),w.push({width:C,content:await this.render(null,"text",D)})}E(T,"\u250C","\u252C","\u2510"),M(T,w,!0),E(T,"\u251C","\u253C","\u2524");for(let F of x)M(T,F);if(v>0){let F=T.reduce((L,N)=>L+N+3,0)+1,D=` ${v} more rows\u2026 `,C=Math.max(1,F-D.length);r.appendLine().appendText(`${"~".repeat(Math.floor(1))}${D}${"~".repeat(Math.ceil(C-1))}`)}else E(T,"\u2514","\u2534","\u2518");function E(F,D,C,L){let N=D+"\u2500".repeat((F[0]||0)+2);for(let B=1;B<F.length;B++)N+=C+"\u2500".repeat(F[B]+2);r.appendLine().appendText(N+L)}function M(F,D){let C=r.appendLine();for(let L=0;L<D.length;L++){let{width:N,align:B,content:O}=D[L],z=F[L]-N+1;z>0&&B!=="right"?C.appendText("\u2502 "):C.appendText("\u2502"+" ".repeat(z)),C.append(O),z>0&&B==="right"?C.appendText(" "):C.appendText(" ".repeat(z))}C.appendText("\u2502")}},{type:"block",usage:Ih}),n.textView.define("table-cell",function(r,o,a,u){let{content:f,contentWhen:d=!0}=o,h=!f&&a!==null&&(Array.isArray(a)?a.length>0:typeof a=="object")&&!(a instanceof RegExp);if(n.queryBool(d,a,u)){if(f)return n.textView.render(r,f,a,u);r.appendText(MD(a,h))}})}function MD(n,e){if(Array.isArray(n)||ArrayBuffer.isView(n))return n.length||"";if(e){for(let r in n)if(ye(n,r))return"{\u2026}";return"{}"}return n===void 0?"":String(n)}var uc={};Ce(uc,{default:()=>ND});var jh={demo:'text:"just a text"'};function ND({textView:n}){n.define("text",{props:"{ text: #.props has no 'text'? } | overrideProps()",usage:jh,render(e,r){let{text:o}=r;e.appendText(String(o))}})}var ua=class n extends jt{#e;constructor(){super(!0),this.#e=Object.create(null)}define(e,r){if(typeof r!="function")throw new Error("callback is not a function");return this.#e=Object.freeze({...this.#e,[e]:r}),n.define(this,e,Object.freeze({name:e,callback:r}))}revoke(e){if(this.has(e)){let r={...this.#e};delete r[e],this.#e=Object.freeze(r)}super.revoke(e)}get actionMap(){return this.#e}call(e,...r){let o=this.get(e);if(o===void 0)throw new Error(`action "${e}" doesn't exist`);let{callback:a}=o;return a(...r)}};var Mo=new Map,cc=null;function BD(n){cc=null;for(let[e,r]of Mo.entries())n.warn.groupCollapsed(`${e} (${r.length})`,r);Mo.clear()}function OD(n,e,...r){cc===null&&Mo.size===0&&(cc=setTimeout(()=>BD(n),1));let o=Mo.get(e);o!==void 0?o.push(r):Mo.set(e,[r])}function qh(n,e,r){switch(typeof e){case"function":return e;case"string":return Object.assign(o=>o&&ye(o,e)?o[e]:void 0,{getterFromString:`object[${JSON.stringify(e)}]`});default:throw new Error(`[Discovery] Bad type "${typeof e}" for ${r} in object marker "${n}" config (must be a string or a function)`)}}function zh(n,e,r,o){let a=e&&ye(e,r)?e[r]:void 0;return a!==void 0?qh(n,a,`"${r}" option`):o}function Rh(n,e,r){return(Array.isArray(e[r])?e[r]||[]:[]).map(a=>qh(n,a,`"${r}" option`))}function Hh(n,e=!1){return n===null?!1:e?typeof n=="object":typeof n=="object"||typeof n=="number"||typeof n=="string"}function PD(n,e){let{name:r,indexRefs:o,lookupRefs:a,annotateScalars:u,page:f,getRef:d,getTitle:h}=e;d!==null&&o.unshift(d),f&&d===null&&n.warn(`Option "ref" for "${r}" marker must be specified when "page" options is defined ("page" option ignored)`),o.length>0&&a.unshift(F=>F);let g=new Set,v=new Map,w=new Map,x=new WeakMap;return{name:r,page:d!==null?f:null,mark:F=>{if(F===null||typeof F!="object"){n.warn(`Invalid value used for "${r}" marker (should be an object)`);return}g.add(F);for(let D of o){let C=D(F);if(Hh(C)){if(!v.has(C)){v.set(C,F);continue}v.get(C)!==F&&OD(n,`The same reference value used for different objects for "${r}" marker`,`Reference value "${C}"`,{refGetter:D.getterFromString||D,ref:C,currentObject:v.get(C),newObject:F})}}},lookup:(F,D=!1)=>{if(!Hh(F,D?!u:!1))return null;let C=typeof F=="object",L=C?x.get(F):w.get(F);if(L!==void 0)return L;let N=null;if(C&&g.has(F))N=F;else for(let _ of a){let W=_(F),te=v.get(W);if(te!==void 0){N=te;break}}if(N===null)return null;let B=w.get(N);if(B!==void 0)return B;let O=d!==null?d(N):null,z=Object.freeze({type:r,object:N,ref:O,title:h(N),href:f!==null&&O!==null?`#${encodeURIComponent(f)}:${encodeURIComponent(O)}`:null});return w.set(N,z),F!==N&&(C?x.set(F,z):w.set(F,z)),z},reset:()=>{g.clear(),v.clear(),w.clear(),x=new WeakMap}}}var mi=class n extends jt{constructor(e){super(),this.logger=e}#e=!1;lock(){this.#e=!0}define(e,r){if(this.#e)throw new Error("Object marker definition is not allowed after setup");if(this.isDefined(e))throw new Error(`Object marker "${e}" is already defined, new definition ignored`);r=r||{};let o=Rh(e,r,"refs"),a=Rh(e,r,"lookupRefs"),u=!!r.annotateScalars,f=r.page,d=typeof f=="string"?f:null,h=zh(e,r,"ref",null),g=zh(e,r,"title",h||(()=>null));return n.define(this,e,Object.freeze(PD(this.logger,{name:e,indexRefs:o,lookupRefs:a,annotateScalars:u,page:d,getRef:h,getTitle:g})))}reset(){for(let{reset:e}of this.values)e()}markerMap(){return Object.fromEntries([...this.entries].map(([e,r])=>[e,r.mark]))}lookup(e,r){if(typeof r=="string")return this.get(r)?.lookup(e)||null;for(let{lookup:o}of this.values){let a=o(e);if(a!==null)return a}return null}lookupAll(e){let r=[];for(let{lookup:o}of this.values){let a=o(e);a!==null&&r.push(a)}return r}};function _h(n,e){return{before(){n.objectMarkers.reset()},contextApi:{markers:n.objectMarkers.markerMap(),setWorkTitle:e?.setPrepareWorkTitle||(()=>Promise.resolve()),rejectData(r,o){throw Object.assign(new Error(r),{renderContent:o})}}}}function fc(n,e){let r=n.objectMarkers,o={setPrepare:n.setPrepare.bind(n),defineObjectMarker:u,addQueryHelpers(h){a={...a,...h}}},a={query:n.query.bind(n),overrideProps:f,pageLink:(h,g,v,w)=>n.encodePageHash(g,h,v,w),marker:r.lookup.bind(r),markerAll:r.lookupAll.bind(r),callAction:d,actionHandler:(h,...g)=>n.action.has(h)?()=>d(h,...g):void 0};typeof e=="function"&&e(o),r.lock(),n.queryFnFromString=Jt.setup({methods:a});function u(h,g){let{mark:v,lookup:w}=r.define(h,g);return w?v:()=>{}}function f(h,g=this.context.props){if(!g)return h;let v={...h};for(let w of Object.keys(v))ye(g,w)&&(v[w]=g[w]);return v}function d(h,...g){let v=g[g.length-1],w=null;typeof v=="function"&&(w=v,g.pop());let x=n.action.call(h,...g);return x&&w&&typeof x.then=="function"?x.then(w):w?w(x):x}}function Wh(n,e){let r=new mi(n.logger),o=[],a=[],u={setWorkTitle:e?.setPrepareWorkTitle||(()=>Promise.resolve()),rejectData(E,M){throw Object.assign(new Error(E),{renderContent:M})},defineObjectMarker:h,lookupObjectMarker:g,lookupObjectMarkerAll:v,addValueAnnotation:x,addQueryHelpers(E){d=Jt.setup({methods:f={...f,...E}})},query(E,...M){return n.queryFn.call({queryFnFromString:d},E)(...M)}},f={query:n.query.bind(n),overrideProps:w,pageLink:(E,M,F,D)=>n.encodePageHash(M,E,F,D),marker:g,markerAll:v,callAction:T,actionHandler:(E,...M)=>n.action.has(E)?()=>T(E,...M):void 0},d=Jt.setup({methods:f});return{contextApi:u,after(E){Object.assign(E,{objectMarkers:r,linkResolvers:o,annotations:a,queryFnFromString:d})}};function h(E,M){let{page:F,mark:D,lookup:C}=r.define(E,M)||{};if(!C)return()=>{};if(F!==null){if(!n.page?.isDefined(F))return n.logger.error(`Page reference "${F}" doesn't exist`),()=>{};o.push(L=>{let N=C(L);return N&&{type:F,text:N.title,href:N.href,entity:N.object}})}return x((L,N)=>{let B=C(L,!0);if(B!==null&&B.object!==N.host)return{place:"before",style:"badge",text:E,href:B.href}}),D}function g(E,M){return r.lookup(E,M)}function v(E){return r.lookupAll(E)}function w(E,M=this.context.props){if(!M)return E;let F={...E};for(let D of Object.keys(F))ye(M,D)&&(F[D]=M[D]);return F}function x(E,M=!1){typeof M=="boolean"&&(M={debug:M}),a.push({query:E,...M})}function T(E,...M){let F=M[M.length-1],D=null;typeof F=="function"&&(D=F,M.pop());let C=n.action.call(E,...M);return C&&D&&typeof C.then=="function"?C.then(D):D?D(C):C}}var $h=new WeakMap,Uh=["variable","property","value","assertion","method"],ID=(n,e)=>Uh.indexOf(n.type)-Uh.indexOf(e.type),jD=n=>{let e=n.toLowerCase();return r=>r!==n&&(typeof r=="string"?r:String(r)).toLowerCase().indexOf(e)!==-1};function zD(n,e){return typeof n!="string"?String(n):(n=JSON.stringify(n),e[0]!=="'"?n:`'${n.slice(1,-1).replace(/\\.|'/g,r=>r==='\\"'?'"':r==="'"?"\\'":r)}'`)}function RD(n,e,r){if(e===r)return!0;let o=n.stat(e)||[],a=n.stat(r)||[];if(o.length!==a.length)return!1;for(let u=0;u<o.length;u++){let f=o[u],d=a[u];for(let h of Object.keys(f))if(f[h]!==d[h])return!1}return!0}function Vh(n,e,r,o,a){try{let u=$h.get(n);if(!u||u.query!==e||u.data!==o||u.context!==a){let d={tolerant:!0,stat:!0};$h.set(n,u={query:e,data:o,context:a,offset:-1,suggestions:null,api:null}),u.api=n.queryFnFromString(e,d)(o,a)}if(u.api===null)return null;if(u.offset!==-1&&RD(u.api,u.offset,r))return u.suggestions;let f=u.api.suggestion(u.offset=r,{sort:!0,filter:jD,limit:50});if(f){u.suggestions=[];for(let d of f.sort(ID))u.suggestions.push(...d.suggestions.map(h=>({type:d.type,from:d.from,to:d.to,text:d.text,value:d.type==="value"?zD(h,d.text):h})))}else u.suggestions=null;return u.suggestions}catch(u){return n.logger.error("Error while attempting to retrieve suggestions for the query:",u.message),null}}var HD=new Proxy({},{get:()=>()=>{}}),ca=["silent","error","warn","info","perf","debug"],qD={error:["error","error"],warn:["warn","warn"],info:["info","info"],perf:["log","perf"],log:["log","any"],debug:["debug","debug"]},No=class{#e;#t;#n;error;warn;info;perf;debug;log;constructor(e="",r="debug",o=console){this.#t=e,this.#n=o||HD,this.logLevel=r}shouldLogLevel(e){let r=ca.indexOf(e);return this.#e!=="silent"&&r!==-1&&r<=ca.indexOf(this.#e)}get logLevel(){return this.#e}set logLevel(e){if(ca.indexOf(e)===-1&&console.error(this.#t,`Bad log level "${e}", supported: ${ca.join(", ")}`),e!==this.#e){let o=this.#n,a=this.#t,u=d=>Function.prototype.bind.call(this.#n[d],this.#n,...this.#t?[this.#t]:[]),f=(d,h)=>(g,v)=>{o[h?"groupCollapsed":"group"](`${a} ${g}`);let x=typeof v=="function"?v():v;if(Array.isArray(x))for(let T of x)o[d](...Array.isArray(T)?T:[T]);o.groupEnd()};this.#e=e;for(let[d,[h,g]]of Object.entries(qD))g==="any"||this.shouldLogLevel(g)?this[d]=Object.assign(u(h),{group:f(h,!1),groupCollapsed:f(h,!0)}):this[d]=Object.assign(()=>{},{group:()=>()=>{},groupCollapsed:()=>()=>{}})}}};var fa=(n,e)=>vi(n,e,fa);function vi(n,e,r=Object.is){if(Object.is(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;for(let o in n)if(ye(n,o)&&(!ye(e,o)||!r(n[o],e[o])))return!1;for(let o in e)if(ye(e,o)&&!ye(n,o))return!1;return!0}var _D=()=>{},WD="[Discovery]",$D=n=>/^[a-zA-Z_][a-zA-Z_$0-9]*$/.test(n)&&!UD.includes(n),UD=["and","or","in","has","is","not","no","asc","ascN","ascA","ascNA","ascAN","desc","descN","descA","descNA","descAN"],da=(n,e)=>({...e,encodings:Array.isArray(e?.encodings)?[...e.encodings,...n.encodings]:n.encodings}),Bo=class extends tr{options;info;logger;action;objectMarkers;linkResolvers;encodings;datasets;data;#e;prepare;#t;#n;textView;constructor(e){super(),this.options=e||{};let{name:r,version:o,description:a,icon:u,logLevel:f="warn",logger:d=console,extensions:h,encodings:g,context:v,setup:w}=e||{};this.info={name:r||"Untitled model",version:o||null,description:a||null,icon:u||null},this.logger=new No(WD,f,d),this.action=new ua,this.objectMarkers=new mi(this.logger),this.linkResolvers=[],this.datasets=[],this.encodings=Ws(g),this.data=void 0,this.#e=v,this.prepare=x=>x,this.#t=!0,this.textView=new ia(this),this.apply(h),typeof w=="function"?(this.#t=!1,fc(this,w)):fc(this,()=>{}),this.apply(la);for(let{page:x,lookup:T}of this.objectMarkers.values)x&&this.linkResolvers.push(E=>{let M=T(E);return M&&{type:x,text:M.title,href:M.href,entity:M.object}})}apply(e){Array.isArray(e)?e.forEach(r=>this.apply(r)):typeof e=="function"?e.call(null,this):e&&this.apply(Object.values(e))}log(){this.logger.error("Model#log() is deprecated, use Model#logger interface instead")}get legacyPrepare(){return this.#t}setPrepare(e){if(typeof e!="function")throw new Error("An argument should be a function");this.prepare=e}get context(){return this.#e}set context(e){this.setContext(e,!0)}setContext(e,r=!1){let o=this.#e;if(r)this.#e=e;else{let a={...this.#e,...e};vi(a,o)||(this.#e=a)}Object.is(this.#e,o)||this.emit("context",o,this.#e)}getContext(){return{model:this.info,actions:this.action.actionMap,datasets:this.datasets,data:this.data,...this.context}}setData(e,r){r=r||{};let o=Symbol();this.#n=o;let a=Date.now(),u=()=>{if(this.#n!==o)throw new Error("Prevented by another setData()")},f=this.#t?Wh(this,r):_h(this,r);return Promise.resolve().then(()=>(u(),f.before?.(this),this.prepare.call(null,e,f.contextApi)||e)).then(h=>{u(),this.datasets=[{...r.dataset,data:h}],this.data=h,f.after?.(this),this.emit("data"),this.logger.perf(`Data prepared in ${Date.now()-a}ms`)})}async trackLoadDataProgress(e){let r=Date.now(),o=await e.dataset;return this.logger.perf(`Data loaded in ${Date.now()-r}ms`),this.setData(o.data,{dataset:o})}loadDataFromStream(e,r){return this.trackLoadDataProgress(Ao(e,da(this,r)))}loadDataFromEvent(e,r){return this.trackLoadDataProgress(Ku(e,da(this,r)))}loadDataFromFile(e,r){return this.trackLoadDataProgress(ea(e,da(this,r)))}loadDataFromUrl(e,r){return this.trackLoadDataProgress(Yu(e,da(this,r)))}unloadData(){this.hasDatasets()&&(this.datasets=[],this.data=void 0,this.emit("unloadData"))}hasDatasets(){return this.datasets.length!==0}getQueryEngineInfo(){return{name:"jora",version:Jt.version,link:"https://discoveryjs.github.io/jora/#article:jora-syntax"}}queryFnFromString(){return _D}queryFn(e){switch(typeof e){case"function":return e;case"string":return Object.assign(this.queryFnFromString(e),{query:e})}}query(e,r,o){switch(typeof e){case"function":return e(r,o);case"string":return this.queryFn(e)(r,o);default:return e}}queryBool(e,r,o){return Jt.buildin.bool(this.query(e,r,o))}querySuggestions(e,r,o,a){return Vh(this,e,r,o,a)}pathToQuery(e){let r="",o=a=>r+=r===""?a[0]==="["?"$"+a:a:a[0]==="["?a:"."+a;for(let a of e)a==="*"?o("values()"):typeof a=="number"?o(`[${a}]`):$D(a)?o(a):o(`["${a}"]`);return r}stripAnchorFromHash(e){return typeof e=="string"?e.replace(/(^|&)!anchor(=[^&]+|(?=&|$))/g,""):e}encodePageHash(e=null,r=null,o,a=null){let u=o;return u&&(typeof u!="string"?(Array.isArray(u)||(u=Object.entries(u)),u=u.filter(([f])=>f!=="!anchor").map(f=>f.map(encodeURIComponent).join("=")).join("&")):u=this.stripAnchorFromHash(u)),`#${e?encodeURIComponent(e):""}${typeof r=="string"&&r||typeof r=="number"?":"+encodeURIComponent(r):""}${u?"&"+u:""}${a?"&!anchor="+encodeURIComponent(a):""}`}decodePageHash(e,r=()=>Object.fromEntries){let o=(e.indexOf("&")+1||e.length+1)-1,[a,u=null]=e.substring(e[0]==="#"?1:0,o).split(":").map(decodeURIComponent),f=[],d=null;for(let h of e.slice(o+1).split("&").filter(Boolean)){let g=h.indexOf("="),v,w;g!==-1?(v=decodeURIComponent(h.slice(0,g)),w=decodeURIComponent(h.slice(g+1))):(v=decodeURIComponent(h),w=!0),v==="!anchor"?d=w&&w!==!0?w:null:f.push([v,w])}return{pageId:a,pageRef:u,pageParams:r(a)(f),pageAnchor:d}}resolveValueLinks(e){let r=[],o=typeof e;if(e&&(o==="object"||o==="string"))for(let a of this.linkResolvers){let u=a(e);u&&r.push(u)}return r.length?r:null}};function $(n,e,r){let o=document.createElement(n);typeof e=="string"&&(e={class:e});for(let a in e)if(ye(e,a)){let u=e[a];if(typeof u>"u")continue;typeof u=="function"?o.addEventListener(a.slice(2),u):o.setAttribute(a,u)}return Array.isArray(r)?o.append(...r):typeof r=="string"&&(o.innerHTML=r),o}function Gh(n){return document.createTextNode(String(n))}function dc(n){return n.nodeType===Node.DOCUMENT_FRAGMENT_NODE}function xr(...n){let e=document.createDocumentFragment();return n.forEach(r=>e.appendChild(r instanceof Node?r:Gh(r))),e}var Kh=(()=>{let n=!1;try{let e={get passive(){return n=!0,!1}},r=()=>{};window.addEventListener("test-passive",r,e),window.removeEventListener("test-passive",r)}catch{}return n})(),Rt=Kh?Object.freeze({passive:!0,capture:!0}):!0;async function Oo(n,e){let r=$("style",null,":host{display:none}"),o=new Set;Array.isArray(e)&&(n.append(...e.map(a=>{switch(typeof a=="string"&&(a={type:"style",content:a}),a.type){case"style":case"inline":return $("style",{media:a.media},a.content);case"link":case"external":{let u,f,d=new Promise((g,v)=>{u=g,f=v});return o.add(d),$("link",{rel:"stylesheet",href:a.href,media:a.media,onerror(g){o.delete(d),f(g)},onload(){o.delete(d),u()}})}default:throw new Error(`Unknown type "${a.type}" for a style descriptor`)}})),o.size&&(n.append(r),await Promise.all(o),r.remove()))}var pc=VD("localStorage"),hc=GD("localStorage"),pa=new Map;function VD(n){let e=Yh(n),r=new Map;return function(a){let u=r.get(a);return u===void 0&&(u=new ha(e,a),r.set(a,u),KD(e,r)),u}}function GD(n){let e=Yh(n);return function(o){return e?.getItem(o)??null}}function Yh(n){let e="__storage_test__"+Math.random(),r;try{r=window[n]}catch{return null}try{r.setItem(e,e),r.removeItem(e)}catch(o){if(!(o instanceof DOMException&&(o.code===22||o.code===1014||o.name==="QuotaExceededError"||o.name==="NS_ERROR_DOM_QUOTA_REACHED")&&r.length!==0))return null}return r}function KD(n,e){n!==null&&!pa.has(n)&&(pa.set(n,e),pa.size===1&&addEventListener("storage",r=>{let o=pa.get(r.storageArea);if(o!==void 0){let a=o.get(r.key);a&&a.forceSync()}}))}var ha=class extends At{#e;#t;constructor(e,r){super(e?.getItem(r)??null),this.#e=e,this.#t=r}#n(){return this.#e?.getItem(this.#t)??null}get storage(){return this.#e}get key(){return this.#t}get(){return this.value}set(e){if(this.#e){let r=this.#n();if(e!==r)return this.#e.setItem(this.#t,e),super.set(e)}return!1}delete(){this.#e&&this.#e.removeItem(this.#t)}forceSync(){return this.#e?super.set(this.#n()):!1}};var Qh="discoveryjs:color-scheme",YD=Object.freeze(["auto","light","dark"]),ma=Object.freeze(["auto","light","dark","light-only","dark-only"]);function Jh(n){return YD.includes(n)}function Po(){return matchMedia("(prefers-color-scheme:dark)")}function Zh(n,e){let r=n;switch(n){case!0:n="dark";break;case!1:n="light";break;case"disabled":case"disable":case"off":n="light-only";break;case"only":n="dark-only";break}if(r!==n&&console.warn(`Used legacy value "${r}" for ColorSheme, value replaced for "${n}"`),n!=="light-only"&&n!=="dark-only"&&e){let o=hc(Qh);Jh(o)&&(n=o)}return n}function QD(n){switch(n){case"light":case"dark":return"manual";case"light-only":case"dark-only":return"only";case"auto":return"auto";default:return n}}function gc(n){let e=yi(n);return e==="auto"?Po().matches?"dark":"light":e}function yi(n){switch(n){case"auto":return"auto";case"dark":case"dark-only":return"dark";case"light":case"light-only":default:return"light"}}function va(n="auto",e=!1){return gc(Zh(n,e))}var ga=class{#e;#t;#n;#i;#r;#o;persistent;state;value;serializedValue;mode;constructor(e="auto",r=!1){this.#e=r?pc(Qh):null,this.#i=[],this.#r=Zh(e,r),this.#o=gc(this.#r),Object.defineProperties(this,{persistent:{get:()=>this.#e!==null},state:{get:()=>this.#r},value:{get:()=>this.#o},serializedValue:{get:()=>yi(this.#r)},mode:{get:()=>QD(this.#r)}}),this.#t=this.#e?.subscribe(o=>{Jh(o)&&o!==this.serializedValue&&this.mode!=="only"&&this.set(o)}),this.#n=()=>{let o=Po(),a=()=>{this.state==="auto"&&this.set("auto")};return o.addEventListener("change",a),()=>o.removeEventListener("change",a)}}subscribe(e,r=!1){let o={fn:e};return this.#i.push(o),r&&o.fn(this.#o,this.#r),()=>{let a=o!==null?this.#i.indexOf(o):-1;o=null,a!==-1&&this.#i.splice(a,1)}}destroy(){this.#t?.(),this.#t=void 0,this.#n?.(),this.#n=void 0}set(e){let r=this.serializedValue,o=this.#o,a=this.#r;if(!ma.includes(e)){console.warn(`Bad value "${e}" for ColorScheme#state, value ignored`);return}this.#r=e,this.#o=gc(e),this.serializedValue!==r&&this.#e?.set(this.serializedValue),(this.#r!==a||this.#o!==o)&&this.#i.forEach(({fn:u})=>u(this.#o,this.#r))}toggle(e=!1){switch(this.#r){case"auto":this.set(Po().matches?"dark":"light");return;case"dark":this.set(e&&!Po().matches?"auto":"light");return;case"light":this.set(e&&Po().matches?"auto":"dark");return}console.warn(`ColorScheme is locked for changes (mode=${this.#r})`)}};var Xh=typeof ResizeObserver=="function",kr=class extends At{static supported=Xh;el;observer;constructor(){super(null),this.el=null,this.observer=Xh?new ResizeObserver(e=>{for(let r of e)this.set(r.contentRect)}):null}observe(e){if(this.observer===null){this.el=null;return}e=e||null,this.el!==e&&(this.el!==null&&this.observer.unobserve(this.el),e!==null&&this.observer.observe(e),this.el=e)}dispose(){this.el=null,this.observer=null}};function eg(n){n.nav.append({name:"index-page",when:"#.widget | pageId != defaultPageId",text:"Index",href:"=pageLink(#.widget.defaultPageId)"})}function tg(n){n.nav.append({name:"discovery-page",when:"#.widget | pageId != discoveryPageId",text:"Discover",href:"=pageLink(#.widget.discoveryPageId)"})}function ng(n){n.nav.before("inspect",{name:"open-file",when:"#.actions.uploadFile and (#.datasets or (#.widget | pageId != defaultPageId))",text:"Open file\u2026",onClick:"=#.actions.uploadFile"})}function rg(n){n.nav.before("inspect",{name:"upload-from-clipboard",when:"#.actions.uploadDataFromClipboard and (#.datasets or (#.widget | pageId != defaultPageId))",text:"",onClick:"=#.actions.uploadDataFromClipboard",tooltip:{position:"trigger",content:'text:"Paste data from clipboard"'}})}function ig(n){let e=()=>{};n.nav.menu.append({view:"block",className:["toggle-menu-item","dark-mode-switcher"],name:"dark-mode",when:'#.widget | colorScheme.mode != "only"',postRender(r,o,a,{widget:u,hide:f}){let d;e(),e=u.colorScheme.subscribe((h,g)=>{let v=yi(g);v!==d&&(r.innerHTML="",d=v,u.view.render(r,{view:"toggle-group",beforeToggles:'text:"Color schema"',onChange(w){d=w,u.colorScheme.set(w),f()},value:v,data:()=>[{value:"light",text:"Light"},{value:"dark",text:"Dark"},{value:"auto",text:"Auto"}]},null,{widget:u}))},!0)}})}function og(n){let r=null,o=0;n.nav.append({name:"inspect",when:"#.widget.inspectMode",text:"",tooltip:{position:"trigger",showDelay:!0,content:'md:"**Enable view inspection**<br>To suspend enabling inspect mode by 3 seconds,<br>click the button with Cmd (\u2318) or Ctrl-key"'},onClick(a,u,f,d){!n.inspectMode.value&&(d.metaKey||d.ctrlKey)?(r===null&&(o=0,r=setTimeout(function h(){o--,o===0?(r=null,delete a.dataset.suspendSeconds,n.inspectMode.set(!0)):(r=setTimeout(h,1e3),a.dataset.suspendSeconds=String(o))},1e3)),o+=3,a.dataset.suspendSeconds=String(o)):r!==null?(clearTimeout(r),r=null,delete a.dataset.suspendSeconds):(n.view.tooltip?.hide(),n.inspectMode.set(!n.inspectMode.value))}})}var Io=class{items;host;baseConfig;constructor(e,r){this.host=e,this.baseConfig=r,this.items=[]}insert(e,r,o){switch(r){case"after":r=this.items.findIndex(u=>u.name===o),r===-1?r=this.items.length:r++;break;case"before":r=this.items.findIndex(u=>u.name===o),r===-1&&(r=this.items.length);break;default:(r===void 0||isNaN(r)||!isFinite(r))&&(r=this.items.length)}r=Math.max(0,Math.min(this.items.length,r));let a=this.host.view.composeConfig(this.baseConfig,e);this.items.splice(r,0,a)}prepend(e){this.insert(e,0)}append(e){this.insert(e)}before(e,r){this.insert(r,"before",e)}after(e,r){this.insert(r,"after",e)}replace(e,r){let o=this.items.findIndex(a=>a.name===e);o!==-1?this.items[o]=this.host.view.composeConfig(this.baseConfig,r):this.insert(r)}remove(e){let r=this.items.findIndex(o=>o.name===e);if(r!==-1)return this.items.splice(r,1)[0]}},ya=class extends Io{host;popup;data;context;config;primary;secondary;menu;contentRect;constructor(e,r="nav-button"){super(e,r);let o=$("div","powered-by-discoveryjs",["powered by ",$("a",{class:"view-link",href:"https://github.com/discoveryjs/discovery",target:"_blank"},"Discovery.js"),` ${_l}`]);this.host=e,this.popup=null,this.data=null,this.context=null,this.primary=new Io(e,"nav-button"),this.secondary=this,this.menu=new Io(e,"menu-item"),this.config=[this.secondary.items,{view:"nav-button",name:"burger",whenData:!0,data:async()=>{let a=xr();return await this.host.view.render(a,this.menu.items,this.host.data,{...this.context,hide:()=>this.popup?.hide()}),[...a.childNodes].filter(u=>u.nodeType===1||u.nodeType===3)},onClick:(a,u)=>{let f=this.popup||new this.host.view.Popup({className:"discovery-nav-popup"});this.popup||(this.popup=f,f.el.addEventListener("click",({target:d})=>{d.closest("a[href]")&&setTimeout(()=>f.hide(),50)},!0)),f.toggle(a,d=>d.append(...u,o))}},this.primary.items],this.contentRect=new kr,this.contentRect.subscribe(a=>{let{container:u}=e.dom;if(u&&a){let{width:f,height:d}=a;u.style.setProperty("--discovery-nav-width",f+"px"),u.style.setProperty("--discovery-nav-height",d+"px")}})}render(e,r,o){this.contentRect.observe(e),e&&(this.data=r,this.context={...o,widget:this.host},this.host.view.setViewRoot(e,"nav",{config:this.config,data:this.data,context:this.context}),e.innerHTML="",this.host.view.render(e,this.config,this.data,this.context))}};var fg=Object.freeze({tag:void 0}),dg=Object.freeze({view:""}),vc=new WeakMap,pg=new WeakMap,hg=new WeakMap,sg=new WeakMap,JD=new Set(["view","when","context","data","whenData","postRender","className","tooltip"]);function bc(n){return typeof n=="string"||Array.isArray(n)||n!==null&&typeof n=="object"&&typeof n.view=="string"}function Cr(n,e){return hg.set(n,e),n}function gg(n,e,r,o){if(e===null||o.has(e))return;let a=n.fragmentEls.get(e);if(a!==void 0)for(let f of a){let d=r.children.find(h=>h.view===f);d?r=d:r.children.push(r={node:null,parent:r,view:f,children:[]})}let u=pg.get(e);if(u!==void 0)r.children.push(r={node:e,parent:r,viewRoot:u,children:[]});else{let f=n.viewEls.get(e);f!==void 0&&r.children.push(r={node:e,parent:r,view:f,children:[]})}if(e.nodeType===1)for(let f=e.firstChild;f;f=f.nextSibling)gg(n,f,r,o)}function ZD(n){return{name:"config-error",options:fg,render(e,r){if(e.className="discovery-buildin-view-render-error",e.dataset.type=r.type,e.textContent=r.reason,"config"in r){let o=e.appendChild(document.createElement("span"));o.className="toggle-config",o.textContent="show config...",o.addEventListener("click",()=>{e.classList.toggle("expanded")?(o.textContent="hide config...",n.render(e,{view:"struct",expanded:1},r.config)):(o.textContent="show config...",e.lastChild?.remove())})}}}}function ag(n,e,r,o,a,u,f,d){return!ye(r,n)||r[n]===void 0||e.host.queryBool(r[n]===!0?"":r[n],o,a)?!0:(e.viewEls.set(d,{skipped:n,config:r,inputData:u,inputDataIndex:f,data:o,context:a}),!1)}function wc(n,e,r,o){let a=e;return typeof a=="string"&&a.startsWith("=")&&(a=n.queryFn(a.slice(1))),typeof a=="function"&&(a=a(r,o)),typeof a=="string"&&(a=a.trim().split(/\s+/)),Array.isArray(a)&&(a=a.map(u=>typeof u=="function"?u(r,o):u).filter(Boolean),a.length)?a:null}function mg(n,e,r,o,a){let u=r?wc(n,r,o,a):null;u!==null&&e.classList.add(...u)}async function vg(n,e,r,o,a,u,f,d,h){let{tag:g}=e.options,v=g===null?document.createDocumentFragment():document.createElement(g||"div");await e.render(v,a,u,f),typeof o.postRender=="function"&&await o.postRender(v,o,u,f);let w={config:o,props:a,inputData:d,inputDataIndex:h,data:u,context:f};if(!dc(v))n.viewEls.set(v,w),e.name&&v.classList.add(`view-${e.name}`),mg(n.host,v,o.className,u,f),o.tooltip&&xc(n.host,v,o.tooltip,u,f);else for(let x of v.childNodes){let T=n.fragmentEls.get(x);T!==void 0?T.unshift(w):n.fragmentEls.set(x,[w])}r.replaceWith(v)}function lg(n,e,r,o){return vg(n,n.defaultRenderErrorRenderer,r,dg,{type:"render",reason:e,config:o})}function XD(n,e){return{name:e,normalizeConfig:n.normalizeConfig.bind(n),ensureValidConfig:n.ensureValidConfig.bind(n),composeConfig:n.composeConfig.bind(n),propsFromConfig:n.propsFromConfig.bind(n),computeClassName:wc.bind(null,n),applyComputedClassName:mg.bind(null,n),render:n.render.bind(n),listLimit:n.listLimit.bind(n),renderList:n.renderList.bind(n),maybeMoreButtons:n.maybeMoreButtons.bind(n),renderMoreButton:n.renderMoreButton.bind(n),tooltip(r,o,a,u){r&&r.nodeType===1?xc(n.host,r,o,a,u):n.host.logger.warn("A tooltip can be attached to a HTML element only")}}}function xc(n,e,r,o,a){e.classList.add("discovery-view-has-tooltip"),vc.set(e,{config:r,data:o,context:a}),n.view.tooltip===null&&(n.view.tooltip=eA(n))}function ug(n){return!!n&&!Array.isArray(n)&&typeof n!="string"&&typeof n!="function"&&!n.view}function cg(n,e){return Number.isFinite(n)?Number(n):e}function eA(n){let e=null,r=new n.view.Popup({className:"discovery-buildin-view-tooltip",hoverTriggers:".discovery-view-has-tooltip",position:"pointer",showDelay(o){let{config:a}=vc.get(o)||{};return ug(a)?a.showDelay??!0:!0},render(o,a){let{config:u,data:f,context:d}=vc.get(a)||{},h="pointer",g="natural",v=3,w=3,x=u;return e!==null&&(o.classList.remove(...e),e=null),ug(u)&&(e=wc(n,u.className,f,d),e!==null&&o.classList.add(...e),h=u.position||h,g=u.positionMode||g,v=cg(u.pointerOffsetX,v),w=cg(u.pointerOffsetY,w),x=u.content),r.position=h,r.positionMode=g,r.pointerOffsetX=v,r.pointerOffsetY=w,x?n.view.render(o,x,f,d):n.view.render(o,{view:n.view.defaultRenderErrorRenderer.render,reason:"Element marked as having a tooltip but related data is not found"})}});return r}async function yg(n,e,r,o,a,u){if(Array.isArray(r)){await Promise.all(r.map(g=>yg(n,e,g,o,a,u)));return}let f=o&&typeof a=="number"?o[a]:o,d=null;switch(typeof r.view){case"function":d={name:!1,options:fg,render:r.view};break;case"string":if(r.view==="render"){let{config:g="",context:v=""}=n.propsFromConfig(r,o,u);d={name:!1,options:{tag:null},render(w,x,T){let E=g!==""?n.host.query(g,f,u):T,M=n.host.query(v,u,f);return n.render(w,E,T!==E?T:f,M)}}}else if(r.view.startsWith("preset/")){let g=r.view.substr(7);d={name:!1,options:{tag:null},render:n.host.preset.isDefined(g)?n.host.preset.get(g).render:()=>{}}}else d=n.get(r.view)||null;break}e||(e=document.createDocumentFragment());let h=e.appendChild(document.createComment(""));if(!d){let g=typeof r.view=="string"?"View `"+r.view+"` is not found":"Render is not a function";return n.host.logger.error(g,r),lg(n,g,h,r)}try{if(ag("when",n,r,f,u,o,a,h)){let g="context"in r?await n.host.query(r.context,f,u):u,v="data"in r?await n.host.query(r.data,f,g):f;if(ag("whenData",n,r,v,g,o,a,h))return await vg(n,d,h,r,n.propsFromConfig(r,v,g),v,g,o,a)}}catch(g){return n.host.logger.error("View render error:",g.message),lg(n,String(g),h,dg)}}var yc=class{el;position;positionMode;pointerOffsetX;pointerOffsetY;constructor(){}toggle(){}async show(){}hide(){}},ba=class n extends jt{host;defaultRenderErrorRenderer;viewEls;fragmentEls;tooltip;Popup=yc;constructor(e){super(),this.host=e,this.defaultRenderErrorRenderer=ZD(this),this.viewEls=new WeakMap,this.fragmentEls=new WeakMap,this.tooltip=null}define(e,r,o){let a=bc(r)||typeof r=="function"?{...o,render:r}:r,{render:u=[],...f}=a,{tag:d,props:h}=f;return n.define(this,e,Object.freeze({name:e,options:Object.freeze({...a,tag:typeof d=="string"||d===void 0?d:null,props:typeof h=="string"?this.host.queryFn(h):h}),render:typeof u=="function"?u.bind(XD(this,e)):(g,v,w,x)=>this.render(g,u,w,x)}))}normalizeConfig(e){if(!e)return null;if(Array.isArray(e)){let r=[];for(let o of e){let a=this.normalizeConfig(o);a!==null&&(Array.isArray(a)?r.push(...a):r.push(a))}return r}if(typeof e=="string"){let[,r,o,a]=e.match(/^(\S+?)([:{])((?:.|\s)+)$/)||[];if(r){if(o==="{")try{return Cr(na(r,o+a),e)}catch(u){return Cr(this.badConfig(e,u),e)}return Cr({view:r,data:a},e)}return Cr({view:e},e)}else if(typeof e=="function")return Cr({view:e},e);return e}badConfig(e,r){let o=r?.message||"Unknown error";return this.host.logger.error(o,{config:e,error:r}),{view:this.defaultRenderErrorRenderer.render,type:"config",reason:o,config:e}}ensureValidConfig(e){return Array.isArray(e)?e.map(r=>this.ensureValidConfig(r)).flat():!e||!e.view?this.badConfig(e,new Error(e?"Option `view` is missed":"Config is not a valid value")):e}composeConfig(e,r){return e=this.normalizeConfig(e),r=this.normalizeConfig(r),e&&r?Array.isArray(e)?e.map(o=>Cr({...o,...r},[o,r])):Cr({...e,...r},[e,r]):e||r}propsFromConfig(e,r,o,a=this.get(e?.view)?.options.props){let u={};for(let[f,d]of Object.entries(e))JD.has(f)||(u[f]=typeof d=="string"&&d.startsWith("=")?this.host.query(d.slice(1),r,o):d);if(typeof a=="function"){let f=a(r,{props:u,context:o});f!==null&&typeof f=="object"&&f!==u&&(sg.set(f,{props:u,fn:a}),u=f)}return u}render(e,r,o,a,u){return yg(this,e,this.ensureValidConfig(this.normalizeConfig(r)),o,u,a)}listLimit(e,r){return e===!1?!1:!e||isNaN(e)?r:Math.max(parseInt(e,10),0)||r}renderList(e,r,o,a,u=0,f,d){let h=typeof f=="object"&&f!==null?f:{limit:f,moreContainer:d},{moreContainer:g,onSliceRender:v}=h,{limit:w=!1}=h;w===!1&&(w=o.length);let x=Promise.all(o.slice(u,u+w).map((T,E,M)=>this.render(e,r,o,{...a,index:u+E,array:o,sliceIndex:E,slice:M},u+E)));return typeof v=="function"&&x.then(()=>v(Math.max(o.length-u-w,0),u,w,o.length)),this.maybeMoreButtons(g||e,null,o.length,u+w,w,T=>this.renderList(e,r,o,a,T,h)),x}maybeMoreButtons(e,r,o,a,u,f){if(o<=a)return null;let d=o-a,h=document.createElement("span");return d>u&&this.renderMoreButton(h,"Show "+u+" more...",()=>f(a,u)),d>0&&this.renderMoreButton(h,"Show all the rest "+d+" items...",()=>f(a,1/0)),h!==null&&(h.className="more-buttons",e.insertBefore(h,r)),h}renderMoreButton(e,r,o){let a=document.createElement("button");a.className="more-button",a.innerHTML=r,a.addEventListener("click",()=>{e.remove(),o()}),e.appendChild(a)}attachTooltip(e,r,o,a){xc(this.host,e,r,o,a)}adoptFragment(e,r){let o=this.fragmentEls.get(r);if(o)for(let a of e.childNodes)this.fragmentEls.set(a,o)}setViewRoot(e,r,o){pg.set(e,{name:r,...o})}getViewTree(e){let r=new Set(e||[]),o=[];return gg(this,this.host.dom?.container||null,{parent:null,children:o},r),o}getViewStackTrace(e){let{container:r}=this.host.dom;if(!r||!(e instanceof Node)||!r.contains(e))return null;let o=[],a=e;for(;a!==null&&a!==r;){let u=this.viewEls.get(a);u!==void 0&&o.push(u),a=a.parentNode}return o.length===0?null:o.reverse()}getViewConfigTransitionTree(e){let r=hg.get(e)||[];return Array.isArray(r)||(r=[r]),{value:e,deps:r.map(this.getViewConfigTransitionTree,this)}}getViewPropsTransition(e){let r=sg.get(e)||null;return r&&{props:r.props,fn:r.fn,query:r.fn.query||null}}};var bg=Symbol("config"),tA={name:"not-found",render:(n,{name:e})=>{n.style.cssText="color:#a00",n.innerText=`Page \`${e}\` not found`}},wa=class n extends jt{#e;#t;#n;lastPage;lastPageRef;pageOverscrolled;setPageOverscroll;constructor(e,r){if(super(),this.#e=e,this.#t=r,this.#n=null,this.lastPage=null,this.lastPageRef=null,this.pageOverscrolled=new At(!1),this.setPageOverscroll=()=>{},typeof IntersectionObserver=="function"){let o=$("div",{style:"position:absolute"}),a=e.dom?.content||null,u=()=>{};if(a!==null){let f=new IntersectionObserver(d=>this.pageOverscrolled.set(!d[d.length-1].isIntersecting),{root:a});this.setPageOverscroll=d=>{f.unobserve(o),u(),d&&(d.prepend(o),f.observe(o),u=this.pageOverscrolled.subscribeSync(h=>{d.classList.toggle("page_overscrolled",h)}))}}}}define(e,r,o){let a=bc(r)||typeof r=="function"?{...o,render:r}:r,{render:u,...f}=a;if(u===void 0)throw new Error(`Page "${e}" requires a specified render option`);return n.define(this,e,Object.freeze({name:e,render:typeof u=="function"?u.bind(this.#t):(d,h,g)=>this.#t.render(d,u,h,g),options:Object.freeze(f),[bg]:u}))}render(e,r,o,a){let u=this.get(r);u||(u=this.get("not-found")||tA,o={name:r});let{reuseEl:f,init:d,keepScrollOffset:h=!0}=u.options||{},g=this.#e.pageRef,v=this.lastPage!==r,w=this.lastPageRef!==g,x=f&&!v?e:$("article",`page page-${CSS.escape(r)}`);this.#n=x,this.lastPage=r,this.lastPageRef=g,v&&typeof d=="function"&&d(x);let T=new Promise(async(E,M)=>{try{if(await u.render(x,o,a),this.#n!==x){M(new Error("Aborted by new page render"));return}x!==e&&(e.replaceWith(x),this.setPageOverscroll(x));let F=x.parentNode;F!==null&&(v||w||!h)&&(F.scrollTop=0),E()}catch(F){x.replaceChildren(),this.#t.render(x,"alert-danger",String(F)+" (see details in console)"),M(F)}});return{pageEl:x,config:u[bg],renderState:T}}};var xa=class n extends jt{#e;constructor(e){super(),this.#e=e}define(e,r){return r=JSON.parse(JSON.stringify(r)),n.define(this,e,Object.freeze({name:e,render:(o,a,u,f)=>this.#e.render(o,r,u,f),config:r}))}render(e,r,o,a){let u=this.get(r);if(!u){let f="Preset `"+r+"` is not found";console.error(f,r);let d=e.appendChild(document.createElement("div"));return d.className="discovery-buildin-view-config-error",d.textContent=f,Promise.resolve()}return u.render(e,null,o,a)}};var{documentElement:Dr,compatMode:nA}=document,wg=nA==="CSS1Compat";function jo(n){let e=n.offsetParent;for(;e!==null&&e!==Dr&&getComputedStyle(e).position==="static";)e=e.offsetParent;return e||Dr}function zo(n){let e=n.parentNode;for(;e!==null&&e!==Dr&&getComputedStyle(e).overflow==="visible";)e=e.parentNode;return e||Dr}function kc(n=null){let e=0,r=0;if(typeof n?.getBoundingClientRect=="function"){let o=n.getBoundingClientRect();e=-o.top,r=-o.left}else if(wg)e=window.pageYOffset||Dr.scrollTop,r=window.pageXOffset||Dr.scrollLeft;else{let{body:o}=document;n!==o&&(e=o.scrollTop-o.clientTop,r=o.scrollLeft-o.clientLeft)}return{left:r,top:e}}function Ht(n,e=null){let r=kc(e),o=0,a=0,u=0,f=0;return n instanceof HTMLElement&&typeof n?.getBoundingClientRect=="function"&&({top:o,left:a,right:u,bottom:f}=n.getBoundingClientRect()),{top:o+r.top,left:a+r.left,right:u+r.left,bottom:f+r.top,width:u-a,height:f-o}}function Cc(n,e=null){let r=wg?Dr:document.body,{top:o,left:a}=n===r&&!e?kc():Ht(n,e),u=0,f=0;return!n||n instanceof Window?(u=window.innerWidth||0,f=window.innerHeight||0):(o+=n.clientTop,a+=n.clientLeft,u=n.clientWidth,f=n.clientHeight),{top:o,left:a,right:a+u,bottom:o+f,width:u,height:f}}var nr=(()=>{let n=new At({x:0,y:0},(e,r)=>e.x!==r.x||e.y!==r.y);return document.addEventListener("pointermove",({x:e,y:r})=>n.set({x:e,y:r}),Rt),n.readonly})();function rA(n){return n!==null&&(typeof n=="object"||typeof n=="function")}function Ar(n,e){if(typeof n!="function")throw new TypeError("Expected a function");if(typeof e=="number"&&(e={wait:e}),!rA(e)){let _;return Object.assign(function(...W){return _=n.apply(this,W)},{cancel(){},flush(){return _},pending(){return!1}})}let r=Math.max(0,Number(e.wait)||0),o=!!e.leading,a="maxWait"in e,u=a?Math.max(Number(e.maxWait)||0,r):1/0,f="trailing"in e?!!e.trailing:!0,d,h,g,v,w,x=0;function T(_){let W=d,te=h;return d=h=void 0,x=_,g=n.apply(te,W),g}function E(_,W){return setTimeout(_,W)}function M(_){clearTimeout(_)}function F(_){return x=_,v=E(L,r),o?T(_):g}function D(_,W){let te=_-W,H=_-x,X=r-te;return Math.min(X,u-H)}function C(_,W){let te=_-W,H=_-x;return te>=r||te<0||H>=u}function L(){let _=Date.now();if(w===void 0||C(_,w))return N(_);v=E(L,D(_,w))}function N(_){return v=void 0,f&&d?T(_):(d=h=void 0,g)}function B(){v!==void 0&&M(v),x=0,d=w=h=v=void 0}function O(){return v===void 0?g:N(Date.now())}function z(){return v!==void 0}return Object.assign(function(..._){let W=Date.now(),te=w===void 0||C(W,w);if(d=_,h=this,w=W,te){if(v===void 0)return F(w);if(a)return v=E(L,r),T(w)}return v===void 0&&(v=E(L,r)),g},{cancel:B,flush:O,pending:z})}var Dc=0,xg=[{view:"badge",when:'view.data != parent.(view or viewRoot).data or "data" in view.config',data:{text:"D"},tooltip:'text:"Data value was changed"'},{view:"badge",when:"view.context != parent.(view or viewRoot).context",data:{text:"C"},tooltip:'text:"Context value was changed"'}];function iA(n){let e=zo(n),r=Ht(n,e),o=0,a=0,{scrollTop:u,scrollLeft:f,clientWidth:d,clientHeight:h}=e,g=u+o,v=f+a,w=f+d,x=u+h,T=u+r.top,E=f+r.left,M=E+r.width,F=u,D=f;(T<g||T>x)&&(F=T-o),E<v?D=E-a:M>w&&(D=Math.max(E,f-(M-w))-a),e?.scrollTo(D,F)}function kg(){Dc=0}function Cg(n,{selectTreeViewLeaf:e,detailsSidebarLeafExpanded:r}){return{view:"tree",when:"#.selectedView",data:"$[0]",className:"sidebar",limitLines:!1,itemConfig:{collapsible:"=not viewRoot",expanded:o=>o.viewRoot||r.has(o),onToggle:(o,a,u)=>o?r.add(u):r.delete(u)},item:{view:"switch",content:[{when:"viewRoot",content:{view:"block",className:"view-root",content:"text:viewRoot.name"}},{when:"$ = #.selectedView",content:[{view:"block",className:[o=>o.view?.skipped?"skipped":!1,"selected"],content:'text:view.config.view or "#root" | is string ?: "\u0192n"',postRender(o){requestAnimationFrame(()=>{n.querySelector(".sidebar").scrollTop=Dc,iA(o)})}},...xg]},{content:[{view:"link",className:o=>o.view?.skipped?"skipped":!1,data:'{ text: view.config.view or "#root" | is string ?: "\u0192n", href: false, view, self: $ }',onClick(o,a){Dc=n.querySelector(".sidebar")?.scrollTop||0,e(a.self)}},...xg]}]}}}function ka(n){n=n.replace(/^(?:\s*[\n]+)+?([ \t]*)/,"$1").trimRight(),n=n.replace(/\n[ \t]+(?=\n)/g,`
`);let e=n.split(/\n+/),r=+(n.match(/^\s/)===null),o=1e3;for(var a=r;a<e.length;a++){let u=e[a].match(/^\s*/);if(u[0].length<o&&(o=u[0].length),o==0)break}return o>0&&(n=n.replace(new RegExp("^ {"+o+"}","gm"),"")),n}var Dg={view:"block",className:["content","props-config"],data:"#.view | view or viewRoot",content:[{view:"block",className:"content-section skip",when:"skipped",content:'block{ content: "badge:{ text: skipped }" }'},{view:"block",className:"content-section render",when:"config.view is not string",content:'source:{ content: config.view + "", syntax: "js" }'},{view:"block",when:"props != undefined",className:"content-section props",content:[{view:"struct",expanded:1,data:"props"},{view:"context",data:(n,e)=>e.host.view.getViewPropsTransition(n.props),whenData:!0,content:[{view:"block",className:"transition-fn",data:n=>({...n,query:typeof n.query=="string"?ka(n.query):void 0}),content:{view:"switch",content:[{when:"query is string",content:{view:"source",data:'{ content: query, syntax: "jora", lineNum: false }'}},{content:"struct:fn"}]}},{view:"struct",expanded:2,data:"props"}]}]},{view:"block",className:"content-section config",content:[{view:"struct",expanded:1,data:"config"},{view:"tree",data:(n,e)=>e.host.view.getViewConfigTransitionTree(n.config).deps,whenData:!0,expanded:3,children:"deps",item:{view:"struct",expanded:1,data:"value"}}]}]};var Ag={view:"list",className:"data-flow-transitions",limit:1,when:".[view]",data:`
        [null]    // to show empty list on first render
        + .[view] // filter viewRoot
        .(
            $parent;
            $parentName: parent.view.config.view;
            $queryData: view | inputDataIndex != undefined ? inputData[inputDataIndex] : inputData;

            view | [
                ...'data' in config ? { inputData: $queryData, transition: config.data, name: config.view, view: $, $parent } : [],
                ...inputDataIndex != undefined ? { inputData, transition: \`$[\${inputDataIndex}]\`, name: \`\${$parentName} \u2192 \${config.view}\`, view: $, $parent } : []
            ]
        )
    `,whenData:"size() > 1",itemConfig:{when:!0},item:[{view:"block",className:"root-data",when:"inputData = ..parent.viewRoot[].data",content:'badge:"Root data"'},{view:"struct",data:"inputData"},{view:"block",className:"data-flow-transition",content:[{view:"switch",content:[{when:"transition is (string or undefined)",content:{view:"context",data(n){return{content:ka(n.transition),refs:[]}},content:{view:"source",data:`{
                                    ...,
                                    syntax: "jora",
                                    lineNum: false
                                }`}}},{content:{view:"struct",data:"transition"}}]},{view:"block",className:"view-name",content:"text:name"}]}]},Sg={view:"block",className:"content-section data",data:"#.view",content:[{view:"context",data:"..parent",content:Ag},{view:"context",content:{...Ag,limit:!1}},{view:"block",className:"root-data",when:"view or viewRoot | data = ([@] + @..parent).viewRoot[].data",content:'badge:"Root data"'},{view:"struct",expanded:1,data:"view or viewRoot | data"}]};function oA(n,e){if(n===null)return!0;for(let r of["top","left","width","height"])if(n[r]!==e[r])return!0;return!1}var Ac=n=>{let e=!1,r=null,o=null,a=null,u=null,f,d=new Set,h=new Map,g=new Map,v=$("div","cancel-hint view-alert view-alert-warning"),w=$("div",{class:"discovery-view-inspector-overlay",onclick:O=>{if((O.metaKey||O.ctrlKey)&&o){let z=o.view.config.view;F(),n.setPage("views-showcase",z);return}D(o&&!a?o:null)}},[v]),x=Ar(()=>{if(!e||a!==null)return;let O=n.view.getViewTree([N.el]),z=new Set([...g.keys()]);(function W(te,H){for(let X of te){if(!X.node||!X.view&&!X.viewRoot){X.children.length&&W(X.children,H);continue}let A=Ht(X.node,H),Q=g.get(X.node)||null;Q===null?(Q={el:H.appendChild($("div",X.viewRoot?"overlay view-root":"overlay")),box:null},X.node.nodeType===1&&(Q.el.style.zIndex=getComputedStyle(X.node).zIndex),X.viewRoot&&X.viewRoot.inspectable!==!1&&(Q.el.dataset.inspectable=!0),g.set(X.node,Q),h.set(Q.el,X)):z.delete(X.node),oA(Q.box,A)&&(Q.el.style.top=`${A.top}px`,Q.el.style.left=`${A.left}px`,Q.el.style.width=`${A.width}px`,Q.el.style.height=`${A.height}px`,Q.box=A),X.children.length&&(X.node.nodeType===1&&(Q.el.style.overflow=getComputedStyle(X.node).overflow!=="visible"?"hidden":"visible"),W(X.children,Q.el))}})(O,w);for(let W of z)g.get(W).el.remove(),g.delete(W);T()},{maxWait:0,wait:50}),T=()=>{let{x:O,y:z}=nr.value;L([...n.dom.container.parentNode.elementsFromPoint(O|0,z|0)||[]].find(_=>h.has(_))||null)},E=O=>{(O.key==="Escape"||O.keyCode===27||O.which===27)&&n.inspectMode.set(!1)},M=()=>{e||(e=!0,document.addEventListener("scroll",x,Rt),document.addEventListener("keydown",E,!0),nr.subscribe(x),f=setInterval(x,500),n.dom.container.append(w),x(),n.inspectMode.set(!0))},F=()=>{e&&(e=!1,clearInterval(f),document.removeEventListener("scroll",x,Rt),document.removeEventListener("keydown",E,!0),nr.unsubscribe(x),B=!1,delete v.dataset.alt,w.remove(),w.replaceChildren(v),g.clear(),C(),n.inspectMode.set(!1))},D=O=>{if(a=O||null,O){let{innerWidth:z,innerHeight:_}=window,{left:W,top:te,width:H,height:X}=N.el.getBoundingClientRect();N.el.style.top=`${te}px`,N.el.style.left=`${W}px`,N.el.style.right=`${z-(W+H)}px`,N.el.style.bottom=`${_-(te+X)}px`,N.frozen=!0,requestAnimationFrame(()=>{L(g.get(O.node)?.el||null),clearTimeout(u),N.show(),N.freeze()}),delete v.dataset.alt}else B?n.inspectMode.set(!1):(d.clear(),kg(),C(),x())},C=()=>{r&&r.classList.remove("hovered"),r=null,o=null,a=null,N.hide()},L=O=>{if(O===r)return;if(r!==null&&r.classList.remove("hovered"),r=O,O===null){u=setTimeout(C,100);return}O.classList.add("hovered");let z=h.get(O)||null;if(z===null){o=null;return}o!==null&&z.view===o.view||(o=z,clearTimeout(u),N.show())},N=new n.view.Popup({className:"discovery-inspect-details-popup",position:"pointer",hideIfEventOutside:!1,hideOnResize:!1,render(O){let z=a||o,_=[],W=z;for(;W!==null&&(W.view||W.viewRoot);)W!==z&&a!==null&&d.add(W),_.unshift(W),W=W.parent;return n.view.render(O,{view:"context",modifiers:[Cg(O,{selectTreeViewLeaf:D,detailsSidebarLeafExpanded:d})],content:{view:"context",modifiers:{view:"block",className:"toolbar",content:[{view:"toggle-group",className:"stack-view-chain",name:"view",data:".({ value: $ })",value:"=$[-1].value",toggleConfig:{className:[te=>te.value.viewRoot?"view-root":!1,te=>te.value.view&&te.value.view.skipped?"skipped":!1],content:['text:value | viewRoot.name or view.config.view | is string ?: "\u0192n"']}},{view:"button",when:a!==null,content:'text:"Close inspector"',onClick(){n.inspectMode.set(!1)}}]},content:[Dg,{view:"block",className:["content","data-context"],content:[Sg,{view:"block",className:"content-section context",data:"$[-1] | view or viewRoot",content:{view:"struct",expanded:1,data:"context"}}]}]}},_,{selectedView:a,host:n})}});n.action.define("startInspect",M),n.action.define("stopInspect",F),n.inspectMode.subscribeSync(O=>O?M():F());let B=!1};var ja={};Ce(ja,{alerts:()=>Sm,appHeader:()=>zm,autoLink:()=>Rm,badges:()=>_m,block:()=>lm,blockquote:()=>Wm,button:()=>Eg,checkbox:()=>Mg,checkboxList:()=>Fg,column:()=>um,columns:()=>cm,contentFilter:()=>Bg,context:()=>cy,dropdown:()=>Pg,editors:()=>sm,expand:()=>dm,headers:()=>Um,hstack:()=>hm,html:()=>Gm,image:()=>Ym,imagePreview:()=>Jm,indicator:()=>Xm,input:()=>zg,link:()=>tv,listItem:()=>gm,lists:()=>mm,markdown:()=>wv,menu:()=>Hg,menuItem:()=>_g,navButton:()=>$g,pageHeader:()=>ym,popup:()=>km,progressbar:()=>Vg,section:()=>Dm,select:()=>Kg,signature:()=>wy,source:()=>ny,struct:()=>_y,switchView:()=>dy,tab:()=>Zg,table:()=>Vy,tableCell:()=>Qy,tableRow:()=>Gy,tabs:()=>Qg,text:()=>iy,textMatch:()=>sy,textNumeric:()=>ly,textRender:()=>hy,tocSection:()=>Am,toggle:()=>Xg,toggleGroup:()=>em,tree:()=>Xy,treeItem:()=>eb});var Ro=(n,e)=>({demo:{view:n,text:"Button",onClick:Function('return () => alert("Hello world!")')()},examples:[{title:"Variations",demo:e.map(r=>`${r}{ text: "${r}" }`)},{title:"Disabled state",demo:e.map(r=>({view:r,disabled:!0,text:r}))},{title:"Complex content",demo:{view:"button",content:['text:"Example "',"pill-badge:123"]}},{title:"Button as a link",demo:{view:"button",text:"Click me",href:"#url",external:!0}},{title:"Using data as source of options",beforeDemo:{view:"md",source:["The following properties are taken from the data when the appropriate options are not specified for a legacy reasons (is subject to remove in the future):","- `text`","- `href`","- `external`"].join(`
`)},highlightProps:["data"],demo:{view:n,data:{text:"demo",href:"#example",external:!0}}}]});var Ca=`is not array? | {
    text: #.props has no 'content' ? is (string or number or boolean) ?: text,
    content: undefined,
    disabled: false,
    href,
    external,
    onClick: undefined
} | overrideProps()`;function Eg(n){function e(r,o,a,u){let{text:f,content:d,disabled:h,href:g,external:v,onClick:w}=o;if(r.classList.add("view-button"),h?r.disabled=!0:typeof w=="function"?(r.addEventListener("click",()=>w(r,a,u)),r.classList.add("onclick")):typeof g=="string"&&r.addEventListener("click",()=>{let x=$("a",{href:g,target:v?"_blank":""});n.dom.root.append(x),x.click(),x.remove()}),d)return n.view.render(r,d,a,u);r.textContent=f}n.view.define("button",e,{tag:"button",props:Ca,usage:Ro}),n.view.define("button-primary",e,{tag:"button",props:Ca,usage:Ro}),n.view.define("button-danger",e,{tag:"button",props:Ca,usage:Ro}),n.view.define("button-warning",e,{tag:"button",props:Ca,usage:Ro})}var Tg={demo:{view:"checkbox-list",checkbox:{content:"text"},data:["one","two","three"]}};function Fg(n){n.view.define("checkbox-list",function(e,r,o,a){let{name:u="filter",checkbox:f,checkboxValue:d="$",emptyText:h,limit:g,onChange:v,onInit:w}=r,x=new Set;if(h!==!1&&h!==""&&e.setAttribute("emptyText",h||"Empty list"),!Array.isArray(o)&&o&&(o=[o]),Array.isArray(o))return n.view.renderList(e,this.composeConfig({view:"checkbox",...f,onInit:(T,E,M,F)=>{T&&x.add(n.query(d,M,F))},onChange:(T,E,M,F)=>{let D=x.size,C=n.query(d,M,F);T?x.add(C):x.delete(C),D!==x.size&&typeof v=="function"&&v([...x],u)}}),o,a,0,n.view.listLimit(g,25)).then(()=>{typeof w=="function"&&w([...x],u)})},{usage:Tg})}var Lg={demo:{view:"checkbox",content:'text:"checkbox caption"'},examples:[{title:"Checked state",beforeDemo:"Checked state is set up with `checked` property. Its value can be a query",demo:[{view:"checkbox",checked:!0,content:'text:"should be checked"'},{view:"checkbox",checked:"=1 > 5",content:`text:"shouldn't be checked"`},{view:"checkbox",checked:"=1 < 5",content:'text:"should be checked"'}]},{title:"Readonly checkbox",demo:{view:"checkbox",readonly:!0,content:'text:"checkbox caption"'}},{title:"On change",demo:{view:"checkbox",onChange:Function("return (value, name, data, context) => alert(`Changed to ${value}!`)")(),content:'text:"click me!"'}}]};var sA=`#.props | {
    name: undefined,
    checked: undefined,
    readonly: undefined,
    content: undefined,
    onInit: undefined,
    onChange: undefined
} | overrideProps() | {
    ...,
    checked is truthy,
    readonly is truthy
}`;function Mg(n){function e(r,o,a,u,f,d){if(r===null)return;let h=f?{...u,[f]:d.checked}:u;return r.innerHTML="",n.view.render(r,o,a,h)}n.view.define("checkbox",function(r,o,a,u){let{name:f,checked:d,readonly:h,content:g,onInit:v,onChange:w}=o,x=r.appendChild($("input")),T=g?r.appendChild($("span","view-checkbox__label")):null;return x.type="checkbox",x.checked=d,x.readOnly=h,x.addEventListener("click",E=>{h&&E.preventDefault()}),x.addEventListener("change",()=>{typeof w=="function"&&(w(x.checked,f,a,u),e(T,g,a,u,f,x))}),typeof v=="function"&&v(x.checked,f,a,u),e(T,g,a,u,f,x)},{tag:"label",props:sA,usage:Lg})}var Ng={demo:{view:"content-filter",data:["foo","bar","baz"],content:{view:"list",data:".[$ ~= #.filter]"}},examples:[{title:"Using with text-match",demo:{view:"content-filter",data:[{name:"foo"},{name:"bar"},{name:"baz"}],name:"customName",content:{view:"list",data:".[name ~= #.customName]",item:"text-match:{ text: name, match: #.customName }"}}}]};function Bg(n){n.view.define("content-filter",function(e,r,o,a){let{name:u="filter",type:f="regexp",placeholder:d,content:h,onInit:g,onChange:v,debounce:w}=r;return n.view.render(e,{view:"context",modifiers:{view:"input",name:u,type:f,placeholder:d||"Filter",debounce:w},content:{view:"block",className:"content",content:h,onInit:g,onChange:v}},o,a)},{usage:Ng})}var Og={demo:{view:"context",modifiers:{view:"dropdown",name:"demo",value:{foo:"two",bar:"hello"},resetValue:{foo:"one",bar:""},caption:"text:`${#.demo.foo} / ${#.demo.bar}`",content:[{view:"select",name:"foo",data:["one","two","three","four"]},{view:"input",name:"bar"}]},content:[{view:"block",content:'text:"Modified context (see values in \\"demo\\" section):"'},{view:"struct",expanded:1,data:"#"}]}};function aA(n,e){if(!n||!e||typeof n!="object"||typeof e!="object")return n===e;for(let r in n)if(ye(n,r)&&n[r]!==e[r])return!1;for(let r in e)if(ye(e,r)&&n[r]!==e[r])return!1;return!0}function Pg(n){n.view.define("dropdown",function(e,r,o,a){function u(O,z){return typeof M=="function"?M(O,z):aA(O,z)}function f(){return N.innerHTML="",n.view.render(N,T||"text",o,{...a,[g||"__self"]:C})}function d(O){C=O,typeof D=="function"&&D(C,g,o,a),L.hide(),f()}function h(O,z){if(B){let _={changed:!u(O,z)};B.innerHTML="",n.view.render(B,[{view:"button-primary",disabled:"=not changed",content:'text:"Apply"',onClick(W,te,H){d(H)}},{view:"button",when:()=>v&&!u(v,C),content:'text:"Reset"',onClick(){d(v)}},{view:"button",disabled:"=not changed",content:'text:"Cancel"',onClick(){L.hide()}}],_,z)}}let{name:g,resetValue:v,value:w,placeholder:x,caption:T,content:E,compare:M,onInit:F,onChange:D}=r,C="value"in r?w:a[g],L=null,N=e.appendChild(document.createElement("div")),B;return x&&(e.dataset.placeholder=x),e.tabIndex=0,e.addEventListener("click",()=>{L===null&&(L=new n.view.Popup({className:"view-dropdown-popup"}));let O={...C},z;L.toggle(e,_=>n.view.render(_,[{view:"block",className:"content",content:n.view.composeConfig(E,{onInit(W,te){O[te]=W},onChange(W,te){O[te]=W,h(z,O)}})},{view:"block",className:"confirm",postRender(W){B=W}}],o,{...a,...C}).then(()=>{z={...O},h(z,O)}))}),N.className="view-dropdown__caption",typeof F=="function"&&F(C,g,o,a),f()},{usage:Og})}function lA(n,e){try{return new RegExp("((?:"+n+")+)",e)}catch{}return new RegExp("((?:"+n.replace(/[\[\]\(\)\?\+\*\{\}\\]/g,"\\$&")+")+)",e)}function Sc(n,e="i"){return Object.assign(lA(n,e),{rawSource:n})}var Ig=Function("return (value) => alert(`Changed to ${value}!`)")(),jg={examples:[{title:"Input with value",demo:{view:"input",value:'"value"'}},{title:"Input with placeholder",demo:{view:"input",placeholder:"placeholder"}},{title:"Input type number with min and max",demo:{view:"input",htmlType:"number",htmlMin:10,htmlMax:20}},{title:"Input with onChange",demo:{view:"input",onChange:Ig}},{title:"Input with onChange debounced",demo:{view:"input",onChange:Ig,debounce:300}}]};var uA=`#.props | {
    name,
    value: $ has no 'value' and name is string ? #.context[name] : value | is (string or number) ?: '',
    type ?: 'text',
    placeholder,
    onInit,
    onChange,
    htmlType ?: 'text',
    htmlMin,
    htmlMax,
    htmlStep,
    debounce
}`;function zg(n){let e={regexp:r=>r?Sc(r):null,text:r=>r};n.view.define("input",function(r,o,a,u){let{name:f,value:d,type:h,placeholder:g,onInit:v,onChange:w,htmlType:x,htmlMin:T,htmlMax:E,htmlStep:M,debounce:F}=o,D=e[h]||e.text,C=r.appendChild(document.createElement("input")),L=d;Number.isFinite(T)&&(C.min=T),Number.isFinite(E)&&(C.max=E),Number.isFinite(M)&&(C.step=M),C.type=x,C.value=L,C.placeholder=[g||"",D!==e.text?"("+h+")":""].filter(Boolean).join(" "),C.addEventListener("input",Ar(()=>{let N=C.value.trim();L!==N&&(L=N,typeof w=="function"&&w(D(N),f,a,u))},F)),typeof v=="function"&&v(D(C.value.trim()),f,a,u)},{usage:jg,props:uA})}var cA=Function("return (value) => alert(`Changed to ${value.text}!`)")(),Rg={demo:{view:"menu",data:[{text:"one",href:"#"},{text:"two",href:"#"},{text:"three",href:"#"}]},examples:[{title:"With limit",demo:{view:"menu",data:[{text:"one",href:"#"},{text:"two",href:"#"},{text:"three",href:"#"}],limit:2}},{title:"With custom item",demo:{view:"menu",data:[{text:"one",href:"#"},{text:"two",href:"#"},{text:"three",href:"#"}],item:"h1:text"}},{title:"On chage handler",demo:{view:"menu",onChange:cA,data:[{text:"one",href:"#"},{text:"two",href:"#"},{text:"three",href:"#"}]}}]};function Hg(n){n.view.define("menu",function(e,r,o,a){let{name:u="filter",item:f,itemConfig:d,limit:h,emptyText:g,onClick:v,onInit:w,onChange:x}=r;if(g!==!1&&g!==""&&e.setAttribute("emptyText",g||"No items"),Array.isArray(o)){let T=this.composeConfig({view:"menu-item",content:f,onClick:typeof v=="function"?v:typeof x=="function"?E=>x(E,u):void 0},d);return n.view.renderList(e,T,o,a,0,n.view.listLimit(h,25)).then(()=>{typeof w=="function"&&w(o.find(E=>E.selected),u)})}},{usage:Rg})}var qg={demo:{view:"menu",data:[{text:"one",href:"#"},{text:"two",href:"#"},{text:"three",href:"#"}]},examples:[{title:"Preselected item",demo:{view:"menu",data:[{text:"one",href:"#"},{text:"two",href:"#",selected:!0},{text:"three",href:"#"}]}},{title:"Disabled item",demo:{view:"menu",data:[{text:"one",href:"#"},{text:"two",href:"#",disabled:!0},{text:"three",href:"#"}]}},{title:"External links",demo:{view:"menu",data:[{text:"one",external:!0,href:"https://github.com/discoveryjs/discovery"},{text:"two",external:!0,href:"https://github.com/discoveryjs/discovery"},{text:"three",external:!0,href:"https://github.com/discoveryjs/discovery"}]}}]};function _g(n){n.view.define("menu-item",function(e,r,o,a){let{content:u,onClick:f}=r,{text:d,selected:h=!1,disabled:g=!1,href:v,external:w}=o||{};if(g?e.classList.add("disabled"):typeof f=="function"?(e.addEventListener("click",()=>f(o,a)),e.classList.add("onclick")):v&&(e.href=v,e.target=w?"_blank":""),h&&e.classList.add("selected"),u)return n.view.render(e,u,o,a);e.textContent=typeof o=="string"?o:d||"Untitled item"},{tag:"a",usage:qg})}var fA=()=>alert("changed!"),Wg={demo:{view:"nav-button",data:{text:"I am nav button"}},examples:[{title:"With href",demo:{view:"nav-button",data:{text:"I am nav button",href:"#"}}},{title:"External link",demo:{view:"nav-button",data:{text:"I am nav button",external:!0,href:"https://github.com/discoveryjs/discovery"}}},{title:"On click handler",demo:{view:"nav-button",data:{text:"I am nav button"},onClick:fA}}]};var dA=`is not array? | {
    name: undefined,
    text: #.props has no 'content' ? is (string or number or boolean) ?: text,
    content: undefined,
    disabled: false,
    href,
    external,
    onClick: undefined
} | overrideProps()`;function $g(n){n.view.define("nav-button",function(e,r,o,a){let{name:u,text:f,content:d,disabled:h,href:g,external:v,onClick:w}=r;if(u&&(e.dataset.name=u),h?e.classList.add("disabled"):typeof w=="function"?(e.addEventListener("click",x=>w(e,o,a,x)),e.classList.add("onclick")):g&&(e.href=g,e.target=v?"_blank":""),d)return n.view.render(e,d,o,a);e.textContent=f},{tag:"a",props:dA,usage:Wg})}var Ug={demo:{view:"progress",progress:.5,content:'text:"Loading..."'},examples:[{title:"With no label (content)",demo:{view:"progress",progress:.25}},{title:"Custom color",demo:{view:"progress",progress:.85,color:"#bdab77",content:'text:"Yellow progress"'}}]};function Vg(n){n.view.define("progress",function(e,r,o,a){let{content:u,progress:f,color:d}=r;if(e.append($("div",{class:"progress",style:`--progress: ${Math.max(0,Math.min(1,Number(f)))};--color: ${d||"unset"};`})),u){let h=$("div","content");return e.prepend(h),n.view.render(h,u,o,a)}},{usage:Ug})}var pA=Function("return (value) => alert(`Changed to ${value}!`)")(),Gg={demo:{view:"select",data:["one","two","three","four"]},examples:[{title:"Select with value",demo:{view:"select",value:'"three"',data:["one","two","three","four"]}},{title:"Select with reset option",demo:{view:"select",resetItem:!0,value:'"three"',data:["one","two","three","four"]}},{title:"Select with placeholder",demo:{view:"select",placeholder:"placeholder",data:["one","two","three","four"]}},{title:"Select with onChange",demo:{view:"select",onChange:pA,data:["one","two","three","four"]}},{title:"Select with custom options",demo:{view:"select",item:"h1:text",data:["one","two","three","four"]}}]};function Kg(n){let e="text-match:{ text, match: #.filter }",r="{ value: $, text: #.selectVariantTextQuery.query($, #) }",o=new n.view.Popup({className:"view-select-popup"});n.view.define("select",function(a,u,f,d){function h(){if(a.innerHTML="",O!==void 0)return n.view.render(a,n.view.composeConfig({view:"menu-item",data:r,content:F},D),O,z)}let{name:g,value:v,text:w="$",placeholder:x,limit:T,minItemsFilter:E=10,resetItem:M=!1,item:F=e,itemConfig:D,beforeItems:C,afterItems:L,onInit:N,onChange:B}=u,O=v?n.query(v,f,d):d[g],z={...d,selectMinItemsFilter:E,selectCurrentValue:O,selectVariantTextQuery:w,selectResetItem:M?[{value:void 0,text:"",...M,resetItem:!0}]:[]},_=[];return C&&_.push(n.view.composeConfig(C,{onInit:N,onChange:B})),_.push({view:"context",data:`.(${r})`,modifiers:{view:"input",when:"size() >= #.selectMinItemsFilter",type:"regexp",name:"filter",className:"view-select__filter",placeholder:"Filter"},content:{view:"menu",className:"view-select__variants",data:"#.selectResetItem + .[no #.filter or text~=#.filter]",limit:T,itemConfig:n.view.composeConfig({className:[W=>W.resetItem?"reset-item":"",W=>W.value===O?"selected":""]},D),item:F,onClick(W){o.hide(),O!==W.value&&(O=W.value,z={...z,selectCurrentValue:O},h(),typeof B=="function"&&B(W.value,g,W,d))}}}),L&&_.push(n.view.composeConfig(L,{onInit:N,onChange:B})),x&&(a.dataset.placeholder=x),a.tabIndex=0,a.addEventListener("click",()=>{o.toggle(a,W=>n.view.render(W,_,f,z).then(()=>(W.querySelector(".view-select__filter input")||{focus(){}}).focus()))}),typeof N=="function"&&N(O,g,f,d),h()},{usage:Gg})}var Yg={demo:{view:"tabs",name:"tabs",value:"two",tabs:[{value:"one",text:"One"},{value:"two",text:"Two"},{value:"three",text:"Three"}],content:{view:"switch",content:[{when:'#.tabs="one"',content:'text:"One"'},{when:'#.tabs="two"',content:'text:"Two"'},{when:'#.tabs="three"',content:'text:"Three"'}]}},examples:[{title:"Value is default text",demo:{view:"tabs",name:"tabsValue",tabs:["foo","bar","baz"],content:"struct:#.tabsValue"}},{title:"With before and after content",demo:{view:"tabs",name:"example",tabs:[{value:"one",text:"One"},{value:"two",text:"Two"},{value:"three",text:"Three"}],beforeTabs:'text:"<Content before tabs>"',afterTabs:'text:"<Content after tabs>"',content:'text:"Selected: " + #.example'}},{title:"On change handler",demo:{view:"tabs",tabs:[{value:"one",text:"One"},{value:"two",text:"Two"},{value:"three",text:"Three"}],onChange:Function('return (value) => alert("changed to " + value)')(),content:'text:"Selected: " + #.filter'}}]};var hA=`undefined | {
    name,
    value,
    tabs,
    tabConfig,
    content,
    beforeTabs,
    afterTabs,
    onInit,
    onChange
} | overrideProps() | {
    ...,
    name is string ?: 'filter',
    value: value is not undefined ? value :
        name is string and name in #.context ? #.context[name]
}`;function Qg(n){n.view.define("tabs",function(e,r,o,a){async function u(B){let O=L?v:g;if(N===B)return;let z=d||h||f?{...a,[w]:B}:null;N=B,L=!0,Array.isArray(T)&&(M.innerHTML="",d&&(D.innerHTML="",await n.view.render(D,d,o,z),M.appendChild(D)),await Promise.all(T.map(_=>n.view.render(M,n.view.composeConfig(_,{active:_.value===N}),o,a))),h&&(C.innerHTML="",await n.view.render(C,h,o,z),M.appendChild(C))),f&&(F.innerHTML="",await n.view.render(F,f,o,z)),typeof O=="function"&&O(N,w,o,a)}let{content:f,beforeTabs:d,afterTabs:h,onInit:g,onChange:v}=r,{name:w,value:x,tabs:T,tabConfig:E}=r,M=e.appendChild(document.createElement("div")),F=null,D=null,C=null,L=!1,N=NaN;return E=n.view.composeConfig({view:"tab",onClick:u},E),M.className="view-tabs-buttons",d&&(D=document.createElement("div"),D.className="view-tabs-buttons-before"),h&&(C=document.createElement("div"),C.className="view-tabs-buttons-after"),f&&(F=e.appendChild(document.createElement("div")),F.className="view-tabs-content"),Array.isArray(T)?T=T.map(B=>{let O=typeof B;return(O==="string"||O==="number"||O==="boolean")&&(B={value:B}),(x===void 0||B.active)&&(x=B.value),n.view.composeConfig(E,B)}):T=[],u(x)},{usage:Yg,props:hA})}var Ec=()=>alert("clicked!"),Jg={demo:{view:"tabs",name:"tabs",tabs:[{value:"one",text:"One"},{value:"two",text:"Two"},{value:"three",text:"Three"}],content:{view:"switch",content:[{when:'#.tabs="one"',content:'text:"One"'},{when:'#.tabs="two"',content:'text:"Two"'},{when:'#.tabs="three"',content:'text:"Three"'}]}},examples:[{title:"Active & disabled tab",demo:{view:"tabs",name:"tabs",tabs:[{value:"one",text:"One"},{value:"two",text:"Two",active:!0},{value:"three",text:"Three",disabled:!0}],content:{view:"switch",content:[{when:'#.tabs="one"',content:'text:"One"'},{when:'#.tabs="two"',content:'text:"Two"'},{when:'#.tabs="three"',content:'text:"Three"'}]}}},{title:"On click handler",demo:{view:"tabs",name:"tabs",tabs:[{value:"one",text:"One",onClick:Ec},{value:"two",text:"Two",onClick:Ec},{value:"three",text:"Three",onClick:Ec}],content:{view:"switch",content:[{when:'#.tabs="one"',content:'text:"One"'},{when:'#.tabs="two"',content:'text:"Two"'},{when:'#.tabs="three"',content:'text:"Three"'}]}}}]};var gA=`is not array? | {
    value,
    text: #.props has no 'content' ? is (string or number or boolean) ?,
    content: undefined,
    active: undefined,
    disabled: undefined,
    onClick: undefined
} | overrideProps() | {
    ...,
    text: text is not undefined ? text : value,
    active is truthy,
    disabled is truthy
}`;function Zg(n){n.view.define("tab",function(e,r,o,a){let{value:u,text:f,content:d,active:h,disabled:g,onClick:v}=r;if(g?e.classList.add("disabled"):typeof v=="function"&&(e.addEventListener("click",()=>v(u)),e.classList.add("onclick")),h&&e.classList.add("active"),d)return n.view.render(e,d,o,a);e.textContent=String(f)},{usage:Jg,props:gA})}var Da={demo:{view:"context",modifiers:{view:"toggle-group",name:"toggleValue",data:[{value:"one",text:"One"},{value:"two",text:"Two"},{value:"three",text:"Three"}]},content:{view:"switch",content:[{when:'#.toggleValue="one"',content:'text:"One"'},{when:'#.toggleValue="two"',content:'text:"Two"'},{when:'#.toggleValue="three"',content:'text:"Three"'}]}},examples:[{title:"With before and after content",demo:{view:"toggle-group",data:[{value:"one",text:"One"},{value:"two",text:"Two"},{value:"three",text:"Three"}],beforeToggles:'text:"<Content before toggles>"',afterToggles:'text:"<Content after toggles>"'}},{title:"On change handler",demo:{view:"toggle-group",name:"example",onChange:Function('return (value) => alert("changed to " + value)')(),data:[{value:"one",text:"One"},{value:"two",text:"Two"},{value:"three",text:"Three"}]}}]};function Xg(n){n.view.define("toggle",function(e,r,o,a){let{content:u,disabled:f=!1,onToggle:d,value:h,text:g=String(h).replace(/^./,w=>w.toUpperCase())}=r,{checked:v=!1}=r;if(f?e.classList.add("disabled"):typeof d=="function"&&(e.addEventListener("click",()=>{v=!v,d(v,h)}),e.classList.add("onclick")),v&&e.classList.add("checked"),u)return n.view.render(e,u,o,a);e.textContent=g},{usage:Da})}function em(n){n.view.define("toggle-group",function(e,r,o,a){async function u(C,L){let N=M?g:h;F!==L&&(F=L,M=!0,Array.isArray(x)&&(e.innerHTML="",f&&(T.innerHTML="",await n.view.render(T,f,o,{...a,[v]:L}),e.appendChild(T)),d&&(E.innerHTML="",await n.view.render(E,d,o,{...a,[v]:L}),e.appendChild(E)),await Promise.all(x.map((B,O)=>n.view.render(e,n.view.composeConfig(B,{checked:B.value===F}),o[O],a)))),typeof N=="function"&&N(F,v,o,a))}let{beforeToggles:f,afterToggles:d,onInit:h,onChange:g}=r,{name:v,toggleConfig:w}=r,x=[],T=null,E=null,M=!1,F=NaN,D="value"in r?r.value:v in a?a[v]:void 0;return w=n.view.composeConfig({view:"toggle",onToggle:u},w),f&&(T=document.createElement("div"),T.className="view-toggle-group-before"),d&&(E=document.createElement("div"),E.className="view-toggle-group-after"),typeof v!="string"&&(v="filter"),Array.isArray(o)&&(x=o.map(C=>{let L=typeof C;return(L==="string"||L==="number"||L==="boolean")&&(C={value:C}),(D===void 0||C.active)&&(D=C.value),n.view.composeConfig(w,C)})),u(!0,D)},{usage:Da})}var mA=/\.\d+(?:eE[-+]?\d+)?|\B(?=(?:\d{3})+(?:\D|$))/g;function Ue(n){return n.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function xt(n,e=!0){let r=e&&typeof n!="number"?Ue(String(n)):String(n);return r.length>3?r.replace(mA,o=>o||'<span class="num-delim"></span>'):r}var Sr=cn(Cn(),1);var Lc=cn(Cn(),1);function Mc(n){let e=new Set(["has","in","no","not","and","or","is","asc","ascN","ascA","ascAN","ascNA","desc","descN","descA","descAN","descNA"]),r=Lc.default.getMode(n,{name:"javascript",json:!0});return{...r,indent(o,a){return o.indented+n.indentUnit*(o.lastType==="{"&&a.trim()[0]!=="}"||o.lastType==="("&&a.trim()[0]!==")"||o.lastType==="["&&a.trim()[0]!=="]")},token(o,a){let u=o.peek();if(u==="#"||u==="@")return r.token(new Lc.default.StringStream("$",4,o.lineOracle),a),o.pos++,"variable";let f=r.token(o,a),d=o.string.slice(o.start,o.pos);if(o.string[o.start-1]!=="."){if(a.isAssertionContext){if((f==="variable"||f==="atom")&&a.isAssertionParen===0&&d!=="not")return"type";d==="("?a.isAssertionParen++:d===")"&&(a.isAssertionParen>0&&a.isAssertionParen--,a.isAssertionParen===0&&(a.isAssertionContext=!1))}if(e.has(d))return d==="is"&&(a.isAssertionContext=!0,a.isAssertionParen=0),"keyword"}if(a.isAssertionContext){if(f==="variable"||f==="atom"||f==="def"||d==="function")return"type";a.isAssertionParen===0&&(f||/\S/.test(d))&&(a.isAssertionContext=!1)}return f}}}var tm=cn(Cn(),1);function nm(n,e){let r=typeof e.isDiscoveryViewDefined=="function"?e.isDiscoveryViewDefined:()=>{},o=tm.default.getMode(n,{name:"javascript",json:!0});return{...o,indent(a,u){return a.indented+n.indentUnit*(a.lastType==="{"&&u.trim()[0]!=="}"||a.lastType==="("&&u.trim()[0]!==")"||a.lastType==="["&&u.trim()[0]!=="]")},token:function(a,u){if(u.suspendTokens){let{pos:h,token:g}=u.suspendTokens.shift();return a.pos=h,u.suspendTokens.length===0&&(u.suspendTokens=null),g}let f=a.pos,d=o.token(a,u);if(d==="string"){let h=a.pos,[,g]=a.string.slice(f+1,h-1).match(/^(.+?)([:{]|$)/)||[];r(g)&&(a.pos=f+1,u.suspendTokens=[{pos:f+1+g.length,token:"string discovery-view-name"},{pos:h,token:d}])}return d}}}var WN=cn(Nc(),1);var qt=cn(Cn(),1);var vA="discovery-view-editor-hints-popup",yA="discovery-view-editor-hint",Bc="active",bA=window.requestAnimationFrame||(n=>setTimeout(n,1e3/60)),wA=window.cancelAnimationFrame||clearTimeout;qt.default.commands.autocomplete=qt.default.showHint;qt.default.defineOption("showHintOptions",null);qt.default.defineExtension("showHint",function(n){n={closeOnUnfocus:!0,container:null,...this.options.showHintOptions,...n},this.state.completionActive&&this.state.completionActive.close(),!(this.listSelections().length>1)&&(this.somethingSelected()||typeof n.hint=="function"&&(this.state.completionActive=new Oc(this,n),this.state.completionActive.update(!0),qt.default.signal(this,"startCompletion",this)))});var Oc=class{constructor(e,r){if(this.cm=e,this.options=r,this.widget=null,this.debounce=0,this.tick=0,this.startPos=this.cm.getCursor("start"),this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length,e.on("cursorActivity",this.activityFunc=()=>this.cursorActivity()),r.closeOnUnfocus){let o;this.onFocus=()=>clearTimeout(o),this.onBlur=()=>o=setTimeout(()=>this.close(),100),e.on("focus",this.onFocus),e.on("blur",this.onBlur)}}close(){this.active()&&(this.cm.state.completionActive=null,this.tick=null,this.cm.off("cursorActivity",this.activityFunc),this.options.closeOnUnfocus&&(this.cm.off("blur",this.onBlur),this.cm.off("focus",this.onFocus)),this.widget&&(this.data&&qt.default.signal(this.data,"close"),this.widget.close()),qt.default.signal(this.cm,"endCompletion",this.cm))}active(){return this.cm.state.completionActive===this}pick(e,r){let o=e.list[r];this.cm.state.completionEnabled=!1,o.hint?o.hint(this.cm,e,o):this.cm.replaceRange(om(o),o.from||e.from,o.to||e.to,"complete"),qt.default.signal(e,"pick",o),this.close()}cursorActivity(){this.debounce&&(wA(this.debounce),this.debounce=0);let e=this.cm.getCursor(),r=this.cm.getLine(e.line);e.line!=this.startPos.line||r.length-e.ch!=this.startLen-this.startPos.ch||e.ch<this.startPos.ch||this.cm.somethingSelected()?this.close():(this.debounce=bA(()=>this.update()),this.widget&&this.widget.disable())}update(e){if(this.tick===null)return;let r=++this.tick;Promise.resolve(this.options.hint(this.cm,this.options)).then(o=>{this.tick==r&&this.finishUpdate(o,e)})}finishUpdate(e){this.data&&qt.default.signal(this.data,"update");let r=this.widget&&this.widget.picked;this.widget&&this.widget.close(),this.data=e,e&&e.list.length&&(r&&e.list.length==1?this.pick(e,0):(this.widget=new Pc(this,e),qt.default.signal(e,"shown")))}};function om(n){return typeof n=="string"?n:n.text}function xA(n,e){for(;e&&e.parentNode!==n;)e=e.parentNode;return e}var Pc=class{constructor(e,r){let o=e.cm,a=this.hintsEl=document.createElement("ul"),u=[vA,e.cm.options.theme].filter(Boolean),f=e.options.container||document.body;this.rootEls=new Set([f.getRootNode()]),this.completion=e,this.data=r,this.picked=!1,this.selectedHint=r.selectedHint||0,a.style.visibility="hidden",a.classList.add(...u),f.appendChild(a),this.items=r.list.map((d,h)=>{let g=a.appendChild(document.createElement("li"));return g.className=yA,h===this.selectedHint&&g.classList.add(Bc),d.render?d.render(g,r,d):g.appendChild(document.createTextNode(d.displayText||om(d))),g}),o.addKeyMap(this.keyMap={Up:()=>this.changeActive(this.selectedHint-1),Down:()=>this.changeActive(this.selectedHint+1),Enter:()=>this.pick(),Tab:()=>this.pick(),Esc:()=>{o.state.completionEnabled=!1,e.close()}}),this.updatePosSize(),this.onScroll=()=>this.updatePosSize();for(let d of this.rootEls)d.addEventListener("scroll",this.onScroll,Rt);qt.default.on(a,"mousedown",d=>{let h=xA(a,d.target),g=this.items.indexOf(h);g!==-1&&(this.close(),this.selectedHint=g,this.pick(),setTimeout(()=>o.focus(),1))}),qt.default.signal(r,"select",r.list[this.selectedHint],this.items[this.selectedHint])}close(){if(this.completion.widget===this){this.completion.widget=null,this.completion.cm.removeKeyMap(this.keyMap),this.hintsEl.remove();for(let e of this.rootEls)e.removeEventListener("scroll",this.onScroll,Rt)}}disable(){this.completion.cm.removeKeyMap(this.keyMap),this.keyMap={Enter:()=>this.picked=!0},this.completion.cm.addKeyMap(this.keyMap)}pick(){this.completion.pick(this.data,this.selectedHint)}changeActive(e,r){e>=this.items.length?e=r?this.items.length-1:0:e<0&&(e=r?0:this.items.length-1);let o=this.items[this.selectedHint],a=this.items[this.selectedHint=e];a!==o&&(o&&o.classList.remove(Bc),a.classList.add(Bc),a.offsetTop<this.hintsEl.scrollTop?this.hintsEl.scrollTop=a.offsetTop-3:a.offsetTop+a.offsetHeight>this.hintsEl.scrollTop+this.hintsEl.clientHeight&&(this.hintsEl.scrollTop=a.offsetTop+a.offsetHeight-this.hintsEl.clientHeight+3),qt.default.signal(this.data,"select",this.data.list[this.selectedHint],a))}getCursorCoords(){let{completion:e,hintsEl:r}=this,o=e.cm,a=jo(r),u=o.cursorCoords(null,"local"),f=Ht(o.display.wrapper,a);return{top:f.top+u.top+5,left:f.left+u.left+9,bottom:f.top+u.bottom+5,right:f.left+u.right+9}}updatePosSize(){let{hintsEl:o}=this,a=this.getCursorCoords(),{clientWidth:u,clientHeight:f}=zo(o);o.style.left="0px",o.style.top="0px";let{width:d,height:h}=o.getBoundingClientRect(),g=f-a.bottom,v=a.top;if(g<h&&v>g){let T=Math.min(h,v-6-1);o.style.top=`${a.top-1-T-6}px`,o.style.maxHeight=`${T}px`}else o.style.top=`${a.bottom+1}px`,o.style.maxHeight=`${g-1-6}px`;let w=u-a.right,x=a.left;w<d&&x>w?(o.style.left=`${a.left+1-Math.min(d,x-6)}px`,o.style.maxWidth=`${x-6}px`):(o.style.left=`${a.right}px`,o.style.maxWidth=`${w-6}px`),o.style.visibility="visible"}};Object.defineProperty(Sr.default.prototype,"display",{configurable:!0,set(n){return n.scroller.addEventListener=function(e,r,o){EventTarget.prototype.addEventListener.call(this,e,r,typeof o!="boolean"?o:{capture:o,passive:["touchstart","touchmove","wheel","mousewheel"].includes(e)})},Object.defineProperty(this,"display",{configurable:!0,enumerable:!0,value:n}),n}});var kA=(n,e,{entry:{type:r,text:o,value:a}})=>{let u=o[0],f=o[o.length-1],d=u==='"'||u==="'"?1:0,h=f==='"'||f==="'"?1:0,g=o.toLowerCase().substring(d,o.length-h),v=g?a.toLowerCase().indexOf(g,a[0]==='"'||a[0]==="'"?1:0):-1;v!==-1&&(a=Ue(a.substring(0,v))+'<span class="match">'+Ue(a.slice(v,v+g.length))+"</span>"+Ue(a.slice(v+g.length))),n.classList.add("type-"+r),n.appendChild($("span","name",a))},Aa=class extends tr{static CodeMirror=Sr.default;el;cm;get container(){return null}constructor({hint:e,mode:r,placeholder:o}){super(),this.el=document.createElement("div"),this.el.className="discovery-view-editor empty-value";let a=this,u=(0,Sr.default)(this.el,{extraKeys:{"Alt-Space":"autocomplete"},mode:r||"javascript",theme:"neo",indentUnit:0,showHintOptions:{hint:e,get container(){return a.container}}});o&&(u.display.lineDiv.parentNode.dataset.placeholder=o),u.on("change",()=>{let d=u.getValue();this.el.classList.toggle("empty-value",d===""),this.emit("change",d)}),typeof e=="function"&&(u.on("cursorActivity",d=>{d.state.completionEnabled&&d.state.focused&&d.showHint()}),u.on("focus",d=>{d.getValue()===""&&(d.state.completionEnabled=!0),d.state.completionEnabled&&!d.state.completionActive&&d.showHint()}),u.on("change",(d,h)=>{h.origin!=="complete"&&(u.state.completionEnabled=!0)})),this.cm=u;let f=new kr;f.subscribe(()=>u.refresh()),f.observe(u.display.wrapper)}getValue(){return this.cm.getValue()}setValue(e){return requestAnimationFrame(()=>this.cm.refresh()),typeof e=="string"&&this.getValue()!==e?(this.cm.setValue(e||""),!0):!1}focus(){this.cm.focus()}},Ic=class extends Aa{queryData;queryContext;inputPanelEl;outputPanelEl;constructor(e){super({mode:"discovery-query",placeholder:"Enter a jora query",hint:r=>{let o=r.getCursor(),a=e(r.getValue(),r.doc.indexFromPos(o),this.queryData,this.queryContext);return a?{list:a.slice(0,50).map(u=>({entry:u,text:u.value,render:kA,from:r.posFromIndex(u.from),to:r.posFromIndex(u.to)}))}:null}}),this.inputPanelEl=$("div","discovery-view-editor__input-panel"),this.outputPanelEl=$("div","discovery-view-editor__output-panel"),this.el.append(this.inputPanelEl,this.outputPanelEl)}setValue(e,r,o){let a=this.queryData!==r||this.queryContext!==o;return this.queryData=r,this.queryContext=o,super.setValue(e)?!0:(a&&this.cm.state.completionEnabled&&this.cm.state.focused&&this.cm.showHint(),!1)}},jc=class extends Aa{constructor(){super({mode:{name:"discovery-view",isDiscoveryViewDefined:e=>this.isViewDefined(e)}})}isViewDefined(){return!1}};Sr.default.defineMode("jora",Mc);Sr.default.defineMode("discovery-query",Mc);Sr.default.defineMode("discovery-view",nm);function sm(n){Object.assign(n.view,{QueryEditor:class extends Ic{get container(){return n.dom.container}},ViewEditor:class extends jc{isViewDefined(e){return n.view.isDefined(e)||n.textView.isDefined(e)}}})}var am={beforeDemo:['md:"A block has no its own look. It\'s using for wrapping some content with a `className` (btw `className` is a common property for any view when appropriate)"'],demo:{view:"block",className:"foo",content:['text:"Content inside block"']}};function lm(n){n.view.define("block",function(e,r,o,a){let{content:u=[],onInit:f,onChange:d}=r,h=typeof f!="function"&&typeof d!="function"?u:this.composeConfig(u,{onInit:f,onChange:d});return n.view.render(e,h,o,a)},{usage:am})}var Sa={demo:{view:"columns",data:["one","two","three","four"],column:"text"}};function um(n){n.view.define("column",function(e,r,o,a){let{content:u=[]}=r;return n.view.render(e,u,o,a)},{usage:Sa})}function cm(n){n.view.define("columns",function(r,o,a,u){let{column:f,columnConfig:d,emptyText:h,limit:g}=o;if(h!==!1&&h!==""&&r.setAttribute("emptyText",h||"Empty"),!Array.isArray(a)&&a&&(a=[a]),Array.isArray(a))return n.view.renderList(r,this.composeConfig({view:"column",content:f},d),a,u,0,n.view.listLimit(g,25))},{usage:Sa})}var fm={demo:{view:"expand",header:'text:"Expand me!"',content:'text:"Content"'}};var CA=`is not array? | {
    header: undefined,
    content: undefined,
    expanded: false,
    onToggle: undefined
} | overrideProps()`;function dm(n){n.view.define("expand",function(e,r,o,a){function u(){if(e.classList.toggle("expanded",f),f)return x=$("div","content"),n.view.render(x,h,o,a).then(()=>e.appendChild(x));x!==null&&(x.remove(),x=null)}let{expanded:f,header:d,content:h,onToggle:g}=r,v=e.appendChild($("div","header")),w=v.appendChild($("div","header-content")),x=null;return v.appendChild($("div","trigger")),v.addEventListener("click",()=>{f=!f,u(),typeof g=="function"&&g(f)}),Promise.all([n.view.render(w,d||'text:"\xA0"',o,a),u()])},{usage:fm,props:CA})}var pm={demo:{view:"hstack",content:['button:{text:"First button"}','button-primary:{text:"Second button"}']}};function hm(n){n.view.define("hstack",function(e,r,o,a){let{content:u=[]}=r;return n.view.render(e,u,o,a)},{usage:pm})}function gm(n){n.view.define("list-item",function(e,r,o,a){let{content:u="text"}=r;return n.view.render(e,u,o,a)},{tag:"li"})}var bi=(n,e)=>({demo:{view:n,data:["one","two","three","four"]},examples:[{title:"Variations",demo:{view:"context",data:["foo","bar","baz"],content:e.map(r=>[`header{ content: 'md:${JSON.stringify('`view: \\"'+r+'\\"`')}' }`,r])}},{title:"Configure item's content",demo:[{view:n,data:["one","two","three","four"],item:['text:"<item> "',{view:"link",data:'{ href: "#" + $ }'}]}]},{title:"Configure item's config",demo:{view:n,data:["one","two","three","four"],itemConfig:{className:"special"},item:{view:"text",data:'"prefix-" + $'}}}]});function mm(n){function e(r,o,a,u){let{item:f,itemConfig:d,limit:h,emptyText:g}=o;if(g!==!1&&g!==""&&r.setAttribute("emptyText",g||"Empty list"),!Array.isArray(a)&&a&&(a=[a]),Array.isArray(a))return n.view.renderList(r,this.composeConfig({view:"list-item",content:f},d),a,u,0,n.view.listLimit(h,25))}n.view.define("list",e,{usage:bi}),n.view.define("inline-list",e,{usage:bi}),n.view.define("comma-list",e,{usage:bi}),n.view.define("ol",e,{tag:"ol",usage:bi}),n.view.define("ul",e,{tag:"ul",usage:bi})}var vm=n=>({beforeDemo:['md:"A special view to be used as the first view in the body of the page. This view stays in place as the page scrolls (although it may move slightly to the top of the page at the start of the scroll), so that the most relevant information and important action elements can remain accessible despite page scrolling."'],demoFixed:100,demo:`${n}:"That's a \\"${n}\\""`,examples:[{title:"Prelude",demoFixed:150,highlightProps:["prelude"],demo:{view:n,prelude:['badge:{ text: "demo" }','badge:{ text: "demo", prefix: "prelude", postfix: "postfix" }'],content:'h1:"Header"'}}]});function ym(n){n.view.define("page-header",function(r,o,a,u){let{prelude:f,content:d,onInit:h,onChange:g}=o,v=r.appendChild($("div","view-page-header__prelude")),w=r.appendChild($("div","view-page-header__content")),x=T=>typeof h!="function"&&typeof g!="function"?T:this.composeConfig(T,{onInit:h,onChange:g});return Promise.all([n.view.render(v,x(f||[]),a,u),n.view.render(w,x(d||"text"),a,u)])},{usage:vm})}var DA=[!1,"popup-hover","trigger-click"],AA=300;function bm(n){return n?n.getRootNode({composed:!0})===document:!0}function wm(n,e){return typeof n=="function"&&(n=n(e)),typeof n=="number"?zc(n):typeof n=="boolean"&&n?AA:0}function xm(n,e){n.lastChild!==e&&n.appendChild(e)}function zc(n,e=0){return Number.isFinite(n)?n:e}function SA(n){return DA.includes(n)}function km(n){let e=[],r=new Set,o=[],a=new Set,u=null,f=D=>{u===null&&(u=setTimeout(()=>v(D),0))},d=()=>{u!==null&&(clearTimeout(u),u=null)},h=null,g=()=>{h===null&&(h=[n.addHostElEventListener("mouseenter",({target:D})=>{for(let C of o){let L=T(C,D),N=L?L.el:D.closest(C.hoverTriggers);N&&(C.hideTimer!==null&&(clearTimeout(C.hideTimer),C.hideTimer=null),N!==C.lastHoverTriggerEl&&((!L||!L.hoverPinned)&&(C.lastHoverTriggerEl=N),L||(C.hoverPinned=!1,C.el.classList.remove("pinned"),C.show(N))))}},Rt),n.addHostElEventListener("mouseleave",({target:D})=>{for(let C of o)C.lastHoverTriggerEl===D&&(E(C),C.lastHoverTriggerEl=null,C.hideTimer=setTimeout(C.hide,100))},Rt),n.addGlobalEventListener("scroll",f,Rt),n.addHostElEventListener("scroll",D=>{d(),v(D)},Rt),n.addGlobalEventListener("click",f,!0),n.addHostElEventListener("click",D=>{d(),v(D),setTimeout(w,50);for(let C of o)C.hoverPin==="trigger-click"&&C.lastHoverTriggerEl&&C.lastTriggerEl?.contains(D.target)&&(C.lastHoverTriggerEl=null,C.hoverPinned=!0,C.el.classList.add("pinned"),D.stopPropagation())},!0)])};nr.subscribe(()=>{for(let D of e)D.position==="pointer"&&!D.hoverPinned&&!D.frozen&&!a.has(D)&&D.updatePosition();for(let D of r){let{showDelayArgs:C}=D;M(D,C?.[0],C?.[1])}}),n.inspectMode.subscribe(D=>D?e.forEach(C=>a.add(C)):a.clear());function v(D){e.slice().forEach(C=>C.hideIfEventOutside(D))}function w(){e.slice().forEach(D=>D.hideOnTriggerHasLeftDocument())}function x(){e.slice().forEach(D=>D.hideOnResize())}function T(D,C){return D.el.contains(C)?D:D.relatedPopups.find(L=>T(L,C))||null}function E(D){D.showDelayTimer!==null&&clearTimeout(D.showDelayTimer),D.showDelayTimer=null,D.showDelayArgs=null,r.delete(D)}function M(D,C,L){D.showDelayTimer!==null&&clearTimeout(D.showDelayTimer),D.showDelayTimer=setTimeout(()=>D.show(C,L,!0),wm(D.showDelay,C)),D.showDelayArgs=[C,L],r.add(D)}class F{el;showDelayTimer;showDelayArgs;showDelay;lastTriggerEl;lastHoverTriggerEl;render;position;positionMode;pointerOffsetX;pointerOffsetY;hoverTriggers;hoverPin;hideIfEventOutsideDisabled;hideOnResizeDisabled;hideTimer;hoverPinned;frozen;lastRenderMarker;constructor(C){let{render:L,showDelay:N=!1,position:B="trigger",positionMode:O="safe",pointerOffsetX:z,pointerOffsetY:_,hoverTriggers:W,hoverPin:te,hideIfEventOutside:H=!0,hideOnResize:X=!0,className:A}=C||{};this.el=document.createElement("div"),this.el.classList.add("discovery-view-popup"),this.showDelayTimer=null,this.showDelayArgs=null,this.showDelay=N,this.hideTimer=null,this.hide=this.hide.bind(this),this.lastTriggerEl=null,this.lastHoverTriggerEl=null,this.hoverPinned=!1,this.frozen=!1,this.render=L,this.lastRenderMarker=null,this.position=B,this.positionMode=O,this.pointerOffsetX=zc(z,3),this.pointerOffsetY=zc(_,3),this.hoverTriggers=W||null,this.hoverPin=SA(te)?te:!1,this.hideIfEventOutsideDisabled=!H,this.hideOnResizeDisabled=!X,A&&this.el.classList.add(A),this.hoverTriggers&&(this.el.classList.add("show-on-hover"),this.el.dataset.pinMode=this.hoverPin||"none",o.push(this),g())}get relatedPopups(){return e.filter(C=>this.el.contains(C.lastTriggerEl))}get visible(){return e.includes(this)}toggle(...C){this.visible?this.hide():this.show(...C)}async show(C,L=this.render,N=!1){if(!this.visible&&!N&&wm(this.showDelay,C)>0){M(this,C,L);return}E(this),a.delete(this),n.view.setViewRoot(this.el,"popup",{config:L});let B=n.dom.container;if(this.hideTimer!==null&&(clearTimeout(this.hideTimer),this.hideTimer=null),this.relatedPopups.forEach(O=>O.hide()),this.el.classList.toggle("inspect",n.inspectMode.value),this.lastTriggerEl&&this.lastTriggerEl.classList.remove("discovery-view-popup-active"),C&&C.classList.add("discovery-view-popup-active"),this.lastTriggerEl=C||null,this.visible||(e.push(this),e.length===1&&window.addEventListener("resize",x)),typeof L=="function"){this.el.innerHTML="";let O=Symbol();if(this.lastRenderMarker=O,requestAnimationFrame(()=>{this.lastRenderMarker===O&&(xm(B,this.el),this.updatePosition())}),await L(this.el,C,this.hide),this.lastRenderMarker!==O)return;this.lastRenderMarker=null}xm(B,this.el),this.updatePosition()}updatePosition(){if(!this.visible)return;let C=this.position==="pointer",L=C?null:this.lastTriggerEl;if(C?this.frozen:!L)return;let N=n.dom.container,B=jo(N.firstChild),O=Cc(window,B),{x:z,y:_}=nr.value,{pointerOffsetX:W,pointerOffsetY:te}=this,H=L?Ht(L,N):{left:Math.round(z)-W,right:Math.round(z)+W,top:Math.round(_)-te,bottom:Math.round(_)+te},X=C?H.left:H.right,A=C?H.right:H.left,Q=H.top-O.top-3,U=O.bottom-H.bottom-3,ce=X-O.left-3,xe=O.right-A-3,Le=xe>=ce,_e=U>=Q;if(_e||(this.el.style.maxHeight=Q+"px",this.el.style.top="auto",this.el.style.bottom=O.bottom-H.top+"px",this.el.dataset.vTo="top"),Le||(this.el.style.left="auto",this.el.style.right=O.right-X+"px",this.el.style.maxWidth=ce+"px",this.el.dataset.hTo="left"),this.positionMode==="natural"&&(!Le||!_e)){let{height:et,width:Ke}=Ht(this.el);_e=et<=U,Le=Ke<=xe}_e&&(this.el.style.maxHeight=U+"px",this.el.style.top=H.bottom-O.top+"px",this.el.style.bottom="auto",this.el.dataset.vTo="bottom"),Le&&(this.el.style.left=A-O.left+"px",this.el.style.right="auto",this.el.style.maxWidth=xe+"px",this.el.dataset.hTo="right"),this.relatedPopups.forEach(et=>et.updatePosition())}freeze(){this.frozen=!0,this.el.classList.add("frozen")}unfreeze(){this.frozen=!1,this.el.classList.remove("frozen"),this.updatePosition()}hide(){this.lastRenderMarker=null,this.hideTimer!==null&&(clearTimeout(this.hideTimer),this.hideTimer=null),E(this),this.visible&&!a.has(this)&&(this.relatedPopups.forEach(C=>C.hide()),e.splice(e.indexOf(this),1),this.el.remove(),this.unfreeze(),this.lastTriggerEl&&(this.lastTriggerEl.classList.remove("discovery-view-popup-active"),this.lastTriggerEl=null),e.length===0&&window.removeEventListener("resize",x))}hideIfEventOutside({target:C}){this.hideIfEventOutsideDisabled||a.has(this)||this.lastTriggerEl&&this.lastTriggerEl.contains(C)||T(this,C)||this.hide()}hideOnTriggerHasLeftDocument(){(!bm(this.lastHoverTriggerEl)||!bm(this.lastTriggerEl))&&this.hide()}hideOnResize(){this.hideOnResizeDisabled||a.has(this)||this.hide()}destroy(){a.delete(this),E(this);let C=o.indexOf(this);C!==-1&&o.splice(C,1),this.hide(),this.el=null,this.lastTriggerEl=null,this.lastHoverTriggerEl=null}}n.view.Popup=F}var Cm={demo:{view:"section",header:'text:"I am section"',content:['text:"content"']}};function Dm(n){n.view.define("section",function(e,r,o,a){let{header:u,content:f=[],onInit:d,onChange:h}=r,g=v=>typeof d!="function"&&typeof h!="function"?v:this.composeConfig(v,{onInit:d,onChange:h});return n.view.render(e,[{view:"header",content:g(u)},g(f)],o,a)},{usage:Cm})}function Am(n){n.view.define("toc-section",function(e,r,o,a){let{header:u,content:f}=r;return n.view.render(e,[{view:"block",className:"header",content:u},{view:"block",className:"content",content:f}],o,a)},{tag:"section"})}var wi=(n,e)=>({demo:{view:n,data:'"Alert"'},examples:[{title:"Variations",demo:e.map(r=>`${r}:"${r}"`)},{title:"Complex content",demo:{view:n,content:['h3:"Some header"','text:"Hello world!"']}}]});function Sm(n){function e(r,o,a,u){let{content:f="text"}=o;return r.classList.add("view-alert"),n.view.render(r,f,a,u)}n.view.define("alert",e,{usage:wi}),n.view.define("alert-primary",e,{usage:wi}),n.view.define("alert-success",e,{usage:wi}),n.view.define("alert-danger",e,{usage:wi}),n.view.define("alert-warning",e,{usage:wi})}var EA=new TextEncoder,Tm=new TextDecoder,[Em,TA]=(()=>{let n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=new Uint8Array(64),r=new Uint8Array(256);for(let o=0;o<n.length;o++){let a=n.charCodeAt(o);r[a]=o,e[o]=a}return[e,r]})();function Ho(n){return Tm.decode(FA(n))}function FA(n){typeof n=="string"&&(n=EA.encode(n));let e=new Uint8Array(Math.ceil(n.length/3)*4),r=0,o=0,a=0;for(let u=0;u<n.length;u++)for(o=o<<8|n[u],a+=8;a>=6;){let f=o>>(a-=6);e[r++]=Em[f],o-=f<<a}for(a!==0&&(e[r++]=Em[o<<6-a]);r<e.length;)e[r++]=61;return e}function qo(n){return Tm.decode(LA(n))}function LA(n){let e=n.length;for(;e>0&&n[e-1]==="=";)e--;let r=new Uint8Array(3*Math.ceil(e/4)),o=0,a=0,u=0;for(let f=0;f<e;f++)if(a=a<<6|TA[n.charCodeAt(f)&255],u+=6,u>8){let d=a>>(u-=8);r[o++]=d,a-=d<<u}return u!==0&&(r[o++]=a),r.subarray(0,(e>>2)*3+(e%4*6>>3))}function xi(){return[performance.timeOrigin.toString(16),(1e4*performance.now()).toString(16),Math.random().toString(16).slice(2)].join("-")}function MA(n,e,r){let o=String(n),[a,u]=o.match(/^(?:\S+\s+)?(\S+)\(/)||[];if(a!=="function"&&a!=="function*"&&u===r.trim().slice(0,-1)&&(r=""),o.indexOf(`
`)===-1)return r+o;let f=o.split(/\n/),d=f[f.length-1].match(/^\s*/)?.[0].length||0,h=new RegExp("^\\s{0,"+d+"}");return r+f.map((g,v)=>v&&g.length?g.replace(h,e):g).join(`
`)}function NA(n,e,r){return typeof n=="function"?MA(n,e,r):n instanceof Date?`${r}new Date("${n.toISOString()}")`:Array.isArray(n)?`${r}[${n.join(", ")}]`:r+String(n)}var BA=new Set(["[object Function]","[object RegExp]","[object Date]"]);function OA(n){return Array.isArray(n)&&n.every(e=>typeof e=="number")}function Pn(n,e,r=4){let o=[];return String(JSON.stringify(n,e||function(u,f){return typeof f=="string"&&pn(this[u])==="[object Date]"&&(f=this[u]),f!==null&&(BA.has(pn(f))||OA(f))?(o.push(f),"{{{__placeholder__}}}"):f},r)).replace(/"((?:\\.|[^"])*)"(:?)/g,(u,f,d)=>d&&/^[a-z$_][a-z$_\d]*$/i.test(f)?f+d:`'${f.replace(/\\"/g,'"').replace(/'/g,"\\'")}'`+d).replace(/(^|\n)([ \t]*)(.*?)([a-zA-Z$_][a-zA-Z0-9$_]+:\s*)?'{{{__placeholder__}}}'/g,(u,f,d,h,g)=>f+d+h+NA(o.shift(),d,g))}var Lm=Symbol("stop-match");function PA(n,e,r=0){let o=r!==0?n.slice(r).search(e):n.search(e);return o!==-1?{offset:r+o,length:RegExp.lastMatch.length}:null}function IA(n,e,r){let o=n.indexOf(e,r);return o!==-1?{offset:o,length:e.length}:null}function rr(n,e,r,o,a=!1){if(!Lo(e)&&typeof e!="string"){r(n,!0);return}let u=String(n);a&&(typeof e=="string"?(u=u.toLowerCase(),e=e.toLowerCase()):e.ignoreCase||(e=new RegExp(e,e.flags+"i")));let f=0,d=!1;do{let h=d?null:typeof e=="string"?IA(u,e,f):PA(u,e,f);if(h===null||h.length===0&&h.offset===f){r(f>0?n.slice(f):n,!0);break}h.length!==0&&(h.offset!==f&&r(n.slice(f,h.offset),!1),d=o(n.substr(h.offset,h.length),Lm)===Lm),f=h.offset+h.length}while(f!==n.length)}var Mm=new WeakMap,jA={"font-family":"Tahoma, Verdana, Arial, sans-serif","font-size":"14px","line-height":"1.6","-webkit-text-size-adjust":"none","text-size-adjust":"none","background-color":"var(--discovery-background-color, white)",color:"var(--discovery-color, black)"},zA={"--discovery-background-color":"#242424","--discovery-color":"#cccccc"};function Nm(n,e,r){e in r||(r[e]=[n.style.getPropertyValue(e),n.style.getPropertyPriority(e)])}function Rc(n,e){let r=Mm.get(n)||Object.create(null),o=va(e)==="dark";for(let[a,u]of Object.entries(jA))Nm(n,a,r),n.style.setProperty(a,u);for(let[a,u]of Object.entries(zA))Nm(n,a,r),o?n.style.setProperty(a,u):n.style.removeProperty(a);return Mm.set(n,r),o}function RA(n){let e=$("div",{style:["position: fixed","overflow: hidden","font-size: 1px","width: 1px","height: 1px","top: 0","left: 0","white-space: pre"].join(";")});document.body.append(e);try{let r=window.getSelection(),o=document.createRange();e.append(n),o.selectNodeContents(e),r?.removeAllRanges(),r?.addRange(o),document.execCommand("copy")}finally{e.remove()}}async function _t(n){try{if(navigator.clipboard)try{let e=await navigator.permissions.query({name:"clipboard-write"});if(e.state==="granted"||e.state==="prompt")return navigator.clipboard.writeText(n)}catch(e){if(e instanceof TypeError)return navigator.clipboard.writeText(n)}}catch{}RA(n)}function Hc(n,e){let r=globalThis.location,o=[],a=({newURL:u,oldURL:f})=>{let d=new URL(u).hash||"#",h=new URL(f).hash||"#";d!==o.shift()&&(e?.debug("locationSync onChange:",h,"->",d),o.length=0,n(d,h))};return addEventListener("hashchange",a),{set(u,f){let d=u||"#";(r.hash||"#")!==d&&(e?.debug("locationSync set:",d,f),o.push(u),f?r.replace(u):r.hash=u)},dispose(){removeEventListener("hashchange",a)}}}var Im={inited:{value:0,duration:0,title:"Init"},request:{value:0,duration:.1,title:"Awaiting data"},receiving:{value:.1,duration:.8,title:"Receiving data"},decoding:{value:.9,duration:.015,title:"Decoding data"},received:{value:.915,duration:.01,title:"Await app ready"},prepare:{value:.925,duration:.055,title:"Processing data (prepare)"},initui:{value:.98,duration:.02,title:"Rendering UI"},done:{value:1,duration:0,title:"Done!"},error:{value:1,duration:0,title:"Error"}},HA=n=>n|0,Bm=n=>typeof n=="function"?n:()=>{},Om=n=>new Promise(e=>setTimeout(e,n)),qA=async()=>{if(!document.hidden)return Promise.race([new Promise(requestAnimationFrame).then(()=>Om(0)),Om(12)])};function Pm(n,e,r){let{value:o,title:a,duration:u}=Im[n],f=0,d=null;if(e){let{done:h,elapsed:g,units:v,completed:w,total:x}=e;x?(f=h?1:w/x,d=v==="bytes"?Math.round(f*100)+"%":`${w}/${x}`):(f=h?1:.1+Math.min(.9,g/2e4),d=v==="bytes"?(w/(1024*1024)).toFixed(1)+"MB":String(w))}return{stageTitle:a,progressValue:o+f*u,progressText:d,stepText:r||"",title:d?`${a} (${d})${r?":":"..."}`:n!=="done"?`${a}${r?":":"..."}`:a}}var Er=class extends At{startTime;lastStageStartTime;awaitRepaintPenaltyTime;finished;awaitRepaint;timings;onTiming;onFinish;appearanceDelay;domReady;el;#e;#t;constructor({onTiming:e,onFinish:r,domReady:o}){super({stage:"inited",progress:null,error:null}),this.startTime=null,this.lastStageStartTime=null,this.awaitRepaintPenaltyTime=0,this.finished=!1,this.awaitRepaint=null,this.timings=[],this.onTiming=Bm(e),this.onFinish=Bm(r),this.domReady=o||Promise.resolve(),this.el=$("div","view-progress skip-fast-track",[$("div","content main-secondary",[this.#e=$("span","main"),this.#t=$("span","secondary")]),$("div","progress")])}recordTiming(e,r,o=performance.now()){let a={stage:e,title:Im[e].title,duration:HA(o-r)};this.lastStageStartTime=o,this.timings.push(a),this.onTiming(a)}async#n(e=!1,r=performance.now()){let o=r-(this.awaitRepaint||0),a=r-(this.lastStageStartTime||0);if(e||o>65&&a>200){let u=performance.now();await qA(),this.awaitRepaintPenaltyTime+=performance.now()-u,this.awaitRepaint=performance.now()}}async setState(e,r){let o=this.value.stage,{stage:a=o,progress:u=null,error:f=null}=e;if(this.finished)return;if(f){this.set("stage"in e?{stage:a,progress:u,error:f}:{...this.value,error:f}),this.finish(f);return}this.set({stage:a,progress:u,error:f});let d=a!==o,h=performance.now();o==="inited"&&(this.startTime=h),d&&(this.lastStageStartTime!==null&&this.recordTiming(o,this.lastStageStartTime,h),this.lastStageStartTime=h,this.awaitRepaint=h);let{title:g,stepText:v,progressValue:w}=Pm(a,u,r);this.el.style.setProperty("--progress",String(w)),this.#e.textContent=g,this.#t.textContent=v,this.el.offsetWidth,await this.#n(d,h)}async setStateStep(e){let{title:r,stepText:o}=Pm(this.value.stage,this.value.progress,e);this.#e.textContent=r,this.#t.textContent=o,this.el.offsetWidth,await this.#n(!0)}finish(e){this.finished||(this.finished=!0,this.lastStageStartTime!==null&&this.recordTiming(this.value.stage,this.lastStageStartTime),this.recordTiming(e?"error":"done",this.startTime||this.lastStageStartTime||performance.now()),this.set({stage:"done",progress:null,error:e||null}),this.onFinish(Object.assign([...this.timings],{awaitRepaintPenaltyTime:Math.round(this.awaitRepaintPenaltyTime)})),this.el.classList.add("done"),this.el.classList.toggle("error",!!e))}dispose(){this.finish(),this.el.remove()}};var jm={demo:{view:"app-header",name:"My app",version:"1.2.3",description:"The best of the best app"},examples:[{title:"Variations",demo:["app-header",'app-header{ name: "Only name" }','app-header{ name: "Name and version", version: "1.2.3" }','app-header{ name: "Name and description", description: "Some description" }','app-header{ name: "Everything set", version: "1.2.3", description: "Very useful description" }']}]};var WA=`is not array? | {
    name: name or "Untitled app",
    icon,
    version,
    description
} | overrideProps() | {
    ...,
    icon is string and $ ~= /\\S/?,
    version is string and $ ~= /\\S/?,
    description is string and $ ~= /\\S/?
}`;function zm(n){n.view.define("app-header",function(e,r){let{name:o,icon:a,version:u,description:f}=r,d=$("h1",null,u?[o,$("span","version",u)]:[o]);a&&e.style.setProperty("--icon",/^(?:\.|\/|data:|https?:)/.test(a)?`url(${JSON.stringify(a)})`:a),e.append($("div","icon"),$("div","content",f?[d,$("div","description",f)]:[d]))},{props:WA,usage:jm})}function Rm(n){n.view.define("auto-link",function(e,r,o,a){let{content:u,fallback:f,href:d}=r;if(!o)return;let h=n.resolveValueLinks(o),v=h?(typeof d=="function"?d:w=>w)(h[0].href,o,a):null;return v?n.view.render(e,{view:"link",content:u},{...h[0],href:v},a):n.view.render(e,f||u||"text",o,a)},{tag:!1})}var qc=(n,e)=>({demo:{view:n,text:"hello world"},examples:[{title:"Variations",demo:e.map(r=>`${r}:"${r}"`)},{title:"Displaying content",beforeDemo:{view:"md",source:["There are several ways to specify the main content of a badge:","- `content` option \u2013 allows to specify any renderable content and has the highest precedence","- `text` option \u2013 used when `content` is omitted or falsy; it renders as plain text","- When both `content` and `text` options are omitted, the `data` is used for content:","  - If `data` is a string, a number, or a boolean value, it is used as the `text` value","  - If `data` is an object, the value of `text` property of `data` coerced to a string is used","  - Otherwise, render an undefined"].join(`
`)},demo:[{view:n,data:'"data"',text:"text",content:'text:"RENDER"'},{view:n,data:'"data"',text:"RENDER",content:"=undefined"},{view:n,data:'"data"',content:"=undefined"},{view:n,data:'"data"',text:"RENDER"},{view:n,data:'"data"',text:"=undefined"},{view:n,data:'"RENDER"'},{view:n,data:'{ text: "RENDER" }'},{view:n,data:"{}"},{view:n,data:[1,2,3]}]},{title:"Using data as source of options",beforeDemo:{view:"md",source:["The following properties are taken from the data when the appropriate options are not specified for a legacy reasons (is subject to remove in the future):","- `color`","- `textColor`","- `darkColor`","- `darkTextColor`","- `text`","- `href`","- `external`","- `prefix`","- `postfix`"].join(`
`)},highlightProps:["data"],demo:{view:n,data:{text:"demo",href:"#example"}}},{title:"Custom colors",beforeDemo:{view:"md",source:["Data properties to setup a custom colors:","* `color` \u2013 default background color","* `textColor` \u2013 default text color","* `darkColor` \u2013 background color in dark mode","* `darkTextColor` \u2013 text color in dark mode"].join(`
`)},demo:{view:n,text:"Colored badge",color:"rgba(237, 177, 9, 0.35)",textColor:"orange",darkColor:"#ffff00",darkTextColor:"black"}},{title:"As a link",highlightProps:["href","external"],demo:{view:n,text:"Link to something",href:"#",external:!0}},{title:"Using onClick handler",highlightProps:["onClick"],demo:{view:n,text:'Show "Hello world"',onClick:Function('return () => alert("Hello world!")')()}},{title:"Prefix and postfix",highlightProps:["prefix","postfix"],demo:{view:n,prefix:"prefix",text:"link",postfix:"postfix"}},{title:"Complex content",highlightProps:["content"],demo:{view:n,content:['text:"text "','link{ href: "#example" }']}}]});var Hm=`is not array? | {
    color,
    textColor,
    darkColor,
    darkTextColor,
    text: #.props has no 'content' ? is (string or number or boolean) ?: text,
    content: undefined,
    href,
    external,
    onClick: undefined,
    prefix,
    postfix
} | overrideProps()`;function qm(n,e,r){if(!r)return;let o=n.appendChild(document.createElement("span"));o.className=e,o.textContent=r}function _m(n){function e(r,o,a,u){let{color:f,textColor:d,darkColor:h,darkTextColor:g,text:v,content:w,href:x,external:T,onClick:E,prefix:M,postfix:F}=o,D;return f&&r.style.setProperty("--discovery-view-badge-color",f),h&&r.style.setProperty("--discovery-view-badge-dark-color",h),d&&r.style.setProperty("--discovery-view-badge-text-color",d),g&&r.style.setProperty("--discovery-view-badge-dark-text-color",g),x&&(r.href=x),T&&r.setAttribute("target","_blank"),typeof E=="function"&&(r.classList.add("onclick"),r.addEventListener("click",C=>{C.preventDefault(),E(r,a,u)})),qm(r,"prefix",M),w?D=this.render(r,w,a,u):r.append(document.createTextNode(v)),qm(r,"postfix",F),D}n.view.define("badge",e,{tag:"a",props:Hm,usage:qc}),n.view.define("pill-badge",e,{tag:"a",props:Hm,usage:qc})}function Wm(n){function e(r,o,a,u){let{content:f="text",kind:d}=o;return typeof d=="string"&&/\S/.test(d)&&(r.dataset.kind=d.trim()),n.view.render(r,f,a,u)}n.view.define("blockquote",{tag:"blockquote",render:e,usage:oa})}var $m=/[\0-\x1F!-,\.\/:-@\[-\^`\{-\xA9\xAB-\xB4\xB6-\xB9\xBB-\xBF\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u0378\u0379\u037E\u0380-\u0385\u0387\u038B\u038D\u03A2\u03F6\u0482\u0530\u0557\u0558\u055A-\u055F\u0589-\u0590\u05BE\u05C0\u05C3\u05C6\u05C8-\u05CF\u05EB-\u05EE\u05F3-\u060F\u061B-\u061F\u066A-\u066D\u06D4\u06DD\u06DE\u06E9\u06FD\u06FE\u0700-\u070F\u074B\u074C\u07B2-\u07BF\u07F6-\u07F9\u07FB\u07FC\u07FE\u07FF\u082E-\u083F\u085C-\u085F\u086B-\u089F\u08B5\u08C8-\u08D2\u08E2\u0964\u0965\u0970\u0984\u098D\u098E\u0991\u0992\u09A9\u09B1\u09B3-\u09B5\u09BA\u09BB\u09C5\u09C6\u09C9\u09CA\u09CF-\u09D6\u09D8-\u09DB\u09DE\u09E4\u09E5\u09F2-\u09FB\u09FD\u09FF\u0A00\u0A04\u0A0B-\u0A0E\u0A11\u0A12\u0A29\u0A31\u0A34\u0A37\u0A3A\u0A3B\u0A3D\u0A43-\u0A46\u0A49\u0A4A\u0A4E-\u0A50\u0A52-\u0A58\u0A5D\u0A5F-\u0A65\u0A76-\u0A80\u0A84\u0A8E\u0A92\u0AA9\u0AB1\u0AB4\u0ABA\u0ABB\u0AC6\u0ACA\u0ACE\u0ACF\u0AD1-\u0ADF\u0AE4\u0AE5\u0AF0-\u0AF8\u0B00\u0B04\u0B0D\u0B0E\u0B11\u0B12\u0B29\u0B31\u0B34\u0B3A\u0B3B\u0B45\u0B46\u0B49\u0B4A\u0B4E-\u0B54\u0B58-\u0B5B\u0B5E\u0B64\u0B65\u0B70\u0B72-\u0B81\u0B84\u0B8B-\u0B8D\u0B91\u0B96-\u0B98\u0B9B\u0B9D\u0BA0-\u0BA2\u0BA5-\u0BA7\u0BAB-\u0BAD\u0BBA-\u0BBD\u0BC3-\u0BC5\u0BC9\u0BCE\u0BCF\u0BD1-\u0BD6\u0BD8-\u0BE5\u0BF0-\u0BFF\u0C0D\u0C11\u0C29\u0C3A-\u0C3C\u0C45\u0C49\u0C4E-\u0C54\u0C57\u0C5B-\u0C5F\u0C64\u0C65\u0C70-\u0C7F\u0C84\u0C8D\u0C91\u0CA9\u0CB4\u0CBA\u0CBB\u0CC5\u0CC9\u0CCE-\u0CD4\u0CD7-\u0CDD\u0CDF\u0CE4\u0CE5\u0CF0\u0CF3-\u0CFF\u0D0D\u0D11\u0D45\u0D49\u0D4F-\u0D53\u0D58-\u0D5E\u0D64\u0D65\u0D70-\u0D79\u0D80\u0D84\u0D97-\u0D99\u0DB2\u0DBC\u0DBE\u0DBF\u0DC7-\u0DC9\u0DCB-\u0DCE\u0DD5\u0DD7\u0DE0-\u0DE5\u0DF0\u0DF1\u0DF4-\u0E00\u0E3B-\u0E3F\u0E4F\u0E5A-\u0E80\u0E83\u0E85\u0E8B\u0EA4\u0EA6\u0EBE\u0EBF\u0EC5\u0EC7\u0ECE\u0ECF\u0EDA\u0EDB\u0EE0-\u0EFF\u0F01-\u0F17\u0F1A-\u0F1F\u0F2A-\u0F34\u0F36\u0F38\u0F3A-\u0F3D\u0F48\u0F6D-\u0F70\u0F85\u0F98\u0FBD-\u0FC5\u0FC7-\u0FFF\u104A-\u104F\u109E\u109F\u10C6\u10C8-\u10CC\u10CE\u10CF\u10FB\u1249\u124E\u124F\u1257\u1259\u125E\u125F\u1289\u128E\u128F\u12B1\u12B6\u12B7\u12BF\u12C1\u12C6\u12C7\u12D7\u1311\u1316\u1317\u135B\u135C\u1360-\u137F\u1390-\u139F\u13F6\u13F7\u13FE-\u1400\u166D\u166E\u1680\u169B-\u169F\u16EB-\u16ED\u16F9-\u16FF\u170D\u1715-\u171F\u1735-\u173F\u1754-\u175F\u176D\u1771\u1774-\u177F\u17D4-\u17D6\u17D8-\u17DB\u17DE\u17DF\u17EA-\u180A\u180E\u180F\u181A-\u181F\u1879-\u187F\u18AB-\u18AF\u18F6-\u18FF\u191F\u192C-\u192F\u193C-\u1945\u196E\u196F\u1975-\u197F\u19AC-\u19AF\u19CA-\u19CF\u19DA-\u19FF\u1A1C-\u1A1F\u1A5F\u1A7D\u1A7E\u1A8A-\u1A8F\u1A9A-\u1AA6\u1AA8-\u1AAF\u1AC1-\u1AFF\u1B4C-\u1B4F\u1B5A-\u1B6A\u1B74-\u1B7F\u1BF4-\u1BFF\u1C38-\u1C3F\u1C4A-\u1C4C\u1C7E\u1C7F\u1C89-\u1C8F\u1CBB\u1CBC\u1CC0-\u1CCF\u1CD3\u1CFB-\u1CFF\u1DFA\u1F16\u1F17\u1F1E\u1F1F\u1F46\u1F47\u1F4E\u1F4F\u1F58\u1F5A\u1F5C\u1F5E\u1F7E\u1F7F\u1FB5\u1FBD\u1FBF-\u1FC1\u1FC5\u1FCD-\u1FCF\u1FD4\u1FD5\u1FDC-\u1FDF\u1FED-\u1FF1\u1FF5\u1FFD-\u203E\u2041-\u2053\u2055-\u2070\u2072-\u207E\u2080-\u208F\u209D-\u20CF\u20F1-\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u214F-\u215F\u2189-\u24B5\u24EA-\u2BFF\u2C2F\u2C5F\u2CE5-\u2CEA\u2CF4-\u2CFF\u2D26\u2D28-\u2D2C\u2D2E\u2D2F\u2D68-\u2D6E\u2D70-\u2D7E\u2D97-\u2D9F\u2DA7\u2DAF\u2DB7\u2DBF\u2DC7\u2DCF\u2DD7\u2DDF\u2E00-\u2E2E\u2E30-\u3004\u3008-\u3020\u3030\u3036\u3037\u303D-\u3040\u3097\u3098\u309B\u309C\u30A0\u30FB\u3100-\u3104\u3130\u318F-\u319F\u31C0-\u31EF\u3200-\u33FF\u4DC0-\u4DFF\u9FFD-\u9FFF\uA48D-\uA4CF\uA4FE\uA4FF\uA60D-\uA60F\uA62C-\uA63F\uA673\uA67E\uA6F2-\uA716\uA720\uA721\uA789\uA78A\uA7C0\uA7C1\uA7CB-\uA7F4\uA828-\uA82B\uA82D-\uA83F\uA874-\uA87F\uA8C6-\uA8CF\uA8DA-\uA8DF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA954-\uA95F\uA97D-\uA97F\uA9C1-\uA9CE\uA9DA-\uA9DF\uA9FF\uAA37-\uAA3F\uAA4E\uAA4F\uAA5A-\uAA5F\uAA77-\uAA79\uAAC3-\uAADA\uAADE\uAADF\uAAF0\uAAF1\uAAF7-\uAB00\uAB07\uAB08\uAB0F\uAB10\uAB17-\uAB1F\uAB27\uAB2F\uAB5B\uAB6A-\uAB6F\uABEB\uABEE\uABEF\uABFA-\uABFF\uD7A4-\uD7AF\uD7C7-\uD7CA\uD7FC-\uD7FF\uE000-\uF8FF\uFA6E\uFA6F\uFADA-\uFAFF\uFB07-\uFB12\uFB18-\uFB1C\uFB29\uFB37\uFB3D\uFB3F\uFB42\uFB45\uFBB2-\uFBD2\uFD3E-\uFD4F\uFD90\uFD91\uFDC8-\uFDEF\uFDFC-\uFDFF\uFE10-\uFE1F\uFE30-\uFE32\uFE35-\uFE4C\uFE50-\uFE6F\uFE75\uFEFD-\uFF0F\uFF1A-\uFF20\uFF3B-\uFF3E\uFF40\uFF5B-\uFF65\uFFBF-\uFFC1\uFFC8\uFFC9\uFFD0\uFFD1\uFFD8\uFFD9\uFFDD-\uFFFF]|\uD800[\uDC0C\uDC27\uDC3B\uDC3E\uDC4E\uDC4F\uDC5E-\uDC7F\uDCFB-\uDD3F\uDD75-\uDDFC\uDDFE-\uDE7F\uDE9D-\uDE9F\uDED1-\uDEDF\uDEE1-\uDEFF\uDF20-\uDF2C\uDF4B-\uDF4F\uDF7B-\uDF7F\uDF9E\uDF9F\uDFC4-\uDFC7\uDFD0\uDFD6-\uDFFF]|\uD801[\uDC9E\uDC9F\uDCAA-\uDCAF\uDCD4-\uDCD7\uDCFC-\uDCFF\uDD28-\uDD2F\uDD64-\uDDFF\uDF37-\uDF3F\uDF56-\uDF5F\uDF68-\uDFFF]|\uD802[\uDC06\uDC07\uDC09\uDC36\uDC39-\uDC3B\uDC3D\uDC3E\uDC56-\uDC5F\uDC77-\uDC7F\uDC9F-\uDCDF\uDCF3\uDCF6-\uDCFF\uDD16-\uDD1F\uDD3A-\uDD7F\uDDB8-\uDDBD\uDDC0-\uDDFF\uDE04\uDE07-\uDE0B\uDE14\uDE18\uDE36\uDE37\uDE3B-\uDE3E\uDE40-\uDE5F\uDE7D-\uDE7F\uDE9D-\uDEBF\uDEC8\uDEE7-\uDEFF\uDF36-\uDF3F\uDF56-\uDF5F\uDF73-\uDF7F\uDF92-\uDFFF]|\uD803[\uDC49-\uDC7F\uDCB3-\uDCBF\uDCF3-\uDCFF\uDD28-\uDD2F\uDD3A-\uDE7F\uDEAA\uDEAD-\uDEAF\uDEB2-\uDEFF\uDF1D-\uDF26\uDF28-\uDF2F\uDF51-\uDFAF\uDFC5-\uDFDF\uDFF7-\uDFFF]|\uD804[\uDC47-\uDC65\uDC70-\uDC7E\uDCBB-\uDCCF\uDCE9-\uDCEF\uDCFA-\uDCFF\uDD35\uDD40-\uDD43\uDD48-\uDD4F\uDD74\uDD75\uDD77-\uDD7F\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDFF\uDE12\uDE38-\uDE3D\uDE3F-\uDE7F\uDE87\uDE89\uDE8E\uDE9E\uDEA9-\uDEAF\uDEEB-\uDEEF\uDEFA-\uDEFF\uDF04\uDF0D\uDF0E\uDF11\uDF12\uDF29\uDF31\uDF34\uDF3A\uDF45\uDF46\uDF49\uDF4A\uDF4E\uDF4F\uDF51-\uDF56\uDF58-\uDF5C\uDF64\uDF65\uDF6D-\uDF6F\uDF75-\uDFFF]|\uD805[\uDC4B-\uDC4F\uDC5A-\uDC5D\uDC62-\uDC7F\uDCC6\uDCC8-\uDCCF\uDCDA-\uDD7F\uDDB6\uDDB7\uDDC1-\uDDD7\uDDDE-\uDDFF\uDE41-\uDE43\uDE45-\uDE4F\uDE5A-\uDE7F\uDEB9-\uDEBF\uDECA-\uDEFF\uDF1B\uDF1C\uDF2C-\uDF2F\uDF3A-\uDFFF]|\uD806[\uDC3B-\uDC9F\uDCEA-\uDCFE\uDD07\uDD08\uDD0A\uDD0B\uDD14\uDD17\uDD36\uDD39\uDD3A\uDD44-\uDD4F\uDD5A-\uDD9F\uDDA8\uDDA9\uDDD8\uDDD9\uDDE2\uDDE5-\uDDFF\uDE3F-\uDE46\uDE48-\uDE4F\uDE9A-\uDE9C\uDE9E-\uDEBF\uDEF9-\uDFFF]|\uD807[\uDC09\uDC37\uDC41-\uDC4F\uDC5A-\uDC71\uDC90\uDC91\uDCA8\uDCB7-\uDCFF\uDD07\uDD0A\uDD37-\uDD39\uDD3B\uDD3E\uDD48-\uDD4F\uDD5A-\uDD5F\uDD66\uDD69\uDD8F\uDD92\uDD99-\uDD9F\uDDAA-\uDEDF\uDEF7-\uDFAF\uDFB1-\uDFFF]|\uD808[\uDF9A-\uDFFF]|\uD809[\uDC6F-\uDC7F\uDD44-\uDFFF]|[\uD80A\uD80B\uD80E-\uD810\uD812-\uD819\uD824-\uD82B\uD82D\uD82E\uD830-\uD833\uD837\uD839\uD83D\uD83F\uD87B-\uD87D\uD87F\uD885-\uDB3F\uDB41-\uDBFF][\uDC00-\uDFFF]|\uD80D[\uDC2F-\uDFFF]|\uD811[\uDE47-\uDFFF]|\uD81A[\uDE39-\uDE3F\uDE5F\uDE6A-\uDECF\uDEEE\uDEEF\uDEF5-\uDEFF\uDF37-\uDF3F\uDF44-\uDF4F\uDF5A-\uDF62\uDF78-\uDF7C\uDF90-\uDFFF]|\uD81B[\uDC00-\uDE3F\uDE80-\uDEFF\uDF4B-\uDF4E\uDF88-\uDF8E\uDFA0-\uDFDF\uDFE2\uDFE5-\uDFEF\uDFF2-\uDFFF]|\uD821[\uDFF8-\uDFFF]|\uD823[\uDCD6-\uDCFF\uDD09-\uDFFF]|\uD82C[\uDD1F-\uDD4F\uDD53-\uDD63\uDD68-\uDD6F\uDEFC-\uDFFF]|\uD82F[\uDC6B-\uDC6F\uDC7D-\uDC7F\uDC89-\uDC8F\uDC9A-\uDC9C\uDC9F-\uDFFF]|\uD834[\uDC00-\uDD64\uDD6A-\uDD6C\uDD73-\uDD7A\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDE41\uDE45-\uDFFF]|\uD835[\uDC55\uDC9D\uDCA0\uDCA1\uDCA3\uDCA4\uDCA7\uDCA8\uDCAD\uDCBA\uDCBC\uDCC4\uDD06\uDD0B\uDD0C\uDD15\uDD1D\uDD3A\uDD3F\uDD45\uDD47-\uDD49\uDD51\uDEA6\uDEA7\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3\uDFCC\uDFCD]|\uD836[\uDC00-\uDDFF\uDE37-\uDE3A\uDE6D-\uDE74\uDE76-\uDE83\uDE85-\uDE9A\uDEA0\uDEB0-\uDFFF]|\uD838[\uDC07\uDC19\uDC1A\uDC22\uDC25\uDC2B-\uDCFF\uDD2D-\uDD2F\uDD3E\uDD3F\uDD4A-\uDD4D\uDD4F-\uDEBF\uDEFA-\uDFFF]|\uD83A[\uDCC5-\uDCCF\uDCD7-\uDCFF\uDD4C-\uDD4F\uDD5A-\uDFFF]|\uD83B[\uDC00-\uDDFF\uDE04\uDE20\uDE23\uDE25\uDE26\uDE28\uDE33\uDE38\uDE3A\uDE3C-\uDE41\uDE43-\uDE46\uDE48\uDE4A\uDE4C\uDE50\uDE53\uDE55\uDE56\uDE58\uDE5A\uDE5C\uDE5E\uDE60\uDE63\uDE65\uDE66\uDE6B\uDE73\uDE78\uDE7D\uDE7F\uDE8A\uDE9C-\uDEA0\uDEA4\uDEAA\uDEBC-\uDFFF]|\uD83C[\uDC00-\uDD2F\uDD4A-\uDD4F\uDD6A-\uDD6F\uDD8A-\uDFFF]|\uD83E[\uDC00-\uDFEF\uDFFA-\uDFFF]|\uD869[\uDEDE-\uDEFF]|\uD86D[\uDF35-\uDF3F]|\uD86E[\uDC1E\uDC1F]|\uD873[\uDEA2-\uDEAF]|\uD87A[\uDFE1-\uDFFF]|\uD87E[\uDE1E-\uDFFF]|\uD884[\uDF4B-\uDFFF]|\uDB40[\uDC00-\uDCFF\uDDF0-\uDFFF]/g;var EB=Object.hasOwnProperty;function Ea(n,e){return typeof n!="string"?"":(e||(n=n.toLowerCase()),n.replace($m,"").replace(/ /g,"-"))}var Tr=(n,e)=>({demo:`${n}:"Header \\"${n}\\""`,examples:[{title:"Variations",view:e.map(r=>`${r}:"Header \\"${r}\\""`)},{title:"Complex content",demo:{view:n,content:['text:"Text "','link:{ text: "Link" }']}},{title:"Using anchor",demo:[{view:n,anchor:"foo",content:'text:"Explicit value for an anchor"'},{view:n,anchor:!0,content:'text:"Auto generated anchor based on text content of header"'}]}]});function Um(n){async function e(r,o,a,u){let{content:f,anchor:d=!1}=o;if(r.classList.add("view-header"),await n.view.render(r,f||"text",a,u),d){let h=Ea(d===!0?r.textContent:String(d)),g=n.encodePageHash(n.pageId,n.pageRef,n.pageParams,h);r.prepend($("a",{class:"view-header__anchor",id:`!anchor:${h}`,href:g}))}}n.view.define("header",e,{tag:"h4",usage:Tr}),n.view.define("h1",e,{tag:"h1",usage:Tr}),n.view.define("h2",e,{tag:"h2",usage:Tr}),n.view.define("h3",e,{tag:"h3",usage:Tr}),n.view.define("h4",e,{tag:"h4",usage:Tr}),n.view.define("h5",e,{tag:"h5",usage:Tr})}var Vm={demo:{view:"html",data:'"<h1>I am inner HTML</h1>"'}};function Gm(n){let e=document.createElement("div");n.view.define("html",function(r,o,a){e.innerHTML=a,r.append(...e.childNodes)},{tag:null,usage:Vm})}var _c="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMjggMTI4Ij4KICAgIDxyZWN0IHg9IjY1LjYiIHk9IjI0LjYiIHRyYW5zZm9ybT0ibWF0cml4KDAuOTM5NyAtMC4zNDIgMC4zNDIgMC45Mzk3IC05Ljk0MjYgMzEuODI4KSIgZmlsbD0iI0ZGRkZGRiIgd2lkdGg9IjM5LjMiIGhlaWdodD0iMzkiPjwvcmVjdD4KICAgIDxyZWN0IHg9IjcwLjYiIHk9IjUyLjciIHRyYW5zZm9ybT0ibWF0cml4KC0wLjkzOTcgMC4zNDIgLTAuMzQyIC0wLjkzOTcgMTk0Ljc4NTIgODEuMTIwNCkiIGZpbGw9IiNDN0Q3RTIiIHdpZHRoPSIzOS4zIiBoZWlnaHQ9IjEwIj48L3JlY3Q+CiAgICA8cGF0aCBmaWxsPSIjOThCRUQ4IiBkPSJNMTExLjUsNTQuNmwtMS4xLDEuMUw5Ny4xLDE5LjFsMS41LDAuMmM4LDAuOSwxNC43LDYuMiwxNy40LDEzLjdsMCwwQzExOC44LDQwLjQsMTE3LDQ4LjgsMTExLjUsNTQuNnoiPjwvcGF0aD4KICAgIDxwYXRoIGZpbGw9IiM0NTRCNTQiIGQ9Ik03My41LDcyLjJjLTEuMiwwLTIuNC0wLjgtMi44LTJMNTcuMywzMy41Yy0wLjMtMC43LTAuMi0xLjYsMC4xLTIuM2MwLjMtMC43LDAuOS0xLjMsMS43LTEuNmwzNi45LTEzLjRjMS42LTAuNiwzLjMsMC4yLDMuOCwxLjhsMTMuMywzNi42YzAuMywwLjcsMC4yLDEuNi0wLjEsMi4zYy0wLjMsMC43LTAuOSwxLjMtMS43LDEuNkw3NC41LDcyQzc0LjIsNzIuMSw3My44LDcyLjIsNzMuNSw3Mi4yek02NCwzNC4zbDExLjMsMzFsMzEuMy0xMS40bC0xMS4zLTMxTDY0LDM0LjN6Ij48L3BhdGg+CiAgICA8cmVjdCB4PSIzNSIgeT0iNDYuNyIgdHJhbnNmb3JtPSJtYXRyaXgoMC45Mzk3IC0wLjM0MiAwLjM0MiAwLjkzOTcgLTE2LjIwMTEgMjAuOTg4KSIgZmlsbD0iI0ZGRkZGRiIgd2lkdGg9IjMyLjgiIGhlaWdodD0iMTkuNSI+PC9yZWN0PgogICAgPHJlY3QgeD0iMzcuMyIgeT0iNTkuOCIgdHJhbnNmb3JtPSJtYXRyaXgoLTAuOTM5NyAwLjM0MiAtMC4zNDIgLTAuOTM5NyAxMjUuNjc2MyAxMDMuMzk0NikiIGZpbGw9IiNDN0Q3RTIiIHdpZHRoPSIzMi44IiBoZWlnaHQ9IjYiPjwvcmVjdD4KICAgIDxwYXRoIGZpbGw9IiM0NTRCNTQiIGQ9Ik0zOS40LDc0LjJjLTAuNCwwLTAuOS0wLjEtMS4zLTAuM2MtMC43LTAuMy0xLjMtMC45LTEuNi0xLjdsLTYuNy0xOC4zYy0wLjMtMC43LTAuMi0xLjYsMC4xLTIuM2MwLjMtMC43LDAuOS0xLjMsMS43LTEuNmwzMC44LTExLjJjMC43LTAuMywxLjYtMC4yLDIuMywwLjFjMC43LDAuMywxLjMsMC45LDEuNiwxLjdMNzMsNTljMC42LDEuNi0wLjIsMy4zLTEuOCwzLjhMNDAuNCw3NEM0MCw3NC4xLDM5LjcsNzQuMiwzOS40LDc0LjJ6IE0zNi41LDU0LjdsNC42LDEyLjdsMjUuMi05LjJsLTQuNi0xMi43TDM2LjUsNTQuN3oiPjwvcGF0aD4KICAgIDxwYXRoIGZpbGw9IiM0NTRCNTQiIGQ9Ik03MCwxMTguOWMtMS4yLDAtMi40LTAuNy0yLjgtMS45bC0xNC0zNy4ybC04LjQsMy4xbC0xNy4yLDM0LjRjLTAuNywxLjUtMi41LDIuMS00LDEuM2MtMS41LTAuNy0yLjEtMi41LTEuMy00TDQwLDc5YzAuMy0wLjcsMC45LTEuMiwxLjctMS41TDU0LDczLjFjMS41LTAuNiwzLjMsMC4yLDMuOCwxLjhsMTUsNDBjMC42LDEuNi0wLjIsMy4zLTEuOCwzLjlDNzAuNywxMTguOCw3MC40LDExOC45LDcwLDExOC45eiI+PC9wYXRoPgogICAgPHBhdGggZmlsbD0iIzQ1NEI1NCIgZD0iTTEzLjYsODAuMWMtMS4yLDAtMi40LTAuOC0yLjgtMkw2LjMsNjUuOWMtMC42LTEuNiwwLjItMy4zLDEuOC0zLjhjMS42LTAuNiwzLjMsMC4yLDMuOCwxLjhsNC40LDEyLjJjMC42LDEuNi0wLjIsMy4zLTEuOCwzLjhDMTQuMyw4MC4xLDE0LDgwLjEsMTMuNiw4MC4xeiI+PC9wYXRoPgogICAgPHBhdGggZmlsbD0iIzQ1NEI1NCIgZD0iTTEzLjIsNzMuM2MtMS4yLDAtMi40LTAuOC0yLjgtMmMtMC42LTEuNiwwLjItMy4zLDEuOC0zLjhMMzUsNTkuMmMxLjYtMC42LDMuMywwLjIsMy44LDEuOGMwLjYsMS42LTAuMiwzLjMtMS44LDMuOGwtMjIuOCw4LjNDMTMuOSw3My4zLDEzLjYsNzMuMywxMy4yLDczLjN6Ij48L3BhdGg+Cjwvc3ZnPgo=",Km={demo:{view:"image",src:_c,height:100},examples:[{title:"Src is not defined",demo:"image"},{title:"Bad url",demo:'image{ src: "<bad url>" }'}]};function Ym(n){n.view.define("image",function(e,r){Object.assign(e,r),e.onerror=()=>e.classList.add("error"),e.onload=()=>e.classList.add("loaded")},{tag:"img",usage:Km})}var Qm={beforeDemo:['md:"Similar to the `image` view but displays as a block with the image centered. The block has a checkered background to highlight image transparency."'],demo:{view:"image-preview",src:_c,height:100},examples:[{title:"Src is not defined",demo:"image-preview"},{title:"Bad url",demo:'image-preview{ src: "<bad url>" }'}]};function Jm(n){n.view.define("image-preview",function(e,r,o,a){this.render(e,{view:"image",...r},o,a)},{usage:Qm})}var Zm={demo:{view:"indicator",data:{label:"Label",value:"1234"}},examples:[{title:"Indicator as link",demo:{view:"indicator",data:{label:"Label",value:"4321",href:"#"}}}]};function Xm(n){n.view.define("indicator",function(e,r,o,a){let{value:u,label:f}=r,{href:d}=o||{},h=document.createElement("div"),g=document.createElement("div");return h.className="value",g.className="label",d&&(e.href=d),Promise.all([n.view.render(h,u||"text:value",o,a),n.view.render(g,f||"text:label",o,a)]).then(()=>e.append(h,g))},{tag:"a",usage:Zm})}var ev={demo:{view:"link",text:"I am a link",href:"#example"},examples:[{title:"Link opened in new tab",highlightProps:["external"],demo:{view:"link",text:"Discovery github",href:"https://github.com/discoveryjs/discovery",external:!0}},{title:"Infering text \u21FF href",highlightProps:["text","href","data"],beforeDemo:['md:"When `text` is omitted but `href` is specified, or vice versa, the opposite component is inferred from the specified one"'],demo:[{view:"link",text:"http://example1.com"},{view:"link",href:"http://example2.com"},{view:"link",data:'"http://example3.com"'}]},{title:"Using onClick handler",highlightProps:["onClick"],demo:{view:"link",text:'Show "Hello world"',onClick:Function('return () => alert("Hello world!")')()}},{title:"Using data as source of options",beforeDemo:{view:"md",source:["The following properties are taken from the data when the appropriate options are not specified for a legacy reasons (is subject to remove in the future):","- `text`","- `href`","- `external`"].join(`
`)},highlightProps:["data"],demo:{view:"link",data:{text:"demo",href:"#example"}}},{title:"Complex content",highlightProps:["content"],demo:{view:"link",href:"#example",content:['text:"text "','html:"<b>bold</b>"']}}]};var $A=`is not array? | {
    text: #.props.content is undefined ? is string ?: text,
    content: undefined,
    href,
    external,
    onClick: undefined
} | overrideProps() | {
    $text; $href;
    ...,
    text: $text | is not undefined or no $href ?: $href,
    href: $href | is not undefined or no $text ?: $text
}`;function tv(n){n.view.define("link",function(e,r,o,a){let{text:u,content:f,href:d,external:h,onClick:g}=r;if(d&&(e.href=d),h&&e.setAttribute("target","_blank"),typeof g=="function"&&(e.classList.add("onclick"),e.addEventListener("click",v=>{v.preventDefault(),g(e,o,a)})),f)return n.view.render(e,f,o,a);e.textContent=u},{tag:"a",props:$A,usage:ev})}function $c(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Lr=$c();function av(n){Lr=n}var lv=/[&<>"']/,UA=new RegExp(lv.source,"g"),uv=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,VA=new RegExp(uv.source,"g"),GA={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},nv=n=>GA[n];function Kt(n,e){if(e){if(lv.test(n))return n.replace(UA,nv)}else if(uv.test(n))return n.replace(VA,nv);return n}var KA=/(^|[^\[])\^/g;function qe(n,e){let r=typeof n=="string"?n:n.source;e=e||"";let o={replace:(a,u)=>{let f=typeof u=="string"?u:u.source;return f=f.replace(KA,"$1"),r=r.replace(a,f),o},getRegex:()=>new RegExp(r,e)};return o}function rv(n){try{n=encodeURI(n).replace(/%25/g,"%")}catch{return null}return n}var $o={exec:()=>null};function iv(n,e){let r=n.replace(/\|/g,(u,f,d)=>{let h=!1,g=f;for(;--g>=0&&d[g]==="\\";)h=!h;return h?"|":" |"}),o=r.split(/ \|/),a=0;if(o[0].trim()||o.shift(),o.length>0&&!o[o.length-1].trim()&&o.pop(),e)if(o.length>e)o.splice(e);else for(;o.length<e;)o.push("");for(;a<o.length;a++)o[a]=o[a].trim().replace(/\\\|/g,"|");return o}function _o(n,e,r){let o=n.length;if(o===0)return"";let a=0;for(;a<o;){let u=n.charAt(o-a-1);if(u===e&&!r)a++;else if(u!==e&&r)a++;else break}return n.slice(0,o-a)}function YA(n,e){if(n.indexOf(e[1])===-1)return-1;let r=0;for(let o=0;o<n.length;o++)if(n[o]==="\\")o++;else if(n[o]===e[0])r++;else if(n[o]===e[1]&&(r--,r<0))return o;return-1}function ov(n,e,r,o){let a=e.href,u=e.title?Kt(e.title):null,f=n[1].replace(/\\([\[\]])/g,"$1");if(n[0].charAt(0)!=="!"){o.state.inLink=!0;let d={type:"link",raw:r,href:a,title:u,text:f,tokens:o.inlineTokens(f)};return o.state.inLink=!1,d}return{type:"image",raw:r,href:a,title:u,text:Kt(f)}}function QA(n,e){let r=n.match(/^(\s+)(?:```)/);if(r===null)return e;let o=r[1];return e.split(`
`).map(a=>{let u=a.match(/^\s+/);if(u===null)return a;let[f]=u;return f.length>=o.length?a.slice(o.length):a}).join(`
`)}var Ci=class{options;rules;lexer;constructor(e){this.options=e||Lr}space(e){let r=this.rules.block.newline.exec(e);if(r&&r[0].length>0)return{type:"space",raw:r[0]}}code(e){let r=this.rules.block.code.exec(e);if(r){let o=r[0].replace(/^(?: {1,4}| {0,3}\t)/gm,"");return{type:"code",raw:r[0],codeBlockStyle:"indented",text:this.options.pedantic?o:_o(o,`
`)}}}fences(e){let r=this.rules.block.fences.exec(e);if(r){let o=r[0],a=QA(o,r[3]||"");return{type:"code",raw:o,lang:r[2]?r[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):r[2],text:a}}}heading(e){let r=this.rules.block.heading.exec(e);if(r){let o=r[2].trim();if(/#$/.test(o)){let a=_o(o,"#");(this.options.pedantic||!a||/ $/.test(a))&&(o=a.trim())}return{type:"heading",raw:r[0],depth:r[1].length,text:o,tokens:this.lexer.inline(o)}}}hr(e){let r=this.rules.block.hr.exec(e);if(r)return{type:"hr",raw:_o(r[0],`
`)}}blockquote(e){let r=this.rules.block.blockquote.exec(e);if(r){let o=_o(r[0],`
`).split(`
`),a="",u="",f=[];for(;o.length>0;){let d=!1,h=[],g;for(g=0;g<o.length;g++)if(/^ {0,3}>/.test(o[g]))h.push(o[g]),d=!0;else if(!d)h.push(o[g]);else break;o=o.slice(g);let v=h.join(`
`),w=v.replace(/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,`
    $1`).replace(/^ {0,3}>[ \t]?/gm,"");a=a?`${a}
${v}`:v,u=u?`${u}
${w}`:w;let x=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(w,f,!0),this.lexer.state.top=x,o.length===0)break;let T=f[f.length-1];if(T?.type==="code")break;if(T?.type==="blockquote"){let E=T,M=E.raw+`
`+o.join(`
`),F=this.blockquote(M);f[f.length-1]=F,a=a.substring(0,a.length-E.raw.length)+F.raw,u=u.substring(0,u.length-E.text.length)+F.text;break}else if(T?.type==="list"){let E=T,M=E.raw+`
`+o.join(`
`),F=this.list(M);f[f.length-1]=F,a=a.substring(0,a.length-T.raw.length)+F.raw,u=u.substring(0,u.length-E.raw.length)+F.raw,o=M.substring(f[f.length-1].raw.length).split(`
`);continue}}return{type:"blockquote",raw:a,tokens:f,text:u}}}list(e){let r=this.rules.block.list.exec(e);if(r){let o=r[1].trim(),a=o.length>1,u={type:"list",raw:"",ordered:a,start:a?+o.slice(0,-1):"",loose:!1,items:[]};o=a?`\\d{1,9}\\${o.slice(-1)}`:`\\${o}`,this.options.pedantic&&(o=a?o:"[*+-]");let f=new RegExp(`^( {0,3}${o})((?:[	 ][^\\n]*)?(?:\\n|$))`),d=!1;for(;e;){let h=!1,g="",v="";if(!(r=f.exec(e))||this.rules.block.hr.test(e))break;g=r[0],e=e.substring(g.length);let w=r[2].split(`
`,1)[0].replace(/^\t+/,D=>" ".repeat(3*D.length)),x=e.split(`
`,1)[0],T=!w.trim(),E=0;if(this.options.pedantic?(E=2,v=w.trimStart()):T?E=r[1].length+1:(E=r[2].search(/[^ ]/),E=E>4?1:E,v=w.slice(E),E+=r[1].length),T&&/^[ \t]*$/.test(x)&&(g+=x+`
`,e=e.substring(x.length+1),h=!0),!h){let D=new RegExp(`^ {0,${Math.min(3,E-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),C=new RegExp(`^ {0,${Math.min(3,E-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),L=new RegExp(`^ {0,${Math.min(3,E-1)}}(?:\`\`\`|~~~)`),N=new RegExp(`^ {0,${Math.min(3,E-1)}}#`),B=new RegExp(`^ {0,${Math.min(3,E-1)}}<(?:[a-z].*>|!--)`,"i");for(;e;){let O=e.split(`
`,1)[0],z;if(x=O,this.options.pedantic?(x=x.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  "),z=x):z=x.replace(/\t/g,"    "),L.test(x)||N.test(x)||B.test(x)||D.test(x)||C.test(x))break;if(z.search(/[^ ]/)>=E||!x.trim())v+=`
`+z.slice(E);else{if(T||w.replace(/\t/g,"    ").search(/[^ ]/)>=4||L.test(w)||N.test(w)||C.test(w))break;v+=`
`+x}!T&&!x.trim()&&(T=!0),g+=O+`
`,e=e.substring(O.length+1),w=z.slice(E)}}u.loose||(d?u.loose=!0:/\n[ \t]*\n[ \t]*$/.test(g)&&(d=!0));let M=null,F;this.options.gfm&&(M=/^\[[ xX]\] /.exec(v),M&&(F=M[0]!=="[ ] ",v=v.replace(/^\[[ xX]\] +/,""))),u.items.push({type:"list_item",raw:g,task:!!M,checked:F,loose:!1,text:v,tokens:[]}),u.raw+=g}u.items[u.items.length-1].raw=u.items[u.items.length-1].raw.trimEnd(),u.items[u.items.length-1].text=u.items[u.items.length-1].text.trimEnd(),u.raw=u.raw.trimEnd();for(let h=0;h<u.items.length;h++)if(this.lexer.state.top=!1,u.items[h].tokens=this.lexer.blockTokens(u.items[h].text,[]),!u.loose){let g=u.items[h].tokens.filter(w=>w.type==="space"),v=g.length>0&&g.some(w=>/\n.*\n/.test(w.raw));u.loose=v}if(u.loose)for(let h=0;h<u.items.length;h++)u.items[h].loose=!0;return u}}html(e){let r=this.rules.block.html.exec(e);if(r)return{type:"html",block:!0,raw:r[0],pre:r[1]==="pre"||r[1]==="script"||r[1]==="style",text:r[0]}}def(e){let r=this.rules.block.def.exec(e);if(r){let o=r[1].toLowerCase().replace(/\s+/g," "),a=r[2]?r[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",u=r[3]?r[3].substring(1,r[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):r[3];return{type:"def",tag:o,raw:r[0],href:a,title:u}}}table(e){let r=this.rules.block.table.exec(e);if(!r||!/[:|]/.test(r[2]))return;let o=iv(r[1]),a=r[2].replace(/^\||\| *$/g,"").split("|"),u=r[3]&&r[3].trim()?r[3].replace(/\n[ \t]*$/,"").split(`
`):[],f={type:"table",raw:r[0],header:[],align:[],rows:[]};if(o.length===a.length){for(let d of a)/^ *-+: *$/.test(d)?f.align.push("right"):/^ *:-+: *$/.test(d)?f.align.push("center"):/^ *:-+ *$/.test(d)?f.align.push("left"):f.align.push(null);for(let d=0;d<o.length;d++)f.header.push({text:o[d],tokens:this.lexer.inline(o[d]),header:!0,align:f.align[d]});for(let d of u)f.rows.push(iv(d,f.header.length).map((h,g)=>({text:h,tokens:this.lexer.inline(h),header:!1,align:f.align[g]})));return f}}lheading(e){let r=this.rules.block.lheading.exec(e);if(r)return{type:"heading",raw:r[0],depth:r[2].charAt(0)==="="?1:2,text:r[1],tokens:this.lexer.inline(r[1])}}paragraph(e){let r=this.rules.block.paragraph.exec(e);if(r){let o=r[1].charAt(r[1].length-1)===`
`?r[1].slice(0,-1):r[1];return{type:"paragraph",raw:r[0],text:o,tokens:this.lexer.inline(o)}}}text(e){let r=this.rules.block.text.exec(e);if(r)return{type:"text",raw:r[0],text:r[0],tokens:this.lexer.inline(r[0])}}escape(e){let r=this.rules.inline.escape.exec(e);if(r)return{type:"escape",raw:r[0],text:Kt(r[1])}}tag(e){let r=this.rules.inline.tag.exec(e);if(r)return!this.lexer.state.inLink&&/^<a /i.test(r[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(r[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(r[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(r[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:r[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:r[0]}}link(e){let r=this.rules.inline.link.exec(e);if(r){let o=r[2].trim();if(!this.options.pedantic&&/^</.test(o)){if(!/>$/.test(o))return;let f=_o(o.slice(0,-1),"\\");if((o.length-f.length)%2===0)return}else{let f=YA(r[2],"()");if(f>-1){let h=(r[0].indexOf("!")===0?5:4)+r[1].length+f;r[2]=r[2].substring(0,f),r[0]=r[0].substring(0,h).trim(),r[3]=""}}let a=r[2],u="";if(this.options.pedantic){let f=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(a);f&&(a=f[1],u=f[3])}else u=r[3]?r[3].slice(1,-1):"";return a=a.trim(),/^</.test(a)&&(this.options.pedantic&&!/>$/.test(o)?a=a.slice(1):a=a.slice(1,-1)),ov(r,{href:a&&a.replace(this.rules.inline.anyPunctuation,"$1"),title:u&&u.replace(this.rules.inline.anyPunctuation,"$1")},r[0],this.lexer)}}reflink(e,r){let o;if((o=this.rules.inline.reflink.exec(e))||(o=this.rules.inline.nolink.exec(e))){let a=(o[2]||o[1]).replace(/\s+/g," "),u=r[a.toLowerCase()];if(!u){let f=o[0].charAt(0);return{type:"text",raw:f,text:f}}return ov(o,u,o[0],this.lexer)}}emStrong(e,r,o=""){let a=this.rules.inline.emStrongLDelim.exec(e);if(!a||a[3]&&o.match(/[\p{L}\p{N}]/u))return;if(!(a[1]||a[2]||"")||!o||this.rules.inline.punctuation.exec(o)){let f=[...a[0]].length-1,d,h,g=f,v=0,w=a[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(w.lastIndex=0,r=r.slice(-1*e.length+f);(a=w.exec(r))!=null;){if(d=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!d)continue;if(h=[...d].length,a[3]||a[4]){g+=h;continue}else if((a[5]||a[6])&&f%3&&!((f+h)%3)){v+=h;continue}if(g-=h,g>0)continue;h=Math.min(h,h+g+v);let x=[...a[0]][0].length,T=e.slice(0,f+a.index+x+h);if(Math.min(f,h)%2){let M=T.slice(1,-1);return{type:"em",raw:T,text:M,tokens:this.lexer.inlineTokens(M)}}let E=T.slice(2,-2);return{type:"strong",raw:T,text:E,tokens:this.lexer.inlineTokens(E)}}}}codespan(e){let r=this.rules.inline.code.exec(e);if(r){let o=r[2].replace(/\n/g," "),a=/[^ ]/.test(o),u=/^ /.test(o)&&/ $/.test(o);return a&&u&&(o=o.substring(1,o.length-1)),o=Kt(o,!0),{type:"codespan",raw:r[0],text:o}}}br(e){let r=this.rules.inline.br.exec(e);if(r)return{type:"br",raw:r[0]}}del(e){let r=this.rules.inline.del.exec(e);if(r)return{type:"del",raw:r[0],text:r[2],tokens:this.lexer.inlineTokens(r[2])}}autolink(e){let r=this.rules.inline.autolink.exec(e);if(r){let o,a;return r[2]==="@"?(o=Kt(r[1]),a="mailto:"+o):(o=Kt(r[1]),a=o),{type:"link",raw:r[0],text:o,href:a,tokens:[{type:"text",raw:o,text:o}]}}}url(e){let r;if(r=this.rules.inline.url.exec(e)){let o,a;if(r[2]==="@")o=Kt(r[0]),a="mailto:"+o;else{let u;do u=r[0],r[0]=this.rules.inline._backpedal.exec(r[0])?.[0]??"";while(u!==r[0]);o=Kt(r[0]),r[1]==="www."?a="http://"+r[0]:a=r[0]}return{type:"link",raw:r[0],text:o,href:a,tokens:[{type:"text",raw:o,text:o}]}}}inlineText(e){let r=this.rules.inline.text.exec(e);if(r){let o;return this.lexer.state.inRawBlock?o=r[0]:o=Kt(r[0]),{type:"text",raw:r[0],text:o}}}},JA=/^(?:[ \t]*(?:\n|$))+/,ZA=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,XA=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Go=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,eS=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,cv=/(?:[*+-]|\d{1,9}[.)])/,fv=qe(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,cv).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),Uc=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,tS=/^[^\n]+/,Vc=/(?!\s*\])(?:\\.|[^\[\]\\])+/,nS=qe(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Vc).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),rS=qe(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,cv).getRegex(),La="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Gc=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,iS=qe("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Gc).replace("tag",La).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),dv=qe(Uc).replace("hr",Go).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",La).getRegex(),oS=qe(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",dv).getRegex(),Kc={blockquote:oS,code:ZA,def:nS,fences:XA,heading:eS,hr:Go,html:iS,lheading:fv,list:rS,newline:JA,paragraph:dv,table:$o,text:tS},sv=qe("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Go).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",La).getRegex(),sS={...Kc,table:sv,paragraph:qe(Uc).replace("hr",Go).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",sv).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",La).getRegex()},aS={...Kc,html:qe(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Gc).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:$o,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:qe(Uc).replace("hr",Go).replace("heading",` *#{1,6} *[^
]`).replace("lheading",fv).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},pv=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,lS=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,hv=/^( {2,}|\\)\n(?!\s*$)/,uS=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Ko="\\p{P}\\p{S}",cS=qe(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,Ko).getRegex(),fS=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,dS=qe(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,Ko).getRegex(),pS=qe("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,Ko).getRegex(),hS=qe("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,Ko).getRegex(),gS=qe(/\\([punct])/,"gu").replace(/punct/g,Ko).getRegex(),mS=qe(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),vS=qe(Gc).replace("(?:-->|$)","-->").getRegex(),yS=qe("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",vS).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Fa=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,bS=qe(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",Fa).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),gv=qe(/^!?\[(label)\]\[(ref)\]/).replace("label",Fa).replace("ref",Vc).getRegex(),mv=qe(/^!?\[(ref)\](?:\[\])?/).replace("ref",Vc).getRegex(),wS=qe("reflink|nolink(?!\\()","g").replace("reflink",gv).replace("nolink",mv).getRegex(),Yc={_backpedal:$o,anyPunctuation:gS,autolink:mS,blockSkip:fS,br:hv,code:lS,del:$o,emStrongLDelim:dS,emStrongRDelimAst:pS,emStrongRDelimUnd:hS,escape:pv,link:bS,nolink:mv,punctuation:cS,reflink:gv,reflinkSearch:wS,tag:yS,text:uS,url:$o},xS={...Yc,link:qe(/^!?\[(label)\]\((.*?)\)/).replace("label",Fa).getRegex(),reflink:qe(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Fa).getRegex()},Wc={...Yc,escape:qe(pv).replace("])","~|])").getRegex(),url:qe(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},kS={...Wc,br:qe(hv).replace("{2,}","*").getRegex(),text:qe(Wc.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Ta={normal:Kc,gfm:sS,pedantic:aS},Wo={normal:Yc,gfm:Wc,breaks:kS,pedantic:xS},hn=class n{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Lr,this.options.tokenizer=this.options.tokenizer||new Ci,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let r={block:Ta.normal,inline:Wo.normal};this.options.pedantic?(r.block=Ta.pedantic,r.inline=Wo.pedantic):this.options.gfm&&(r.block=Ta.gfm,this.options.breaks?r.inline=Wo.breaks:r.inline=Wo.gfm),this.tokenizer.rules=r}static get rules(){return{block:Ta,inline:Wo}}static lex(e,r){return new n(r).lex(e)}static lexInline(e,r){return new n(r).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);for(let r=0;r<this.inlineQueue.length;r++){let o=this.inlineQueue[r];this.inlineTokens(o.src,o.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,r=[],o=!1){this.options.pedantic&&(e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""));let a,u,f;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(d=>(a=d.call({lexer:this},e,r))?(e=e.substring(a.raw.length),r.push(a),!0):!1))){if(a=this.tokenizer.space(e)){e=e.substring(a.raw.length),a.raw.length===1&&r.length>0?r[r.length-1].raw+=`
`:r.push(a);continue}if(a=this.tokenizer.code(e)){e=e.substring(a.raw.length),u=r[r.length-1],u&&(u.type==="paragraph"||u.type==="text")?(u.raw+=`
`+a.raw,u.text+=`
`+a.text,this.inlineQueue[this.inlineQueue.length-1].src=u.text):r.push(a);continue}if(a=this.tokenizer.fences(e)){e=e.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.heading(e)){e=e.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.hr(e)){e=e.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.blockquote(e)){e=e.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.list(e)){e=e.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.html(e)){e=e.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.def(e)){e=e.substring(a.raw.length),u=r[r.length-1],u&&(u.type==="paragraph"||u.type==="text")?(u.raw+=`
`+a.raw,u.text+=`
`+a.raw,this.inlineQueue[this.inlineQueue.length-1].src=u.text):this.tokens.links[a.tag]||(this.tokens.links[a.tag]={href:a.href,title:a.title});continue}if(a=this.tokenizer.table(e)){e=e.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.lheading(e)){e=e.substring(a.raw.length),r.push(a);continue}if(f=e,this.options.extensions&&this.options.extensions.startBlock){let d=1/0,h=e.slice(1),g;this.options.extensions.startBlock.forEach(v=>{g=v.call({lexer:this},h),typeof g=="number"&&g>=0&&(d=Math.min(d,g))}),d<1/0&&d>=0&&(f=e.substring(0,d+1))}if(this.state.top&&(a=this.tokenizer.paragraph(f))){u=r[r.length-1],o&&u?.type==="paragraph"?(u.raw+=`
`+a.raw,u.text+=`
`+a.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=u.text):r.push(a),o=f.length!==e.length,e=e.substring(a.raw.length);continue}if(a=this.tokenizer.text(e)){e=e.substring(a.raw.length),u=r[r.length-1],u&&u.type==="text"?(u.raw+=`
`+a.raw,u.text+=`
`+a.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=u.text):r.push(a);continue}if(e){let d="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(d);break}else throw new Error(d)}}return this.state.top=!0,r}inline(e,r=[]){return this.inlineQueue.push({src:e,tokens:r}),r}inlineTokens(e,r=[]){let o,a,u,f=e,d,h,g;if(this.tokens.links){let v=Object.keys(this.tokens.links);if(v.length>0)for(;(d=this.tokenizer.rules.inline.reflinkSearch.exec(f))!=null;)v.includes(d[0].slice(d[0].lastIndexOf("[")+1,-1))&&(f=f.slice(0,d.index)+"["+"a".repeat(d[0].length-2)+"]"+f.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(d=this.tokenizer.rules.inline.blockSkip.exec(f))!=null;)f=f.slice(0,d.index)+"["+"a".repeat(d[0].length-2)+"]"+f.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(d=this.tokenizer.rules.inline.anyPunctuation.exec(f))!=null;)f=f.slice(0,d.index)+"++"+f.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(h||(g=""),h=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(v=>(o=v.call({lexer:this},e,r))?(e=e.substring(o.raw.length),r.push(o),!0):!1))){if(o=this.tokenizer.escape(e)){e=e.substring(o.raw.length),r.push(o);continue}if(o=this.tokenizer.tag(e)){e=e.substring(o.raw.length),a=r[r.length-1],a&&o.type==="text"&&a.type==="text"?(a.raw+=o.raw,a.text+=o.text):r.push(o);continue}if(o=this.tokenizer.link(e)){e=e.substring(o.raw.length),r.push(o);continue}if(o=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(o.raw.length),a=r[r.length-1],a&&o.type==="text"&&a.type==="text"?(a.raw+=o.raw,a.text+=o.text):r.push(o);continue}if(o=this.tokenizer.emStrong(e,f,g)){e=e.substring(o.raw.length),r.push(o);continue}if(o=this.tokenizer.codespan(e)){e=e.substring(o.raw.length),r.push(o);continue}if(o=this.tokenizer.br(e)){e=e.substring(o.raw.length),r.push(o);continue}if(o=this.tokenizer.del(e)){e=e.substring(o.raw.length),r.push(o);continue}if(o=this.tokenizer.autolink(e)){e=e.substring(o.raw.length),r.push(o);continue}if(!this.state.inLink&&(o=this.tokenizer.url(e))){e=e.substring(o.raw.length),r.push(o);continue}if(u=e,this.options.extensions&&this.options.extensions.startInline){let v=1/0,w=e.slice(1),x;this.options.extensions.startInline.forEach(T=>{x=T.call({lexer:this},w),typeof x=="number"&&x>=0&&(v=Math.min(v,x))}),v<1/0&&v>=0&&(u=e.substring(0,v+1))}if(o=this.tokenizer.inlineText(u)){e=e.substring(o.raw.length),o.raw.slice(-1)!=="_"&&(g=o.raw.slice(-1)),h=!0,a=r[r.length-1],a&&a.type==="text"?(a.raw+=o.raw,a.text+=o.text):r.push(o);continue}if(e){let v="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(v);break}else throw new Error(v)}}return r}},ir=class{options;parser;constructor(e){this.options=e||Lr}space(e){return""}code({text:e,lang:r,escaped:o}){let a=(r||"").match(/^\S*/)?.[0],u=e.replace(/\n$/,"")+`
`;return a?'<pre><code class="language-'+Kt(a)+'">'+(o?u:Kt(u,!0))+`</code></pre>
`:"<pre><code>"+(o?u:Kt(u,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:r}){return`<h${r}>${this.parser.parseInline(e)}</h${r}>
`}hr(e){return`<hr>
`}list(e){let r=e.ordered,o=e.start,a="";for(let d=0;d<e.items.length;d++){let h=e.items[d];a+=this.listitem(h)}let u=r?"ol":"ul",f=r&&o!==1?' start="'+o+'"':"";return"<"+u+f+`>
`+a+"</"+u+`>
`}listitem(e){let r="";if(e.task){let o=this.checkbox({checked:!!e.checked});e.loose?e.tokens.length>0&&e.tokens[0].type==="paragraph"?(e.tokens[0].text=o+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=o+" "+e.tokens[0].tokens[0].text)):e.tokens.unshift({type:"text",raw:o+" ",text:o+" "}):r+=o+" "}return r+=this.parser.parse(e.tokens,!!e.loose),`<li>${r}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let r="",o="";for(let u=0;u<e.header.length;u++)o+=this.tablecell(e.header[u]);r+=this.tablerow({text:o});let a="";for(let u=0;u<e.rows.length;u++){let f=e.rows[u];o="";for(let d=0;d<f.length;d++)o+=this.tablecell(f[d]);a+=this.tablerow({text:o})}return a&&(a=`<tbody>${a}</tbody>`),`<table>
<thead>
`+r+`</thead>
`+a+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){let r=this.parser.parseInline(e.tokens),o=e.header?"th":"td";return(e.align?`<${o} align="${e.align}">`:`<${o}>`)+r+`</${o}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${e}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:r,tokens:o}){let a=this.parser.parseInline(o),u=rv(e);if(u===null)return a;e=u;let f='<a href="'+e+'"';return r&&(f+=' title="'+r+'"'),f+=">"+a+"</a>",f}image({href:e,title:r,text:o}){let a=rv(e);if(a===null)return o;e=a;let u=`<img src="${e}" alt="${o}"`;return r&&(u+=` title="${r}"`),u+=">",u}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):e.text}},Uo=class{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}},gn=class n{options;renderer;textRenderer;constructor(e){this.options=e||Lr,this.options.renderer=this.options.renderer||new ir,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Uo}static parse(e,r){return new n(r).parse(e)}static parseInline(e,r){return new n(r).parseInline(e)}parse(e,r=!0){let o="";for(let a=0;a<e.length;a++){let u=e[a];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[u.type]){let d=u,h=this.options.extensions.renderers[d.type].call({parser:this},d);if(h!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(d.type)){o+=h||"";continue}}let f=u;switch(f.type){case"space":{o+=this.renderer.space(f);continue}case"hr":{o+=this.renderer.hr(f);continue}case"heading":{o+=this.renderer.heading(f);continue}case"code":{o+=this.renderer.code(f);continue}case"table":{o+=this.renderer.table(f);continue}case"blockquote":{o+=this.renderer.blockquote(f);continue}case"list":{o+=this.renderer.list(f);continue}case"html":{o+=this.renderer.html(f);continue}case"paragraph":{o+=this.renderer.paragraph(f);continue}case"text":{let d=f,h=this.renderer.text(d);for(;a+1<e.length&&e[a+1].type==="text";)d=e[++a],h+=`
`+this.renderer.text(d);r?o+=this.renderer.paragraph({type:"paragraph",raw:h,text:h,tokens:[{type:"text",raw:h,text:h}]}):o+=h;continue}default:{let d='Token with "'+f.type+'" type was not found.';if(this.options.silent)return console.error(d),"";throw new Error(d)}}}return o}parseInline(e,r){r=r||this.renderer;let o="";for(let a=0;a<e.length;a++){let u=e[a];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[u.type]){let d=this.options.extensions.renderers[u.type].call({parser:this},u);if(d!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(u.type)){o+=d||"";continue}}let f=u;switch(f.type){case"escape":{o+=r.text(f);break}case"html":{o+=r.html(f);break}case"link":{o+=r.link(f);break}case"image":{o+=r.image(f);break}case"strong":{o+=r.strong(f);break}case"em":{o+=r.em(f);break}case"codespan":{o+=r.codespan(f);break}case"br":{o+=r.br(f);break}case"del":{o+=r.del(f);break}case"text":{o+=r.text(f);break}default:{let d='Token with "'+f.type+'" type was not found.';if(this.options.silent)return console.error(d),"";throw new Error(d)}}}return o}},ki=class{options;block;constructor(e){this.options=e||Lr}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?hn.lex:hn.lexInline}provideParser(){return this.block?gn.parse:gn.parseInline}},Vo=class{defaults=$c();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=gn;Renderer=ir;TextRenderer=Uo;Lexer=hn;Tokenizer=Ci;Hooks=ki;constructor(...e){this.use(...e)}walkTokens(e,r){let o=[];for(let a of e)switch(o=o.concat(r.call(this,a)),a.type){case"table":{let u=a;for(let f of u.header)o=o.concat(this.walkTokens(f.tokens,r));for(let f of u.rows)for(let d of f)o=o.concat(this.walkTokens(d.tokens,r));break}case"list":{let u=a;o=o.concat(this.walkTokens(u.items,r));break}default:{let u=a;this.defaults.extensions?.childTokens?.[u.type]?this.defaults.extensions.childTokens[u.type].forEach(f=>{let d=u[f].flat(1/0);o=o.concat(this.walkTokens(d,r))}):u.tokens&&(o=o.concat(this.walkTokens(u.tokens,r)))}}return o}use(...e){let r=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(o=>{let a={...o};if(a.async=this.defaults.async||a.async||!1,o.extensions&&(o.extensions.forEach(u=>{if(!u.name)throw new Error("extension name required");if("renderer"in u){let f=r.renderers[u.name];f?r.renderers[u.name]=function(...d){let h=u.renderer.apply(this,d);return h===!1&&(h=f.apply(this,d)),h}:r.renderers[u.name]=u.renderer}if("tokenizer"in u){if(!u.level||u.level!=="block"&&u.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let f=r[u.level];f?f.unshift(u.tokenizer):r[u.level]=[u.tokenizer],u.start&&(u.level==="block"?r.startBlock?r.startBlock.push(u.start):r.startBlock=[u.start]:u.level==="inline"&&(r.startInline?r.startInline.push(u.start):r.startInline=[u.start]))}"childTokens"in u&&u.childTokens&&(r.childTokens[u.name]=u.childTokens)}),a.extensions=r),o.renderer){let u=this.defaults.renderer||new ir(this.defaults);for(let f in o.renderer){if(!(f in u))throw new Error(`renderer '${f}' does not exist`);if(["options","parser"].includes(f))continue;let d=f,h=o.renderer[d],g=u[d];u[d]=(...v)=>{let w=h.apply(u,v);return w===!1&&(w=g.apply(u,v)),w||""}}a.renderer=u}if(o.tokenizer){let u=this.defaults.tokenizer||new Ci(this.defaults);for(let f in o.tokenizer){if(!(f in u))throw new Error(`tokenizer '${f}' does not exist`);if(["options","rules","lexer"].includes(f))continue;let d=f,h=o.tokenizer[d],g=u[d];u[d]=(...v)=>{let w=h.apply(u,v);return w===!1&&(w=g.apply(u,v)),w}}a.tokenizer=u}if(o.hooks){let u=this.defaults.hooks||new ki;for(let f in o.hooks){if(!(f in u))throw new Error(`hook '${f}' does not exist`);if(["options","block"].includes(f))continue;let d=f,h=o.hooks[d],g=u[d];ki.passThroughHooks.has(f)?u[d]=v=>{if(this.defaults.async)return Promise.resolve(h.call(u,v)).then(x=>g.call(u,x));let w=h.call(u,v);return g.call(u,w)}:u[d]=(...v)=>{let w=h.apply(u,v);return w===!1&&(w=g.apply(u,v)),w}}a.hooks=u}if(o.walkTokens){let u=this.defaults.walkTokens,f=o.walkTokens;a.walkTokens=function(d){let h=[];return h.push(f.call(this,d)),u&&(h=h.concat(u.call(this,d))),h}}this.defaults={...this.defaults,...a}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,r){return hn.lex(e,r??this.defaults)}parser(e,r){return gn.parse(e,r??this.defaults)}parseMarkdown(e){return(o,a)=>{let u={...a},f={...this.defaults,...u},d=this.onError(!!f.silent,!!f.async);if(this.defaults.async===!0&&u.async===!1)return d(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof o>"u"||o===null)return d(new Error("marked(): input parameter is undefined or null"));if(typeof o!="string")return d(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(o)+", string expected"));f.hooks&&(f.hooks.options=f,f.hooks.block=e);let h=f.hooks?f.hooks.provideLexer():e?hn.lex:hn.lexInline,g=f.hooks?f.hooks.provideParser():e?gn.parse:gn.parseInline;if(f.async)return Promise.resolve(f.hooks?f.hooks.preprocess(o):o).then(v=>h(v,f)).then(v=>f.hooks?f.hooks.processAllTokens(v):v).then(v=>f.walkTokens?Promise.all(this.walkTokens(v,f.walkTokens)).then(()=>v):v).then(v=>g(v,f)).then(v=>f.hooks?f.hooks.postprocess(v):v).catch(d);try{f.hooks&&(o=f.hooks.preprocess(o));let v=h(o,f);f.hooks&&(v=f.hooks.processAllTokens(v)),f.walkTokens&&this.walkTokens(v,f.walkTokens);let w=g(v,f);return f.hooks&&(w=f.hooks.postprocess(w)),w}catch(v){return d(v)}}}onError(e,r){return o=>{if(o.message+=`
Please report this to https://github.com/markedjs/marked.`,e){let a="<p>An error occurred:</p><pre>"+Kt(o.message+"",!0)+"</pre>";return r?Promise.resolve(a):a}if(r)return Promise.reject(o);throw o}}},Fr=new Vo;function He(n,e){return Fr.parse(n,e)}He.options=He.setOptions=function(n){return Fr.setOptions(n),He.defaults=Fr.defaults,av(He.defaults),He};He.getDefaults=$c;He.defaults=Lr;He.use=function(...n){return Fr.use(...n),He.defaults=Fr.defaults,av(He.defaults),He};He.walkTokens=function(n,e){return Fr.walkTokens(n,e)};He.parseInline=Fr.parseInline;He.Parser=gn;He.parser=gn.parse;He.Renderer=ir;He.TextRenderer=Uo;He.Lexer=hn;He.lexer=hn.lex;He.Tokenizer=Ci;He.Hooks=ki;He.parse=He;var QB=He.options,JB=He.setOptions,ZB=He.use,XB=He.walkTokens,eO=He.parseInline;var tO=gn.parse,nO=hn.lex;var Ma=class extends ir{heading({tokens:e,depth:r,text:o}){let{discoveryjs:{host:a,useAnchors:u}}=this.options,f=Ea(o.replace(/<!--.*?-->/g,"")),d="";if(u){let h=a.encodePageHash(a.pageId,a.pageRef,a.pageParams,f);d=`<a class="view-header__anchor" id="!anchor:${Ue(f)}" href="${h}"></a>`}return`<h${r} class="view-header view-h${r}" data-slug="${f}">${d}${this.parser.parseInline(e)}</h${r}>
`}blockquote({tokens:e}){let r=this.parser.parse(e),o=null,a=r.match(/^(<p>)?\[!([a-z]+)\]\n/i);return a&&(o=a[2],r=(a[1]||"")+r.slice(a[0].length)),`<blockquote class="view-blockquote"${o?` data-kind=${JSON.stringify(o.toLowerCase())}`:""}>${r}</blockquote>`}code({text:e,lang:r}){let{discoveryjs:{codes:o}}=this.options;return`<code class="discoveryjs-code" data-id="${o.push({syntax:r,source:e})-1}"></code>`}link({tokens:e,href:r,title:o}){let a=this.parser.parseInline(e);if(r===null)return a;let u='<a class="view-link md-rendered-link" href="'+Ue(r)+'"';return o&&(u+=' title="'+Ue(o)+'"'),u+=">"+a+"</a>",u}checkbox({checked:e}){return'<label class="view-checkbox"><input type="checkbox" disabled'+(e?" checked":"")+"/></label> "}list({items:e,ordered:r,start:o}){let a=r?"ol":"ul",u=r&&o!==1?` start="${o}"`:"";return`<${a} class="view-${a}"${u}>
`+e.map(this.listitem,this).join(`
`)+`
</${a}>
`}listitem(e){let r="";if(e.task){let o=this.checkbox({checked:!!e.checked});if(e.loose){let a=e.tokens[0];a?.type==="paragraph"?(a.text=o+a.text,Array.isArray(a.tokens)&&a.tokens[0]?.type==="text"&&(a.tokens[0].text=o+a.tokens[0].text)):e.tokens.unshift({type:"text",raw:o,text:o})}else r+=o}return`<li class="view-list-item${e.task?" check-list-item":""}">${r}${this.parser.parse(e.tokens,!!e.loose)}</li>
`}table({header:e,rows:r}){let o=r.map(a=>'<tr class="view-table-row">'+a.map(this.tablecell,this).join("")+"</tr>").join(`
`);return`<table class="view-table">
<thead>
`+e.map(this.tablecell,this).join("")+`
</thead>
`+(o?`<tbody>
`+o+`
</tbody>
`:"")+`</table>
`}tablecell({tokens:e,header:r,align:o}){let a=r?"th":"td";return`<${a} class="${r?"view-table-header-cell":"view-table-cell"}"${o?` align="${o}"`:""}>`+this.parser.parseInline(e)+`</${a}>
`}};var Qc={demo:{view:"markdown",source:`# Markdown example

> NOTE: The \`markdown\` view is based on [marked](https://github.com/markedjs/marked) package

Markdown is good because:
* You'll get **formatted** *text* with _no tags_
* It's much simpler than \`HTML\`

\`\`\`html
<b>bold</b><i>italic</i>
\`\`\`
[Read more](https://guides.github.com/features/mastering-markdown/)`},examples:[{title:"Inline config",demo:'markdown{ source: "**Hello** `world`!" }'},{title:"Shorthand syntax",beforeDemo:['md:"You can use `md` as an alias for `markdown` with a string as data. That\'s a **shortest** definition for a marked text"'],demo:'md:"**Hello** `world`!"'},{title:"Array of strings as a source",beforeDemo:['md:"Array of strings might be passed as a value for `source` property which is useful for a long sources\\n> NOTE: This doesn\'t work a source passed via data"'],demo:{view:"markdown",source:["Array","of","`strings`"]}},{title:"Interpolation",beforeDemo:['md:"Interpolation can be used almost anywhere in a markdown to embed the result of a jora query into resulting HTML. Just place a jora query between `{{`{{`}}` and `{{`}`+`}`}}`:"'],demo:{view:"md",source:["Simple evaluation: 2 + 2 = `{{ 2 + 2 }}`","","Markdown view has {{ #.options.usage.examples.size() }} examples"]}},{title:"Disable anchors for headers",highlightProps:["anchors"],beforeDemo:"Hover a header to see a chain icon on the left side of header when anchors are enabled:",demo:[{view:"markdown",source:"## header with default settings"},{view:"markdown",anchors:!1,source:"## header with disabled anchor"}]},{title:"Sections prelude and postlude",highlightProps:["sectionPrelude","sectionPostlude"],demo:{view:"markdown",source:`Section without a header

## Header level 2

Section 1

### Header level 3

Section 2

## Header level 2

Section 3`,sectionPrelude:"struct:#.section",sectionPostlude:{view:"link",href:"#top",text:"Scroll to top \u2191"}}},{title:"Configuration for code blocks",highlightProps:["codeConfig"],beforeDemo:['md:"Use `codeConfig` to specify any settings for code blocks available for `source` view."'],demo:{view:"markdown",source:`# Header 1

\`\`\`js
console.log("Hello world")
\`\`\`

## Header 2

text

## Header 3



\`\`\`jora
foo.bar.baz
\`\`\``,codeConfig:{prelude:{view:"block",content:["badge:syntax",'text:"Length: " + #.sourceViewProps.source.size()']},postlude:"struct:#.section",actionButtons:[{view:"button",text:'Say "Hello world"',onClick:Function('return () => alert("Hello world!")')()}]}}},{title:"Showcase",demo:{view:"markdown",source:`
# Header level 1
## Header level 2
### Header level 3
#### Header level 4
##### Header level 5
* One
* Two
    * Three

4. Four
5. Five
    6. Six
- [{{ true }}] Task 1
- [x] Task 2

Interpolation in text: 2 + 2 = \`{{ 2 + 2 }}\`, or in attribute: [link](#dummy-link/{{"exam" + "ple"}} "{{ "example" + " title" }}")

Paragraph **bold** __bold__ *italic* _italic_ ~line-through~ \`code\` [link](#href)

>Blockquote
> > Line 2

> [!NOTE]
> Useful information that users should know, even when skimming content.

> [!TIP]
> Helpful advice for doing things better or more easily.

> [!IMPORTANT]
> Key information users need to know to achieve their goal.

> [!WARNING]
> Urgent info that needs immediate user attention to avoid problems.

> [!CAUTION]
> Advises about risks or negative outcomes of certain actions.

\`\`\`js
var some = "code";
\`\`\`

foo | bar
----|-----
1 | A
2 | C
3 | E
`.trim().split(/\n/)}}]};function vv(n,e){let{nodeValue:r}=n,o=r.replace(/{{(\d+)}}/gs,(a,u)=>e[u]);o!==r&&(n.nodeValue=o)}function bv(n,e){for(let r of n.childNodes)switch(r.nodeType){case document.ELEMENT_NODE:if(!r.classList.contains("view-source")){bv(r,e);for(let o of r.attributes)vv(o,e)}break;case document.TEXT_NODE:vv(r,e);break}}function CS(n){let e=new Map,r={after:n.prepend.bind(n)},o={next:null,data:{sectionIdx:0,slug:null,text:null,href:null}};e.set(r,o);for(let a of[...n.querySelectorAll(":scope > :is(h1, h2, h3, h4, h5, h6)")]){a===n.firstElementChild&&(e.delete(r),r=a,o=null);let u=a.querySelector(':scope > a[id^="!anchor:"]'),f={next:null,data:{sectionIdx:e.size,slug:a.dataset.slug,text:a.textContent.trim(),href:u?.hash}};e.set(a,f),o&&(o.next=a),o=f}return{sectionByHeaderEl:e,findSectionByEl(a){let u=e.get(r);for(;a!==null&&a!==n;){if(e.has(a)){u=e.get(a);break}a=a.previousSibling||a.parentNode}return u?.data||null}}}var yv=`is not array? | {
    source: #.props has no 'source' ? is (string or array) ?,
    anchors: true,
    sectionPrelude: undefined,
    sectionPostlude: undefined,
    codeConfig: undefined
} | overrideProps()`;function wv(n){let e=new Vo().setOptions({smartLists:!0,renderer:new Ma});function r(o,a,u,f){let d=new Map,h=[],g=[],{anchors:v=!0,sectionPrelude:w,sectionPostlude:x}=a,{source:T,codeConfig:E}=a;if(Array.isArray(T)&&(T=T.join(`
`)),T=T.replace(/{{(.+?)}}/gs,(D,C)=>(C=C.trim(),d.has(C)||d.set(C,d.size),`{{${d.get(C)}}}`)),o.classList.add("view-markdown"),o.innerHTML=e.parse(T,{discoveryjs:{host:n,useAnchors:v,codes:h}}),d.size>0){let D=new Array(d.size);for(let[C,L]of d.entries())try{D[L]=n.query(C,u,f)}catch(N){n.logger.error("Interpolation query error in markdown:",N.message)}bv(o,D)}for(let D of o.querySelectorAll(".md-rendered-link"))D.getAttribute("href").startsWith("#")||D.setAttribute("target","_blank");let{sectionByHeaderEl:M,findSectionByEl:F}=h.length||w||x?CS(o):{sectionByHeaderEl:new Map,findSectionByEl:()=>null};{E=typeof E=="object"?{view:"source",...E}:E||"source";for(let D of[...o.querySelectorAll(".discoveryjs-code")]){let C=F(D),L=document.createDocumentFragment(),N=D.dataset.id,{syntax:B,source:O}=h[N];g.push(this.render(L,E,{syntax:B,source:O},{...f,section:C}).then(()=>D.replaceWith(L)))}}if(w||x){let D=(C,L,N)=>{let B=document.createDocumentFragment();g.push(this.render(B,C,u,{...f,section:L.data}).then(()=>N(B)))};for(let[C,L]of M)w&&D(w,L,N=>C.after(N)),x&&D(x,L,N=>L.next?L.next.before(N):o.append(N))}return Promise.all(g)}n.view.define("markdown",r,{props:yv,usage:Qc}),n.view.define("md",r,{props:yv,usage:Qc})}var ty=cn(Vv(),1),Br=cn(Cn(),1),TO=cn(Nc(),1),FO=cn(Yv(),1),LO=cn(Zv(),1);var Di=cn(Cn(),1);var Nr='let name = "world";\n\nconsole.log(`Hello, ${name}!`);',PS=Function("return num => num + 5")(),IS=Function('return () => alert("Hello world!")')();function jS(){let n=new Set,e=new Map,r=o=>{let a=Di.default.resolveMode(o),u=[...e.keys()].find(f=>vi(f,a));return u||(e.set(a,{name:new Set,mime:new Set}),a)};for(let[o,a]of Object.entries(Di.default.modeToMime)){let u=e.get(r(a));u.mime.add(a),u.name.add(o),n.add(o)}for(let[o,a]of Object.entries(Di.default.mimeModes)){let u=e.get(r(o));u.mime.add(o),typeof a=="string"&&(u.name.add(a),n.add(a))}for(let[o]of Object.entries(Di.default.modes))if(!n.has(o)){let a=Di.default.modes[o];e.has(a)||e.set(a,{name:new Set,mime:[]}),e.get(a).name.add(o)}return[...e.values()].map(o=>({name:[...o.name],mime:[...o.mime]}))}var Xv={demo:{view:"source",syntax:"js",source:Nr},examples:[{title:"Supported syntaxes",beforeDemo:['md:"Following values (for both `name` and `mime`) are supported for `syntax` option:"','html:"<br>"',{view:"table",data:jS,cols:{name:{content:"comma-list:name"},mime:{content:"comma-list:mime"}}},'html:"<br>"',"md:\"More syntaxes may be added via `import 'codemirror/mode/[name]/[name]';`\""],source:!1},{title:"Max content size for syntax highlight",highlightProps:["maxSourceSizeToHighlight"],beforeDemo:['md:"By default a syntax highlighing is not appling to a source longer than 250Kb. Option `maxSourceSizeToHighlight` is using to change max size of source to be syntax highlighted."'],demo:{view:"source",source:Nr,syntax:"js",maxSourceSizeToHighlight:4}},{title:"Custom line numbers",highlightProps:["lineNum"],demo:[{view:"source",source:Nr,syntax:"js",lineNum:PS},{view:"source",source:Nr,syntax:"js",lineNum:"==> $ + 12345"}]},{title:"Hide line numbers",highlightProps:["lineNum"],beforeDemo:['md:"Pass falsy value to `lineNum` option to hide line numbers:"'],demo:{view:"source",source:Nr,syntax:"js",lineNum:!1}},{title:"Customise copy source button",beforeDemo:['md:"By default, the `source` view includes a \\"copy to clipboard\\" button. To customize its behavior use the `actionCopySource` option, which accepts the following values:\\n- `true` (default) \u2013 displays a button that copies the entire source to the clipboard;\\n- A function `({ source, syntax, lineNum, refs, ... }) => string` \u2013 displays a button that calls the provided function on click to determine the text to copy;\\n- Anything else \u2013 hides the copy button, i.e. the button is not rendered."'],highlightProps:["actionCopySource"],demo:[{view:"source",actionCopySource:"==> source[0:10]",source:"// In this example, the copy button copies only the first 10 characters of the source"},{view:"source",actionCopySource:!1,source:"// This example demonstrates how to disable the default copy button"}]},{title:"Additional action buttons",highlightProps:["actionButtons"],demo:{view:"source",actionButtons:[{view:"button",content:'text:"Say \\"Hello world\\""',onClick:IS}],source:Nr,syntax:"js"}},{title:"Prelude and postlude slots",highlightProps:["prelude","postlude"],demo:{view:"source",prelude:['text:"Prelude:"',"struct:{ data: $, context: # }"],postlude:['text:"Postlude:"',"struct:{ data: $, context: # }"],source:Nr,syntax:"js"}},{title:"Highlight ranges",highlightProps:["ranges"],beforeDemo:{view:"md",source:["The `ranges` option (formerly `refs`) allows highlighting specific parts of the source text or turning them into links. The `ranges` value must be an array of objects with the following fields:",`
`,"- `range` (required) - an array of two numbers representing the start and end offsets of the span","- `className` - class name(s) for the wrapping element. This can be a string (a space-separated list of class names) or an array of strings. Predefined class names include `def`, `ref`, `global-ref`, and `error`, each specifying a particular style for the span.","- `href` - when specified, the range becomes a link (`<a>`), otherwise, the range is a regular span (`<span>`)","- `tooltip` - config for a [tooltip](#views-showcase&!anchor=tooltips), similar to tooltips in other views","- `marker` - a value added to the wrapping element as a `data-marker` attribute"]},demo:{view:"source",source:`let span = "def + ref + global-ref + error";
let link = "def + ref + global-ref + error";

// span with tooltip`,syntax:"js",ranges:[{range:[4,8]},{range:[12,15],className:"def"},{range:[18,21],className:"ref"},{range:[24,34],className:"global-ref"},{range:[37,42],className:"error"},{range:[49,53],href:"#"},{range:[57,60],href:"#",className:"def"},{range:[63,66],href:"#",className:"ref"},{range:[69,79],href:"#",className:"global-ref"},{range:[82,87],href:"#",className:"error"},{range:[104,111],href:"#example",tooltip:{position:"trigger",content:"text:`Link to ${href}`"}}]}},{title:"Marks",highlightProps:["marks"],beforeDemo:{view:"md",source:["The `marks` option allows injecting visual or text marks at specific points in the source text. The `marks` value must be an array of objects with the following fields:",`
`,"- `offset` (required) - the offset in the source where the mark is injected.","- `kind` - the type of mark, which can be one of the following: `span` (default), `dot`, `self` (self value), `nested` (nested value), `total` (total value), or `none`","- `className` - class name(s) for the wrapping element. This can be a string (a space-separated list of class names) or an array of strings. Predefined class names include `def`, `ref`, `global-ref`, `error`, and `inactive`, each specifying a particular style for the mark.","- `href` - when specified, the mark becomes a link (`<a>`), otherwise, it is a regular span (`<span>`)","- `content` - view config for content (e.g., `'text:\"hello\"'` or `{ view: 'name', ... }`). If not specified, `kind` is ignored and defaults to `dot` (since content is optional for marks of type `dot`)","- `prefix` (ignored when `kind` is `dot`) - text to display before the content of mark, styled with a dimmed color ","- `postfix` (ignored when `kind` is `dot`) - text to display after the content of mark, styled with a dimmed color","- `tooltip` - config for a [tooltip](#views-showcase&!anchor=tooltips), similar to tooltips in other views","- `marker` - a value added to the wrapping element as a `data-marker` attribute"]},demo:{view:"source",source:`let span = "def + ref + global-ref + error";
let link = "def + ref + global-ref + error";

// kinds: self nested total none
// kind="dot": default def ref global-ref error inactive
// kind="dot" with tooltip: 
// kind="dot" with href: 
// mark with tooltip`,syntax:"js",marks:[{offset:4},{offset:4,kind:"dot",content:'text:"dot with text"'},{offset:4,content:'text:"mark"'},{offset:12,className:"def",content:'text:"def"'},{offset:18,className:"ref",content:'text:"ref"'},{offset:24,className:"global-ref",content:'text:"global-ref"'},{offset:37,className:"error",content:'text:"error"'},{offset:49,href:"#"},{offset:49,href:"#",kind:"dot",content:'text:"dot with text"'},{offset:49,href:"#",content:'text:"link"'},{offset:57,href:"#",className:"def",content:'text:"def"'},{offset:63,href:"#",className:"ref",content:'text:"ref"'},{offset:69,href:"#",className:"global-ref",content:'text:"global-def"'},{offset:82,href:"#",className:"error",content:'text:"error"'},{offset:101,kind:"self",content:'text:"123"',href:"#",postfix:"ms"},{offset:106,kind:"nested",content:'text:"123"',postfix:"ms"},{offset:113,kind:"total",content:'text:"123"',postfix:"ms"},{offset:119,kind:"none",content:'text:"none"'},{offset:123,kind:"none",content:'text:"\u26A0\uFE0F"'},{offset:123,kind:"none",content:'text:"none"',prefix:"prefix",postfix:" postfix",href:"#test"},{offset:139,kind:"dot"},{offset:147,kind:"dot",className:"def"},{offset:151,kind:"dot",className:"ref"},{offset:155,kind:"dot",className:"global-ref"},{offset:166,kind:"dot",className:"error"},{offset:172,kind:"dot",className:"inactive"},...["","def","ref","global-ref","error","inactive"].map(n=>({offset:209,kind:"dot",className:n,tooltip:"text:"+JSON.stringify(n||"default")})),...["","def","ref","global-ref","error","inactive"].map(n=>({offset:235,kind:"dot",className:n,href:"#"+(n||"default")})),{offset:256,href:"#example",content:'text:"show tooltip"',tooltip:{position:"trigger",content:"text:`Link to ${href}`"}}]}}]};Br.default.modeToMime={js:"application/javascript",ts:"application/typescript",typescript:"application/typescript",json:"application/json",html:"text/html",css:"text/css",scss:"text/x-scss",less:"text/x-less"};function zS(n,e){let r=Br.default.getMode(Br.default.defaults,{name:Br.default.modeToMime[n]||n,isDiscoveryViewDefined:o=>e.view.isDefined(o)||e.textView.isDefined(o)});return(o,a)=>{let u=Br.default.startState(r),f=o.split(/(\n|\r\n?)/),d=0;for(let h=0;h<f.length;h++){if(h%2===0){let g=new Br.default.StringStream(f[h],4,{lookAhead:v=>f[h+v],baseToken:function(){}});for(;!g.eol();){let v=r.token(g,u);v&&a(d+g.start,d+g.pos,v),g.start=g.pos}}d+=f[h].length}}}function RS(n,e){let r=n&&n.className,o=Array.isArray(r)?r.join(" "):typeof r=="string"?r:!1,a=e&&o?[e,o].join(" "):e||o||"";return a?` class="${a}"`:""}function nf(n,e="spotlight"){return`${RS(n,e)}${n.marker?` data-marker="${n.marker}"`:""}${typeof n.tooltipId=="number"?` data-tooltip-id="${n.tooltipId}"`:""}`}function ey(n,e="mark"){let r=n.prefix??(["self","nested","total"].includes(n.kind)?n.kind[0].toUpperCase():void 0),o=n.postfix??void 0;return nf(n,e)+` data-render-id=${n.renderId}${n.kind?` data-kind="${n.kind}"`:""}${r!==void 0?` data-prefix="${Ue(r)}"`:""}${o!==void 0?` data-postfix="${Ue(o)}"`:""}`}var HS={html:{open({data:n}){switch(n.type){case"link":return`<a href=${JSON.stringify(n.href)}${nf(n,"spotlight")}>`;case"span":case"spotlight":return`<span${nf(n,"spotlight")}>`}},close({data:n}){switch(n.type){case"link":return"</a>";case"span":case"spotlight":return"</span>"}}}},qS={html:{open({data:n}){switch(n.type){case"link":return`<a href=${JSON.stringify(n.href)}${ey(n,"mark")}>`;case"span":return`<span${ey(n,"mark")}>`}},close({data:n}){switch(n.type){case"link":return"</a>";case"span":return"</span>"}}}},_S=`is not array? | {
    source: #.props has no 'source' ? is string ?: content is string ? content : source,
    syntax,
    lineNum is function ?: is not undefined ? bool() : true,
    ranges: #.props.refs or refs | is array ?: undefined,
    marks is array ?: null,
    maxSourceSizeToHighlight is number ?: 250 * 1024, // 250Kb
    actionButtons: undefined,
    actionCopySource is undefined ? true,
    prelude: undefined,
    postlude: undefined
} | overrideProps()`;function ny(n){n.view.define("source",async function(e,r,o,a){let u=e.appendChild($("div","view-source__prelude")),f=e.appendChild($("div","view-source__content")),d=e.appendChild($("div","view-source__postlude")),h=new Map,g=new Map,v=[],w=[],{source:x,syntax:T,lineNum:E=!0,ranges:M,marks:F,maxSourceSizeToHighlight:D,actionButtons:C,actionCopySource:L,prelude:N,postlude:B}=r,O=typeof o=="string"?{source:o}:o,z={...a,sourceViewProps:{source:x,syntax:T,lineNum:E,ranges:M,marks:F,maxSourceSizeToHighlight:D}};if(typeof x!="string")return;x.length<D&&w.push([zS(T,n),{html:{open({data:A}){return'<span class="token '+A+'">'},close(){return"</span>"}}}]),Array.isArray(M)&&w.push([(A,Q)=>M.forEach(U=>{if(!U||typeof U!="object"){n.logger.warn('Bad value for an entry in "source" view props.ranges, must be an object',{props:r,entry:U});return}let ce=U.type?U.type==="spotlight"?"span":U.type:U.href?"link":"span",xe=U.range,Le;if(!["link","span"].includes(ce)){n.logger.warn(`Bad type "${ce}" of an entry in "source" view props.ranges`,{props:r,ref:U});return}if(!xe){n.logger.warn('Missed range for an entry in "source" view props.ranges',{props:r,entry:U});return}U.tooltip&&h.set(Le=h.size,U),Q(U.range[0],U.range[1],{...U,type:ce,tooltipId:Le})}),HS]),Array.isArray(F)&&w.push([(A,Q)=>F.forEach(U=>{if(!U||typeof U!="object"){n.logger.warn('Bad value for an entry in "source" view props.mark, must be an object',{props:r,mark:U});return}let ce=U.content?!U.kind||["dot","self","nested","total","none"].includes(U.kind)?U.kind||"span":void 0:"dot",xe=typeof U.offset=="number"&&isFinite(U.offset)?Math.max(0,Math.round(U.offset)):void 0,Le;if(typeof ce!="string"){n.logger.warn('Bad "kind" value for an entry in "source" view props.marks',{props:r,mark:U});return}if(typeof xe!="number"){n.logger.warn('Bad "offset" value for an entry in "source" view props.marks',{props:r,mark:U});return}U.tooltip&&h.set(Le=h.size,U);let _e={...U,type:typeof U.href=="string"?"link":"span",kind:ce,renderId:g.size,tooltipId:Le};g.set(_e.renderId,_e),Q(xe,xe,_e)}),qS]);let _=typeof E=="function"?E:A=>A+1,W=E?'<div class="view-source__lines">'+x.split(/\r\n?|\n/g).map((A,Q)=>"<span>"+_(Q)+"</span>").join("")+"</div>":"";if(f.innerHTML=W+`<div class="view-source__source">${(0,ty.default)(w,"html")(x)}</div>`,g.size)for(let A of f.querySelectorAll(".mark[data-render-id]")){let Q=g.get(Number(A.dataset.renderId));Q.content&&v.push(this.render(A,Q.content,Q,z))}let te=$("div","view-source__action-buttons"),H=L!==!0?typeof L=="function"?L:null:({source:A})=>A,X=typeof H=="function"?{view:"button",className:"copy",content:[],async onClick(A){clearTimeout(A.copiedTimer),await _t(String(H(z.sourceViewProps))),A.classList.add("copied"),A.copiedTimer=setTimeout(()=>A.classList.remove("copied"),1250)}}:null;f.prepend(te),await n.view.render(te,[C,X],O,z);for(let A of f.querySelectorAll(":scope [data-tooltip-id]")){let Q=h.get(Number(A.dataset.tooltipId));delete A.dataset.tooltipId,this.tooltip(A,Q.tooltip,Q,a)}N&&await n.view.render(u,N,O,z),B&&await n.view.render(d,B,O,z),v.length&&await Promise.all(v)},{props:_S,usage:Xv,tag:"pre"})}var ry={demo:{view:"text",data:'"Hello world!"'},examples:[{title:"Shorthand usage",view:'text:"Hello world!"'}]};var WS=`{
    text: #.props has no 'text'?
} | overrideProps()`;function iy(n){n.view.define("text",function(e,{text:r}){e.appendChild(document.createTextNode(String(r)))},{tag:!1,props:WS,usage:ry})}var oy={demo:{view:"text-match",data:{text:"I am matched text or a text with matches!",match:/match/}},examples:[{title:"Raw string as match",demo:{view:"text-match",data:{text:"I am matched text or a text with matches!",match:"match"}}},{title:"Using with a link",demo:{view:"link",data:{href:"#"},content:'text-match:{ text: "Test link", match: /\\w+/i }'}},{title:"Various configurations",demo:{view:"table",cols:[{header:"text-match",content:"text-match"},{header:"Config",content:"struct"}],data:[null,{},{},{match:"test"},{match:"Test"},{match:"test",ignoreCase:!0},{match:"Test",ignoreCase:!0},{match:/test/},{match:/test/g},{match:/test/i},{match:/test/,ignoreCase:!0},{match:/test/g,ignoreCase:!0}].map((n,e)=>e>1?{text:"test Test",...n}:n)}}]};var $S=$("span","view-text-match"),US=`is not array? | {
    text: #.props has no 'text' ? text,
    match,
    ignoreCase: ignoreCase or false
} | overrideProps()`;function sy(n){n.view.define("text-match",function(e,r){let{text:o,match:a,ignoreCase:u}=r;rr(String(o),a,f=>e.append(f),f=>e.appendChild($S.cloneNode()).append(f),u)},{tag:!1,props:US,usage:oy})}var ay={demo:{view:"text-numeric",data:'"Like a `text` view but adds a thousands separator to integer part of numbers, e.g. 12345678 or 12345.67890"'},examples:[{title:"Shorthand usage",view:"text-numeric:1234567"}]};var VS=`{
    text: #.props has no 'text'?
} | overrideProps()`;function ly(n){n.view.define("text-numeric",function(e,{text:r}){e.innerHTML=xt(r)},{tag:"span",props:VS,usage:ay})}var uy={beforeDemo:['md:"A non-visual view used to group views, manage their visibility, or explicitly define data and context for nested views. In the example, the `context` view sets up specific data and context, allowing nested views (`content`) to utilize these shared definitions directly:"'],demo:{view:"context",data:{name:"World",age:"1000 years"},context:'{ ...#, greeting: "Hello" }',content:["text:`${#.greeting}, ${name}!`","table"]},examples:[{title:"Using with modifiers",demo:{view:"context",modifiers:['h2:"Modifiers"',{view:"input",name:"inputValue"},{view:"select",name:"selectValue",data:["foo","bar","baz"]}],content:['h2:"Values"',"struct{ expanded: 1, data: # }"]}}]};var GS=`#.props | {
    modifiers is array ?: is truthy ? [$] : [],
    content,
    proxy.bool(),
    onInit,
    onChange
}`;function cy(n){n.view.define("context",async function(e,r,o,a){let{modifiers:u=[],content:f=[],proxy:d,onInit:h,onChange:g}=r,v=a,w=null,x=!1;await this.render(e,this.composeConfig(u,{onInit:F,onChange:F}),o,a);let T=e.appendChild(document.createComment('{ view: "context" } content start')),E=e.appendChild(document.createComment('{ view: "context" } content end'));d&&(h||g)&&(f=this.composeConfig(f,{onInit:h,onChange:g})),x=!0,await M();async function M(){let D=E.previousSibling;for(;D&&D!==T;)D=D.previousSibling,D.nextSibling.remove();let C=w=document.createDocumentFragment();await n.view.render(C,f,o,v),C===w&&(n.view.adoptFragment(C,T),T.after(C),w=null)}function F(D,C){C&&(!ye(v,C)||v[C]!==D)&&(v={...v,[C]:D},x?(M(),d&&typeof g=="function"&&g(D,C)):typeof h=="function"&&h(D,C))}},{tag:!1,props:GS,usage:uy})}var fy={beforeDemo:['md:"A non-visual view that conditionally renders a single matching section from the provided content. It sequentially evaluates each item\'s `when` expression and renders the content of the first truthy condition. If an item has no `when` property, its condition defaults to truthy, enabling unconditional rendering, often used as a fallback or default content."'],demo:{view:"switch",content:[{when:"expr",content:'text:"Renders when `expr` is truthy"'},{content:'text:"Renders when all other `when` conditions are falsy"'}]},examples:[{title:"Using with context and a modifier",demo:{view:"context",modifiers:{view:"tabs",tabs:["foo","bar","baz"],name:"section"},content:{view:"switch",content:[{when:'#.section="foo"',content:'text:"Content for `foo`"'},{when:'#.section="bar"',content:'text:"Content for `bar`"'},{content:'text:"No content is found for `" + #.section + "`"'}]}}}]};function dy(n){n.view.define("switch",function(e,r,o,a){let{content:u}=r,f='alert-warning:"No case choosen"';if(Array.isArray(u))for(let d=0;d<u.length;d++){let h=u[d];if(h&&n.queryBool(h.when||!0,o,a)){f="data"in h?{view:"context",data:h.data,content:h.content}:h.content;break}}return n.view.render(e,f,o,a)},{tag:!1,usage:fy})}var py={beforeDemo:['md:"The `text-render` view renders data as text using the `Model#textView` API. For a full list of available text views, refer to the [`text`](#views-showcase&render=text) section."'],demo:{view:"text-render",content:['text:"hello!"',{view:"ul",data:[1,2,3,4],item:'text:"item #" + $'},{view:"table",data:[{name:"foo",size:1e3},{name:"bar",size:123},{name:"baz",size:34555}]}]}};function hy(n){n.view.define("text-render",async function(e,r,o,a){let{content:u}=r,f=await n.textView.render("block",u,o,a);e.append(n.textView.serialize(f).text)},{tag:"pre",usage:py}),n.view.define("text-render-tree",async function(e,r,o,a){let{content:u,expanded:f=2}=r,d=await n.textView.render("block",u,o,a);return this.render(e,{view:"struct",expanded:f},n.textView.cleanUpRenderTree(d))},{tag:!1})}function rf(n,e,r){for(let o in n){if(!ye(n,o))continue;let a;r.dictMode?(a=r.dictMode,a.count++,a.keys.add(o)):r.properties.has(o)?(a=r.properties.get(o),a.count++):(a={count:1,map:Object.create(null)},r.properties.set(o,a)),Ai(n[o],e-1,a.map)}}function Ai(n,e,r=Object.create(null)){let o=n===null?"null":zt(n)?"array":kn(n)?"set":typeof n;switch(o){default:o in r||(r[o]=new Map),r[o].set(n,(r[o].get(n)||0)+1);break;case"object":"object"in r||(r.object=new Map,r.object.count=0,r.object.properties=e?new Map:null,r.object.dictMode=null,r.object.sortKeys=!1),r.object.count++,r.object.has(n)?r.object.set(n,r.object.get(n)+1):(r.object.set(n,1),e&&rf(n,e,r.object));break;case"array":"array"in r||(r.array=new Map,r.array.count=0,r.array.map=Object.create(null)),r.array.count++,r.array.set(n,(r.array.get(n)||0)+1);for(let a=0;a<n.length;a++)Ai(n[a],e,r.array.map);break;case"set":"set"in r||(r.set=new Map,r.set.count++,r.set.map=Object.create(null)),r.set.count++,r.set.set(n,(r.set.get(n)||0)+1);for(let a of n)Ai(a,e,r.set.map);break}return r}var Pa=["rgba(83,211,75,0.75)","rgba(241,235,44,0.75)","rgba(244,152,99,0.75)","rgba(148,99,244,0.75)","rgba(44,132,241,0.75)","rgba(233,117,117,0.75)","rgba(85,187,155,0.75)","rgba(151,147,99,0.75)","rgba(216,107,196,0.75)","rgba(108,204,227,0.75)","rgba(164,164,164,0.75)"],Yo=["null","undefined","string","number","bigint","boolean","symbol","function","array","set","object"];function Si(n,e,r,o,a=[],u="",f=null){Object.keys(e).sort((d,h)=>Yo.indexOf(d)-Yo.indexOf(h)).forEach((d,h,g)=>{switch(h>0&&n.append(" | "),d){default:{let v=n.appendChild($("span","type",d));r.set(v,{type:"type",context:o,path:a,stat:e,name:d});break}case"object":{let v=e[d],{properties:w,dictMode:x,sortKeys:T}=v;if(w===null){r.set(n.appendChild($("span","expand","{\u2026}")),{type:"expand",context:o,path:a,stat:e,map:e[d],offset:u});break}if(w.size===0){n.appendChild($("span","object","{}"));break}let E=v.size,M=x?[["[key]",x]]:[...w.entries()],F=u+"    ",D=n.appendChild($("span","object",["{",$("span",{"data-action":"collapse"})])),C=$("div",{class:"object-entries",style:`--object-entries-offset: ${u.length}`});w.size>1&&(D.appendChild($("span",{title:"Toggle dictionary mode (collapse all the values in a single signature)","data-action":"dict-mode","data-enabled":x!==null})),M.some(([L],N)=>N!==0&&L<M[N-1][0])&&D.appendChild($("span",{title:"Toggle keys sorting","data-action":"sort-keys","data-enabled":T})),T&&M.sort(([L],[N])=>L<N?-1:L>N?1:0)),r.set(D,{type:"shape",context:o,path:a,map:e[d],offset:u}),(E>1||g.length>1||f!==null&&Object.keys(f).length>1)&&(D.appendChild($("span","count")).dataset.value=String(E));for(let[L,{count:N,map:B}]of M){let O=$("span","property",[L]);r.set(O,{type:"property",context:o,path:a,stat:e,name:L,map:B}),C.append(F),C.append(O),N!==E&&x===null&&O.append($("span","optional","?")),C.append(": "),Si(C,B,r,o,a.concat(x?"*":L),F),C.append(`;
`)}D.append(C),D.append(u,"}");break}case"array":n.append("["),Si(n,e[d].map,r,o,a,u),n.append("]");break;case"set":n.append("Set("),Si(n,e[d].map,r,o,a,u),n.append(")");break}})}function Ei(n,e){return n.toFixed(e).replace(/\.?0+$/,"")}function gy(n){let e=Math.cos(2*Math.PI*n),r=Math.sin(2*Math.PI*n);return[e,r]}function my(n){let e=0;return['<svg viewBox="-1 -1 2 2" class="pie">',...n.map(r=>{let[o,a]=gy(e),[u,f]=gy(e+=r.percent),d=r.percent>.5?1:0;return`<path d="${[`M ${o} ${a}`,`A 1 1 0 ${d} 1 ${u} ${f}`,"L 0 0"].join(" ")}" fill="${r.color}" stroke="black" stroke-width=".0025"/>`}),"</svg>"].join(`
`)}function KS(n){let e=0;for(let r in n)n[r].forEach(o=>e+=o);return e}function YS(n){let e=Object.create(null);for(let r in n)e[r]=0,n[r].forEach(o=>e[r]+=o);return e}function vy(n,e,r){let{context:o,path:a,stat:u,name:f}=e,d=u.object,{map:h,count:g}=d.dictMode||d.properties.get(f),v=d.dictMode?d.dictMode.count:d.size,w={name:f,path:r.pathToQuery(a),total:v,count:g,percent:Ei(100*g/v,1)+"%"};r.view.render(n,[{view:"block",when:"path",className:"path",content:"text:path"},{view:"h1",className:"property",content:["text:name",{view:"html",when:"count != total",data:`"<span class=\\"usage-stat optional\\">" + (
                        "(in <span class=\\"num\\">" + count + "</span> of <span class=\\"num\\">" + total + "</span> objects, <span class=\\"num\\">" + percent + "</span>)"
                    ) + "</span>"`}]}],w,o),yy(n,{context:o,map:h,count:g},r)}function yy(n,{context:e,map:r,count:o},a){let u=YS(r),f=[],d=Yo.filter(h=>h in r);Object.entries(u).sort(([,h],[,g])=>g-h).forEach(([h,g],v)=>{f.push({name:Ue(h),count:g,percent:g/o,percent100:Ei(100*g/o,1),color:Pa[v]})}),a.view.render(n,{view:"block",when:"typeStat.size() > 1",data:"typeStat",className:"pie-stat",content:[{view:"block",content:{view:"html",data:my}},{view:"block",content:['html:"<span class=\\"list-header\\">Types usage:</span>"',{view:"list",item:`html:
                            "<span class=\\"dot\\" style=\\"--size: 10px; background-color: " + color + "\\"></span> " +
                            "<span class=\\"caption\\">" + name + "</span>" +
                            "<span class=\\"times\\"> \xD7 " + count + " (" + percent100 + "%)</span>"
                        `}]}]},f,e),d.forEach(h=>of(n,{context:e,name:h,stat:r},a))}function of(n,e,r){let o=e.context,a=e.stat[e.name],u=KS(e.stat),f=[],d=[],h;switch(e.name){case"number":{let g=[],v=0,w=0,x=0,T=1/0,E=-1/0;a.forEach((M,F)=>{g.push({count:M,value:F}),v+=F*M,w+=M,M>1&&x++,F<T&&(T=F),F>E&&(E=F)}),h={type:e.name,count:w,distinct:a.size,duplicated:x,min:T,max:E,sum:v,avg:Ei(v/w,3),values:g.sort((M,F)=>F.count-M.count||M.value-F.value)},h.distinct>1&&f.push({view:"block",className:"overview-stat",content:`html:
                        "range: (min) <span class=\\"num\\">" + min + "</span> ... " +
                        "<span class=\\"num\\">" + max + "</span> (max), " +
                        "avg: <span class=\\"num\\">" + avg + "</span>"
                    `});break}default:{let g=[],v=0,w=0;a.forEach((x,T)=>{g.push({count:x,value:T}),v+=x,x>1&&w++}),h={type:e.name,count:v,distinct:a.size,duplicated:w,values:e.name==="object"||e.name==="array"||e.name==="set"?g.sort((x,T)=>T.count-x.count):g.sort((x,T)=>T.count-x.count||x.value>T.value||-(x.value<T.value))};break}}if(e.name!=="undefined"&&e.name!=="null"){if(f.unshift({view:"block",className:"overview-stat",content:['html:"<span class=\\"num\\">" + count + "</span> " + (count > 1 ? "values, " : "value")',{view:"switch",when:"count > 1",content:[{when:"distinct = 1",content:'text:"a single unique value:"'},{when:"distinct = count",content:'text:"all unique, no duplicates"'},{content:['html:"<span class=\\"num\\">" + distinct + "</span> unique, "','html:duplicated = distinct ? "all occur more than once" : "<span class=\\"num\\">" + duplicated + "</span> occur more than once"']}]}]}),h.values.length>1&&h.duplicated&&e.name!=="object"&&e.name!=="set"&&e.name!=="array"){let g=[],v=h.values.length===10?10:Math.min(9,h.values.length),w=0;for(let x=0;x<v;x++){let{count:T,value:E}=h.values[x];w+=T,g.push({name:Ue(String(E)),count:T,percent:T/h.count,percent100:Ei(100*T/h.count,1),color:Pa[x]})}if(g.length){let x=h.count-w;x>0&&g.push({name:"...",count:x,percent:x/h.count,percent100:Ei(100*x/h.count,1),color:Pa[g.length]}),d.push({view:"button",className:"group",when:"#.actions | queryAcceptChanges and querySubquery",onClick(T,E,M){let F=E.path?[...E.path]:[],D=F.pop(),C=r.pathToQuery(F),L=M.rootData;M.actions.queryAcceptChanges(L)&&M.actions.querySubquery(`${C}${C?".group(":"group("}=>${r.pathToQuery([D])}).sort(value.size() desc)`,L)}}),f.push({view:"block",className:"pie-stat",data:g,content:[{view:"block",content:{view:"html",data:my}},{view:"block",content:['html:"<span class=\\"list-header\\">Dominators:</span>"',{view:"list",item:`html:
                                        "<span class=\\"dot\\" style=\\"--size: 10px; background-color: " + color + "\\"></span> " +
                                        "<span class=\\"caption\\" title=\\"" + name + "\\">" + name + "</span>" +
                                        "<span class=\\"times\\"> \xD7 " + count + " (" + percent100 + "%)</span>"
                                    `}]}]})}}h.values.length>1?(e.name==="number"||e.name==="string")&&f.push({view:"content-filter",name:"filter",data:"values.sort(value ascN)",content:{view:e.name==="string"?"list":"menu",className:"struct-list",data:".[no #.filter or value~=#.filter]",emptyText:"Nothing matched",item:[e.name==="string"?{view:"struct",data:"value",match:"=#.filter"}:{view:"block",className:"caption",content:"text-match:{ text: value, match: #.filter }"},{view:"block",when:"count > 1",className:"count",content:'text:" \xD7 " + count'}]}}):(e.name==="number"||e.name==="string"||e.name==="boolean")&&f.push({view:"struct",data:"values[].value"}),e.name==="object"&&f.push({view:"list",className:"struct-list",data:"values",item:["struct:value",{view:"block",when:"count > 1",className:"count",content:'text:" \xD7 " + count'}]}),(e.name==="array"||e.name==="set")&&Object.keys(a.map).length&&f.push({view:"block",className:e.name==="array"?"array-types":"set-types",postRender(g){yy(g,{...a,context:o},r)}})}r.view.render(n,[{view:"block",when:"path",className:"path",data:g=>r.pathToQuery(g.path),content:"text"},{view:"block",className:"signature-action-buttons",content:d},{view:"h1",className:"type",content:["text:name",`html:"<span class=\\"usage-stat\\">" + (
                    count = total
                        ? "only this type is used"
                        : "used in <span class=\\"num\\">" + count + "</span> of <span class=\\"num\\">" + total + "</span> cases (<span class=\\"num\\">" + percent + "</span>)"
                ) + "</span>"`]},...f],{...h,name:e.name,path:e.path,total:u,percent:Ei(100*h.count/u,1)+"%"},o)}var by={beforeDemo:['md:"The `signature` view is used to output a type definition for current data using TypeScript like style:"'],demo:{view:"signature",expanded:!0}};function wy(n){let e=new WeakMap,r=({target:o})=>{let a="expand",u=o.closest(`
            .view-signature .expand,
            .view-signature [data-action]
        `);if(!u)return;u.dataset.action&&(a=u.dataset.action,u=u.parentNode);let f=e.get(u);if(f){let{context:d,path:h,stat:g,map:v,offset:w}=f,x=document.createDocumentFragment();switch(a){case"sort-keys":v.sortKeys=!v.sortKeys;break;case"dict-mode":if(v.dictMode)v.dictMode=null;else{let T=v.dictMode={keys:new Set,count:0,map:Object.create(null)};v.forEach((E,M)=>{for(let F in M)ye(M,F)&&(T.keys.add(F),T.count++,Ai(M[F],1,T.map))})}break;default:v.properties===null?(v.properties=new Map,v.forEach((T,E)=>rf(E,1,v))):v.properties=null}Si(x,{object:v},e,d,h,w,g),u.replaceWith(x)}};n.addHostElEventListener("click",r,!1),new n.view.Popup({className:"signature-details",hoverPin:"trigger-click",hoverTriggers:`
            .view-signature .property,
            .view-signature .type
        `,render(o,a){let u=e.get(a);switch(u.type){case"property":return vy(o,u,n);case"type":return of(o,u,n)}}}),n.view.define("signature",function(o,a,u,f){let{expanded:d,path:h}=a,g=Ai(u,d),v=Array.isArray(h)?h:void 0,w="rootData"in a?a.rootData:!v||v.length===0?u:void 0;Si(o,g,e,{...f,rootData:w},v)},{usage:by})}var QS=/^(?:https?:)?\/\/(?:[a-z0-9\-]+(?:\.[a-z0-9\-]+)+|\d+(?:\.\d+){3})(?:\:\d+)?(?:\/\S*?)?$/i;function Wt(n,e){return`<span class="${n}">${e}</span>`}function sf(n){return Wt("more",`\u2026 ${xt(n)} more`)}function Ti(n){return Ue(Fi(n))}function Fi(n){return/[^\x20\x21\x23-\x5B\x5D-\uD799]/.test(n)?JSON.stringify(n).slice(1,-1):n}function Or(n,e,r){switch(typeof n){case"boolean":case"undefined":return Wt("keyword",String(n));case"number":case"bigint":return Wt("number",xt(n));case"symbol":return Wt("symbol",String(n));case"function":return"\u0192n";case"string":{let o=n.length,a=e?r.maxCompactStringLength:r.maxStringLength,u=o>a+r.allowedExcessStringLength,f="",d="",h="";if(u){if(r.match){let g=[],v=a>30?10:5,w=a-v,x=0,T=-1;if(rr(n,r.match,E=>{x+=E.length},(E,M)=>{if(T===-1&&(T=x+w),x<T&&g.push({start:x,end:x+E.length}),x+=E.length,x>T)return M}),g.length>0){let E=g[0].start,M=a;if(E!==0){let F=Fi(n.slice(0,E));if(E>v){let C=v-2;d=Wt("more prefix",""),f=F.slice(-C),M-=v}else f=F}for(let F=0;F<g.length&&M>0;F++){let{start:D,end:C}=g[F],L=Math.min(C-D,M);if(f+=Wt("match",Ti(n.slice(D,D+L))),M-=L,M>0){let N=F+1>=g.length,B=N?n.length:g[F+1].start,O=Math.min(B-C,M);if(N){let z=n.length-(C+O);z>0&&(h=Wt("more suffix",xt(z)))}O>0&&(f+=Ti(n.slice(C,C+O)),M-=O)}}}}f===""&&(f=Ti(n.slice(0,a)),h=Wt("more suffix",xt(o-a)))}else r.match?rr(n,r.match,g=>{f+=Ti(g)},g=>{f+=Wt("match",Ti(g))}):f=Ti(n);return Wt("string",!e&&(n[0]==="h"||n[0]==="/")&&QS.test(n)?`"${d}<a href="${Ue(n)}" target="_blank">${f}</a>${h}"`:`"${d}${f}${h}"`)}case"object":{if(n===null)return Wt("keyword","null");if(zt(n)){let f=n.length,d=r.limitCollapsed===!1||r.limitCollapsed>f?f:r.limitCollapsed,h=Array.from({length:d},(g,v)=>Or(n[v],!0,r));return f>d&&h.push(`${sf(f-d)} `),`[${h.join(", ")}]`}switch(pn(n)){case"[object Set]":{let f=n.size,d=r.limitCollapsed===!1||r.limitCollapsed>f?f:r.limitCollapsed,h=n.values(),g=Array.from({length:d},()=>Or(h.next().value,!0,r));return f>d&&g.push(`${sf(f-d)} `),`[${g.join(", ")}]`}case"[object Date]":return Wt("date",String(n));case"[object RegExp]":return Wt("regexp",String(n))}if(e&&r.limitCompactObjectEntries===0){for(let f in n)if(ye(n,f))return"{\u2026}";return"{}"}let o=e?r.limitCompactObjectEntries===!1?1/0:r.limitCompactObjectEntries:r.limitCollapsed===!1?1/0:r.limitCollapsed,a=[],u=0;for(let f in n)if(ye(n,f)){if(u<o){let d=Ue(f.length>r.maxCompactPropertyLength?f.slice(0,r.maxCompactPropertyLength)+"\u2026":f);a.push(`${Wt("property",d)}: ${Or(n[f],!0,r)}`)}u++}return u>o&&a.push(sf(u-o)),a.length?`{ ${a.join(", ")} }`:"{}"}default:return`unknown type "${typeof n}"`}}var xy=(n,e,r,o,a,u,f)=>({target:d})=>{let h="expand",g=d.closest(`
        .view-struct.struct-expand,
        .view-struct .struct-expand-value,
        .view-struct .struct-action-button
    `);if(g)switch(g.dataset.action&&(h=g.dataset.action),h){case"expand":g.classList.contains("struct-expand")&&(g=g.lastChild),n(g,0),r(),g.parentNode.classList.add("struct-expanded-value"),a.has(g.parentNode)&&g.parentNode.classList.remove("struct-expand");break;case"collapse":g=g.parentNode,e(g),r(),g.parentNode.classList.remove("struct-expanded-value"),g.classList.remove("view-as-table"),a.has(g.parentNode)&&g.parentNode.classList.add("struct-expand");break;case"show-signature":f.show(g);break;case"value-actions":u.show(g);break;case"toggle-sort-keys":n(g.parentNode,0,g.parentNode.classList.toggle("sort-keys")),r();break;case"toggle-string-mode":{g=g.parentNode;let v=g.classList.toggle("string-value-as-text");for(let w=g.querySelector(".string-text").firstChild;w!==null;w=w.nextSibling){let x=w.nodeType===3?w:w.firstChild,T=x.nodeValue;if(v)T.indexOf("\\")!==-1&&(x.nodeValue=JSON.parse(`"${T}"`));else{let E=Fi(T);E!==T&&(x.nodeValue=E)}}break}case"toggle-view-as-table":g=g.parentNode,g.classList.toggle("view-as-table")?o(g):g.querySelector(":scope > .view-table")?.remove();break}};function ky(n){return n?", "+xt(n)+" bytes":""}function JS(n){for(;n.parent!==null;)n=n.parent;return n.host[""]}function Cy(n,e,r,o){return new n.view.Popup({className:"view-struct-actions-popup",render(a,u,f){let d=u.parentNode,h=e.get(d),g=[];if(typeof h=="string")g=[{text:"Copy as quoted string",action:()=>_t(JSON.stringify(h))},{text:"Copy as unquoted string",action:()=>_t(JSON.stringify(h).slice(1,-1))},{text:"Copy a value (unescaped)",action:()=>_t(h)}];else{let v=n.pathToQuery(o(d)),w=1024*1024*1024,x=!1,T=!1,E=0,M=0;try{let{bytes:F,spaceBytes:D,circular:C}=xo(h,{space:4});C.length?(x="Converting circular structure to JSON",T="Converting circular structure to JSON"):(E=F-D,M=F+2,E>w&&(T="Resulting JSON is over 1 Gb"),M>w&&(x="Resulting JSON is over 1 Gb"))}catch(F){T=x=/Maximum call stack size|too much recursion/i.test(F.message)?"Too much nested structure":F.message}if(T&&(T="Can't be copied: "+T),x&&(x="Can't be copied: "+x),v){g.push({text:"Copy path:",notes:Ue(v),action:()=>_t(v)});let F=r.get(d),D=JS(F);n.action.has("queryAcceptChanges")&&n.action.call("queryAcceptChanges",D)&&(n.action.has("querySubquery")&&g.push({groupStart:!0,text:"Create a subquery from the path",action:()=>n.action.call("querySubquery",v,D)}),n.action.has("queryAppend")&&g.push({text:"Append path to current query",action:()=>n.action.call("queryAppend",v,D)}))}g.push({groupStart:!0,text:"Copy as JSON",notes:`(formatted${ky(M)})`,error:x,disabled:!!x,action:()=>_t(JSON.stringify(h,null,4))}),g.push({text:"Copy as JSON",notes:`(compact${ky(E)})`,error:T,disabled:!!T,action:()=>_t(JSON.stringify(h))})}n.view.render(a,{view:"menu",onClick(v){f(),v.action()},itemConfig:{className:'=groupStart ? "group-start" : null'},item:["html:text",{view:"block",when:"notes",className:"notes",content:"html:notes"},{view:"block",when:"error",className:"error",content:"text:error"}]},g)}})}var ZS=["none","default","badge"],Dy=new WeakMap;function af(n,e){return Array.isArray(n)?Array.isArray(e)?n.concat(e):n:e}function Ia(n){return Array.isArray(n)&&n.length>0?n.map(e=>typeof e=="string"||typeof e=="function"?{query:e}:e):!1}function Ay(n){return Ia([...n.objectMarkers.values].map(({name:e,lookup:r})=>(o,a)=>{let u=r(o,!0);if(u!==null&&u.object!==a.host)return{place:"before",style:"badge",text:e,href:u.href}}))}function Sy(n,e){return af(e,Ia(n))}function XS(n){return ZS.includes(n)}function Ey(n){let e=Date.now()+8,r=0;for(;r<n.length&&!(Date.now()>e);r++){let{el:o,config:a,renderer:u,data:f,context:d}=n[r],{place:h="after",className:g,text:v,icon:w,href:x,external:T,tooltip:E}=a,M=XS(a.style)?a.style:h==="before"?"none":"default",F=v===void 0?typeof a!="object"?String(a):"":String(v),D=F!=="",C=["value-annotation","style-"+M,h==="before"?"before":"after",D?"has-text":"",g||""].join(" "),L=$(x?"a":"span",{class:C,href:typeof x=="string"?x:void 0,target:T?"_blank":void 0});if(D&&(/\d{4}/.test(F)?L.innerHTML=xt(F):L.append(F)),typeof w=="string"&&(L.classList.add("icon"),/^[a-z_$][a-z0-9_$-]*$/i.test(w)?L.classList.add("icon-"+w):L.style.setProperty("--annotation-image",`url("${w}")`)),E&&u.tooltip(L,E,f,{...d,config:a}),h==="before")o.before(L);else{let N=o.parentNode,B=Dy.get(o);B===void 0&&(Dy.set(o,B=$("span","value-annotations")),N.classList.contains("struct-expanded-value")?o.querySelector(":scope > .value-size, :scope > .string-length")?.after(B):N.append(B)),B.append(L)}}n.splice(0,r)}var Ty={level_1:{level_2_1:{level_3_1:{level_4_1:{}},level_3_2:2,level_3_3:3,level_3_4:4,level_3_5:5,level_3_6:6},level_2_2:[{foo:1,bar:2},{foo:3}],level_2_3:3,level_2_4:4,level_2_5:5,level_2_6:6},level_1_2:2,level_1_3:3,level_1_4:4,level_1_5:5,level_1_6:6,level_1_7:7},Fy={beforeDemo:['md:"View to display the structure of any value. This is the simplest yet powerful way to enable data exploration."'],demo:{view:"struct",data:{foo:"bar",baz:[1,2,3]}},examples:[{title:"Default expanded depth",highlightProps:["expanded"],beforeDemo:['md:"By default `struct` view is collapsed in one line. The `expanded` option is using to specify an initial expanded depth. A value for the option can be a boolean (`false` \u2192 `0`, `true` \u2192 `1`) or a positive number."'],demoData:Ty,demo:['badge:"Default (expanded option is not used)"',{view:"struct"},'badge:"expanded = true"',{view:"struct",expanded:!0},'badge:"expanded = 2"',{view:"struct",expanded:2}]},{title:"Annotations",highlightProps:["annotations"],beforeDemo:[{view:"md",source:["Clarity of data can be improved by adding annotations. An annotation is special marker before or after a value which displaying for expanded objects and arrays only.","Any number of annotations can be applied to a single value.","","Annotations are adding with `annotations` option which should contain an array of strings (jora queries) and functions to compute an annotation config. An annotation config is an object with following fields:","```ts","type AnnotationConfig = {",'   place?: "before" | "after"; // the placement of an annotation, "after" is by default','   style?: "none" | "badge" | "default"; // appereance of annotation, "default" is by default',"   className?: string;         // a class to add to an annotation element","   text?: any;                 // text content of an annotation element","   icon?: string;              // name of icon or url to an image","   href?: string;              // annotation is a link and that's an URL","   external?: boolean;         // open a link in new tab, make sence when `href` is specified only","   tooltip?: TooltipConfig;    // configuration for a tooltip, the same as for any view","}","```","",'An annotation is not displayed (not rendered) when computed annotation config is a falsy value. Any other value (truthy, but not an object) is used as value for `text` option, i.e. `"example"` is the same as `{ text: "example" }`.',"","In addition to a string or function, an object can be used as an element of `annotations` array","* `query` \u2013 a string (jora query) or a function to compute an annotation config","* `debug` (optional) - when truthy a debug information is output to the console; when value is a string, it's used in debug message"]}],demoData:{items:[{id:1,value:"example"},{id:2,value:"bar"},{id:3,value:"baz"}],"annotation styles":["none","default","badge"]},demo:{view:"struct",expanded:3,annotations:['#.key = "items" ? { place: "before", style: "badge", text: "view as table", tooltip: "table" } : null',`$ ~= /az/ and "Value has 'az' substring!"`,'$ in ["none", "default", "badge"] and { style: $, place: "before", text: $ + " before" }','$ in ["none", "default", "badge"] and { style: $, text: $ + " after" }']}},{title:"Limit number of array elements and object entries",beforeDemo:{view:"md",source:["The following options define the maximum number of elements in array or entries in object:","* `limit` (default: `50`) \u2013 max number of elements/entries for expanded array/object","* `limitCollapsed` (default: `4`) \u2013 max of elements/entries for collapsed array/object","* `limitCompactObjectEntries` (default: `0`) \u2013 max number of entries in a object which appears in a collapsed array or object","","> Use `false` for any of these options to disable a limitation"]},highlightProps:["limit","limitCollapsed","limitCompactObjectEntries"],demoData:Ty,demo:{view:"struct",limit:4,limitCollapsed:1,expanded:2}},{title:"Maximum length for strings",beforeDemo:{view:"md",source:["The following options define the maximum string length in various cases:","* `maxStringLength` (default: `150`) \u2013 max string length when a host value is expanded","* `maxCompactStringLength` (default: `40`) \u2013 max of string length when a host value is collapsed",'* `allowedExcessStringLength` (default: `10`) \u2013 allowed excess in length before a string will be cut and \\"N more\\" label will be added',"* `maxPropertyLength` (default: `Infinity`) \u2013 max of property name length","* `maxCompactPropertyLength` (default: `35`) \u2013 max of property name length in collapsed objects","","> Expand and collapse `level2` branch to see difference in a value presentation"]},highlightProps:["maxStringLength","maxCompactStringLength","allowedExcessStringLength","maxPropertyLength","maxCompactPropertyLength"],demo:{view:"struct",maxStringLength:30,maxCompactStringLength:10,allowedExcessStringLength:5,maxPropertyLength:30,maxCompactPropertyLength:15,expanded:1},demoData:{stringsInExpandedObject:"Quite a long string value Quite a long string value",string_34_chars:"String with 34 chars length demo x",string_35_chars:"String with 35 chars length demo xx",string_36_chars:"String with 36 chars length demo xxx",very_very_very_very_very_very_very_very_very_very_long_property_name:"a property name should be truncated due to settings, but will not be by default",level2:{stringsInCollapsedObject:"Quite a long string value Quite a long string value",string_14_chars:"Short string x",string_15_chars:"Short string xx",string_16_chars:"Short string xxx"}}}]};var Xt={get collapse(){return $("span",{class:"struct-action-button struct-collapse-value","data-action":"collapse"})},get signature(){return $("span",{class:"struct-action-button show-signature","data-action":"show-signature"})},get actions(){return $("span",{class:"struct-action-button",title:"Value actions","data-action":"value-actions"})},get stringMode(){return $("span",{class:"struct-action-button",title:"Toggle string show mode","data-action":"toggle-string-mode"})},get viewAsTable(){return $("span",{class:"struct-action-button",title:"Toggle view as table","data-action":"toggle-view-as-table"})},get sortKeys(){return $("span",{class:"struct-action-button",title:"Toggle key sorting","data-action":"toggle-sort-keys"})}},Ly=xr('"',Xt.collapse,Xt.actions,Xt.stringMode,$("span","string-length"),$("span","string-text-wrapper",[$("span","string-text")]),'"'),My=xr("[",Xt.collapse,Xt.signature,Xt.actions,Xt.viewAsTable,$("span","value-size"),"]"),Ny=xr("{",Xt.collapse,Xt.signature,Xt.actions,Xt.viewAsTable,Xt.sortKeys,$("span","value-size"),"}"),By=$("div","entry-line"),Oy=$("span","value"),Py=$("span","match"),Iy=$("span","label",["\xA0\xA0\xA0\xA0",$("span","property"),":\xA0"]);function eE(n){for(;n.parent!==null;)n=n.parent;return n.host[""]}function jy(n,e,r,o,a){return new n.view.Popup({className:"view-struct-signature-popup",hoverPin:"popup-hover",hoverTriggers:".view-struct .show-signature",showDelay:50,render(u,f){let d=f.parentNode,h=e.get(d),g=r.get(d),v=o.get(d)||{};u.classList.add("computing"),setTimeout(()=>{n.view.render(u,{view:"signature",expanded:2,rootData:eE(g),path:a(d)},h,v.context).then(()=>u.classList.remove("computing"))},16)}})}var zy=50,tE=4,nE=0,rE=150,iE=40,oE=10,sE=1/0,aE=35;function Qo(n,e){return typeof n=="number"&&isFinite(n)&&n>=1?parseInt(n,10):e}function Ry(n,e){if(typeof n=="string")return n.length>e.maxStringLength||/[\r\n\f\t]/.test(n);if(zt(n))return n.length>0;if(typeof n=="object"&&n!==null)switch(pn(n)){case"[object Set]":return n.size>0;case"[object Object]":for(let r in n)if(ye(n,r))return!0}return!1}function Hy(n){return!(typeof n=="string"||aa(n)||zt(n)&&n.every(e=>typeof e=="number"))}function lf(n,e){n.appendChild(document.createTextNode(e))}function qy(n,e,r){e>1&&(n.lastElementChild.innerHTML=xt(e)+" "+r)}function lE(n,e,r){e.length<2||e.every(([a],u)=>u===0||a>e[u-1][0])?n.querySelector('[data-action="toggle-sort-keys"]').remove():r&&e.sort(([a],[u])=>a<u?-1:a>u?1:0)}function uE(n,e,r){let o=Iy.cloneNode(!0),a=e.length>r?e.slice(0,r)+"\u2026":e;lf(o.firstElementChild,a),n.appendChild(o)}function _y(n){function e(B){let O=x.get(B),z=v.get(B);B.classList.add("struct-expand-value"),B.innerHTML=Or(z,!1,O),B.annotationsEl&&B.parentNode.append(B.annotationsEl)}function r(B,O,z){let _=v.get(B);if(B.classList.remove("struct-expand-value"),typeof _=="string"){let W=x.get(B),te=Ly.cloneNode(!0),H=te.lastChild.previousSibling,X=H.firstChild,A=H.previousSibling,Q=Fi(_);A.innerHTML=`length: ${xt(Q.length)} chars`,W.match?rr(_,W.match,U=>X.append(JSON.stringify(U).slice(1,-1)),U=>X.appendChild(Py.cloneNode()).append(JSON.stringify(U).slice(1,-1))):lf(X,Q),B.replaceChildren(te),d(B,A)}else if(zt(_)||kn(_)){let W=w.get(B),te=x.get(B),H=typeof _.size=="number"?_.size:_.length;B.replaceChildren(My.cloneNode(!0)),qy(B,H,"elements"),d(B,B.lastElementChild),a(B,B.lastChild,_.values(),H,(X,A,Q)=>{Q>0&&Q%10===9&&(X.dataset.index=Q+1),o(X,A,O,te,Object.freeze({parent:W,host:_,key:Q,index:Q}))},0,te.limit)}else{let W=w.get(B),te=x.get(B),H=Object.entries(_);B.replaceChildren(Ny.cloneNode(!0)),qy(B,H.length,"entries"),d(B,B.lastElementChild),lE(B,H,z),a(B,B.lastChild,H.values(),H.length,(X,[A,Q],U)=>{U>0&&U%10===9&&(X.dataset.index=U+1),uE(X,A,te.maxPropertyLength),o(X,Q,O,te,Object.freeze({parent:W,host:_,key:A,index:U}))},0,te.limit)}}function o(B,O,z,_,W){let te=Ry(O,_),H=Oy.cloneNode(!0);v.set(H,O),w.set(H,W),x.set(H,_),te&&Hy(O)&&z?(B.classList.add("struct-expanded-value"),r(H,z-1)):(te&&H.classList.add("struct-expand-value"),H.innerHTML=Or(O,!1,_)),h(H,O,_,W),B.appendChild(H)}function a(B,O,z,_,W,te=0,H=zy){H===!1&&(H=1/0);let X=document.createDocumentFragment(),A=_-1,Q=0;for(;Q<H;Q++,te++){let{done:U,value:ce}=z.next();if(U)break;let xe=By.cloneNode(!0);W(xe,ce,te),te!==A&&lf(xe,","),X.appendChild(xe)}B.insertBefore(X,O),n.view.maybeMoreButtons(B,O,_,te,H,(U,ce)=>a(B,O,z,_,W,U,ce))}function u(B){let O=x.get(B),z=v.get(B);!zt(z)&&!kn(z)&&(z=Object.entries(z).map(([_,W])=>({"[key]":_,"[value]":W}))),n.view.render(B,"table",z,O.context),B.append(B.lastChild.previousSibling)}function f(B){let O=[],z=w.get(B);for(;z!==null&&z.parent!==null;)O.unshift(z.key),z=z.parent;return O}function d(B,O){B.annotationsEl&&O.after(B.annotationsEl)}function h(B,O,z,_){if(z.annotations.length){for(let W of z.annotations)try{let{query:te,debug:H}=W,X={..._,context:z.context},A=n.query(te,O,X);H&&n.logger.info(`Compute struct view annotation${typeof H=="string"?` "${H}"`:""}:`,{data:O,context:X,query:te,queryResult:A}),A&&E.push(A.tooltip?{el:B,config:A,renderer:z.renderer,data:O,context:X}:{el:B,config:A})}catch(te){n.logger.error(te.message)}g()}}function g(){D===null&&E.length&&(D=Promise.resolve().then(()=>{D=null,Ey(E),E.length&&g()}))}let v=new WeakMap,w=new WeakMap,x=new WeakMap,T=new WeakSet,E=[],M=Ay(n),F=M,D=null,C=Cy(n,v,w,f),L=jy(n,v,w,x,f),N=xy(r,e,g,u,T,C,L);return n.addHostElEventListener("click",N,!1),n.legacyPrepare||n.action.define("setStructViewAnnotations",B=>{F=af(M,Ia(B))}),n.view.define("struct",function(B,O,z,_){let{annotations:W,match:te,expanded:H,limit:X,limitCollapsed:A,limitCompactObjectEntries:Q,maxStringLength:U,maxCompactStringLength:ce,allowedExcessStringLength:xe,maxPropertyLength:Le,maxCompactPropertyLength:_e}=O,et=Sy(W,n.legacyPrepare?n.annotations:F),Ke={renderer:this,context:_,annotations:et||[],match:Lo(te)||typeof te=="string"?te:null,limit:n.view.listLimit(X,zy),limitCollapsed:n.view.listLimit(A,tE),limitCompactObjectEntries:n.view.listLimit(Q,nE),maxStringLength:Qo(U,rE),maxCompactStringLength:Qo(ce,iE),allowedExcessStringLength:Qo(xe,oE),maxPropertyLength:Qo(Le,sE),maxCompactPropertyLength:Qo(_e,aE)};T.add(B),o(B,z,H,Ke,{parent:null,host:{"":z},key:"",index:0}),g(),(!H||!Hy(z))&&Ry(z,Ke)&&B.classList.add("struct-expand")},{usage:Fy}),()=>{document.removeEventListener("click",N,!1)}}var Pr=[{name:"Alice",age:34,occupation:"Engineer"},{name:"Bob",age:42,occupation:"Doctor"},{name:"Charlie",age:9,occupation:"Student"},{name:"David",age:50,occupation:"Doctor"},{name:"Eve",age:15,occupation:"Engineer"}],Wy={beforeDemo:['md:"A view to display tabular data, usually an array of objects. When no column setup is provided, it infers columns from all keys of objects in the input data and auto-detects sorting for scalar values."'],demo:{view:"table"},demoData:[{foo:1,bar:"bar",baz:"zab"},{foo:2,baz:"xyz"},{foo:3,bar:"qux",baz:"baz"},{foo:4,bar:"aaa",baz:"abc"}],examples:[{title:"Columns setup",beforeDemo:{view:"md",source:["To set up columns, the `cols` property is used. When an array of objects is used for `cols`, it specifies the exact set of columns. Each object contains a configuration for the `table-cell` view with additional properties that apply at the table level:\n","- `header` \u2013 a text for the column header\n","- `footer` \u2013 a config for the footer cell\n","- `headerClassName` - specifies className for a header cell, works as `className` for any view (i.e. can be a string, an array, a function, etc.)\n","- `sorting` \u2013 a sorting function or query for the column\n"]},highlightProps:["cols","header","footer","headerClassName","sorting"],demo:{view:"table",cols:[{header:"Name",sorting:"name asc",data:"name",footer:'text:"Total:"'},{header:"Age",headerClassName:"age",className:"number",content:'text:age + " y.o."',footer:{data:"size()"}}]},demoData:Pr},{title:"Adjastments of infered columns",beforeDemo:{view:"md",source:["In cases where adjustments are needed for inferred columns, an object can be used for the `cols` option, where each key is the name of a property from the objects:","- If a key is missing from the inferred columns, a new column is added with the specified configuration.","- If a key matches one of the inferred columns:","  - If the specified configuration is falsy (i.e., `null`, `undefined`, or `false`), then the column is omitted.","  - Otherwise, options from the specified configuration override properties of the inferred configuration.","","> When specified configuration is a string, it expands into object `{ content: value }`.","The default inferred configuration:","```js","{","    header: key,","    sorting: `$[${JSON.stringify(key)}] ascN`,",'    view: "table-cell",',"    data: value => value?.[key]","}","```"].join(`
`)},afterDemo:["struct:#.id.pageLink(#.page, #.params)"],highlightProps:["cols"],demo:{view:"table",cols:{age:'text:age + " y.o."',occupation:!1,extraColumn:{header:"Extra column",content:'text:age >= 21 ? "Adult" : "Child"'}}},demoData:Pr},{title:"Sorting",beforeDemo:{view:"md",source:['To specify a sorting function, use the `sorting` property in the column options. When a value for `sorting` is set, the column becomes sortable, allowing users to toggle sorting by clicking the column header. The value can be a function `(a, b) => number` or a string representing a jora query that returns a [comparator function](https://discoveryjs.github.io/jora/#article:jora-syntax-functions&!anchor=comparator-functions) (e.g., "name asc, complex.expression desc"), otherwise the value ignores. The function should take two rows\' data (`a` and `b`) and return a negative number if `a` is less than `b`, a positive number if `a` is greater than `b`, or zero otherwise.',"","> The `table` view automatically displays a sorting direction indicator (icon) on a column when a comparator function returns `<= 0` or `>= 0` for each pair of consecutive rows.","","> Note: A sorting (comparator) function has no access to the table's context, so any attempt to access context (`#`) values within a comparator function produced by a query will return `undefined`.","","The `table` view attempts to infer a sorting function for a column when the `sorting` option is not explicitly specified, by executing the following steps:","- Use `data` if it is a string or function to extract column values from row data; otherwise, use the row's data.",'- If `content` is a string formatted as `"view-name:query"`, use the `query` to extract a value from the previous step.','  > To prevent sorting inference from the `content` value, specify content in another format, often by wrapping it in an array, e.g., `{ content: "text:name" }` \u2192 `{ content: ["text:name"] }`.',"- If any condition is met, construct a sorting (comparator) function.","  > If neither `data` nor `content` options meet the conditions, a sorting function cannot be inferred, and the column becomes non-sortable.","","> Note: When inferring a comparator function, the when, whenData, and contentWhen options are not considered for now. If these options are needed to affect sorting, an explicit sorting function should be specified."].join(`
`)},highlightProps:["sorting","data","content"],demo:{view:"table",cols:[{header:"Sorting from data",data:"name"},{header:"Sorting from content",content:"text:age"},{header:"Sorting from data&content",data:"{ name, age }",content:"text:`${age} ${name}`"},{header:"Explicit sorting",sorting:"name asc, age desc",content:["text:`${name} ${age}`"]}]},demoData:Pr},{title:"Displaying non-object values",beforeDemo:['md:"When input data (an array) contains non-object values, such values are display using `struct` view in a single cell spanning all the columns"'],highlightProps:["data","valueCol"],demo:['h3:"Table with non-object values"',{view:"table",data:[123,"string",null,{foo:1,bar:2},[1,2,3]]},'h3:"Enforce displaying of a [value] column"',{view:"table",valueCol:!0}],demoData:Pr},{title:"Setup cell display",beforeDemo:{view:"md",source:["To manage cell display, the following options are available in the `cols` setting:","- `colWhen` (similar to `when` and `whenData` options) allows disabling column rendering based on the table's data.","- `when` and `whenData` apply to `table-cell` and behave the same way as they do for any view, to disabling rendering of the cell itself.","- `contentWhen` (similar to `when` and `whenData` options) allows disabling cell content rendering based on the cell's data.","- `colSpan` allows setting a relevant attribute for a table cell. (Note: subsequent cells should be disabled using `when` or `whenData`)."].join(`
`)},highlightProps:["contentWhen","colWhen","colSpan","when"],demo:{view:"table",data:'.({ name, age, fare: age > 21 ? "Full" : age > 12 ? "Half" })',cols:{name:{contentWhen:'$ != "Bob"'},age:{colWhen:"size() > 10"},fare:{colSpan:"=fare ? 1 : 2",content:{data:"fare",view:"switch",content:[{when:"$",content:"text"},{content:'text:"Not applicable"'}]}},price:{when:"fare",data:'fare = "Full" ? 50 : 25',content:'text:"$" + $'}}},demoData:Pr},{title:"Cell details",beforeDemo:{view:"md",source:["Table cells can display an additional detail view of their content when clicked. Clicking the same cell again, or a different cell with details, will hide the view. To enable and customize the detail view, use the `details` option.","","By default, if the `details` option is not explicitly defined, it will automatically activate for cells containing an object or a non-empty array, as long as no custom `content` is specified. In this case, a default `struct` view will be used to display the data.","","You can control the visibility of detail views using the `detailsWhen` option. This option accepts a function that checks the cell's data and disables the details view if the function returns a falsy value."]},highlightProps:["details","detailsWhen"],demo:{view:"table",cols:[{header:"Group",data:"group"},{header:"Default",data:"peoples"},{header:"Custom details",data:"peoples",details:['h2:"Custom detail views"',"table"]},{header:"Disable default details",data:"peoples",details:!1},{header:"Conditional details",data:"peoples",detailsWhen:"size() > 2"}]},demoData:[{group:"Kids",max:21},{group:"Adults",min:21},{group:"All"}].map(({group:n,min:e=0,max:r=100})=>({group:n,peoples:Pr.filter(o=>o.age>e&&o.age<r)}))},{title:"Setup footer cell display",beforeDemo:{view:"md",source:["A setup for footer cell is similar to a [regular cell](#!setup-cell-display), the same set of options are supported, except `colWhen`.","","When value for the `footer` is an object without a `view` property, it's interpreted as a footer config. Otherwise, it is treated as footer cell content, equivalent to passing `{ content: value }`."]},highlightProps:["footer"],demoData:Pr,demo:{view:"table",cols:{name:{footer:'text:"Raw data"'},age:{footer:{colSpan:2}}}}}]};function uf(n,e){return{header:n,sorting:`${e} ascN`,view:"table-cell",data:e}}function cE(n,e,r){let o="",a="";if("data"in n&&n.data!==void 0)switch(typeof n.data){case"string":a=`(${n.data||"$"})`;break;case"function":o="$dataQuery;",a="$dataQuery(#)";break;default:o="$dataQuery;",a="$dataQuery"}if(typeof n.content=="string"){let u=n.content.indexOf(":"),f=n.content.slice(0,u);if(u===-1||!e.view.has(f))return;let d=n.content.slice(u+1);d&&(a=a?`(${a} | ${d})`:`(${d})`)}return a?e.query(`${o} ${a} ascN`,{dataQuery:n.data},r):!1}function fE(n,e,r){return typeof e=="string"&&(e={content:e}),ye(e,"content")||ye(e,"data")?{header:n,view:"table-cell",...e}:{...uf(n,r),...e}}function $y(n){return Array.isArray(n)?n.length:n}function Uy(n,e,r){if(typeof r!="function")return!1;let o=0;try{for(let a=1,u=$y(e[0]);a<e.length;a++){let f=$y(e[a]),d=Math.sign(r(u,f));if(d){if(o&&d!==o)return!1;o=d}u=f}}catch(a){return n.logger.error("Error on column order detection in table view",a),0}return-o}function Vy(n){let e=n.queryFn("is not object");n.view.define("table",function(r,o,a,u){let{rows:f,cols:d,rowConfig:h,limit:g,valueCol:v=!1}=o,w;"rows"in o||(f=a),kn(f)&&(f=[...f]),zt(f)||(f=f?[f]:[]);let x=r.appendChild($("thead")).appendChild($("tr")),T=[],E=[],M=[],F=r.appendChild($("tbody")),D=r.appendChild($("tbody",{class:"view-table-more-buttons"})),C=D.appendChild($("tr")).appendChild($("td")),L=B=>{F.innerHTML="",C.innerHTML="";for(let O of T){let z=Uy(n,B,O.sorting);O.el.classList.toggle("asc",z===1),O.el.classList.toggle("desc",z===-1)}return n.view.renderList(F,w,B,{...u,cols:d},0,{limit:n.view.listLimit(g,25),moreContainer:C,onSliceRender:O=>O===0&&D.remove()})};async function N(){let B=r.appendChild($("tfoot")).appendChild($("tr"));await n.view.render(B,E,a,u);let O=()=>$("td",{class:"view-table-footer-cell"}),z=0;[...B.childNodes].forEach((_,W)=>{let te=M[W];if(_.nodeType===1){if(_.tagName!=="TD"){_.replaceWith(document.createComment("removed non <td> element"));return}if(console.log({colIndex:z,shouldBeIndex:te,x:te-M[W-1]}),z>te){let H=_.previousElementSibling;H.colSpan=te-H.cellIndex}else for(let H=te-z;H>0;H--)_.before(O());z=te+_.colSpan}});for(let _=T.length-z;_>0;_--)B.append(O())}if(Array.isArray(d))d=d.map((B,O)=>typeof B=="string"?uf(B,n.pathToQuery([B])):{header:"col"+O,view:"table-cell",...B});else{let B=new Set,O=d&&typeof d=="object"?d:{};d=[];for(let z of f)if(e(z))v=!0;else for(let _ of Object.keys(z))B.add(_);for(let z of Object.keys(O))O[z]?B.add(z):B.delete(z);for(let z of B)d.push(ye(O,z)?fE(z,O[z],n.pathToQuery([z])):uf(z,n.pathToQuery([z])))}v&&d.unshift({header:"[value]",view:"table-cell",sorting:"$ ascN",colSpan:"=is not object ? #.cols.size() : 1",content:'=is not object ? "struct"',details:'=is object ? "struct"'}),d=d.filter(B=>!ye(B,"colWhen")||n.queryBool(B.colWhen,a,u));for(let B of d){let O=ye(B,"sorting")?n.query(B.sorting,null,u):cE(B,n,u),z=typeof O=="function"?Uy(n,f,O):0,_=x.appendChild($("th","view-table-header-cell")),W={el:_};if(ye(B,"footer")&&typeof B.footer<"u"){let te=typeof B.footer=="object"&&B.footer!==null&&typeof B.footer.view!="string"?B.footer:{content:B.footer};M.push(T.length),E.push(n.view.composeConfig({view:"table-footer-cell"},te))}T.push(W),_.textContent=B.header,this.applyComputedClassName(_,B.headerClassName,a,u),z!==0?(W.sorting=O,_.classList.add("sortable"),_.addEventListener("click",()=>{_.classList.contains("asc")?L(f.slice().sort(O).reverse()):_.classList.contains("desc")&&!z?L(f):L(f.slice().sort(O))})):B.sorting=!1}return C.colSpan=d.length,w=this.composeConfig({view:"table-row",cols:v?"=is not object ? [#.cols[]] : #.cols":"=#.cols"},h),E.length===0?L(f):Promise.all([L(f),N()])},{tag:"table",usage:Wy})}function Gy(n){n.view.define("table-row",function(e,r,o,a){let{cols:u}=r;if(Array.isArray(u))return Promise.all(u.map((f,d)=>n.view.render(e,f,o,{...a,colIndex:d})))},{tag:"tr"})}var dE={view:"struct",expanded:1};function Ky(n,e,r){if(Array.isArray(e)||ArrayBuffer.isView(e)){n.classList.add("number"),n.textContent=e.length||"";return}if(r){n.classList.add("complex");for(let o in e)if(ye(e,o)){n.textContent="{\u2026}";return}n.textContent="{}";return}if(e!==void 0){if(typeof e=="number"){let o=String(e);if(n.classList.add("number"),!Number.isFinite(e)){n.classList.add("keyword"),n.textContent=o;return}o.length>3?n.innerHTML=xt(o,!1):n.textContent=o;return}(e===null||e===!1||e===!0)&&n.classList.add("keyword"),n.textContent=String(e)}}function Yy(n,e,r,o,a){return()=>{let u=e.parentNode,f=u.parentNode,d=Array.from(f.querySelectorAll(".view-table-cell.details-expanded")).find(g=>g.parentNode.parentNode===f),h=null;if(d){let g=d.parentNode;if(d.classList.remove("details-expanded"),d===e){u.nextSibling.remove();return}g!==u?g.nextSibling.remove():(h=u.nextSibling.firstChild,h.innerHTML="")}h===null&&(h=u.parentNode.insertBefore(document.createElement("tr"),u.nextSibling).appendChild(document.createElement("td")),h.parentNode.className="view-table-cell-details-row",h.className="view-cell-details-content",h.colSpan=1e3),e.classList.add("details-expanded"),n.view.render(h,r||dE,o,a)}}function Qy(n){n.view.define("table-cell",function(e,r,o,a){let{content:u,contentWhen:f=!0,details:d,detailsWhen:h=!0,colSpan:g}=r,v=!u&&o!==null&&(Array.isArray(o)?o.length>0:typeof o=="object")&&!(o instanceof RegExp);if(typeof g=="number"&&g>1&&(e.colSpan=g),!!n.queryBool(f,o,a)){if((d||d===void 0&&v)&&n.queryBool(h,o,a)&&(e.classList.add("details"),e.addEventListener("click",Yy(n,e,d,o,a))),u)return n.view.render(e,u,o,a);Ky(e,o,v)}},{tag:"td"}),n.view.define("table-footer-cell",function(e,r,o,a){let{content:u,contentWhen:f=!0,details:d,detailsWhen:h=!0,colSpan:g}=r,v=!u&&o!==null&&(Array.isArray(o)?o.length>0:typeof o=="object")&&!(o instanceof RegExp);if(e.classList.add("view-table-cell"),typeof g=="number"&&g>1&&(e.colSpan=g),!!n.queryBool(f,o,a)){if((d||d===void 0&&v)&&n.queryBool(h,o,a)&&(e.classList.add("details"),e.addEventListener("click",Yy(n,e,d,o,a))),u)return n.view.render(e,u,o,a);Ky(e,o,v)}},{tag:"td"})}var pE=()=>alert("toggled!"),Jy=([n,...e],r="")=>{let o=[];for(let a=0;a<n;a++){let u=r+"."+(a+1);o.push({title:u,children:e.length?Jy(e,u):null})}return o},Zy={demo:{view:"tree",item:"text:text",data:{text:"Root",children:[{text:"Child"},{text:"Another child",children:[{text:"Lvl 2 child"},{text:"Lvl 2 child"}]}]}},examples:[{title:"Expanded tree",highlightProps:["expanded"],demo:{view:"tree",item:"text:text",expanded:999},demoData:{text:"Root",children:[{text:"Child"},{text:"Another child",children:[{text:"Lvl 2 child"},{text:"Lvl 2 child"}]}]}},{title:"With empty text",highlightProps:["emptyText"],demo:{view:"tree",emptyText:"This tree is empty",data:null}},{title:"With toggle handler",highlightProps:["onToggle"],demo:{view:"tree",item:"text:text",onToggle:pE},demoData:{text:"Root",children:[{text:"Child"},{text:"Another child",children:[{text:"Lvl 2 child"},{text:"Lvl 2 child"}]}]}},{title:"limitLines",highlightProps:["limitLines"],demoData:Jy([5,3,3]),demo:{view:"tree",item:"text:title",limitLines:7}}]};function Xy(n){function e(o,a,u,f,d,h){return h===!1&&(h=u.length),o.classList.add("incomplete"),u.slice(d,d+h).reduce((g,v)=>g.then(()=>{let{container:w,itemConfig:x}=a;return n.view.render(w,n.view.composeConfig(x,{expanded:v.expanded,last:v.last,hasChildren:v.hasChildren,children:v.children}),v.data,f).then(()=>{if(v.expanded&&v.hasChildren){let T=w.lastChild.querySelector(".view-tree-leaf-children");T.classList.add("incomplete"),a={container:T,itemConfig:n.view.composeConfig(x,x.itemConfig),prev:a}}else for(;v.shift--;)a.container.classList.remove("incomplete"),a=a.prev})}),Promise.resolve()).then(()=>n.view.maybeMoreButtons(o,null,u.length,d+h,h,(g,v)=>e(o,a,u,f,g,v))||o.classList.remove("incomplete"))}function r(o,a,u,f){function d(v,w,x,T=0){v.forEach((E,M,F)=>{let D=n.query(x.children,E,a),C=Array.isArray(D)&&D.length>0,L=M===F.length-1,N=g.has(E)?0:typeof w=="function"?w(E,a):w;g.add(E),h.push({data:E,expanded:N,last:L,hasChildren:C,children:N?null:x.children,shift:L&&(!N||!C)?T+1:0}),C&&N&&d(D,typeof w=="number"?w-1:w,n.view.composeConfig(x,x.itemConfig),L?T+1:0)})}let h=[],g=new Set;return d(o,f,u),h}n.view.define("tree",function(a,u,f,d){let{children:h="children",item:g="text",itemConfig:v,collapsible:w,emptyText:x,onToggle:T}=u,{expanded:E,limit:M,limitLines:F=!0}=u;if(x!==!1&&x!==""&&a.setAttribute("emptyText",x||"Empty tree"),!Array.isArray(f)&&f&&(f=[f]),Array.isArray(f)){if(M=n.view.listLimit(M,25),F=n.view.listLimit(F,25),E=typeof E=="function"?E:n.view.listLimit(E,1),F){let D=r(f,d,this.composeConfig({children:h},v),E),C={container:a,itemConfig:this.composeConfig({view:"tree-leaf",itemConfig:v,content:g,collapsible:w,onToggle:T},v)};return e(a,C,D,d,0,F)}return this.renderList(a,this.composeConfig({view:"tree-leaf",itemConfig:v,content:g,collapsible:w,expanded:E,children:h,limit:M,onToggle:T},v),f,d,0,M)}},{tag:"ul",usage:Zy})}var hE=`#.props | {
    $items: children.query(@, #.context) | is array?;

    itemConfig,
    content is not undefined ?: 'text',
    collapsible is not undefined ?: true,
    onToggle,
    expanded,
    last,
    hasChildren: hasChildren or $items.size() > 0,
    children,
    $items,
    limit: limit | $ = false or is int ?: 25
}`;function eb(n){let e=new WeakMap,r=({target:o})=>{let a=o.closest(".view-tree-leaf-toggle");if(a){let u=e.get(a),f=!a.parentNode.classList.toggle("collapsed");typeof u.render=="function"&&u.render(),typeof u.onToggle=="function"&&u.onToggle(f,a.parentNode,u.data,u.context)}};n.addHostElEventListener("click",r,!1),n.view.define("tree-leaf",async function(o,a,u,f){let{expanded:d,hasChildren:h,children:g,items:v,content:w,itemConfig:x,collapsible:T,last:E,limit:M,onToggle:F}=a,D=o.appendChild($("span","view-tree-leaf-toggle")),C=o.appendChild($("span","view-tree-leaf-content"));if(E&&o.classList.add("last"),T||o.classList.add("non-collapsible"),await this.render(C,w,u,f),h){let L=o.appendChild($("ul","view-tree-leaf-children")),N={data:u,context:f,onToggle:F,render:null},B=(O,z)=>(typeof z=="number"&&z--,this.renderList(L,this.composeConfig({view:"tree-leaf",expanded:z,itemConfig:x,content:w,collapsible:T,children:g,limit:M,onToggle:F},x),O,f,0,this.listLimit(M,25)));o.classList.add("has-children"),e.set(D,N),(typeof d=="function"?d(u,f):d)?v&&await B(v,d):(o.classList.add("collapsed"),v&&(N.render=()=>{N.render=null,B(v,d||1)}))}},{tag:"li",props:hE})}var Wa={};Ce(Wa,{default:()=>tb,discovery:()=>hb,notFound:()=>nb,viewsShowcase:()=>yb});function tb(n){n.page.define("default",{view:"switch",content:[{when:"no #.datasets",content:"preset/welcome-block"},{content:['page-header{ content: "h1:#.name" }',{view:"struct",expanded:1}]}]}),n.preset.define("welcome-block",{view:"block",className:"welcome-block",data:"#.model",content:["app-header",{view:"block",className:"upload-data",when:"#.actions.uploadFile",content:["preset/upload",{view:"block",className:"upload-notes",content:'html:name + " is a server-less application that securely opens and analyzes your data directly on your device,<br>ensuring all processing is done locally without transmitting your data elsewhere."'}]}]})}function nb(n){n.page.define("not-found",['alert-warning:"Page `" + name + "` not found"'])}function za(n,e=""){return typeof n=="string"?n:e}var rb=["query","graph","view","viewEditorHidden","title","dzen","noedit"],gE=["q","graph","v","vh","title","dzen","noedit"];function ib(n){let e=typeof n=="string"?{query:n}:n,{query:r,graph:o,view:a,viewEditorHidden:u,title:f,dzen:d,noedit:h,...g}=e,v=[];d&&v.push(["dzen"]),h&&v.push(["noedit"]),f&&v.push(["title",f]),r&&v.push(["q",Ho(r)]),o&&v.push(["graph",Ho(JSON.stringify(o))]),typeof a=="string"&&v.push(a?["v",Ho(a)]:["v"]),u&&v.push(["vh"]);for(let[w,x]of Object.keys(g||{}).sort())rb.includes(w)||v.push([w,w.endsWith("-b64")&&typeof x=="string"?Ho(x):x]);return v}function ob(n){let e=Object.fromEntries(n),r={title:za(e.title),query:qo(za(e.q)),graph:JSON.parse(qo(za(e.graph))||"null"),view:"v"in e?qo(za(e.v)):void 0,viewEditorHidden:"vh"in e,dzen:"dzen"in e,noedit:"noedit"in e};for(let[o,a]of Object.entries(e))gE.includes(o)||(r[o]=o.endsWith("-b64")&&typeof a=="string"?qo(a):e[o]);return r}function mE(n){return Object.fromEntries(Object.entries(n).filter(([e])=>!rb.includes(e)))}function cf(n,e,...r){for(let o of Object.keys(n))if(n[o]!==e[o]&&!r.includes(o))return!1;for(let o of Object.keys(e))if(n[o]!==e[o]&&!r.includes(o))return!1;return!0}function Ra(n,e={}){let r={...n,params:mE(n.params)};return!cf(e,r,"params","actions")||!cf(e.params,r.params)||!cf(e.actions,r.actions)?r:e}function Li(n){return n&&typeof n=="object"&&"params"in n?n.params:{}}function vE(n){return n.replace(/\\/g,"\\\\").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/'/g,"\\'")}function yE(n){let{title:e,query:r,view:o}=n,a={title:e,query:r,view:o};return`{
${Object.keys(a).reduce((u,f)=>typeof a[f]=="string"?u.concat(`    ${f}: '${vE(a[f])}'`):u,[]).join(`,
`)}
}`}function bE(n){if(n&&(typeof n=="number"||typeof n=="string")){let e=new Date(n);return isNaN(Number(e))?null:e}return n instanceof Date?n:null}function sb(n){let e=bE(n);return e?e.toISOString().replace(/^(\d{4})-(\d{2})-(\d{2})T([\d:]+).*/,"$3/$2/$1 $4 UTC"):null}function ab(n,e){let r,o,a,u,f=new n.view.Popup({render:(v,w,x)=>n.view.render(v,{view:"menu",data:()=>[{text:"Copy page permalink",disabled:!n.action.has("permalink"),action:async()=>_t(await n.action.call("permalink",n.pageHash))},{text:"Copy page hash",action:()=>_t(n.pageHash)},{text:"Copy page as JSON",action:()=>_t(yE(n.pageParams))}],onClick(T){x(),T.action()}})}),d=$("div","discovery-actions",[u=$("button",{class:"edit-mode discovery-hidden-in-dzen",title:"Toggle edit mode",onclick(){this.blur(),e({noedit:!n.pageParams.noedit})}}),$("button",{class:"share",title:"Sharing",onclick(){this.blur(),f.show(this)}}),$("button",{class:"toggle-fullscreen",title:"Toggle full page mode",onclick(){this.blur(),e({dzen:!n.pageParams.dzen})}})]),h=v=>{v.parentNode.dataset.title=v.value||v.placeholder},g=$("div","discovery-header",[$("div",{class:"discovery-header-text","data-title":"\xA0"},[r=$("input",{class:"discovery-hidden-in-dzen",placeholder:"Untitled discovery",oninput(){h(this)},onchange(){h(this),e({title:this.value},!0)},onkeypress(v){v.key==="Enter"&&this.blur()}}),$("span","timestamp",[o=$("span",null,"&nbsp;"),a=$("span")])])]);return{el:[d,g],render(v,w){let{title:x,noedit:T}=Li(w),E=sb(w?.datasets?.[0]?.resource?.createdAt);r.value=x||"",h(r),u.classList.toggle("disabled",T),o.innerText=E?"Data collected at "+E+" | ":"",a.innerText="Rendered at "+sb(new Date)}}}function lb(n,e,r){return n.length?`${n.length} ${n.length===1?e:r}`:"empty"}function ff(n){return Array.isArray(n)?`Array (${lb(n,"element","elements")})`:n&&typeof n=="object"?`Object (${lb(Object.keys(n),"entry","entries")})`:`Scalar (${n===null?"null":typeof n})`}function df(n,e){let r=document.createElementNS("http://www.w3.org/2000/svg",n);if(e)for(let[o,a]of Object.entries(e))r.setAttribute(o,String(a));return r}function wE(n,e,r){function o(){return n.appendChild($("div","query-graph-box"))}function a(f,d,h,g){Array.isArray(g)||(g=[]),f||(f=o());let v=g.length===1,w=g.length>1,x=f.appendChild($("div",{"data-path":h.join(" "),tabindex:-1,class:`query-graph-node${v?" target":w?" current":""}`}));if(r.view.attachTooltip(x,{className:"query-graph-tooltip",content:v?'badge:"Current query"':{view:"source",syntax:'=query ? "jora" : false',source:'=query or "<empty query>"',actionCopySource:!1,lineNumber:!1}},{query:d.query}),Array.isArray(d.children))for(let T=0;T<d.children.length;T++){let E=a(f.nextSibling,d.children[T],h.concat(T),g[1]===T?g.slice(1):[]);u.push([x,E])}return x}let u=[];for(let f=0;f<e.children.length;f++)a(n.firstChild,e.children[f],[f],e.current[0]===f?e.current:[]);requestAnimationFrame(()=>{let f=n.appendChild(df("svg"));for(let[d,h]of u){let g=Ht(d,f),v=Ht(h,f),w=g.right-2,x=g.top+g.height/2,T=v.left+2,E=v.top+v.height/2,M=(T-w)/3;f.append(x===E?df("line",{stroke:"#888",x1:w,y1:x,x2:T,y2:E}):df("path",{stroke:"#888",fill:"none",d:`M ${w} ${x} C ${w+2*M} ${x} ${T-2*M} ${E} ${T} ${E}`}))}})}function ub(n){let e={current:Array.isArray(n.current)?n.current:[],children:Array.isArray(n.children)?n.children:[]};return e.current.length===0&&e.current.push(0),e.children.length===0&&e.children.push({}),e}function Ha(n,e){let r=[n],o=n;for(let a=0;a<e.length;a++)o=o.children?.[e[a]],r.push(o);return r}function cb(n,e){let r=n.view.QueryEditor,o={},a,u=NaN,f=!1,d=NaN,h,g,v=ub({}),w,x=null,T=null,E=[],M,F,D=(G,ae,ne,re)=>M.checked?n.querySuggestions(G,ae,ne,re):null,C=new r(D).on("change",G=>F.checked&&e({query:G},!0)),L=n.getQueryEngineInfo(),N=$("div","query-graph-actions"),B=$("div","buttons"),O=$("div","query-input"),z=$("div","query-input-details"),_=$("div","data-query-result"),W=$("div","data-query-result-details"),te=$("div","query-graph"),H=$("div","query-path"),X=$("div","form query-editor-form",[te,H,$("div","query-editor",[C.el])]);C.inputPanelEl.append(N,O,z,$("a",{class:"view-link query-engine",href:L.link,target:"_blank"},[`${L.name} ${L.version||""}`])),C.outputPanelEl.append(_,B,W);let A=G=>({position:"trigger",className:"hint-tooltip",showDelay:!0,content:{view:"context",data:typeof G=="function"?G:()=>G,content:"md"}});function Q(G=""){ce(({nextGraph:ae,last:ne})=>(Array.isArray(ne.children)||(ne.children=[]),ne.query=h,ne.view=g,ae.current.push(ne.children.push({})-1),{query:G,view:void 0,graph:ae}))}n.view.render(N,[{view:"button",className:"subquery",tooltip:A("Create a new query for a result of current one"),onClick:Q},{view:"button",className:"stash",tooltip:A(()=>v.current.length<2?"Stash current query and create a new empty query":"Stash current query and create a new empty query for current parent"),onClick(){ce(({nextGraph:G,last:ae,preLast:ne})=>{let re=ne.children||[];return ae.query=h,ae.view=g,G.current[G.current.length-1]=re.push({})-1,{query:"",view:void 0,graph:G}})}},{view:"button",className:"clone",tooltip:A("Clone current query"),onClick(){ce(({nextGraph:G,last:ae,preLast:ne})=>{let re=ne.children||[];return ae.query=h,ae.view=g,G.current[G.current.length-1]=re.push({})-1,{graph:G}})}},{view:"button",className:"delete",tooltip:A("Delete current query and all the descendants"),onClick(){ce(({nextGraph:G,last:ae,preLast:ne})=>{let re=ne.children?.indexOf(ae)??-1,Ee=ne.query;if(ne.children?.splice(re,1),ne.children?.length||(ne.children=void 0),G.current.pop(),G.current.length===0){let Ae=Math.max(0,Math.min(re-1,(G.children?.length||0)-1));G.current.push(Ae),Ee=G.children?.[Ae]?.query}return{query:Ee,graph:G}})}}]),B.append($("label",{class:"view-checkbox suggestions",tabindex:0},[M=$("input",{class:"live-update",type:"checkbox",checked:!0,onchange(){C.focus(),C.cm.showHint()}}),$("span","view-checkbox__label","suggestions")]),$("label",{class:"view-checkbox live-update",tabindex:0},[F=$("input",{class:"live-update",type:"checkbox",checked:!0,onchange({target:G}){C.focus(),G.checked&&e({query:C.getValue()},!0)}}),$("span","view-checkbox__label","process on input")])),n.view.attachTooltip(M.parentNode,A(()=>M.checked?"Query suggestions enabled<br>(click to disable)":"Query suggestions disabled<br>(click to enable)")),n.view.attachTooltip(F.parentNode,A(()=>F.checked?"Auto-perform query enabled<br>(click to disable)":"Auto-perform query disabled<br>(click to enable)")),n.view.render(B,{view:"button-primary",content:'text:"Process"',onClick:()=>{E=E.slice(0,v.current.length-1),e({query:C.getValue()},!0),n.scheduleRender("page")}}),H.addEventListener("click",({target:G})=>{let ae=G.closest(".query-path > *"),ne=[...H.children].indexOf(ae);ne!==-1&&ce(({nextGraph:re,currentPath:Ee,last:Ae})=>(Ae.query=h,re.current=re.current.slice(0,ne+1),{query:Ee[ne+1].query,graph:re}))}),te.addEventListener("click",({target:G})=>{let ae=G.dataset.path;typeof ae=="string"&&ae!==v.current.join(" ")&&ce(({nextGraph:ne,last:re})=>{let Ee=ae.split(" ").map(Number),Ae=Ha(ne,Ee),we=Ae[Ae.length-1],We=we.query,Te=we.view;return we.query=void 0,we.view=void 0,re.query=h,re.view=g,ne.current=Ee,{query:We,view:Te,graph:ne}})});function U(G,ae=!0,ne=!1){e(G,ne),ae&&setTimeout(()=>{C.focus(),C.cm.setCursor(C.cm.lineCount(),0)},0)}function ce(G){let ae=JSON.parse(JSON.stringify(v)),ne=Ha(ae,ae.current),re=ne[ne.length-1],Ee=ne[ne.length-2],Ae=G({nextGraph:ae,currentPath:ne,last:re,preLast:Ee});U(Ae,!0)}function xe(G){let ae=setTimeout(G,16);return()=>clearTimeout(ae)}function Le(G){O.innerHTML="",O.append($("div",{class:"query-input-data",tabindex:-1,onclick(){a=a==="data"?void 0:"data",_e(G)}},[$("span",{class:"query-input-variable","data-name":"input"},["@"]),G.state==="awaiting"?"Computing...":G.state==="canceled"?"Not available (undefined)":ff(G.data)]),$("div",{class:"query-input-context",tabindex:-1,onclick(){a=a==="context"?void 0:"context",_e(G)}},[$("span",{class:"query-input-variable","data-name":"context"},["#"]),G.state==="awaiting"?"Computing...":G.state==="canceled"?"Not available (undefined)":ff(G.context)])),_e(G)}function _e(G){if(C.inputPanelEl.classList.toggle("details-expanded",a!==void 0),O.dataset.details=a,a){let ae=G.state!=="awaiting"&&G.state!=="canceled"?G[a]:NaN;ae!==u&&(u=ae,G.state==="awaiting"?z.textContent="Computing...":G.state==="canceled"?z.textContent="Not available because one of ancestor queries failed":(z.innerHTML="",n.view.render(z,[{view:"struct",expanded:1}],u)))}else u=NaN,z.innerHTML=""}function et(G,ae,ne){let re=[$("span","query-output-message",Array.isArray(ne)?ne:[ne])];ae&&re.unshift($("span","query-output-prelude",[ae])),_.replaceChildren($("div",{class:"query-result-data"+(G.state==="failed"?" error":""),tabindex:-1,onclick(){f=!f,ht(G)}},re))}function Ke(G){switch(x&&(x.clear(),x=null),G.state){case"canceled":{C.setValue(G.query),et(G,"Result","Not available");break}case"awaiting":{C.setValue(G.query),et(G,null,"Avaiting...");break}case"computing":{C.setValue(G.query,G.data,G.context),et(G,null,"Computing...");break}case"successful":{C.setValue(G.query,G.data,G.context),et(G,"Result",[ff(G.computed),` in ${parseInt(G.duration,10)}ms`]);break}case"failed":{let{error:ae}=G,ne=ae?.details?.loc?.range,re=C.cm.doc;if(Array.isArray(ne)&&ne.length===2){let[Ee,Ae]=ne;x=ae.details?.token==="EOF"||Ee===Ae||G.query[Ee]===`
`?re.setBookmark(re.posFromIndex(Ee),{widget:$("span","discovery-editor-error"," ")}):re.markText(re.posFromIndex(Ee),re.posFromIndex(Ae),{className:"discovery-editor-error"})}C.setValue(G.query,G.data,G.context),et(G,"Error",[ae.message.split(/\n/)[0].replace(/^(Parse error|Bad input).+/s,"Parse error")]);break}}ht(G)}function ht(G){if(C.outputPanelEl.classList.toggle("details-expanded",f),f){let ae=G.state!=="awaiting"&&G.state!=="canceled"&&G.state!=="computing"?G.error||G.computed:NaN;if(ae!==d)switch(d=ae,G.state){case"awaiting":W.innerHTML='<div class="state-message">Awaiting for all of ancestor queries done<div>';break;case"canceled":W.innerHTML='<div class="state-message">Not available because one of ancestor queries failed<div>';break;case"failed":W.innerHTML='<div class="discovery-error query-error">'+Ue(G.error?.message||"")+"</div>";break;case"successful":W.innerHTML="",n.view.render(W,{view:"struct",expanded:1},d);break}}else d=NaN,W.innerHTML=""}function Pe(G){let ae=G.path.join(" "),ne=te.querySelector(`[data-path="${ae}"]`);ne&&(ne.dataset.state=G.state),E[v.current.length-1]===G&&(Le(G),Ke(G))}function ke(G,ae,ne,re=!1){T&&(T.cancel(),T.computation.state="canceled",T=null);let Ee=!1;if(re)for(let Ae=G;Ae<v.current.length;Ae++){let we=E[Ae];we.state!=="computing"&&Pe(we)}for(let Ae=G;Ae<v.current.length;Ae++){let we=E[Ae],We=Ae===v.current.length-1;if(we.state==="awaiting"&&(we.state="computing"),we.state==="failed"?Ee=!0:Ee&&(we.state="canceled"),we.state!=="computing"){if(ae=we.computed,ne=we.context,Pe(we),We)return Promise.resolve(we);continue}return new Promise((Te,$e)=>{we.data=ae,we.context=ne,Pe(we),T={computation:we,cancel:xe(()=>{let st=Date.now();T=null;try{we.computed=n.query(we.query,we.data,we.context),we.state="successful"}catch(it){we.error=it,we.state="failed"}we.duration=Date.now()-st,ke(Ae,ae,ne).then(Te,$e)})}})}return Promise.reject("No computation found")}function be(G,ae){let ne=Ha(v,v.current).slice(1),re=-1,Ee=null;for(let Ae=0;Ae<v.current.length;Ae++){let we=ne[Ae],We=E[Ae]||{},$e=Ae===v.current.length-1?h:we.query,st=v.current.slice(0,Ae+1);if(re===-1&&We.query===$e&&We.data===G&&We.context===ae&&String(We.path)===String(st)){G=We.computed,Ee=We.error;continue}let it=E[Ae]={state:"awaiting",path:v.current.slice(0,Ae+1),query:$e||"",data:void 0,context:void 0,computed:void 0,error:null,duration:0};if(Ee){it.state="canceled";continue}if(re===-1){re=Ae,it.state="computing",it.data=G,it.context=ae;continue}}return re!==-1?E.slice(re,v.current.length):[]}return{el:X,createSubquery:Q,appendToQuery(G){let ae=typeof h=="string"&&h.trimRight()!==""?h.replace(/(\n[ \t]*)*$/,()=>`
| `+G):G;U({query:ae},!0,!0)},perform(G,ae){let ne=Ra(ae,w),re=Li(ae),Ee=re.query,Ae=re.view,we=ub({...re.graph||o});N.classList.toggle("root",we.current.length<2),te.innerHTML="",wE(te,we,n),H.innerHTML="";for(let We of Ha(we,we.current).slice(1,-1))H.append($("div","query",We.query||""));return v=we,w=ne,h=Ee,g=Ae,be(G,ne),ke(0,G,ne,!0)}}}function qa(n){return!!(n&&n.nodeType===Node.TEXT_NODE)}function pf(n,e=`
`){let r="";for(let o of n.childNodes)!qa(o)&&o.previousSibling&&!qa(o.previousSibling)&&(r+=e),r+=xE(o,e);return r}function xE(n,e=`
`){switch(n.nodeType){case Node.ELEMENT_NODE:let[r,o=""]=n.cloneNode().outerHTML.split(/(?=<\/[^>]+>$)/);return r+(n.firstChild&&!qa(n.firstChild)?e+"  ":"")+pf(n,e+"  ")+(n.lastChild&&!qa(n.lastChild)?e:"")+o;case Node.TEXT_NODE:return n.nodeValue;case Node.COMMENT_NODE:return"<!--"+n.nodeValue+"-->";case Node.DOCUMENT_FRAGMENT_NODE:return pf(n,e)}return""}function fb(n,e){let r=[],o=[...Array.isArray(n.highlight)?n.highlight:n.highlight?[n.highlight]:[]];Array.isArray(n.highlightProps)&&o.push(`(")?(?:${n.highlightProps.join("|")})\\1(?=:)`);for(let a of o){let u=new RegExp(a,"gm"),f=null;for(;f=u.exec(e);)r.push({range:[f.index,f.index+f[0].length]})}return r}var hf=n=>(e,r)=>{let o=r.params?.render==="text"?"text":"web",a=[...n.view.values],u=[...n.textView.values];return{...r,render:o,views:{webViews:a,textViews:u,selected:o==="text"?u:a}}};function _a(n){let e={view:"context",modifiers:[{view:"switch",when:"beforeDemo",content:[{when:({beforeDemo:r})=>typeof r=="string",content:'html:"<p>" + beforeDemo + "</p>"'},{content:{view:"render",config:"beforeDemo",context:"{ __demoContext: true, ...(viewDef | { name, group, options }) }"}}]},{view:"block",when:"demo or view",className:"usage-render",postRender(r,{onInit:o},{demoFixed:a},u){a&&(r.classList.add("demo-fixed"),r.style.height=a+"px"),r.dataset.renderType=u.render,o(r,"root")},content:{view:"render",config:'demo or view | #.render != "text" ?: [{ view: "text-render", content: $ }, { view: "text-render-tree", when: false, content: $ }]',data:"demoData",context:"{ __demoContext: true, ...(viewDef | { name, group, options }) }"}},{view:"switch",when:"afterDemo",content:[{when:({afterDemo:r})=>typeof r=="string",content:'html:"<p>" + afterDemo + "</p>"'},{content:{view:"render",config:"afterDemo",context:"{ __demoContext: true, ...(viewDef | { name, group, options }) }"}}]}],content:{view:"tabs",when:"source != false",className:"usage-sources",name:"code",tabs:[{value:"config",text:"Config (JS)"},{value:"config-json",text:"Config (JSON)"},{value:"html",text:"Rendered HTML"}],content:{view:"switch",content:[{when:'#.code="config"',content:[{view:"expand",when:'"demoData" in $',header:'text:"Input data"',content:{view:"struct",expanded:2,data:"demoData"}},{view:"source",className:"first-tab",data:r=>{let o=Pn(r.demo||r.view);return{syntax:"discovery-view",content:o,refs:fb(r,o)}}}]},{when:'#.code="config-json"',content:[{view:"expand",when:'"demoData" in $',header:'text:"Input data"',content:{view:"struct",expanded:2,data:"demoData"}},{view:"source",data:r=>{let o=JSON.stringify(r.demo||r.view,null,4);return{syntax:"json",content:o,refs:fb(r,o)}}}]},{when:'#.code="html"',content:{view:"source",data:(r,o)=>({syntax:"html",content:pf(o.root)})}}]}}};return{view:"block",className:"discovery-view-usage",context:hf(n),data({name:r,options:o},a){let u=a.views.selected.filter(f=>f.options.usage===o.usage).map(f=>f.name);return u.includes(r)||u.unshift(r),a.viewDef={demo:{view:r,data:'"'+r+'"'},...typeof o.usage=="function"?o.usage(r,u):Array.isArray(o.usage)?{examples:o.usage}:o.usage,name:r,group:u,options:o}},content:["h1:name",e,{view:"list",data:"examples",whenData:!0,itemConfig:{className:"usage-section"},item:["h2{ anchor: true, data: title }",e]}]}}var db=`{
    view: 'struct',
    expanded: 1
}`,kE=[{name:"Table",content:Pn({view:"table"})},{name:"Auto-link list",content:Pn({view:"ol",item:"auto-link"})},{name:"Signature",content:Pn({view:"signature",expanded:2})},{name:"Text render",content:Pn({view:"text-render",content:["table"]})}];function CE(n,e,r){return $("div",{class:"discovery-editor-tab",onclick:()=>r({view:e})},n||"Untitled preset")}function pb(n,e){let r=n.view.ViewEditor,o=kE,a={},u,f,d,h,g,v=new r().on("change",E=>g.checked&&e({view:E},!0)),w=$("div","buttons"),x=$("div","form view-editor-form",[$("div","view-editor-form-header",[$("div","discovery-editor-tabs view-mode",h=["Default","Custom"].map(E=>$("div",{class:"discovery-editor-tab","data-mode":E.toLowerCase(),onclick(){this.classList.contains("active")?e({viewEditorHidden:!x.classList.contains("hide-editor")},!0):e({view:E==="Default"?void 0:db,viewEditorHidden:!1},!0)}},E==="Custom"?[E,$("span","show-view-editor-toggle")]:E))),$("div","discovery-editor-tabs presets",o.map(({name:E,content:M})=>CE(E,M,e))),$("div","view-editor-form-header-links",'<a href="#views-showcase" class="view-link">Views showcase</a>')]),$("div","view-editor-form-content",[$("button",{class:"view-button formatting",title:"Prettify (input should be a JSON)",onclick(){v.focus();try{let E=v.getValue().trim(),M=new Function("return 0,"+E)();e({view:Pn(M)})}catch(E){n.logger.error("View editor prettify failed:",E)}}}),v.el,$("div","editor-toolbar",[u=$("div","view-expand",[$("div",{class:"header",onclick(){u.classList.toggle("expanded"),d.classList.toggle("visible")}},[f=$("div","header-content"),$("div","trigger")]),d=$("div","view-editor-view-list")]),$("label","view-checkbox",[g=$("input",{class:"live-update",type:"checkbox",checked:!0,onchange(){this.checked&&e({view:v.getValue()},!0)}}),$("span","view-checkbox__label","build on input")]),w])])]);n.view.render(w,{view:"button-primary",content:'text:"Build"',onClick(){a={},e({view:v.getValue()},!0),n.scheduleRender("page")}}),new n.view.Popup({className:"view-editor-view-list-hint",hoverTriggers:".view-editor-view-list .item.with-usage",render(E,M){n.view.render(E,_a(n),n.view.get(M?.textContent),{})}}),f.textContent=`Available ${[...n.view.entries].filter(([,E])=>E.options.usage).length} views`;let T=()=>d.innerHTML='<a href="#views-showcase" class="view-link">Views showcase</a><br><br>'+[...n.view.entries].sort().map(([E,M])=>`<div><a class="item view-link${M.options.usage?" with-usage":""}" ${M.options.usage?'href="#views-showcase:'+E+'"':""}>${E}</a></div>`).join("");return T(),n.view.on("define",Ar(T,100)),{el:x,render(E,M,F){let D=Ra(M,a.context),C=Li(M),L=typeof C.view=="string"?"custom":"default",N=L==="default"||C.viewEditorHidden===!0,B=C.view,O=null;if(v.setValue(B),x.classList.toggle("hide-editor",N),h.forEach(z=>z.classList.toggle("active",z.dataset.mode===L)),!B&&L==="default"&&(B=db),a.view!==B||a.data!==E||a.context!==D){F.innerHTML="";try{O=Function("return "+(B?"0,"+B:"null"))(),n.view.render(F,O,E,D)}catch(z){n.view.render(F,_=>{_.className="discovery-error render-error",_.innerHTML=Ue(String(z))+"<br>(see details in console)",n.logger.error(z)})}a={data:E,context:D,view:B}}}}}function hb(n){function e(g,v){return n.setPageParams({...n.pageParams,...g},v)}function r(){if(f!==null)return f;let g=ab(n,e),v=cb(n,e),w=pb(n,e),x=$("div",{class:"discovery-editor discovery-hidden-in-dzen",hidden:!0},[v.el,w.el]),T=$("div","discovery-render-content"),E=[...g.el,x,T];return f={header:g,queryEditor:v,viewEditor:w,discoverEditorEl:x,discoverContentEl:T,layout:E}}function o(g){return g===h}function a(g,v){o(v)&&r().queryEditor.createSubquery(g)}function u(g,v){o(v)&&r().queryEditor.appendToQuery(g)}let f=null,d=null,h=NaN;n.on("pageStateChange",g=>{n.pageId!==g.id&&(n.pageId===n.discoveryPageId?(n.action.define("queryAcceptChanges",o),n.action.define("querySubquery",a),n.action.define("queryAppend",u)):(n.action.revoke("queryAcceptChanges"),n.action.revoke("querySubquery"),n.action.revoke("queryAppend")))}),n.page.define("discovery",function(g,v,w){let{header:x,queryEditor:T,viewEditor:E,discoverEditorEl:M,discoverContentEl:F}=r();M.hidden=w.params.noedit,x.render(v,w),h=NaN;let D=d=Symbol("last-query-request");T.perform(v,w).then(C=>{if(d===D){if(C.error){E.el.hidden=!0,F.hidden=!0;return}h=C.computed,E.el.hidden=!1,F.hidden=!1,E.render(h,w,F)}})},{reuseEl:!0,init(g){r().layout.forEach(v=>g.appendChild(v))},encodeParams:ib,decodeParams:ob})}var gb=`
## Working with views

In Discovery.js, presentations are organized as a tree of views. Views are defined using object notation, where the \`view\` property specifies the type, and additional properties allow further customization.

\`\`\`discovery-view
{
    view: "view-name"
}
\`\`\`

A view definition takes \`data\` and \`context\` values, which can be used to define properties and control rendering. Views can transform data and context (using the \`data\` and \`context\` properties) for use by the view and its descendant views, enabling clear data flow. Views are rendered by calling the render method:

\`\`\`js
discovery.render(containerEl, viewDefinition, data, context)
\`\`\`

Discovery.js is designed to be declarative. For dynamic calculations or event handling, [jora](https://discoveryjs.github.io/jora/) queries are preferred over JavaScript functions.

Each view can use the following properties:

- \`view\` (required) \u2014 Specifies the view type.
- \`when\` \u2014 Controls whether the view should be rendered. Evaluated before \`data\` transformation.
- \`context\` \u2014 Transforms the input context for the view and its nested views.
- \`data\` \u2014 Transforms the input data for the view and its nested views.
- \`whenData\` \u2014 Controls rendering based on the computed \`data\`. Evaluated after \`context\` and \`data\` are set.
- \`className\` \u2014 Adds CSS class name(s) to the root element of the view (see [ClassName](#!classname)).
- \`postRender\` \u2014 A function executed after rendering the view but before placing it in the DOM.
- \`tooltip\` \u2014 Sets up a tooltip for the view (only applicable to views with a container element, see [Tooltips](#!tooltips)).

The sequence of property evaluation during rendering (view render lifecycle):

\`\`\`
[start]               render(data, context)
 \\                          |     |
  * when()                  |     | stop rendering when value is falsy
  |\\                        |     |
  | * context() ------------|-----* (async) replace \`context\` with new value
  |  \\                      |     |
  |   * data() -------------*     | (async) replace \`data\` with new value
  |    \\                    |     |
  |     * whenData()        |     | stop rendering when value is falsy
  |     |\\                  |     |
  |     | * (render)        |     | (async) main render logic
  |     |  \\                |     |
  |     |   * postRender()  |     | do something once (render) is done
  |     |    \\              |     |
  |     |     * className() |     | compute className and apply to root element
  |     |      \\            V     V
  +-----+-----> * [finish render]
\`\`\`

- \`context\` and \`data\` \u2014 Modify the flow of context or data based on the provided value:
  - **String** \u2014 Treated as a jora query, and its result is used.
  - **Function** (\`fn(data, context)\`) \u2014 The result of the function invocation is used.
  - **Other values** \u2014 Directly used as a new value for data or context.
- \`when\` and \`whenData\` \u2014 Determine if a view should be rendered:
  - **String** \u2014 Treated as a jora query.
  - \`true\` \u2014 Evaluated as an empty query, meaning the data itself is tested for truthiness.
  - \`undefined\` \u2014 Treated as not specified, allowing rendering.
  - **Function** (\`fn(data, context)\`) or other values \u2014 Evaluated for truthiness.
  > Note: In jora, empty arrays and objects with no own keys are falsy, unlike JavaScript where they are truthy.

\`\`\`discovery-view
{
    view: 'list',
    data: 'some.list.sort(name asc)', // Fetch an array for the list view, based on current data
    whenData: 'size() > 0',  // Check if the array has elements, skip rendering if empty
    item: 'text:name' // Render each element as text, displaying the name
}
\`\`\`

## Computable property values

If a property starts with \`=\`, it indicates a jora query used to compute the property's value before a rendering.

\`\`\`discovery-view
{
    view: 'list',
    limit: '=size() <= 12 ? false : 10' // Dynamically computes the limit based on flow data
}
\`\`\`

> To pass a literal string that starts with \`=\`, use a query like \`'="=some string"'\`.

## Shorthand notations

Discovery.js supports shorthand notations for defining views, making the configuration more concise:

| Shorthand notation                      | Expanded form                                      |
| --------------------------------------- | -------------------------------------------------- |
| \`'name'\`                                | \`{ view: 'name' }\`                                 |
| \`'name:<query>'\`                        | \`{ view: 'name', data: '<query>' }\`                |
| \`'name{ foo: size() / 2, bar: "qux" }'\` | \`{ view: 'name', foo: '=size() / 2', bar: 'qux' }\` |

## Lists of views

Multiple views can be combined into a list using an array:

\`\`\`discovery-view
{
    view: 'list',
    item: [ // render two views as a content of a list item
        'text:name',
        { view: 'badge', data: 'something.size()' }
    ]
}
\`\`\`

## ClassName

The \`className\` property uses a sequence of transformations to convert its input into a final array of class names. This process can start from different input forms \u2014 such as a jora query, a function, a string, or an array \u2014 and move through each step until a definitive result is obtained. At each stage, the current value is examined and transformed if applicable; if not, the process continues to the next step:

1. **Jora Query (String Starting with \`=\`)**  
   If the initial value begins with \`=\`, it is treated as a jora query and compiled into a function. That function is then processed as described in the next step.

   \`\`\`discovery-view
   {
       view: "text",
       className: "=isValid ? 'valid' : 'invalid'"
   }
   \`\`\`
   <br>

2. **Function**  
   Once a function is available (either provided directly or obtained from a jora query) it is called with \`(data, context)\`. The return value can be a string or an array, otherwise discarded.

   \`\`\`discovery-view
   {
       view: "text",
       className: (data, context) => data.flag ? "highlighted" : null
   }
   \`\`\`
   <br>

3. **String**  
   Any string (obtained from the previous steps or provided directly) is trimmed and split by whitespace to produce an array of class names, excluding empty entries.

   \`\`\`discovery-view
   {
       view: "text",
       className: "primary emphasized"
   }
   \`\`\`
   <br>

4. **Array**  
   When the value is or becomes an array, each element is processed:
   - If an element is a function, it is called with \`(data, context)\` and its result replaces the function.
   - All falsy or empty results are removed.

   \`\`\`discovery-view
   {
       view: "text",
       className: [
           "base-class",
           data => data.error && "error-indicator",
           ""
       ]
   }
   \`\`\`

   If \`data.error\` is true, this may result in \`class="base-class error-indicator"\`. If \`data.error\` is false, the array would become \`["base-class", false, ""]\`, and after filtering out falsy and empty values, it results in \`class="base-class"\`.

If, after all steps, there are no valid class names, the \`class\` attribute is not applied. This cascading process ensures any initial input \u2014 jora query, function, string, or array \u2014 is consistently transformed into a meaningful final list of class names.

## Tooltips

Tooltips can be configured using a simple view definition or an object with additional settings. When the \`tooltip\` value is a view definition, it becomes the \`content\` of the tooltip.

\`\`\`discovery-view
{
    view: 'button',
    tooltip: 'md:"Some **content**"'
}
\`\`\`

\`\`\`discovery-view
{
    view: 'button',
    tooltip: {
        position: 'trigger',
        content: 'md:"Some **content**"'
    }
}
\`\`\`

| Tooltip value                     | Normalized tooltip config                      |
| --------------------------------- | ---------------------------------------------- |
| \`'shorthand-view-notation'\`       | \`{ content: 'shorthand-view-notation' }\`       |
| \`{ view: 'name', ... }\`           | \`{ content: { view: 'name', ... } }\`           |
| \`['view', { view: 'name', ... }]\` | \`{ content: ['view', { view: 'name', ... }] }\` |

Tooltip options:

- \`className\` \u2014 Additional class names for the tooltip element.
- \`position\` \u2014 Where the tooltip is positioned. Options are \`'trigger'\` or \`'pointer'\` (default).
- \`positionMode\` \u2014 Positioning mode. Options are \`'natural'\` (default) or \`'safe'\`.
- \`pointerOffsetX\` \u2014 Horizontal offset from the pointer (default: 3).
- \`pointerOffsetY\` \u2014 Vertical offset from the pointer (default: 3).
- \`showDelay\` \u2014 Delay before showing the tooltip. Options are \`true\` (300ms, default), \`false\` (0ms), a number, or a function that returns a boolean or numeric value.
- \`content\` \u2014 View configuration for tooltip content.
`;var mb=`
## Working with text views

Text views in Discovery.js adhere to the same underlying principles as standard web-based views but are simplified due to the constraints of textual representation (e.g., lack of interactivity and styling).

Text views are managed through the \`Model#textView\` interface, enabling text rendering for any model type (\`Model\`, \`ViewModel\`, \`ScriptModel\`, etc.):

\`\`\`js
model.textView.define('text-view-name', render);
// ...
const renderTree = model.textView.render(null, 'text-view-name:...', data, context);
const { text } = model.textView.serialize(renderTree);

console.log(text);
\`\`\`

Each text view supports a limited set of properties compared to regular views, but these retain the same semantics:

- \`view\` (required) \u2014 Specifies the view type.
- \`when\` \u2014 Controls whether the view should be rendered. Evaluated before \`data\` transformation.
- \`context\` \u2014 Transforms the input context for the view and its nested views.
- \`data\` \u2014 Transforms the input data for the view and its nested views.
- \`whenData\` \u2014 Controls rendering based on the computed \`data\`. Evaluated after \`context\` and \`data\` are set.

## Layout model

The text renderer builds a render tree composed of **box nodes** and **text nodes**.

- **Text nodes**: Represent direct text strings. Their values can include newline characters.
- **Box nodes**: Define the layout of their content and can optionally render a "border" around it. The content is generated by rendering child nodes, which can be a mix of box and text nodes. Box nodes support several display types:
    - \`inline\` \u2014 Inserts its content lines as-is.
    - \`inline-block\` \u2014 Ensures that whitespace is added before and after its content to prevent merging with adjacent boxes. If the content spans multiple lines, subsequent lines align with the first line.
    - \`line\` \u2014 Places the box's content on a new line within its parent box.
    - \`block\` \u2014 Similar to \`line\`, but also adds an extra empty line before and after the content when needed.

\`\`\`render:text
[
  'text:"\u2026text\u2026"',
  'inline:"<inline\\\\nwith multi-line\\\\ntext...>"',
  'text:"\u2026text\u2026"',
  'inline-block:"<inline-block\\\\nwith multi-line\\\\ntext...>"',
  'text:"\u2026text\u2026"',
  'line:"<line\\\\nwith multi-line\\\\ntext...>"',
  'text:"\u2026text\u2026"',
  'block:"<block\\\\nwith multi-line\\\\ntext...>"',
  'text:"\u2026text\u2026"'
]
\`\`\`

## Box border

A box border is an optional decorative frame that can be drawn around a box node\u2019s content. Although termed a "border", its appearance is highly customizable and might not resemble a traditional border. A border can consist of up to four sides \u2013 top, right, bottom, and left \u2013 and by default, boxes have no border.

There are slight differences in how vertical (left and right) and horizontal (top and bottom) borders are defined, though the corresponding pairs behave similarly.

### Vertical sides (left and right)

Left and right borders specify the characters to be prepended or appended to each line of the box\u2019s content, effectively drawing vertical lines along the sides. The value for these borders can be defined in several ways:

- **Falsy value:** A falsy value (e.g., \`null\`, empty string) means no border is drawn.
- **String:** A static string that is added to the beginning (for \`left\`) or end (for \`right\`) of each line. For the \`right\` border, lines are padded with spaces to ensure consistent line lengths.
- **Function:** A function with the signature \`(index, total) => string | undefined\` for fine-tuned control. This allows different characters for the first, middle, and last lines. For example:
  
  \`\`\`js
  const leftBorder = (index, total) =>
      total === 1 ? '[' :
      index === 0 ? '\u23A1' :
      index + 1 === total ? '\u23A3' : '\u23A2';
  \`\`\`
  
  If the function returns strings of varying lengths, they are padded with spaces (from the start for \`left\` and from the end for \`right\`) to equalize their lengths.
- **Array of strings:** An array of 1 to 4 strings representing \`start\`, \`middle\`, \`end\`, and \`single\` cases, respectively. For example:
  
  \`\`\`js
  const leftBorder = ['\u23A1', '\u23A2', '\u23A3', '['];
  \`\`\`

  This form is equivalent to a function that selects the appropriate border based on the line index and total number of lines:

  \`\`\`ts
  function borderLR(start: string, mid = start, end = mid, single = start) {
      return (idx: number, total: number) =>
          total === 1 ? single : idx === 0 ? start : idx + 1 === total ? end : mid;
  }
  \`\`\`

### Horizontal Sides (top and bottom)

Top and bottom borders define the first and last lines of the box after the left and right borders have been applied. Their value can be set in one of the following ways:

- **Falsy value:** No border is drawn if the value is falsy.
- **String:** A static string that is repeated to achieve the required total length (\`midLen + leftLen + rightLen\`).
- **Function:** A function with the signature \`(midLen, leftLen, rightLen) => string | undefined\` that returns a string. If the returned string is non-empty, it is truncated to match the total length. For example:

  \`\`\`js
  const topBorder = (midLength, leftLen, rightLen) =>
      \`\${<}\${''.padEnd(midLength + leftLen + rightLen, '-')}\${>}\`;
  \`\`\`

- **Array of strings:** An array of 1 to 3 strings representing \`start\`, \`middle\`, and \`end\` segments. This is equivalent to a function that constructs the border by concatenating the start, a repeated middle, and the end string. For example:
  
  \`\`\`js
  const topBorder = ['<', '-', '>'];
  \`\`\`

  This form is equivalent to a call the function:

  \`\`\`ts
  function borderTB(start: string, mid = start, end = mid) {
    return (m: number, l: number, r: number) =>
        \`\${start}\${''.padStart(m + l + r - start.length - end.length, mid)}\${end}\`;
  }
  \`\`\`

### Using borders in views

Most view definitions include a preset border that cannot be modified. However, any content can be wrapped in a basic box view (\`inline\`, \`inline-block\`, \`line\`, or \`block\`) to add a border.

For example, a full border definition using array notation for sides:

\`\`\`render:text
{
    view: 'inline-list',
    data: [1, 2, 3, 4, 5],
    item: {
        view: 'inline-block',
        data: '$seq:=>?[...$ - 1 | $seq(), "line " + $]:[];$seq().join("\\\\n")',
        border: {
            top: ['\u2190', '-', '\u2192'],
            left: ['\u2191 ', '|', '\u2193', '[ '],
            right: [' \u2191', '|', '\u2193', ' ]'],
            bottom: ['\u2190', '-', '\u2192']
        }
    }
}
\`\`\`

Borders can also be specified in a compact array notation following the TRBL (top, right, bottom, left) order, similar to CSS:

\`\`\`render:text
{
  view: 'block',
  border: ['T', 'R', 'B', 'L'],
  content: 'text:"    \\\\n "'
}
\`\`\`

If the bottom border element is undefined, it inherits the top border value (if defined). Similarly, if the left border is undefined while the right border is specified, the left border adopts the right border value. This mechanism allows you to define vertical and horizontal borders with just two elements.

\`\`\`render:text
{
  view: 'block',
  border: ['-', '|'],
  content: 'text:"    \\\\n "'
}
\`\`\`

The following example demonstrates the difference between \`undefined\` and a falsy value (such as \`null\`):

\`\`\`render:text
{
  view: 'block',
  border: [['+', '-', '+'], '|', undefined, null],
  content: 'text:"    \\\\n "'
}
\`\`\`

Each element in the concise notation accepts any value applicable for a side in object notation, i.e. a string, a function or array of strings.
`;var vb={view:"switch",content:[{when:'syntax="render:text"',content:{view:"block",className:"view-render",content:[{view:"block",className:"view-render__source",content:'source{ syntax: "discovery-view", source }'},{view:"block",className:"view-render__result",data:n=>({...n,config:{view:n.syntax==="render:text"?"text-render":"context",content:Function("return "+n.source)()}}),content:"render{ config }"}]}},{content:"source"}]};function yb(n){n.on("pageAnchorChange",e=>{if(n.pageId==="views-showcase"&&e&&!n.pageAnchor){let r=n.dom.content.querySelector(".page-views-showcase > .content");r&&(r.scrollTop=0)}}),n.page.define("views-showcase",{view:"context",context:hf(n),data:"#.views.selected",modifiers:[{view:"block",className:"sidebar",content:[{view:"block",className:"sidebar-header",content:[{view:"link",className:'="index-page-link" + (#.id ? " view-selected" : "")',href:'="".pageLink(#.page, #.params.render |? { render: $ })',text:"Intro"},{view:"context",content:{view:"toggle-group",className:"render-toggle",beforeToggles:'text:"Render:"',value:"=#.render",onChange(e){n.setPageParams(e==="text"?{render:"text"}:{})},data:[{value:"web"},{value:"text"}]}}]},{view:"content-filter",content:{view:"menu",name:"view",limit:!1,emptyText:"Nothing matched",item:"text-match:{ text: name, match: #.filter }",itemConfig:{postRender(e,r,o){e.dataset.name=o.name}},context:(e,r)=>({...r,selectedViewId:n.pageRef}),data:`
                                .[name ~= #.filter]
                                .sort(name asc)
                                .({ ..., disabled: no options.usage, selected: name = #.selectedViewId })
                            `}}]}],content:{view:"block",className:"content",data:"$[=> name=(#.view.name or #.id)]",content:{view:"switch",context(e,r){return n.overridePageHashStateWithAnchor({ref:e?.name,anchor:n.pageRef===(e?.name||null)?n.pageAnchor:null}),n.cancelScheduledRender(),setTimeout(()=>{let o=n.dom.root.querySelector("article > .view-block.sidebar .index-page-link"),a=n.dom.root.querySelector("article > .view-block.sidebar > .view-content-filter > .content");o&&o.classList.toggle("view-selected",n.pageRef),a&&(a.querySelector(":scope .view-menu-item.selected")?.classList?.remove("selected"),a.querySelector(`:scope .view-menu-item[data-name=${CSS.escape(e?.name)}]`)?.classList?.add("selected"))},50),{...r,id:n.pageRef}},content:[{when:"no $ and #.id",content:'alert-warning:"View \\"" + #.id + "\\" not found"'},{when:"no $",content:[`h1:#.render = "text" ? "Model's text views" : "Model's views"`,'alert:"\u2190 Select a view to get details"',{view:"markdown",when:'#.render = "web"',source:gb,codeConfig:vb},{view:"markdown",when:'#.render = "text"',source:mb,codeConfig:vb}]},{content:[_a(n)]}]}}},{sidebar:!1})}var DE=["nav","sidebar","page"],bb=()=>{},AE=n=>n,SE=n=>Object.fromEntries(n);function gf(n,e,r){r?n.dataset[e]=r:delete n.dataset[e]}function EE(n,e,r,o){let a=n.page.get(e)?.options;return a!==void 0&&ye(a,r)?a[r]:o}function wb(n,e,r,o){let a=EE(n,e,r,o);return typeof a=="function"?a:o}var Jo=class extends Bo{compact;colorScheme;inspectMode;view;nav;preset;page;#e;#t;defaultPageId;discoveryPageId;reportToDiscoveryRedirect;pageId;pageRef;pageParams;pageAnchor;pageHash;dom;queryExtensions;constructor(e){let{container:r,styles:o,extensions:a,logLevel:u,compact:f,darkmode:d="light-only",darkmodePersistent:h=!1,colorScheme:g=d,colorSchemePersistent:v=h,defaultPage:w,defaultPageId:x,discoveryPageId:T,reportToDiscoveryRedirect:E=!0,inspector:M=!1}=e||{};super({...e,logLevel:u||"perf",extensions:void 0}),("darkmode"in e||"darkmodePersistent"in e)&&this.logger.warn('ViewModel "darkmode" option is deprecated, use "colorScheme" instead'),this.compact=!!f,this.colorScheme=new ga(g,v),this.inspectMode=new At(!1),this.initDom(o),this.view=new ba(this),this.nav=new ya(this),this.preset=new xa(this.view),this.page=new wa(this,this.view),this.#e=new Set,this.#t=16,this.defaultPageId=x||"default",this.discoveryPageId=T||"discovery",this.reportToDiscoveryRedirect=!!E,this.pageId=this.defaultPageId,this.pageRef=null,this.pageParams={},this.pageAnchor=null,this.pageHash=this.encodePageHash(this.pageId,this.pageRef,this.pageParams,this.pageAnchor),this.apply(ja),this.apply(Wa),w&&this.page.define(this.defaultPageId,w),M&&this.apply(Ac),this.apply(a),this.setPageHash(this.pageHash),this.setContainer(r),this.scheduleRender();for(let{name:F,page:D}of this.objectMarkers.values)D&&!this.page.isDefined(D)&&this.logger.error(`Page reference "${D}" in object marker "${F}" doesn't exist`)}initRenderTriggers(){this.on("context",()=>this.scheduleRender()),this.on("unloadData",()=>this.scheduleRender()),this.on("pageStateChange",()=>this.scheduleRender("nav","page")),this.on("pageAnchorChange",()=>this.applyPageAnchor()),this.action.on("define",()=>this.scheduleRender("nav","page")).on("revoke",()=>this.scheduleRender("nav","page")),this.page.on("define",e=>{this.pageId===e&&(this.setPageHash(this.pageHash),this.scheduleRender("page"))})}async setData(e,r){let{render:o=!0}=r||{};await super.setData(e,r),o&&this.scheduleRender()}async setDataProgress(e,r,o){let{dataset:a,progressbar:u}=o||{};this.cancelScheduledRender(),this.emit("startSetData",(...f)=>u?.subscribeSync(...f)||(()=>{})),await u?.setState({stage:"prepare"}),await this.setData(e,{dataset:a,setPrepareWorkTitle:u?.setStateStep.bind(u),render:!1}),await u?.setState({stage:"initui"}),this.scheduleRender(),await Promise.all([this.dom.wrapper.parentNode?this.dom.ready:!0,this.enforceScheduledRenders()]),u?.finish()}initDom(e){let r=$("div","discovery"),o=r.attachShadow({mode:"open"}),a=o.appendChild($("div")),u=$("article"),f=$("div","discovery-nav discovery-hidden-in-dzen"),d=$("nav","discovery-sidebar discovery-hidden-in-dzen"),h=$("main","discovery-content",[u]),g=Oo(o,this.info.icon?e?.concat(`.discovery-root{--discovery-app-icon:url(${JSON.stringify(this.info.icon)}`):e);this.dom={ready:g,wrapper:r,root:o,container:a,nav:f,sidebar:d,content:h,pageContent:u,detachColorScheme:this.colorScheme.subscribe(v=>a.classList.toggle("discovery-root-darkmode",v==="dark"),!0)},a.classList.add("discovery-root","discovery"),a.append(f,d,h),o.addEventListener("click",v=>{let w=v.target?.closest("a");!w||w.getAttribute("target")||w.origin!==location.origin||w.pathname!==location.pathname||(v.preventDefault(),v.stopPropagation(),w.classList.contains("ignore-href")||this.setPageHash(w.hash)||this.applyPageAnchor())},!0)}setContainer(e){e instanceof HTMLElement?e.append(this.dom.wrapper):this.dom.wrapper.remove()}disposeDom(){typeof this.dom.detachColorScheme=="function"&&(this.dom.detachColorScheme(),this.dom.detachColorScheme=null),this.dom.container.remove(),this.dom=null}addGlobalEventListener(e,r,o){return document.addEventListener(e,r,o),()=>document.removeEventListener(e,r,o)}addHostElEventListener(e,r,o){let a=this.dom.container;return a.addEventListener(e,r,o),()=>a.removeEventListener(e,r,o)}scheduleRender(...e){let r=!1;e.length===0&&(r=!0,e=[...DE]);for(let o of e)this.#e.add(o);this.#e.timer&&clearTimeout(this.#e.timer),this.#e.timer=setTimeout(()=>this.enforceScheduledRenders(),this.#t),this.logger.debug(`Scheduled renders: ${[...this.#e].join(", ")} (requested: ${r?"all":e.join(", ")})`)}async enforceScheduledRenders(){let e=[...this.#e];this.logger.debug(`Enforce scheduled renders: ${e.join(", ")||"none"}`),this.cancelScheduledRender();for(let r of e)switch(r){case"nav":await this.renderNav();break;case"sidebar":await this.renderSidebar();break;case"page":await this.renderPage();break}this.initRenderTriggers!==bb&&(this.initRenderTriggers(),this.initRenderTriggers=bb,this.#t=0)}cancelScheduledRender(e){let r=[...this.#e];e?this.#e.delete(e):this.#e.clear(),this.#e.size===0&&this.#e.timer&&(clearTimeout(this.#e.timer),this.#e.timer=null),this.#e.size!==r.length&&this.logger.debug(`Canceled renders: ${r.join(", ")}`)}getRenderContext(){return{page:this.pageId,id:this.pageRef,params:this.pageParams,...this.getContext()}}renderNav(){return this.cancelScheduledRender("nav"),this.nav.render(this.dom.nav,this.data,this.getRenderContext())}renderSidebar(){if(this.cancelScheduledRender("sidebar"),this.hasDatasets()&&this.view.isDefined("sidebar")){let e=Date.now(),r=this.data,o=this.getRenderContext();return this.view.setViewRoot(this.dom.sidebar,"sidebar",{data:r,context:o}),this.dom.sidebar.innerHTML="",this.view.render(this.dom.sidebar,"sidebar",r,o).finally(()=>this.logger.perf(`Sidebar rendered in ${Date.now()-e}ms`))}}encodePageHash(e,r=null,o,a=null){let u=e||this.defaultPageId,d=wb(this,e,"encodeParams",AE)(o||{});return super.encodePageHash(u!==this.defaultPageId?u:"",r,d,a)}decodePageHash(e){let{pageId:r,pageRef:o,pageParams:a,pageAnchor:u}=super.decodePageHash(e,f=>wb(this,f||this.defaultPageId,"decodeParams",SE));return{pageId:r||this.defaultPageId,pageRef:o,pageParams:a,pageAnchor:u}}setPageHashState(e={},r=!1){return this.setPageHashStateWithAnchor({...e,anchor:null},r)}overridePageHashState(e,r=!1){return this.setPageHashState({...this.getPageHashState(),...e},r)}getPageHashState(){return{id:this.pageId,ref:this.pageRef,params:this.pageParams}}setPageHashStateWithAnchor(e,r=!1){let{id:o=null,ref:a=null,params:u={},anchor:f=null}=e;return this.setPageHash(this.encodePageHash(o||this.defaultPageId,a,u,f),r)}overridePageHashStateWithAnchor(e,r=!1){return this.setPageHashStateWithAnchor({...this.getPageHashStateWithAnchor(),...e},r)}getPageHashStateWithAnchor(){return{...this.getPageHashState(),anchor:this.pageAnchor}}setPage(e,r,o,a=!1){return this.setPageHashState({id:e,ref:r,params:o},a)}setPageRef(e=null,r=!1){return this.overridePageHashStateWithAnchor({ref:e},r)}setPageParams(e,r=!1){return this.overridePageHashStateWithAnchor({params:e},r)}setPageAnchor(e,r=!1){return this.overridePageHashStateWithAnchor({anchor:e},r)}setPageHash(e,r=!1){e.startsWith("#")||(e="#"+e),e.startsWith("#!")&&(e=this.stripAnchorFromHash(this.pageHash)+(e.length>2?"&!anchor="+e.slice(2):""));let{pageId:o,pageRef:a,pageParams:u,pageAnchor:f}=this.decodePageHash(e);if(this.reportToDiscoveryRedirect&&o==="report"&&this.discoveryPageId!=="report"&&setTimeout(()=>this.pageId==="report"&&this.setPageHashStateWithAnchor({id:this.discoveryPageId,ref:a,params:u,anchor:f},!0)),this.pageId!==o||this.pageRef!==a||!fa(this.pageParams,u)){let d=this.getPageHashState();this.pageId=o,this.pageRef=a,this.pageParams=u,this.emit("pageStateChange",d)}if(f!==this.pageAnchor){let d=this.pageAnchor;this.pageAnchor=f,this.emit("pageAnchorChange",d)}return e!==this.pageHash?(this.pageHash=e,this.emit("pageHashChange",r),!0):!1}applyPageAnchor(e=!1){let r=this.dom.pageContent;if(this.pageAnchor){let o=r.querySelector("#"+CSS.escape("!anchor:"+this.pageAnchor));if(o){let a=r.querySelector(".view-page-header");o.style.scrollMargin=a?a.offsetHeight+"px":"",o.scrollIntoView(!0)}}else e||(this.dom.content.scrollTop=0)}renderPage(){this.cancelScheduledRender("page");let{data:e,pageId:r,pageParams:o,compact:a}=this,u=this.getRenderContext();this.logger.debug(`Start page "${r}" rendering...`);let f=Date.now(),{pageEl:d,renderState:h,config:g}=this.page.render(this.dom.pageContent,r,e,u);return this.view.setViewRoot(d,`Page: ${r}`,{inspectable:!1,config:g,data:e,context:u}),this.dom.pageContent=d,gf(this.dom.container,"page",r),gf(this.dom.container,"dzen",!!o.dzen),gf(this.dom.container,"compact",!!a),h.then(async()=>{await this.dom.ready,this.applyPageAnchor(!0)}).catch(v=>{this.logger.error(`Page "${r}" render error:`,v)}),h.finally(()=>{this.logger.perf(`Page "${r}" render done in ${Date.now()-f}ms`)})}};var xb=n=>{let e="";n.nav.remove("index-page"),n.nav.remove("discovery-page"),n.on("data",()=>{n.defaultPageId!==n.discoveryPageId&&(e=n.defaultPageId,n.defaultPageId=n.discoveryPageId,n.setPageHash(n.pageHash,!0),n.cancelScheduledRender())}),n.on("unloadData",()=>{e!==n.defaultPageId&&(n.defaultPageId=e,n.setPageHash(n.pageHash,!0))})};var $a=Object.assign(Cb(),{setup:Cb}),kb=n=>/^\./.test(n);function Cb(n){return n={accept:"application/json,application/jsonxl,.json,.jsonxl",useAcceptForFilePicker:!1,dragdrop:!0,clipboard:!1,...n},function(e){let r=!!n.useAcceptForFilePicker,o=!!n.dragdrop,a=!!n.clipboard,u=String(n.accept),f=u.split(",");o&&(e.dom.container.addEventListener("drop",d=>{e.loadDataFromEvent(d)},!0),e.dom.container.addEventListener("dragover",d=>{d.stopPropagation(),d.preventDefault()},!0),document.addEventListener("paste",d=>{let{files:h}=d.clipboardData||{files:[]};h?.length>0&&e.loadDataFromEvent(d)})),e.preset.define("upload",[{view:"button-primary",text:'=`Open file${#.actions.uploadFile.fileExtensions |? " (" + join(", ") + ")" : "" | size() > 1 and size() <= 17 ?: "\u2026"}`',onClick:"=#.actions.uploadFile"},{view:"context",when:"#.actions.uploadDataFromClipboard",content:['html:"<span style=\\"color: #888; padding: 0 1ex\\"> or </span>"',{view:"button",text:"Paste from clipboard",onClick:"=#.actions.uploadDataFromClipboard"}]},{view:"context",when:"#.actions.uploadFile.dragdrop",content:['html:"<span style=\\"color: #888; padding: 0 1ex\\"> or </span>"','text:"drop a file on the page"']}]),e.action.define("unloadData",()=>{e.unloadData()}),e.action.define("uploadFile",Object.assign(()=>{$("input",{type:"file",accept:r?u:void 0,onchange:d=>e.loadDataFromEvent(d)}).click()},{fileExtensions:f.filter(d=>kb(d)),mimeTypes:f.filter(d=>!kb(d)),dragdrop:o,clipboard:a})),a&&e.action.define("uploadDataFromClipboard",async()=>{let d=await navigator.clipboard.readText();e.loadDataFromStream(new Blob([d]).stream())})}}var Mi=Object.assign(Sb(),{setup:Sb}),Db=()=>{},Ab=["primary","secondary","menu"],TE=["insert","prepend","append","before","after","replace","remove"];function mf(n,e,r){let o=Array.isArray(r)?r:[];return JSON.parse(JSON.stringify(n),(a,u)=>typeof u=="string"&&o.includes(u)?()=>e("navMethod",u):u)}function Sb(n){let e=n?.hostId||xi(),r=n?.postponeMessages,o=typeof n?.onNotify=="function"?n.onNotify:()=>{};return function(a){let u=null,f=Db,d=E=>{u?.finish(),u=null,E&&a.logger.debug("Cancel chunked data load from host with error:",E)},h=window.parent,g=new Map,v=(E,M)=>{let F={from:"discoveryjs-app",id:e,type:E,payload:M};h.postMessage(F,"*")},w=E=>{f=()=>{E!==null&&(f=Db,E())}},x=E=>{a.trackLoadDataProgress(E).catch(()=>{})},T=({data:E})=>{let{id:M,type:F,payload:D}=E||{};if(M===e)switch(F){case"notification":{let{name:C,details:L}=D;o(C,L);break}case"defineAction":{let C=D;a.action.define(C,(...L)=>new Promise((N,B)=>{let O=xi();g.set(O,{resolve:N,reject:B}),setTimeout(()=>{g.delete(O),B(new Error("Timeout"))},3e4),v("action",{callId:O,name:C,args:L})}));break}case"actionResult":{let{callId:C}=D;if(!g.has(C)){a.logger.error(`[Discovery.js] Unknown action call id "${C}"`);break}let{resolve:L,reject:N}=g.get(C);"error"in D?N(D.error):L(D.value);break}case"setPageHash":{let{replace:C,hash:L}=D||{};a.setPageHash(L||"",C||!1);break}case"setPageHashState":{let{replace:C,id:L,ref:N,params:B}=D||{};a.setPageHashState({id:L,ref:N,params:B},C);break}case"setPageHashStateWithAnchor":{let{replace:C,id:L,ref:N,params:B,anchor:O}=D||{};a.setPageHashStateWithAnchor({id:L,ref:N,params:B,anchor:O},C);break}case"setPage":{let{replace:C,id:L,ref:N,params:B}=D||{};a.setPage(L,N,B,C);break}case"setPageRef":{let{replace:C,ref:L}=D||{};a.setPageRef(L,C);break}case"setPageParams":{let{replace:C,params:L}=D||{};a.setPageParams(L,C);break}case"setPageAnchor":{let{replace:C,anchor:L}=D||{};a.setPageAnchor(L,C);break}case"setColorSchemeState":{let C=D;if(!ma.includes(C)){a.logger.warn(`Wrong value for colorScheme "${C}", supported values: ${ma.map(L=>JSON.stringify(L)).join(", ")}`);break}a.colorScheme.set(C);break}case"setRouterPreventLocationUpdate":{a.action.call("setPreventLocationUpdate",!!D);break}case"changeNavButtons":{let{section:C="primary",action:L="unknown"}=D;if(!Ab.includes(C)){a.logger.warn(`Wrong value for nav button place "${C}", supported values: ${Ab.map(N=>JSON.stringify(N)).join(", ")}`);break}switch(D.action){case"insert":{let{name:N,position:B,config:O,commands:z}=D;a.nav[C].insert(mf(O,v,z),B,N);break}case"prepend":case"append":{let{config:N,commands:B}=D;a.nav[C][D.action](mf(N,v,B));break}case"before":case"after":case"replace":{let{name:N,config:B,commands:O}=D;a.nav[C][D.action](N,mf(B,v,O));break}case"remove":{let{name:N}=D;a.nav[C].remove(N);break}default:a.logger.warn(`Wrong value for nav button action "${L}", supported values: ${TE.map(N=>JSON.stringify(N)).join(", ")}`)}break}case"unloadData":{d(),a.unloadData();break}case"dataStream":{let{stream:C,resource:L}=D;d(),x(Ao(C,{resource:L}));break}case"startChunkedDataUpload":{let{acceptToken:C,resource:L}=D;d(),u=Object.assign(Qu({resource:L}),{acceptToken:C}),x(u);break}case"cancelChunkedDataUpload":{let{acceptToken:C,error:L}=D;u?.acceptToken===C&&d(L)}case"dataChunk":{let{acceptToken:C}=D;if(u===null){a.logger.warn("Loading data is not inited");break}if(u.acceptToken!==C){a.logger.warn("Bad accept token");break}"value"in D&&D.value!==void 0&&u.push(D.value),"done"in D&&D.done&&d();break}default:a.logger.warn(`Got a post-message addressed to discovery app but with unknown "${F}" type`)}};h!==window&&(a.on("pageHashChange",E=>{v("pageHashChanged",{replace:E,hash:a.pageHash||"#",id:a.pageId,ref:a.pageRef,params:a.pageParams,anchor:a.pageAnchor})}),a.on("startLoadData",E=>{f(),w(E(M=>v("loadingState",M)))}),a.on("startSetData",E=>{f(),w(E(M=>v("loadingState",M)))}),a.on("data",()=>{v("data",null)}),a.on("unloadData",()=>{f(),v("unloadData",null)}),a.colorScheme.subscribe((E,M)=>v("colorSchemeChanged",{state:M,value:yi(M)})),Array.isArray(r)&&Promise.resolve().then(()=>{for(let E of r)T({data:E})}),addEventListener("message",T,!1),addEventListener("unload",()=>v("destroy",null),!1),v("ready",{page:{hash:a.pageHash||"#",id:a.pageId,ref:a.pageRef,params:a.pageParams,anchor:a.pageAnchor},colorScheme:{state:a.colorScheme.state,value:a.colorScheme.serializedValue}}))}}function vf(n){function e(){return Hc(o=>n.setPageHash(o),n.logger)}let r=e();n.setPageHash(location.hash),n.cancelScheduledRender(),n.action.define("permalink",o=>new URL(o,String(location)).href),n.action.define("setPreventLocationUpdate",(o=!0)=>{o?(r?.dispose(),r=null):r===null&&(r=e())}),n.on("pageHashChange",o=>r?.set(n.pageHash,o))}var Ni=(n,e)=>n!==void 0?n:e,Bi=class extends Jo{constructor(e={}){let r=[];r.push(eg),r.push(tg),r.push(ig),Ni(e.router,!0)&&r.push(vf),e.mode==="modelfree"&&r.push(xb),Ni(e.upload,!1)&&(r.push(e.upload===!0?$a:$a.setup(e.upload||{})),r.push(ng),r.push(rg)),Ni(e.inspector,!0)&&r.push(og),Ni(e.embed,!1)&&r.push(e.embed===!0?Mi:Mi.setup(e.embed||{})),super({container:document.body,...e,extensions:e.extensions?[r,e.extensions]:r,colorScheme:Ni(e.colorScheme??e.darkmode,"auto"),colorSchemePersistent:Ni(e.colorSchemePersistent??e.darkmodePersistent,!0)})}setLoadingState(e,r){let o=this.dom.loadingOverlay,{progressbar:a}=r||{};switch(e){case"init":{if(o.classList.remove("error","done"),a?.el.parentNode)return;o.replaceChildren(a?.el||"");break}case"success":{o.classList.add("done");break}case"error":{let u=r?.error,f=this.getRenderContext(),d={stage:a?.value.stage,errorText:String(u),errorMessage:u.message||String(u),errorStack:(u.stack||"").replace(/^Error:\s*(\S+Error:)/,"$1")},h=["app-header:#.model",{view:"block",className:"action-buttons",content:[{view:"preset/upload",when:this.preset.isDefined("upload")}]},{view:"block",className:ye(u,"renderContent")?"warning-message":"error-message",content:[{view:"block",className:"error-type-badge",postRender(g,v,w){w.stage&&(g.dataset.stage=` on ${w.stage}`)}},"h3:errorText",u.renderContent||'text:"(see details in the console)"']}];o.classList.add("error"),o.replaceChildren(),this.view.setViewRoot(o,"AppOverlay",{inspectable:!1,config:h,data:d,context:f}),this.view.render(o,h,d,f).then(()=>{this.logger.error(u),a?.setState({error:u})});break}}}async setDataProgress(e,r,o){let a=o?.dataset,u=o?.progressbar||this.progressbar({title:"Set data"});try{this.setLoadingState("init",{progressbar:u}),await super.setDataProgress(e,r,{dataset:a,progressbar:u}),this.setLoadingState("success")}catch(f){this.setLoadingState("error",{error:f,progressbar:u})}}progressbar(e){return new Er({domReady:this.dom.ready,onFinish:r=>this.logger.perf.groupCollapsed(`${e.title||"Load data"} (${r[r.length-1].duration}ms)`,()=>[...r.map(o=>`${o.title}: ${o.duration}ms`),`(await repaint: ${r.awaitRepaintPenaltyTime}ms)`]),...e})}async trackLoadDataProgress(e){let r=this.progressbar({title:e.title});this.cancelScheduledRender(),this.setLoadingState("init",{progressbar:r}),this.emit("startLoadData",r.subscribeSync.bind(r)),ta(e,r).then(o=>this.setDataProgress(o.data,null,{dataset:o,progressbar:r}),o=>this.setLoadingState("error",{error:o,progressbar:r})),await e.dataset}initDom(e){super.initDom(e),this.dom.container.append(this.dom.loadingOverlay=$("div","loading-overlay done"))}renderPage(){return document.title=this.info.name||document.title,super.renderPage()}};function FE(n){return new Er({domReady:n,onTiming:({title:e,duration:r})=>console.log(`[Discovery/preloader] ${e} \u2013 ${r}ms`)})}function LE(n){if(n&&!ye(Js,n))throw new Error(`dataSource "${n}" is not supported`)}function ME(n,e,r){let{darkmode:o,darkmodePersistent:a,colorScheme:u=o,colorSchemePersistent:f=a}=r,d=va(u,f);Rc(e,d)&&n.setAttribute("darkmode","")}yf.colorScheme=!0;function yf(n){n=n||{};let e=n.container||document.body,r=document.createElement("div"),o=r.attachShadow({mode:"open"}),a=n.dataSource;LE(a),ME(r,e,n);let u=n.data,f=u?a==="push"?Js.push(n.loadDataOptions):Js[a||"url"](n.data,n.loadDataOptions):{dataset:Promise.resolve(),state:void 0};if(u&&a==="push"){let{start:v,push:w,finish:x}=f;globalThis.discoveryLoader={start:v,push:w,finish(...T){delete globalThis.discoveryLoader,x(...T)}}}let d=Oo(o,n.styles),h=n.progressbar||FE(d),g=n.embed?NE(f.state):()=>{};return f.state&&ta(f,h).catch(()=>{}),o.append(h.el),e.append(r),Object.assign(f.dataset,{el:r,shadowRoot:o,progressbar:h,disposeEmbed:g})}function NE(n){let e=xi(),r=window.parent,o=[],a=(h,g)=>{let v={from:"discoveryjs-app",id:e,type:h,payload:g};r.postMessage(v,"*")},u=()=>a("destroy",null),f=h=>{let{id:g,type:v}=h.data||{};if(g===e)switch(v){case"defineAction":case"setPageHash":case"setRouterPreventLocationUpdate":{o.push(h.data);break}default:console.error(`[Discovery/preloader] Unknown preload message type "${v}"`)}};if(r===window)return;addEventListener("message",f,!1),addEventListener("unload",u,!1),a("preinit",{page:{hash:location.hash||"#"}});let d=n?n.subscribeSync(h=>{let{stage:g}=h;return(g==="error"||g==="received")&&d(),a("loadingState",h)}):()=>{};return()=>(removeEventListener("message",f,!1),removeEventListener("unload",u,!1),d(),u(),{hostId:e,postponeMessages:o})}var Eb="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",BE=new Uint8Array(256),Gj=new TextEncoder;for(let n=0;n<Eb.length;n++)BE[Eb.charCodeAt(n)]=n;var Tb=({darkmode:n,darkmodePersistent:e,colorScheme:r=n,colorSchemePersistent:o=e})=>yf.colorScheme?{colorScheme:r,colorSchemePersistent:o}:{darkmode:r,darkmodePersistent:o};function s4(n,e,r,o){let a=n.model,u={model:a},f=new Bi({name:a.name,version:a.version,description:a.description,icon:a.icon,mode:n.mode,styles:n.styles,...Tb(a),upload:a.upload,inspector:a.inspector,router:a.router,encodings:wp,context:u,setup:ql,extensions:[a.embed&&Mi.setup(r),!ql&&bp,...Cp]});n.mode==="multi"&&f.nav.menu.append({name:"switch-model",onClick:'=$handler:"openModelIndex".actionHandler(href); $hide: #.hide; $handler and => $hide() or $handler()',data:{text:"Switch model",href:n.indexUrl}});let d={progressbar:e,dataset:o};if(typeof f.setContext=="function"){if(o)return f.setDataProgress(o.data,null,d)}else return f.context=u,o?f.setDataProgress(o.data,u,d):f.scheduleRender()}export{s4 as default};
